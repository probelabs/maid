var nI=Object.create;var hp=Object.defineProperty;var iI=Object.getOwnPropertyDescriptor;var sI=Object.getOwnPropertyNames;var oI=Object.getPrototypeOf,aI=Object.prototype.hasOwnProperty;var Xn=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var T=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var lI=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of sI(e))!aI.call(t,i)&&i!==r&&hp(t,i,{get:()=>e[i],enumerable:!(n=iI(e,i))||n.enumerable});return t};var cI=(t,e,r)=>(r=t!=null?nI(oI(t)):{},lI(e||!t||!t.__esModule?hp(r,"default",{value:t,enumerable:!0}):r,t));var KE=T((Tde,FE)=>{function hq(){this.__data__=[],this.size=0}FE.exports=hq});var _n=T((Ode,GE)=>{function fq(t,e){return t===e||t!==t&&e!==e}GE.exports=fq});var So=T((Lde,jE)=>{var dq=_n();function pq(t,e){for(var r=t.length;r--;)if(dq(t[r][0],e))return r;return-1}jE.exports=pq});var HE=T((Ade,WE)=>{var mq=So(),gq=Array.prototype,xq=gq.splice;function Eq(t){var e=this.__data__,r=mq(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():xq.call(e,r,1),--this.size,!0}WE.exports=Eq});var VE=T((bde,zE)=>{var yq=So();function Sq(t){var e=this.__data__,r=yq(e,t);return r<0?void 0:e[r][1]}zE.exports=Sq});var YE=T((Nde,QE)=>{var Tq=So();function Oq(t){return Tq(this.__data__,t)>-1}QE.exports=Oq});var ZE=T((kde,XE)=>{var Lq=So();function Aq(t,e){var r=this.__data__,n=Lq(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}XE.exports=Aq});var To=T((Cde,JE)=>{var bq=KE(),Nq=HE(),kq=VE(),Cq=YE(),vq=ZE();function Zi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Zi.prototype.clear=bq;Zi.prototype.delete=Nq;Zi.prototype.get=kq;Zi.prototype.has=Cq;Zi.prototype.set=vq;JE.exports=Zi});var ty=T((vde,ey)=>{var Iq=To();function wq(){this.__data__=new Iq,this.size=0}ey.exports=wq});var ny=T((Ide,ry)=>{function Rq(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}ry.exports=Rq});var sy=T((wde,iy)=>{function Mq(t){return this.__data__.get(t)}iy.exports=Mq});var ay=T((Rde,oy)=>{function Uq(t){return this.__data__.has(t)}oy.exports=Uq});var Lf=T((Mde,ly)=>{var _q=typeof global=="object"&&global&&global.Object===Object&&global;ly.exports=_q});var Bt=T((Ude,cy)=>{var Pq=Lf(),qq=typeof self=="object"&&self&&self.Object===Object&&self,Dq=Pq||qq||Function("return this")();cy.exports=Dq});var Pn=T((_de,uy)=>{var $q=Bt(),Bq=$q.Symbol;uy.exports=Bq});var py=T((Pde,dy)=>{var hy=Pn(),fy=Object.prototype,Fq=fy.hasOwnProperty,Kq=fy.toString,Oo=hy?hy.toStringTag:void 0;function Gq(t){var e=Fq.call(t,Oo),r=t[Oo];try{t[Oo]=void 0;var n=!0}catch{}var i=Kq.call(t);return n&&(e?t[Oo]=r:delete t[Oo]),i}dy.exports=Gq});var gy=T((qde,my)=>{var jq=Object.prototype,Wq=jq.toString;function Hq(t){return Wq.call(t)}my.exports=Hq});var ln=T((Dde,yy)=>{var xy=Pn(),zq=py(),Vq=gy(),Qq="[object Null]",Yq="[object Undefined]",Ey=xy?xy.toStringTag:void 0;function Xq(t){return t==null?t===void 0?Yq:Qq:Ey&&Ey in Object(t)?zq(t):Vq(t)}yy.exports=Xq});var vt=T(($de,Sy)=>{function Zq(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}Sy.exports=Zq});var Ji=T((Bde,Ty)=>{var Jq=ln(),eD=vt(),tD="[object AsyncFunction]",rD="[object Function]",nD="[object GeneratorFunction]",iD="[object Proxy]";function sD(t){if(!eD(t))return!1;var e=Jq(t);return e==rD||e==nD||e==tD||e==iD}Ty.exports=sD});var Ly=T((Fde,Oy)=>{var oD=Bt(),aD=oD["__core-js_shared__"];Oy.exports=aD});var Ny=T((Kde,by)=>{var Af=Ly(),Ay=(function(){var t=/[^.]+$/.exec(Af&&Af.keys&&Af.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function lD(t){return!!Ay&&Ay in t}by.exports=lD});var bf=T((Gde,ky)=>{var cD=Function.prototype,uD=cD.toString;function hD(t){if(t!=null){try{return uD.call(t)}catch{}try{return t+""}catch{}}return""}ky.exports=hD});var vy=T((jde,Cy)=>{var fD=Ji(),dD=Ny(),pD=vt(),mD=bf(),gD=/[\\^$.*+?()[\]{}|]/g,xD=/^\[object .+?Constructor\]$/,ED=Function.prototype,yD=Object.prototype,SD=ED.toString,TD=yD.hasOwnProperty,OD=RegExp("^"+SD.call(TD).replace(gD,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function LD(t){if(!pD(t)||dD(t))return!1;var e=fD(t)?OD:xD;return e.test(mD(t))}Cy.exports=LD});var wy=T((Wde,Iy)=>{function AD(t,e){return t?.[e]}Iy.exports=AD});var cn=T((Hde,Ry)=>{var bD=vy(),ND=wy();function kD(t,e){var r=ND(t,e);return bD(r)?r:void 0}Ry.exports=kD});var Sc=T((zde,My)=>{var CD=cn(),vD=Bt(),ID=CD(vD,"Map");My.exports=ID});var Lo=T((Vde,Uy)=>{var wD=cn(),RD=wD(Object,"create");Uy.exports=RD});var qy=T((Qde,Py)=>{var _y=Lo();function MD(){this.__data__=_y?_y(null):{},this.size=0}Py.exports=MD});var $y=T((Yde,Dy)=>{function UD(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}Dy.exports=UD});var Fy=T((Xde,By)=>{var _D=Lo(),PD="__lodash_hash_undefined__",qD=Object.prototype,DD=qD.hasOwnProperty;function $D(t){var e=this.__data__;if(_D){var r=e[t];return r===PD?void 0:r}return DD.call(e,t)?e[t]:void 0}By.exports=$D});var Gy=T((Zde,Ky)=>{var BD=Lo(),FD=Object.prototype,KD=FD.hasOwnProperty;function GD(t){var e=this.__data__;return BD?e[t]!==void 0:KD.call(e,t)}Ky.exports=GD});var Wy=T((Jde,jy)=>{var jD=Lo(),WD="__lodash_hash_undefined__";function HD(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=jD&&e===void 0?WD:e,this}jy.exports=HD});var zy=T((epe,Hy)=>{var zD=qy(),VD=$y(),QD=Fy(),YD=Gy(),XD=Wy();function es(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}es.prototype.clear=zD;es.prototype.delete=VD;es.prototype.get=QD;es.prototype.has=YD;es.prototype.set=XD;Hy.exports=es});var Yy=T((tpe,Qy)=>{var Vy=zy(),ZD=To(),JD=Sc();function e$(){this.size=0,this.__data__={hash:new Vy,map:new(JD||ZD),string:new Vy}}Qy.exports=e$});var Zy=T((rpe,Xy)=>{function t$(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}Xy.exports=t$});var Ao=T((npe,Jy)=>{var r$=Zy();function n$(t,e){var r=t.__data__;return r$(e)?r[typeof e=="string"?"string":"hash"]:r.map}Jy.exports=n$});var tS=T((ipe,eS)=>{var i$=Ao();function s$(t){var e=i$(this,t).delete(t);return this.size-=e?1:0,e}eS.exports=s$});var nS=T((spe,rS)=>{var o$=Ao();function a$(t){return o$(this,t).get(t)}rS.exports=a$});var sS=T((ope,iS)=>{var l$=Ao();function c$(t){return l$(this,t).has(t)}iS.exports=c$});var aS=T((ape,oS)=>{var u$=Ao();function h$(t,e){var r=u$(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}oS.exports=h$});var Tc=T((lpe,lS)=>{var f$=Yy(),d$=tS(),p$=nS(),m$=sS(),g$=aS();function ts(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ts.prototype.clear=f$;ts.prototype.delete=d$;ts.prototype.get=p$;ts.prototype.has=m$;ts.prototype.set=g$;lS.exports=ts});var uS=T((cpe,cS)=>{var x$=To(),E$=Sc(),y$=Tc(),S$=200;function T$(t,e){var r=this.__data__;if(r instanceof x$){var n=r.__data__;if(!E$||n.length<S$-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new y$(n)}return r.set(t,e),this.size=r.size,this}cS.exports=T$});var bo=T((upe,hS)=>{var O$=To(),L$=ty(),A$=ny(),b$=sy(),N$=ay(),k$=uS();function rs(t){var e=this.__data__=new O$(t);this.size=e.size}rs.prototype.clear=L$;rs.prototype.delete=A$;rs.prototype.get=b$;rs.prototype.has=N$;rs.prototype.set=k$;hS.exports=rs});var Oc=T((hpe,fS)=>{function C$(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}fS.exports=C$});var Nf=T((fpe,dS)=>{var v$=cn(),I$=(function(){try{var t=v$(Object,"defineProperty");return t({},"",{}),t}catch{}})();dS.exports=I$});var No=T((dpe,mS)=>{var pS=Nf();function w$(t,e,r){e=="__proto__"&&pS?pS(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}mS.exports=w$});var ko=T((ppe,gS)=>{var R$=No(),M$=_n(),U$=Object.prototype,_$=U$.hasOwnProperty;function P$(t,e,r){var n=t[e];(!(_$.call(t,e)&&M$(n,r))||r===void 0&&!(e in t))&&R$(t,e,r)}gS.exports=P$});var ns=T((mpe,xS)=>{var q$=ko(),D$=No();function $$(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(r[a],t[a],a,r,t):void 0;c===void 0&&(c=t[a]),i?D$(r,a,c):q$(r,a,c)}return r}xS.exports=$$});var yS=T((gpe,ES)=>{function B$(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}ES.exports=B$});var Qt=T((xpe,SS)=>{function F$(t){return t!=null&&typeof t=="object"}SS.exports=F$});var OS=T((Epe,TS)=>{var K$=ln(),G$=Qt(),j$="[object Arguments]";function W$(t){return G$(t)&&K$(t)==j$}TS.exports=W$});var is=T((ype,bS)=>{var LS=OS(),H$=Qt(),AS=Object.prototype,z$=AS.hasOwnProperty,V$=AS.propertyIsEnumerable,Q$=LS((function(){return arguments})())?LS:function(t){return H$(t)&&z$.call(t,"callee")&&!V$.call(t,"callee")};bS.exports=Q$});var $e=T((Spe,NS)=>{var Y$=Array.isArray;NS.exports=Y$});var CS=T((Tpe,kS)=>{function X$(){return!1}kS.exports=X$});var qn=T((Co,ss)=>{var Z$=Bt(),J$=CS(),wS=typeof Co=="object"&&Co&&!Co.nodeType&&Co,vS=wS&&typeof ss=="object"&&ss&&!ss.nodeType&&ss,eB=vS&&vS.exports===wS,IS=eB?Z$.Buffer:void 0,tB=IS?IS.isBuffer:void 0,rB=tB||J$;ss.exports=rB});var vo=T((Ope,RS)=>{var nB=9007199254740991,iB=/^(?:0|[1-9]\d*)$/;function sB(t,e){var r=typeof t;return e=e??nB,!!e&&(r=="number"||r!="symbol"&&iB.test(t))&&t>-1&&t%1==0&&t<e}RS.exports=sB});var Lc=T((Lpe,MS)=>{var oB=9007199254740991;function aB(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=oB}MS.exports=aB});var _S=T((Ape,US)=>{var lB=ln(),cB=Lc(),uB=Qt(),hB="[object Arguments]",fB="[object Array]",dB="[object Boolean]",pB="[object Date]",mB="[object Error]",gB="[object Function]",xB="[object Map]",EB="[object Number]",yB="[object Object]",SB="[object RegExp]",TB="[object Set]",OB="[object String]",LB="[object WeakMap]",AB="[object ArrayBuffer]",bB="[object DataView]",NB="[object Float32Array]",kB="[object Float64Array]",CB="[object Int8Array]",vB="[object Int16Array]",IB="[object Int32Array]",wB="[object Uint8Array]",RB="[object Uint8ClampedArray]",MB="[object Uint16Array]",UB="[object Uint32Array]",Se={};Se[NB]=Se[kB]=Se[CB]=Se[vB]=Se[IB]=Se[wB]=Se[RB]=Se[MB]=Se[UB]=!0;Se[hB]=Se[fB]=Se[AB]=Se[dB]=Se[bB]=Se[pB]=Se[mB]=Se[gB]=Se[xB]=Se[EB]=Se[yB]=Se[SB]=Se[TB]=Se[OB]=Se[LB]=!1;function _B(t){return uB(t)&&cB(t.length)&&!!Se[lB(t)]}US.exports=_B});var Io=T((bpe,PS)=>{function PB(t){return function(e){return t(e)}}PS.exports=PB});var Ac=T((wo,os)=>{var qB=Lf(),qS=typeof wo=="object"&&wo&&!wo.nodeType&&wo,Ro=qS&&typeof os=="object"&&os&&!os.nodeType&&os,DB=Ro&&Ro.exports===qS,kf=DB&&qB.process,$B=(function(){try{var t=Ro&&Ro.require&&Ro.require("util").types;return t||kf&&kf.binding&&kf.binding("util")}catch{}})();os.exports=$B});var as=T((Npe,BS)=>{var BB=_S(),FB=Io(),DS=Ac(),$S=DS&&DS.isTypedArray,KB=$S?FB($S):BB;BS.exports=KB});var Cf=T((kpe,FS)=>{var GB=yS(),jB=is(),WB=$e(),HB=qn(),zB=vo(),VB=as(),QB=Object.prototype,YB=QB.hasOwnProperty;function XB(t,e){var r=WB(t),n=!r&&jB(t),i=!r&&!n&&HB(t),s=!r&&!n&&!i&&VB(t),o=r||n||i||s,a=o?GB(t.length,String):[],c=a.length;for(var u in t)(e||YB.call(t,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||zB(u,c)))&&a.push(u);return a}FS.exports=XB});var Mo=T((Cpe,KS)=>{var ZB=Object.prototype;function JB(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||ZB;return t===r}KS.exports=JB});var vf=T((vpe,GS)=>{function e2(t,e){return function(r){return t(e(r))}}GS.exports=e2});var WS=T((Ipe,jS)=>{var t2=vf(),r2=t2(Object.keys,Object);jS.exports=r2});var bc=T((wpe,HS)=>{var n2=Mo(),i2=WS(),s2=Object.prototype,o2=s2.hasOwnProperty;function a2(t){if(!n2(t))return i2(t);var e=[];for(var r in Object(t))o2.call(t,r)&&r!="constructor"&&e.push(r);return e}HS.exports=a2});var dr=T((Rpe,zS)=>{var l2=Ji(),c2=Lc();function u2(t){return t!=null&&c2(t.length)&&!l2(t)}zS.exports=u2});var wr=T((Mpe,VS)=>{var h2=Cf(),f2=bc(),d2=dr();function p2(t){return d2(t)?h2(t):f2(t)}VS.exports=p2});var YS=T((Upe,QS)=>{var m2=ns(),g2=wr();function x2(t,e){return t&&m2(e,g2(e),t)}QS.exports=x2});var ZS=T((_pe,XS)=>{function E2(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}XS.exports=E2});var eT=T((Ppe,JS)=>{var y2=vt(),S2=Mo(),T2=ZS(),O2=Object.prototype,L2=O2.hasOwnProperty;function A2(t){if(!y2(t))return T2(t);var e=S2(t),r=[];for(var n in t)n=="constructor"&&(e||!L2.call(t,n))||r.push(n);return r}JS.exports=A2});var un=T((qpe,tT)=>{var b2=Cf(),N2=eT(),k2=dr();function C2(t){return k2(t)?b2(t,!0):N2(t)}tT.exports=C2});var nT=T((Dpe,rT)=>{var v2=ns(),I2=un();function w2(t,e){return t&&v2(e,I2(e),t)}rT.exports=w2});var If=T((Uo,ls)=>{var R2=Bt(),aT=typeof Uo=="object"&&Uo&&!Uo.nodeType&&Uo,iT=aT&&typeof ls=="object"&&ls&&!ls.nodeType&&ls,M2=iT&&iT.exports===aT,sT=M2?R2.Buffer:void 0,oT=sT?sT.allocUnsafe:void 0;function U2(t,e){if(e)return t.slice();var r=t.length,n=oT?oT(r):new t.constructor(r);return t.copy(n),n}ls.exports=U2});var wf=T(($pe,lT)=>{function _2(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}lT.exports=_2});var Rf=T((Bpe,cT)=>{function P2(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}cT.exports=P2});var Mf=T((Fpe,uT)=>{function q2(){return[]}uT.exports=q2});var Nc=T((Kpe,fT)=>{var D2=Rf(),$2=Mf(),B2=Object.prototype,F2=B2.propertyIsEnumerable,hT=Object.getOwnPropertySymbols,K2=hT?function(t){return t==null?[]:(t=Object(t),D2(hT(t),function(e){return F2.call(t,e)}))}:$2;fT.exports=K2});var pT=T((Gpe,dT)=>{var G2=ns(),j2=Nc();function W2(t,e){return G2(t,j2(t),e)}dT.exports=W2});var kc=T((jpe,mT)=>{function H2(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}mT.exports=H2});var _o=T((Wpe,gT)=>{var z2=vf(),V2=z2(Object.getPrototypeOf,Object);gT.exports=V2});var Uf=T((Hpe,xT)=>{var Q2=kc(),Y2=_o(),X2=Nc(),Z2=Mf(),J2=Object.getOwnPropertySymbols,eF=J2?function(t){for(var e=[];t;)Q2(e,X2(t)),t=Y2(t);return e}:Z2;xT.exports=eF});var yT=T((zpe,ET)=>{var tF=ns(),rF=Uf();function nF(t,e){return tF(t,rF(t),e)}ET.exports=nF});var _f=T((Vpe,ST)=>{var iF=kc(),sF=$e();function oF(t,e,r){var n=e(t);return sF(t)?n:iF(n,r(t))}ST.exports=oF});var Pf=T((Qpe,TT)=>{var aF=_f(),lF=Nc(),cF=wr();function uF(t){return aF(t,cF,lF)}TT.exports=uF});var LT=T((Ype,OT)=>{var hF=_f(),fF=Uf(),dF=un();function pF(t){return hF(t,dF,fF)}OT.exports=pF});var bT=T((Xpe,AT)=>{var mF=cn(),gF=Bt(),xF=mF(gF,"DataView");AT.exports=xF});var kT=T((Zpe,NT)=>{var EF=cn(),yF=Bt(),SF=EF(yF,"Promise");NT.exports=SF});var qf=T((Jpe,CT)=>{var TF=cn(),OF=Bt(),LF=TF(OF,"Set");CT.exports=LF});var IT=T((eme,vT)=>{var AF=cn(),bF=Bt(),NF=AF(bF,"WeakMap");vT.exports=NF});var $n=T((tme,qT)=>{var Df=bT(),$f=Sc(),Bf=kT(),Ff=qf(),Kf=IT(),PT=ln(),cs=bf(),wT="[object Map]",kF="[object Object]",RT="[object Promise]",MT="[object Set]",UT="[object WeakMap]",_T="[object DataView]",CF=cs(Df),vF=cs($f),IF=cs(Bf),wF=cs(Ff),RF=cs(Kf),Dn=PT;(Df&&Dn(new Df(new ArrayBuffer(1)))!=_T||$f&&Dn(new $f)!=wT||Bf&&Dn(Bf.resolve())!=RT||Ff&&Dn(new Ff)!=MT||Kf&&Dn(new Kf)!=UT)&&(Dn=function(t){var e=PT(t),r=e==kF?t.constructor:void 0,n=r?cs(r):"";if(n)switch(n){case CF:return _T;case vF:return wT;case IF:return RT;case wF:return MT;case RF:return UT}return e});qT.exports=Dn});var $T=T((rme,DT)=>{var MF=Object.prototype,UF=MF.hasOwnProperty;function _F(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&UF.call(t,"index")&&(r.index=t.index,r.input=t.input),r}DT.exports=_F});var Gf=T((nme,BT)=>{var PF=Bt(),qF=PF.Uint8Array;BT.exports=qF});var Cc=T((ime,KT)=>{var FT=Gf();function DF(t){var e=new t.constructor(t.byteLength);return new FT(e).set(new FT(t)),e}KT.exports=DF});var jT=T((sme,GT)=>{var $F=Cc();function BF(t,e){var r=e?$F(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}GT.exports=BF});var HT=T((ome,WT)=>{var FF=/\w*$/;function KF(t){var e=new t.constructor(t.source,FF.exec(t));return e.lastIndex=t.lastIndex,e}WT.exports=KF});var XT=T((ame,YT)=>{var zT=Pn(),VT=zT?zT.prototype:void 0,QT=VT?VT.valueOf:void 0;function GF(t){return QT?Object(QT.call(t)):{}}YT.exports=GF});var jf=T((lme,ZT)=>{var jF=Cc();function WF(t,e){var r=e?jF(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}ZT.exports=WF});var eO=T((cme,JT)=>{var HF=Cc(),zF=jT(),VF=HT(),QF=XT(),YF=jf(),XF="[object Boolean]",ZF="[object Date]",JF="[object Map]",eK="[object Number]",tK="[object RegExp]",rK="[object Set]",nK="[object String]",iK="[object Symbol]",sK="[object ArrayBuffer]",oK="[object DataView]",aK="[object Float32Array]",lK="[object Float64Array]",cK="[object Int8Array]",uK="[object Int16Array]",hK="[object Int32Array]",fK="[object Uint8Array]",dK="[object Uint8ClampedArray]",pK="[object Uint16Array]",mK="[object Uint32Array]";function gK(t,e,r){var n=t.constructor;switch(e){case sK:return HF(t);case XF:case ZF:return new n(+t);case oK:return zF(t,r);case aK:case lK:case cK:case uK:case hK:case fK:case dK:case pK:case mK:return YF(t,r);case JF:return new n;case eK:case nK:return new n(t);case tK:return VF(t);case rK:return new n;case iK:return QF(t)}}JT.exports=gK});var Wf=T((ume,rO)=>{var xK=vt(),tO=Object.create,EK=(function(){function t(){}return function(e){if(!xK(e))return{};if(tO)return tO(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})();rO.exports=EK});var Hf=T((hme,nO)=>{var yK=Wf(),SK=_o(),TK=Mo();function OK(t){return typeof t.constructor=="function"&&!TK(t)?yK(SK(t)):{}}nO.exports=OK});var sO=T((fme,iO)=>{var LK=$n(),AK=Qt(),bK="[object Map]";function NK(t){return AK(t)&&LK(t)==bK}iO.exports=NK});var cO=T((dme,lO)=>{var kK=sO(),CK=Io(),oO=Ac(),aO=oO&&oO.isMap,vK=aO?CK(aO):kK;lO.exports=vK});var hO=T((pme,uO)=>{var IK=$n(),wK=Qt(),RK="[object Set]";function MK(t){return wK(t)&&IK(t)==RK}uO.exports=MK});var mO=T((mme,pO)=>{var UK=hO(),_K=Io(),fO=Ac(),dO=fO&&fO.isSet,PK=dO?_K(dO):UK;pO.exports=PK});var zf=T((gme,yO)=>{var qK=bo(),DK=Oc(),$K=ko(),BK=YS(),FK=nT(),KK=If(),GK=wf(),jK=pT(),WK=yT(),HK=Pf(),zK=LT(),VK=$n(),QK=$T(),YK=eO(),XK=Hf(),ZK=$e(),JK=qn(),eG=cO(),tG=vt(),rG=mO(),nG=wr(),iG=un(),sG=1,oG=2,aG=4,gO="[object Arguments]",lG="[object Array]",cG="[object Boolean]",uG="[object Date]",hG="[object Error]",xO="[object Function]",fG="[object GeneratorFunction]",dG="[object Map]",pG="[object Number]",EO="[object Object]",mG="[object RegExp]",gG="[object Set]",xG="[object String]",EG="[object Symbol]",yG="[object WeakMap]",SG="[object ArrayBuffer]",TG="[object DataView]",OG="[object Float32Array]",LG="[object Float64Array]",AG="[object Int8Array]",bG="[object Int16Array]",NG="[object Int32Array]",kG="[object Uint8Array]",CG="[object Uint8ClampedArray]",vG="[object Uint16Array]",IG="[object Uint32Array]",xe={};xe[gO]=xe[lG]=xe[SG]=xe[TG]=xe[cG]=xe[uG]=xe[OG]=xe[LG]=xe[AG]=xe[bG]=xe[NG]=xe[dG]=xe[pG]=xe[EO]=xe[mG]=xe[gG]=xe[xG]=xe[EG]=xe[kG]=xe[CG]=xe[vG]=xe[IG]=!0;xe[hG]=xe[xO]=xe[yG]=!1;function vc(t,e,r,n,i,s){var o,a=e&sG,c=e&oG,u=e&aG;if(r&&(o=i?r(t,n,i,s):r(t)),o!==void 0)return o;if(!tG(t))return t;var f=ZK(t);if(f){if(o=QK(t),!a)return GK(t,o)}else{var l=VK(t),d=l==xO||l==fG;if(JK(t))return KK(t,a);if(l==EO||l==gO||d&&!i){if(o=c||d?{}:XK(t),!a)return c?WK(t,FK(o,t)):jK(t,BK(o,t))}else{if(!xe[l])return i?t:{};o=YK(t,l,a)}}s||(s=new qK);var h=s.get(t);if(h)return h;s.set(t,o),rG(t)?t.forEach(function(m){o.add(vc(m,e,r,m,t,s))}):eG(t)&&t.forEach(function(m,g){o.set(g,vc(m,e,r,g,t,s))});var p=u?c?zK:HK:c?iG:nG,x=f?void 0:p(t);return DK(x||t,function(m,g){x&&(g=m,m=t[g]),$K(o,g,vc(m,e,r,g,t,s))}),o}yO.exports=vc});var TO=T((xme,SO)=>{var wG=zf(),RG=4;function MG(t){return wG(t,RG)}SO.exports=MG});var Ic=T((Eme,OO)=>{function UG(t){return function(){return t}}OO.exports=UG});var AO=T((yme,LO)=>{function _G(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[t?a:++i];if(r(s[c],c,s)===!1)break}return e}}LO.exports=_G});var wc=T((Sme,bO)=>{var PG=AO(),qG=PG();bO.exports=qG});var Rc=T((Tme,NO)=>{var DG=wc(),$G=wr();function BG(t,e){return t&&DG(t,e,$G)}NO.exports=BG});var CO=T((Ome,kO)=>{var FG=dr();function KG(t,e){return function(r,n){if(r==null)return r;if(!FG(r))return t(r,n);for(var i=r.length,s=e?i:-1,o=Object(r);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return r}}kO.exports=KG});var Po=T((Lme,vO)=>{var GG=Rc(),jG=CO(),WG=jG(GG);vO.exports=WG});var hn=T((Ame,IO)=>{function HG(t){return t}IO.exports=HG});var Vf=T((bme,wO)=>{var zG=hn();function VG(t){return typeof t=="function"?t:zG}wO.exports=VG});var Qf=T((Nme,RO)=>{var QG=Oc(),YG=Po(),XG=Vf(),ZG=$e();function JG(t,e){var r=ZG(t)?QG:YG;return r(t,XG(e))}RO.exports=JG});var Yf=T((kme,MO)=>{MO.exports=Qf()});var _O=T((Cme,UO)=>{var ej=Po();function tj(t,e){var r=[];return ej(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}UO.exports=tj});var qO=T((vme,PO)=>{var rj="__lodash_hash_undefined__";function nj(t){return this.__data__.set(t,rj),this}PO.exports=nj});var $O=T((Ime,DO)=>{function ij(t){return this.__data__.has(t)}DO.exports=ij});var Xf=T((wme,BO)=>{var sj=Tc(),oj=qO(),aj=$O();function Mc(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new sj;++e<r;)this.add(t[e])}Mc.prototype.add=Mc.prototype.push=oj;Mc.prototype.has=aj;BO.exports=Mc});var KO=T((Rme,FO)=>{function lj(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}FO.exports=lj});var Zf=T((Mme,GO)=>{function cj(t,e){return t.has(e)}GO.exports=cj});var Jf=T((Ume,jO)=>{var uj=Xf(),hj=KO(),fj=Zf(),dj=1,pj=2;function mj(t,e,r,n,i,s){var o=r&dj,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(t),f=s.get(e);if(u&&f)return u==e&&f==t;var l=-1,d=!0,h=r&pj?new uj:void 0;for(s.set(t,e),s.set(e,t);++l<a;){var p=t[l],x=e[l];if(n)var m=o?n(x,p,l,e,t,s):n(p,x,l,t,e,s);if(m!==void 0){if(m)continue;d=!1;break}if(h){if(!hj(e,function(g,S){if(!fj(h,S)&&(p===g||i(p,g,r,n,s)))return h.push(S)})){d=!1;break}}else if(!(p===x||i(p,x,r,n,s))){d=!1;break}}return s.delete(t),s.delete(e),d}jO.exports=mj});var HO=T((_me,WO)=>{function gj(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}WO.exports=gj});var Uc=T((Pme,zO)=>{function xj(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}zO.exports=xj});var ZO=T((qme,XO)=>{var VO=Pn(),QO=Gf(),Ej=_n(),yj=Jf(),Sj=HO(),Tj=Uc(),Oj=1,Lj=2,Aj="[object Boolean]",bj="[object Date]",Nj="[object Error]",kj="[object Map]",Cj="[object Number]",vj="[object RegExp]",Ij="[object Set]",wj="[object String]",Rj="[object Symbol]",Mj="[object ArrayBuffer]",Uj="[object DataView]",YO=VO?VO.prototype:void 0,ed=YO?YO.valueOf:void 0;function _j(t,e,r,n,i,s,o){switch(r){case Uj:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Mj:return!(t.byteLength!=e.byteLength||!s(new QO(t),new QO(e)));case Aj:case bj:case Cj:return Ej(+t,+e);case Nj:return t.name==e.name&&t.message==e.message;case vj:case wj:return t==e+"";case kj:var a=Sj;case Ij:var c=n&Oj;if(a||(a=Tj),t.size!=e.size&&!c)return!1;var u=o.get(t);if(u)return u==e;n|=Lj,o.set(t,e);var f=yj(a(t),a(e),n,i,s,o);return o.delete(t),f;case Rj:if(ed)return ed.call(t)==ed.call(e)}return!1}XO.exports=_j});var tL=T((Dme,eL)=>{var JO=Pf(),Pj=1,qj=Object.prototype,Dj=qj.hasOwnProperty;function $j(t,e,r,n,i,s){var o=r&Pj,a=JO(t),c=a.length,u=JO(e),f=u.length;if(c!=f&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in e:Dj.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var x=!0;s.set(t,e),s.set(e,t);for(var m=o;++l<c;){d=a[l];var g=t[d],S=e[d];if(n)var E=o?n(S,g,d,e,t,s):n(g,S,d,t,e,s);if(!(E===void 0?g===S||i(g,S,r,n,s):E)){x=!1;break}m||(m=d=="constructor")}if(x&&!m){var y=t.constructor,O=e.constructor;y!=O&&"constructor"in t&&"constructor"in e&&!(typeof y=="function"&&y instanceof y&&typeof O=="function"&&O instanceof O)&&(x=!1)}return s.delete(t),s.delete(e),x}eL.exports=$j});var cL=T(($me,lL)=>{var td=bo(),Bj=Jf(),Fj=ZO(),Kj=tL(),rL=$n(),nL=$e(),iL=qn(),Gj=as(),jj=1,sL="[object Arguments]",oL="[object Array]",_c="[object Object]",Wj=Object.prototype,aL=Wj.hasOwnProperty;function Hj(t,e,r,n,i,s){var o=nL(t),a=nL(e),c=o?oL:rL(t),u=a?oL:rL(e);c=c==sL?_c:c,u=u==sL?_c:u;var f=c==_c,l=u==_c,d=c==u;if(d&&iL(t)){if(!iL(e))return!1;o=!0,f=!1}if(d&&!f)return s||(s=new td),o||Gj(t)?Bj(t,e,r,n,i,s):Fj(t,e,c,r,n,i,s);if(!(r&jj)){var h=f&&aL.call(t,"__wrapped__"),p=l&&aL.call(e,"__wrapped__");if(h||p){var x=h?t.value():t,m=p?e.value():e;return s||(s=new td),i(x,m,r,n,s)}}return d?(s||(s=new td),Kj(t,e,r,n,i,s)):!1}lL.exports=Hj});var rd=T((Bme,fL)=>{var zj=cL(),uL=Qt();function hL(t,e,r,n,i){return t===e?!0:t==null||e==null||!uL(t)&&!uL(e)?t!==t&&e!==e:zj(t,e,r,n,hL,i)}fL.exports=hL});var pL=T((Fme,dL)=>{var Vj=bo(),Qj=rd(),Yj=1,Xj=2;function Zj(t,e,r,n){var i=r.length,s=i,o=!n;if(t==null)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=r[i];var c=a[0],u=t[c],f=a[1];if(o&&a[2]){if(u===void 0&&!(c in t))return!1}else{var l=new Vj;if(n)var d=n(u,f,c,t,e,l);if(!(d===void 0?Qj(f,u,Yj|Xj,n,l):d))return!1}}return!0}dL.exports=Zj});var nd=T((Kme,mL)=>{var Jj=vt();function eW(t){return t===t&&!Jj(t)}mL.exports=eW});var xL=T((Gme,gL)=>{var tW=nd(),rW=wr();function nW(t){for(var e=rW(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,tW(i)]}return e}gL.exports=nW});var id=T((jme,EL)=>{function iW(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}EL.exports=iW});var SL=T((Wme,yL)=>{var sW=pL(),oW=xL(),aW=id();function lW(t){var e=oW(t);return e.length==1&&e[0][2]?aW(e[0][0],e[0][1]):function(r){return r===t||sW(r,t,e)}}yL.exports=lW});var Bn=T((Hme,TL)=>{var cW=ln(),uW=Qt(),hW="[object Symbol]";function fW(t){return typeof t=="symbol"||uW(t)&&cW(t)==hW}TL.exports=fW});var Pc=T((zme,OL)=>{var dW=$e(),pW=Bn(),mW=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gW=/^\w*$/;function xW(t,e){if(dW(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||pW(t)?!0:gW.test(t)||!mW.test(t)||e!=null&&t in Object(e)}OL.exports=xW});var bL=T((Vme,AL)=>{var LL=Tc(),EW="Expected a function";function sd(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(EW);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(sd.Cache||LL),r}sd.Cache=LL;AL.exports=sd});var kL=T((Qme,NL)=>{var yW=bL(),SW=500;function TW(t){var e=yW(t,function(n){return r.size===SW&&r.clear(),n}),r=e.cache;return e}NL.exports=TW});var vL=T((Yme,CL)=>{var OW=kL(),LW=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,AW=/\\(\\)?/g,bW=OW(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(LW,function(r,n,i,s){e.push(i?s.replace(AW,"$1"):n||r)}),e});CL.exports=bW});var qo=T((Xme,IL)=>{function NW(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}IL.exports=NW});var PL=T((Zme,_L)=>{var wL=Pn(),kW=qo(),CW=$e(),vW=Bn(),IW=1/0,RL=wL?wL.prototype:void 0,ML=RL?RL.toString:void 0;function UL(t){if(typeof t=="string")return t;if(CW(t))return kW(t,UL)+"";if(vW(t))return ML?ML.call(t):"";var e=t+"";return e=="0"&&1/t==-IW?"-0":e}_L.exports=UL});var od=T((Jme,qL)=>{var wW=PL();function RW(t){return t==null?"":wW(t)}qL.exports=RW});var Do=T((ege,DL)=>{var MW=$e(),UW=Pc(),_W=vL(),PW=od();function qW(t,e){return MW(t)?t:UW(t,e)?[t]:_W(PW(t))}DL.exports=qW});var us=T((tge,$L)=>{var DW=Bn(),$W=1/0;function BW(t){if(typeof t=="string"||DW(t))return t;var e=t+"";return e=="0"&&1/t==-$W?"-0":e}$L.exports=BW});var $o=T((rge,BL)=>{var FW=Do(),KW=us();function GW(t,e){e=FW(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[KW(e[r++])];return r&&r==n?t:void 0}BL.exports=GW});var KL=T((nge,FL)=>{var jW=$o();function WW(t,e,r){var n=t==null?void 0:jW(t,e);return n===void 0?r:n}FL.exports=WW});var jL=T((ige,GL)=>{function HW(t,e){return t!=null&&e in Object(t)}GL.exports=HW});var ad=T((sge,WL)=>{var zW=Do(),VW=is(),QW=$e(),YW=vo(),XW=Lc(),ZW=us();function JW(t,e,r){e=zW(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=ZW(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&XW(i)&&YW(o,i)&&(QW(t)||VW(t)))}WL.exports=JW});var ld=T((oge,HL)=>{var eH=jL(),tH=ad();function rH(t,e){return t!=null&&tH(t,e,eH)}HL.exports=rH});var VL=T((age,zL)=>{var nH=rd(),iH=KL(),sH=ld(),oH=Pc(),aH=nd(),lH=id(),cH=us(),uH=1,hH=2;function fH(t,e){return oH(t)&&aH(e)?lH(cH(t),e):function(r){var n=iH(r,t);return n===void 0&&n===e?sH(r,t):nH(e,n,uH|hH)}}zL.exports=fH});var cd=T((lge,QL)=>{function dH(t){return function(e){return e?.[t]}}QL.exports=dH});var XL=T((cge,YL)=>{var pH=$o();function mH(t){return function(e){return pH(e,t)}}YL.exports=mH});var JL=T((uge,ZL)=>{var gH=cd(),xH=XL(),EH=Pc(),yH=us();function SH(t){return EH(t)?gH(yH(t)):xH(t)}ZL.exports=SH});var pr=T((hge,eA)=>{var TH=SL(),OH=VL(),LH=hn(),AH=$e(),bH=JL();function NH(t){return typeof t=="function"?t:t==null?LH:typeof t=="object"?AH(t)?OH(t[0],t[1]):TH(t):bH(t)}eA.exports=NH});var ud=T((fge,tA)=>{var kH=Rf(),CH=_O(),vH=pr(),IH=$e();function wH(t,e){var r=IH(t)?kH:CH;return r(t,vH(e,3))}tA.exports=wH});var nA=T((dge,rA)=>{var RH=Object.prototype,MH=RH.hasOwnProperty;function UH(t,e){return t!=null&&MH.call(t,e)}rA.exports=UH});var hd=T((pge,iA)=>{var _H=nA(),PH=ad();function qH(t,e){return t!=null&&PH(t,e,_H)}iA.exports=qH});var oA=T((mge,sA)=>{var DH=bc(),$H=$n(),BH=is(),FH=$e(),KH=dr(),GH=qn(),jH=Mo(),WH=as(),HH="[object Map]",zH="[object Set]",VH=Object.prototype,QH=VH.hasOwnProperty;function YH(t){if(t==null)return!0;if(KH(t)&&(FH(t)||typeof t=="string"||typeof t.splice=="function"||GH(t)||WH(t)||BH(t)))return!t.length;var e=$H(t);if(e==HH||e==zH)return!t.size;if(jH(t))return!DH(t).length;for(var r in t)if(QH.call(t,r))return!1;return!0}sA.exports=YH});var fd=T((gge,aA)=>{function XH(t){return t===void 0}aA.exports=XH});var dd=T((xge,lA)=>{var ZH=Po(),JH=dr();function ez(t,e){var r=-1,n=JH(t)?Array(t.length):[];return ZH(t,function(i,s,o){n[++r]=e(i,s,o)}),n}lA.exports=ez});var pd=T((Ege,cA)=>{var tz=qo(),rz=pr(),nz=dd(),iz=$e();function sz(t,e){var r=iz(t)?tz:nz;return r(t,rz(e,3))}cA.exports=sz});var hA=T((yge,uA)=>{function oz(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}uA.exports=oz});var dA=T((Sge,fA)=>{function az(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}fA.exports=az});var md=T((Tge,pA)=>{var lz=hA(),cz=Po(),uz=pr(),hz=dA(),fz=$e();function dz(t,e,r){var n=fz(t)?lz:hz,i=arguments.length<3;return n(t,uz(e,4),r,i,cz)}pA.exports=dz});var gA=T((Oge,mA)=>{var pz=ln(),mz=$e(),gz=Qt(),xz="[object String]";function Ez(t){return typeof t=="string"||!mz(t)&&gz(t)&&pz(t)==xz}mA.exports=Ez});var EA=T((Lge,xA)=>{var yz=cd(),Sz=yz("length");xA.exports=Sz});var SA=T((Age,yA)=>{var Tz="\\ud800-\\udfff",Oz="\\u0300-\\u036f",Lz="\\ufe20-\\ufe2f",Az="\\u20d0-\\u20ff",bz=Oz+Lz+Az,Nz="\\ufe0e\\ufe0f",kz="\\u200d",Cz=RegExp("["+kz+Tz+bz+Nz+"]");function vz(t){return Cz.test(t)}yA.exports=vz});var vA=T((bge,CA)=>{var OA="\\ud800-\\udfff",Iz="\\u0300-\\u036f",wz="\\ufe20-\\ufe2f",Rz="\\u20d0-\\u20ff",Mz=Iz+wz+Rz,Uz="\\ufe0e\\ufe0f",_z="["+OA+"]",gd="["+Mz+"]",xd="\\ud83c[\\udffb-\\udfff]",Pz="(?:"+gd+"|"+xd+")",LA="[^"+OA+"]",AA="(?:\\ud83c[\\udde6-\\uddff]){2}",bA="[\\ud800-\\udbff][\\udc00-\\udfff]",qz="\\u200d",NA=Pz+"?",kA="["+Uz+"]?",Dz="(?:"+qz+"(?:"+[LA,AA,bA].join("|")+")"+kA+NA+")*",$z=kA+NA+Dz,Bz="(?:"+[LA+gd+"?",gd,AA,bA,_z].join("|")+")",TA=RegExp(xd+"(?="+xd+")|"+Bz+$z,"g");function Fz(t){for(var e=TA.lastIndex=0;TA.test(t);)++e;return e}CA.exports=Fz});var wA=T((Nge,IA)=>{var Kz=EA(),Gz=SA(),jz=vA();function Wz(t){return Gz(t)?jz(t):Kz(t)}IA.exports=Wz});var MA=T((kge,RA)=>{var Hz=bc(),zz=$n(),Vz=dr(),Qz=gA(),Yz=wA(),Xz="[object Map]",Zz="[object Set]";function Jz(t){if(t==null)return 0;if(Vz(t))return Qz(t)?Yz(t):t.length;var e=zz(t);return e==Xz||e==Zz?t.size:Hz(t).length}RA.exports=Jz});var _A=T((Cge,UA)=>{var e3=Oc(),t3=Wf(),r3=Rc(),n3=pr(),i3=_o(),s3=$e(),o3=qn(),a3=Ji(),l3=vt(),c3=as();function u3(t,e,r){var n=s3(t),i=n||o3(t)||c3(t);if(e=n3(e,4),r==null){var s=t&&t.constructor;i?r=n?new s:[]:l3(t)?r=a3(s)?t3(i3(t)):{}:r={}}return(i?e3:r3)(t,function(o,a,c){return e(r,o,a,c)}),r}UA.exports=u3});var $A=T((vge,DA)=>{var PA=Pn(),h3=is(),f3=$e(),qA=PA?PA.isConcatSpreadable:void 0;function d3(t){return f3(t)||h3(t)||!!(qA&&t&&t[qA])}DA.exports=d3});var qc=T((Ige,FA)=>{var p3=kc(),m3=$A();function BA(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=m3),i||(i=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?BA(a,e-1,r,n,i):p3(i,a):n||(i[i.length]=a)}return i}FA.exports=BA});var GA=T((wge,KA)=>{function g3(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}KA.exports=g3});var Ed=T((Rge,WA)=>{var x3=GA(),jA=Math.max;function E3(t,e,r){return e=jA(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=jA(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),x3(t,this,a)}}WA.exports=E3});var VA=T((Mge,zA)=>{var y3=Ic(),HA=Nf(),S3=hn(),T3=HA?function(t,e){return HA(t,"toString",{configurable:!0,enumerable:!1,value:y3(e),writable:!0})}:S3;zA.exports=T3});var YA=T((Uge,QA)=>{var O3=800,L3=16,A3=Date.now;function b3(t){var e=0,r=0;return function(){var n=A3(),i=L3-(n-r);if(r=n,i>0){if(++e>=O3)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}QA.exports=b3});var yd=T((_ge,XA)=>{var N3=VA(),k3=YA(),C3=k3(N3);XA.exports=C3});var Bo=T((Pge,ZA)=>{var v3=hn(),I3=Ed(),w3=yd();function R3(t,e){return w3(I3(t,e,v3),t+"")}ZA.exports=R3});var Sd=T((qge,JA)=>{function M3(t,e,r,n){for(var i=t.length,s=r+(n?1:-1);n?s--:++s<i;)if(e(t[s],s,t))return s;return-1}JA.exports=M3});var tb=T((Dge,eb)=>{function U3(t){return t!==t}eb.exports=U3});var nb=T(($ge,rb)=>{function _3(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}rb.exports=_3});var sb=T((Bge,ib)=>{var P3=Sd(),q3=tb(),D3=nb();function $3(t,e,r){return e===e?D3(t,e,r):P3(t,q3,r)}ib.exports=$3});var ab=T((Fge,ob)=>{var B3=sb();function F3(t,e){var r=t==null?0:t.length;return!!r&&B3(t,e,0)>-1}ob.exports=F3});var cb=T((Kge,lb)=>{function K3(t,e,r){for(var n=-1,i=t==null?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1}lb.exports=K3});var hb=T((Gge,ub)=>{function G3(){}ub.exports=G3});var db=T((jge,fb)=>{var Td=qf(),j3=hb(),W3=Uc(),H3=1/0,z3=Td&&1/W3(new Td([,-0]))[1]==H3?function(t){return new Td(t)}:j3;fb.exports=z3});var mb=T((Wge,pb)=>{var V3=Xf(),Q3=ab(),Y3=cb(),X3=Zf(),Z3=db(),J3=Uc(),eV=200;function tV(t,e,r){var n=-1,i=Q3,s=t.length,o=!0,a=[],c=a;if(r)o=!1,i=Y3;else if(s>=eV){var u=e?null:Z3(t);if(u)return J3(u);o=!1,i=X3,c=new V3}else c=e?[]:a;e:for(;++n<s;){var f=t[n],l=e?e(f):f;if(f=r||f!==0?f:0,o&&l===l){for(var d=c.length;d--;)if(c[d]===l)continue e;e&&c.push(l),a.push(f)}else i(c,l,r)||(c!==a&&c.push(l),a.push(f))}return a}pb.exports=tV});var Od=T((Hge,gb)=>{var rV=dr(),nV=Qt();function iV(t){return nV(t)&&rV(t)}gb.exports=iV});var Eb=T((zge,xb)=>{var sV=qc(),oV=Bo(),aV=mb(),lV=Od(),cV=oV(function(t){return aV(sV(t,1,lV,!0))});xb.exports=cV});var Sb=T((Vge,yb)=>{var uV=qo();function hV(t,e){return uV(e,function(r){return t[r]})}yb.exports=hV});var Ld=T((Qge,Tb)=>{var fV=Sb(),dV=wr();function pV(t){return t==null?[]:fV(t,dV(t))}Tb.exports=pV});var It=T((Yge,Ob)=>{var Dc;if(typeof Xn=="function")try{Dc={clone:TO(),constant:Ic(),each:Yf(),filter:ud(),has:hd(),isArray:$e(),isEmpty:oA(),isFunction:Ji(),isUndefined:fd(),keys:wr(),map:pd(),reduce:md(),size:MA(),transform:_A(),union:Eb(),values:Ld()}}catch{}Dc||(Dc=window._);Ob.exports=Dc});var $c=T((Zge,Nb)=>{"use strict";var W=It();Nb.exports=Z;var mV="\0",Fn="\0",Lb="";function Z(t){this._isDirected=W.has(t,"directed")?t.directed:!0,this._isMultigraph=W.has(t,"multigraph")?t.multigraph:!1,this._isCompound=W.has(t,"compound")?t.compound:!1,this._label=void 0,this._defaultNodeLabelFn=W.constant(void 0),this._defaultEdgeLabelFn=W.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[Fn]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}Z.prototype._nodeCount=0;Z.prototype._edgeCount=0;Z.prototype.isDirected=function(){return this._isDirected};Z.prototype.isMultigraph=function(){return this._isMultigraph};Z.prototype.isCompound=function(){return this._isCompound};Z.prototype.setGraph=function(t){return this._label=t,this};Z.prototype.graph=function(){return this._label};Z.prototype.setDefaultNodeLabel=function(t){return W.isFunction(t)||(t=W.constant(t)),this._defaultNodeLabelFn=t,this};Z.prototype.nodeCount=function(){return this._nodeCount};Z.prototype.nodes=function(){return W.keys(this._nodes)};Z.prototype.sources=function(){var t=this;return W.filter(this.nodes(),function(e){return W.isEmpty(t._in[e])})};Z.prototype.sinks=function(){var t=this;return W.filter(this.nodes(),function(e){return W.isEmpty(t._out[e])})};Z.prototype.setNodes=function(t,e){var r=arguments,n=this;return W.each(t,function(i){r.length>1?n.setNode(i,e):n.setNode(i)}),this};Z.prototype.setNode=function(t,e){return W.has(this._nodes,t)?(arguments.length>1&&(this._nodes[t]=e),this):(this._nodes[t]=arguments.length>1?e:this._defaultNodeLabelFn(t),this._isCompound&&(this._parent[t]=Fn,this._children[t]={},this._children[Fn][t]=!0),this._in[t]={},this._preds[t]={},this._out[t]={},this._sucs[t]={},++this._nodeCount,this)};Z.prototype.node=function(t){return this._nodes[t]};Z.prototype.hasNode=function(t){return W.has(this._nodes,t)};Z.prototype.removeNode=function(t){var e=this;if(W.has(this._nodes,t)){var r=function(n){e.removeEdge(e._edgeObjs[n])};delete this._nodes[t],this._isCompound&&(this._removeFromParentsChildList(t),delete this._parent[t],W.each(this.children(t),function(n){e.setParent(n)}),delete this._children[t]),W.each(W.keys(this._in[t]),r),delete this._in[t],delete this._preds[t],W.each(W.keys(this._out[t]),r),delete this._out[t],delete this._sucs[t],--this._nodeCount}return this};Z.prototype.setParent=function(t,e){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(W.isUndefined(e))e=Fn;else{e+="";for(var r=e;!W.isUndefined(r);r=this.parent(r))if(r===t)throw new Error("Setting "+e+" as parent of "+t+" would create a cycle");this.setNode(e)}return this.setNode(t),this._removeFromParentsChildList(t),this._parent[t]=e,this._children[e][t]=!0,this};Z.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]};Z.prototype.parent=function(t){if(this._isCompound){var e=this._parent[t];if(e!==Fn)return e}};Z.prototype.children=function(t){if(W.isUndefined(t)&&(t=Fn),this._isCompound){var e=this._children[t];if(e)return W.keys(e)}else{if(t===Fn)return this.nodes();if(this.hasNode(t))return[]}};Z.prototype.predecessors=function(t){var e=this._preds[t];if(e)return W.keys(e)};Z.prototype.successors=function(t){var e=this._sucs[t];if(e)return W.keys(e)};Z.prototype.neighbors=function(t){var e=this.predecessors(t);if(e)return W.union(e,this.successors(t))};Z.prototype.isLeaf=function(t){var e;return this.isDirected()?e=this.successors(t):e=this.neighbors(t),e.length===0};Z.prototype.filterNodes=function(t){var e=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});e.setGraph(this.graph());var r=this;W.each(this._nodes,function(s,o){t(o)&&e.setNode(o,s)}),W.each(this._edgeObjs,function(s){e.hasNode(s.v)&&e.hasNode(s.w)&&e.setEdge(s,r.edge(s))});var n={};function i(s){var o=r.parent(s);return o===void 0||e.hasNode(o)?(n[s]=o,o):o in n?n[o]:i(o)}return this._isCompound&&W.each(e.nodes(),function(s){e.setParent(s,i(s))}),e};Z.prototype.setDefaultEdgeLabel=function(t){return W.isFunction(t)||(t=W.constant(t)),this._defaultEdgeLabelFn=t,this};Z.prototype.edgeCount=function(){return this._edgeCount};Z.prototype.edges=function(){return W.values(this._edgeObjs)};Z.prototype.setPath=function(t,e){var r=this,n=arguments;return W.reduce(t,function(i,s){return n.length>1?r.setEdge(i,s,e):r.setEdge(i,s),s}),this};Z.prototype.setEdge=function(){var t,e,r,n,i=!1,s=arguments[0];typeof s=="object"&&s!==null&&"v"in s?(t=s.v,e=s.w,r=s.name,arguments.length===2&&(n=arguments[1],i=!0)):(t=s,e=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],i=!0)),t=""+t,e=""+e,W.isUndefined(r)||(r=""+r);var o=Fo(this._isDirected,t,e,r);if(W.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=n),this;if(!W.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(t),this.setNode(e),this._edgeLabels[o]=i?n:this._defaultEdgeLabelFn(t,e,r);var a=gV(this._isDirected,t,e,r);return t=a.v,e=a.w,Object.freeze(a),this._edgeObjs[o]=a,Ab(this._preds[e],t),Ab(this._sucs[t],e),this._in[e][o]=a,this._out[t][o]=a,this._edgeCount++,this};Z.prototype.edge=function(t,e,r){var n=arguments.length===1?Ad(this._isDirected,arguments[0]):Fo(this._isDirected,t,e,r);return this._edgeLabels[n]};Z.prototype.hasEdge=function(t,e,r){var n=arguments.length===1?Ad(this._isDirected,arguments[0]):Fo(this._isDirected,t,e,r);return W.has(this._edgeLabels,n)};Z.prototype.removeEdge=function(t,e,r){var n=arguments.length===1?Ad(this._isDirected,arguments[0]):Fo(this._isDirected,t,e,r),i=this._edgeObjs[n];return i&&(t=i.v,e=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],bb(this._preds[e],t),bb(this._sucs[t],e),delete this._in[e][n],delete this._out[t][n],this._edgeCount--),this};Z.prototype.inEdges=function(t,e){var r=this._in[t];if(r){var n=W.values(r);return e?W.filter(n,function(i){return i.v===e}):n}};Z.prototype.outEdges=function(t,e){var r=this._out[t];if(r){var n=W.values(r);return e?W.filter(n,function(i){return i.w===e}):n}};Z.prototype.nodeEdges=function(t,e){var r=this.inEdges(t,e);if(r)return r.concat(this.outEdges(t,e))};function Ab(t,e){t[e]?t[e]++:t[e]=1}function bb(t,e){--t[e]||delete t[e]}function Fo(t,e,r,n){var i=""+e,s=""+r;if(!t&&i>s){var o=i;i=s,s=o}return i+Lb+s+Lb+(W.isUndefined(n)?mV:n)}function gV(t,e,r,n){var i=""+e,s=""+r;if(!t&&i>s){var o=i;i=s,s=o}var a={v:i,w:s};return n&&(a.name=n),a}function Ad(t,e){return Fo(t,e.v,e.w,e.name)}});var Cb=T((Jge,kb)=>{kb.exports="2.1.8"});var Ib=T((exe,vb)=>{vb.exports={Graph:$c(),version:Cb()}});var Rb=T((txe,wb)=>{var mr=It(),xV=$c();wb.exports={write:EV,read:TV};function EV(t){var e={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:yV(t),edges:SV(t)};return mr.isUndefined(t.graph())||(e.value=mr.clone(t.graph())),e}function yV(t){return mr.map(t.nodes(),function(e){var r=t.node(e),n=t.parent(e),i={v:e};return mr.isUndefined(r)||(i.value=r),mr.isUndefined(n)||(i.parent=n),i})}function SV(t){return mr.map(t.edges(),function(e){var r=t.edge(e),n={v:e.v,w:e.w};return mr.isUndefined(e.name)||(n.name=e.name),mr.isUndefined(r)||(n.value=r),n})}function TV(t){var e=new xV(t.options).setGraph(t.value);return mr.each(t.nodes,function(r){e.setNode(r.v,r.value),r.parent&&e.setParent(r.v,r.parent)}),mr.each(t.edges,function(r){e.setEdge({v:r.v,w:r.w,name:r.name},r.value)}),e}});var Ub=T((rxe,Mb)=>{var Bc=It();Mb.exports=OV;function OV(t){var e={},r=[],n;function i(s){Bc.has(e,s)||(e[s]=!0,n.push(s),Bc.each(t.successors(s),i),Bc.each(t.predecessors(s),i))}return Bc.each(t.nodes(),function(s){n=[],i(s),n.length&&r.push(n)}),r}});var bd=T((nxe,Pb)=>{var _b=It();Pb.exports=Ft;function Ft(){this._arr=[],this._keyIndices={}}Ft.prototype.size=function(){return this._arr.length};Ft.prototype.keys=function(){return this._arr.map(function(t){return t.key})};Ft.prototype.has=function(t){return _b.has(this._keyIndices,t)};Ft.prototype.priority=function(t){var e=this._keyIndices[t];if(e!==void 0)return this._arr[e].priority};Ft.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key};Ft.prototype.add=function(t,e){var r=this._keyIndices;if(t=String(t),!_b.has(r,t)){var n=this._arr,i=n.length;return r[t]=i,n.push({key:t,priority:e}),this._decrease(i),!0}return!1};Ft.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key};Ft.prototype.decrease=function(t,e){var r=this._keyIndices[t];if(e>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[r].priority+" New: "+e);this._arr[r].priority=e,this._decrease(r)};Ft.prototype._heapify=function(t){var e=this._arr,r=2*t,n=r+1,i=t;r<e.length&&(i=e[r].priority<e[i].priority?r:i,n<e.length&&(i=e[n].priority<e[i].priority?n:i),i!==t&&(this._swap(t,i),this._heapify(i)))};Ft.prototype._decrease=function(t){for(var e=this._arr,r=e[t].priority,n;t!==0&&(n=t>>1,!(e[n].priority<r));)this._swap(t,n),t=n};Ft.prototype._swap=function(t,e){var r=this._arr,n=this._keyIndices,i=r[t],s=r[e];r[t]=s,r[e]=i,n[s.key]=t,n[i.key]=e}});var Nd=T((ixe,qb)=>{var LV=It(),AV=bd();qb.exports=NV;var bV=LV.constant(1);function NV(t,e,r,n){return kV(t,String(e),r||bV,n||function(i){return t.outEdges(i)})}function kV(t,e,r,n){var i={},s=new AV,o,a,c=function(u){var f=u.v!==o?u.v:u.w,l=i[f],d=r(u),h=a.distance+d;if(d<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+u+" Weight: "+d);h<l.distance&&(l.distance=h,l.predecessor=o,s.decrease(f,h))};for(t.nodes().forEach(function(u){var f=u===e?0:Number.POSITIVE_INFINITY;i[u]={distance:f},s.add(u,f)});s.size()>0&&(o=s.removeMin(),a=i[o],a.distance!==Number.POSITIVE_INFINITY);)n(o).forEach(c);return i}});var $b=T((sxe,Db)=>{var CV=Nd(),vV=It();Db.exports=IV;function IV(t,e,r){return vV.transform(t.nodes(),function(n,i){n[i]=CV(t,i,e,r)},{})}});var kd=T((oxe,Fb)=>{var Bb=It();Fb.exports=wV;function wV(t){var e=0,r=[],n={},i=[];function s(o){var a=n[o]={onStack:!0,lowlink:e,index:e++};if(r.push(o),t.successors(o).forEach(function(f){Bb.has(n,f)?n[f].onStack&&(a.lowlink=Math.min(a.lowlink,n[f].index)):(s(f),a.lowlink=Math.min(a.lowlink,n[f].lowlink))}),a.lowlink===a.index){var c=[],u;do u=r.pop(),n[u].onStack=!1,c.push(u);while(o!==u);i.push(c)}}return t.nodes().forEach(function(o){Bb.has(n,o)||s(o)}),i}});var Gb=T((axe,Kb)=>{var RV=It(),MV=kd();Kb.exports=UV;function UV(t){return RV.filter(MV(t),function(e){return e.length>1||e.length===1&&t.hasEdge(e[0],e[0])})}});var Wb=T((lxe,jb)=>{var _V=It();jb.exports=qV;var PV=_V.constant(1);function qV(t,e,r){return DV(t,e||PV,r||function(n){return t.outEdges(n)})}function DV(t,e,r){var n={},i=t.nodes();return i.forEach(function(s){n[s]={},n[s][s]={distance:0},i.forEach(function(o){s!==o&&(n[s][o]={distance:Number.POSITIVE_INFINITY})}),r(s).forEach(function(o){var a=o.v===s?o.w:o.v,c=e(o);n[s][a]={distance:c,predecessor:s}})}),i.forEach(function(s){var o=n[s];i.forEach(function(a){var c=n[a];i.forEach(function(u){var f=c[s],l=o[u],d=c[u],h=f.distance+l.distance;h<d.distance&&(d.distance=h,d.predecessor=l.predecessor)})})}),n}});var Cd=T((cxe,zb)=>{var Ko=It();zb.exports=Hb;Hb.CycleException=Fc;function Hb(t){var e={},r={},n=[];function i(s){if(Ko.has(r,s))throw new Fc;Ko.has(e,s)||(r[s]=!0,e[s]=!0,Ko.each(t.predecessors(s),i),delete r[s],n.push(s))}if(Ko.each(t.sinks(),i),Ko.size(e)!==t.nodeCount())throw new Fc;return n}function Fc(){}Fc.prototype=new Error});var Yb=T((uxe,Qb)=>{var Vb=Cd();Qb.exports=$V;function $V(t){try{Vb(t)}catch(e){if(e instanceof Vb.CycleException)return!1;throw e}return!0}});var vd=T((hxe,Zb)=>{var Kc=It();Zb.exports=BV;function BV(t,e,r){Kc.isArray(e)||(e=[e]);var n=(t.isDirected()?t.successors:t.neighbors).bind(t),i=[],s={};return Kc.each(e,function(o){if(!t.hasNode(o))throw new Error("Graph does not have node: "+o);Xb(t,o,r==="post",s,n,i)}),i}function Xb(t,e,r,n,i,s){Kc.has(n,e)||(n[e]=!0,r||s.push(e),Kc.each(i(e),function(o){Xb(t,o,r,n,i,s)}),r&&s.push(e))}});var eN=T((fxe,Jb)=>{var FV=vd();Jb.exports=KV;function KV(t,e){return FV(t,e,"post")}});var rN=T((dxe,tN)=>{var GV=vd();tN.exports=jV;function jV(t,e){return GV(t,e,"pre")}});var sN=T((pxe,iN)=>{var nN=It(),WV=$c(),HV=bd();iN.exports=zV;function zV(t,e){var r=new WV,n={},i=new HV,s;function o(c){var u=c.v===s?c.w:c.v,f=i.priority(u);if(f!==void 0){var l=e(c);l<f&&(n[u]=s,i.decrease(u,l))}}if(t.nodeCount()===0)return r;nN.each(t.nodes(),function(c){i.add(c,Number.POSITIVE_INFINITY),r.setNode(c)}),i.decrease(t.nodes()[0],0);for(var a=!1;i.size()>0;){if(s=i.removeMin(),nN.has(n,s))r.setEdge(s,n[s]);else{if(a)throw new Error("Input graph is not connected: "+t);a=!0}t.nodeEdges(s).forEach(o)}return r}});var aN=T((mxe,oN)=>{oN.exports={components:Ub(),dijkstra:Nd(),dijkstraAll:$b(),findCycles:Gb(),floydWarshall:Wb(),isAcyclic:Yb(),postorder:eN(),preorder:rN(),prim:sN(),tarjan:kd(),topsort:Cd()}});var uN=T((gxe,cN)=>{var lN=Ib();cN.exports={Graph:lN.Graph,json:Rb(),alg:aN(),version:lN.version}});var Kt=T((xxe,hN)=>{var Gc;if(typeof Xn=="function")try{Gc=uN()}catch{}Gc||(Gc=window.graphlib);hN.exports=Gc});var dN=T((yxe,fN)=>{var VV=zf(),QV=1,YV=4;function XV(t){return VV(t,QV|YV)}fN.exports=XV});var Go=T((Sxe,pN)=>{var ZV=_n(),JV=dr(),e4=vo(),t4=vt();function r4(t,e,r){if(!t4(r))return!1;var n=typeof e;return(n=="number"?JV(r)&&e4(e,r.length):n=="string"&&e in r)?ZV(r[e],t):!1}pN.exports=r4});var xN=T((Txe,gN)=>{var n4=Bo(),i4=_n(),s4=Go(),o4=un(),mN=Object.prototype,a4=mN.hasOwnProperty,l4=n4(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&s4(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=o4(s),a=-1,c=o.length;++a<c;){var u=o[a],f=t[u];(f===void 0||i4(f,mN[u])&&!a4.call(t,u))&&(t[u]=s[u])}return t});gN.exports=l4});var yN=T((Oxe,EN)=>{var c4=pr(),u4=dr(),h4=wr();function f4(t){return function(e,r,n){var i=Object(e);if(!u4(e)){var s=c4(r,3);e=h4(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}EN.exports=f4});var TN=T((Lxe,SN)=>{var d4=/\s/;function p4(t){for(var e=t.length;e--&&d4.test(t.charAt(e)););return e}SN.exports=p4});var LN=T((Axe,ON)=>{var m4=TN(),g4=/^\s+/;function x4(t){return t&&t.slice(0,m4(t)+1).replace(g4,"")}ON.exports=x4});var kN=T((bxe,NN)=>{var E4=LN(),AN=vt(),y4=Bn(),bN=NaN,S4=/^[-+]0x[0-9a-f]+$/i,T4=/^0b[01]+$/i,O4=/^0o[0-7]+$/i,L4=parseInt;function A4(t){if(typeof t=="number")return t;if(y4(t))return bN;if(AN(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=AN(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=E4(t);var r=T4.test(t);return r||O4.test(t)?L4(t.slice(2),r?2:8):S4.test(t)?bN:+t}NN.exports=A4});var Id=T((Nxe,vN)=>{var b4=kN(),CN=1/0,N4=17976931348623157e292;function k4(t){if(!t)return t===0?t:0;if(t=b4(t),t===CN||t===-CN){var e=t<0?-1:1;return e*N4}return t===t?t:0}vN.exports=k4});var wN=T((kxe,IN)=>{var C4=Id();function v4(t){var e=C4(t),r=e%1;return e===e?r?e-r:e:0}IN.exports=v4});var MN=T((Cxe,RN)=>{var I4=Sd(),w4=pr(),R4=wN(),M4=Math.max;function U4(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:R4(r);return i<0&&(i=M4(n+i,0)),I4(t,w4(e,3),i)}RN.exports=U4});var _N=T((vxe,UN)=>{var _4=yN(),P4=MN(),q4=_4(P4);UN.exports=q4});var wd=T((Ixe,PN)=>{var D4=qc();function $4(t){var e=t==null?0:t.length;return e?D4(t,1):[]}PN.exports=$4});var DN=T((wxe,qN)=>{var B4=wc(),F4=Vf(),K4=un();function G4(t,e){return t==null?t:B4(t,F4(e),K4)}qN.exports=G4});var BN=T((Rxe,$N)=>{function j4(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}$N.exports=j4});var KN=T((Mxe,FN)=>{var W4=No(),H4=Rc(),z4=pr();function V4(t,e){var r={};return e=z4(e,3),H4(t,function(n,i,s){W4(r,i,e(n,i,s))}),r}FN.exports=V4});var jc=T((Uxe,GN)=>{var Q4=Bn();function Y4(t,e,r){for(var n=-1,i=t.length;++n<i;){var s=t[n],o=e(s);if(o!=null&&(a===void 0?o===o&&!Q4(o):r(o,a)))var a=o,c=s}return c}GN.exports=Y4});var WN=T((_xe,jN)=>{function X4(t,e){return t>e}jN.exports=X4});var zN=T((Pxe,HN)=>{var Z4=jc(),J4=WN(),eQ=hn();function tQ(t){return t&&t.length?Z4(t,eQ,J4):void 0}HN.exports=tQ});var Rd=T((qxe,VN)=>{var rQ=No(),nQ=_n();function iQ(t,e,r){(r!==void 0&&!nQ(t[e],r)||r===void 0&&!(e in t))&&rQ(t,e,r)}VN.exports=iQ});var XN=T((Dxe,YN)=>{var sQ=ln(),oQ=_o(),aQ=Qt(),lQ="[object Object]",cQ=Function.prototype,uQ=Object.prototype,QN=cQ.toString,hQ=uQ.hasOwnProperty,fQ=QN.call(Object);function dQ(t){if(!aQ(t)||sQ(t)!=lQ)return!1;var e=oQ(t);if(e===null)return!0;var r=hQ.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&QN.call(r)==fQ}YN.exports=dQ});var Md=T(($xe,ZN)=>{function pQ(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}ZN.exports=pQ});var ek=T((Bxe,JN)=>{var mQ=ns(),gQ=un();function xQ(t){return mQ(t,gQ(t))}JN.exports=xQ});var ok=T((Fxe,sk)=>{var tk=Rd(),EQ=If(),yQ=jf(),SQ=wf(),TQ=Hf(),rk=is(),nk=$e(),OQ=Od(),LQ=qn(),AQ=Ji(),bQ=vt(),NQ=XN(),kQ=as(),ik=Md(),CQ=ek();function vQ(t,e,r,n,i,s,o){var a=ik(t,r),c=ik(e,r),u=o.get(c);if(u){tk(t,r,u);return}var f=s?s(a,c,r+"",t,e,o):void 0,l=f===void 0;if(l){var d=nk(c),h=!d&&LQ(c),p=!d&&!h&&kQ(c);f=c,d||h||p?nk(a)?f=a:OQ(a)?f=SQ(a):h?(l=!1,f=EQ(c,!0)):p?(l=!1,f=yQ(c,!0)):f=[]:NQ(c)||rk(c)?(f=a,rk(a)?f=CQ(a):(!bQ(a)||AQ(a))&&(f=TQ(c))):l=!1}l&&(o.set(c,f),i(f,c,n,s,o),o.delete(c)),tk(t,r,f)}sk.exports=vQ});var ck=T((Kxe,lk)=>{var IQ=bo(),wQ=Rd(),RQ=wc(),MQ=ok(),UQ=vt(),_Q=un(),PQ=Md();function ak(t,e,r,n,i){t!==e&&RQ(e,function(s,o){if(i||(i=new IQ),UQ(s))MQ(t,e,o,r,ak,n,i);else{var a=n?n(PQ(t,o),s,o+"",t,e,i):void 0;a===void 0&&(a=s),wQ(t,o,a)}},_Q)}lk.exports=ak});var hk=T((Gxe,uk)=>{var qQ=Bo(),DQ=Go();function $Q(t){return qQ(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&DQ(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}uk.exports=$Q});var dk=T((jxe,fk)=>{var BQ=ck(),FQ=hk(),KQ=FQ(function(t,e,r){BQ(t,e,r)});fk.exports=KQ});var Ud=T((Wxe,pk)=>{function GQ(t,e){return t<e}pk.exports=GQ});var gk=T((Hxe,mk)=>{var jQ=jc(),WQ=Ud(),HQ=hn();function zQ(t){return t&&t.length?jQ(t,HQ,WQ):void 0}mk.exports=zQ});var Ek=T((zxe,xk)=>{var VQ=jc(),QQ=pr(),YQ=Ud();function XQ(t,e){return t&&t.length?VQ(t,QQ(e,2),YQ):void 0}xk.exports=XQ});var Sk=T((Vxe,yk)=>{var ZQ=Bt(),JQ=function(){return ZQ.Date.now()};yk.exports=JQ});var Lk=T((Qxe,Ok)=>{var eY=ko(),tY=Do(),rY=vo(),Tk=vt(),nY=us();function iY(t,e,r,n){if(!Tk(t))return t;e=tY(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=nY(e[i]),u=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var f=a[c];u=n?n(f,c,a):void 0,u===void 0&&(u=Tk(f)?f:rY(e[i+1])?[]:{})}eY(a,c,u),a=a[c]}return t}Ok.exports=iY});var bk=T((Yxe,Ak)=>{var sY=$o(),oY=Lk(),aY=Do();function lY(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=sY(t,o);r(a,o)&&oY(s,aY(o,t),a)}return s}Ak.exports=lY});var kk=T((Xxe,Nk)=>{var cY=bk(),uY=ld();function hY(t,e){return cY(t,e,function(r,n){return uY(t,n)})}Nk.exports=hY});var vk=T((Zxe,Ck)=>{var fY=wd(),dY=Ed(),pY=yd();function mY(t){return pY(dY(t,void 0,fY),t+"")}Ck.exports=mY});var wk=T((Jxe,Ik)=>{var gY=kk(),xY=vk(),EY=xY(function(t,e){return t==null?{}:gY(t,e)});Ik.exports=EY});var Mk=T((eEe,Rk)=>{var yY=Math.ceil,SY=Math.max;function TY(t,e,r,n){for(var i=-1,s=SY(yY((e-t)/(r||1)),0),o=Array(s);s--;)o[n?s:++i]=t,t+=r;return o}Rk.exports=TY});var _k=T((tEe,Uk)=>{var OY=Mk(),LY=Go(),_d=Id();function AY(t){return function(e,r,n){return n&&typeof n!="number"&&LY(e,r,n)&&(r=n=void 0),e=_d(e),r===void 0?(r=e,e=0):r=_d(r),n=n===void 0?e<r?1:-1:_d(n),OY(e,r,n,t)}}Uk.exports=AY});var qk=T((rEe,Pk)=>{var bY=_k(),NY=bY();Pk.exports=NY});var $k=T((nEe,Dk)=>{function kY(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}Dk.exports=kY});var Kk=T((iEe,Fk)=>{var Bk=Bn();function CY(t,e){if(t!==e){var r=t!==void 0,n=t===null,i=t===t,s=Bk(t),o=e!==void 0,a=e===null,c=e===e,u=Bk(e);if(!a&&!u&&!s&&t>e||s&&o&&c&&!a&&!u||n&&o&&c||!r&&c||!i)return 1;if(!n&&!s&&!u&&t<e||u&&r&&i&&!n&&!s||a&&r&&i||!o&&i||!c)return-1}return 0}Fk.exports=CY});var jk=T((sEe,Gk)=>{var vY=Kk();function IY(t,e,r){for(var n=-1,i=t.criteria,s=e.criteria,o=i.length,a=r.length;++n<o;){var c=vY(i[n],s[n]);if(c){if(n>=a)return c;var u=r[n];return c*(u=="desc"?-1:1)}}return t.index-e.index}Gk.exports=IY});var Hk=T((oEe,Wk)=>{var Pd=qo(),wY=$o(),RY=pr(),MY=dd(),UY=$k(),_Y=Io(),PY=jk(),qY=hn(),DY=$e();function $Y(t,e,r){e.length?e=Pd(e,function(s){return DY(s)?function(o){return wY(o,s.length===1?s[0]:s)}:s}):e=[qY];var n=-1;e=Pd(e,_Y(RY));var i=MY(t,function(s,o,a){var c=Pd(e,function(u){return u(s)});return{criteria:c,index:++n,value:s}});return UY(i,function(s,o){return PY(s,o,r)})}Wk.exports=$Y});var Qk=T((aEe,Vk)=>{var BY=qc(),FY=Hk(),KY=Bo(),zk=Go(),GY=KY(function(t,e){if(t==null)return[];var r=e.length;return r>1&&zk(t,e[0],e[1])?e=[]:r>2&&zk(e[0],e[1],e[2])&&(e=[e[0]]),FY(t,BY(e,1),[])});Vk.exports=GY});var Xk=T((lEe,Yk)=>{var jY=od(),WY=0;function HY(t){var e=++WY;return jY(t)+e}Yk.exports=HY});var Jk=T((cEe,Zk)=>{function zY(t,e,r){for(var n=-1,i=t.length,s=e.length,o={};++n<i;){var a=n<s?e[n]:void 0;r(o,t[n],a)}return o}Zk.exports=zY});var tC=T((uEe,eC)=>{var VY=ko(),QY=Jk();function YY(t,e){return QY(t||[],e||[],VY)}eC.exports=YY});var Te=T((hEe,rC)=>{var Wc;if(typeof Xn=="function")try{Wc={cloneDeep:dN(),constant:Ic(),defaults:xN(),each:Yf(),filter:ud(),find:_N(),flatten:wd(),forEach:Qf(),forIn:DN(),has:hd(),isUndefined:fd(),last:BN(),map:pd(),mapValues:KN(),max:zN(),merge:dk(),min:gk(),minBy:Ek(),now:Sk(),pick:wk(),range:qk(),reduce:md(),sortBy:Qk(),uniqueId:Xk(),values:Ld(),zipObject:tC()}}catch{}Wc||(Wc=window._);rC.exports=Wc});var sC=T((dEe,iC)=>{iC.exports=Hc;function Hc(){var t={};t._next=t._prev=t,this._sentinel=t}Hc.prototype.dequeue=function(){var t=this._sentinel,e=t._prev;if(e!==t)return nC(e),e};Hc.prototype.enqueue=function(t){var e=this._sentinel;t._prev&&t._next&&nC(t),t._next=e._next,e._next._prev=t,e._next=t,t._prev=e};Hc.prototype.toString=function(){for(var t=[],e=this._sentinel,r=e._prev;r!==e;)t.push(JSON.stringify(r,XY)),r=r._prev;return"["+t.join(", ")+"]"};function nC(t){t._prev._next=t._next,t._next._prev=t._prev,delete t._next,delete t._prev}function XY(t,e){if(t!=="_next"&&t!=="_prev")return e}});var aC=T((pEe,oC)=>{var Rr=Te(),ZY=Kt().Graph,JY=sC();oC.exports=t5;var e5=Rr.constant(1);function t5(t,e){if(t.nodeCount()<=1)return[];var r=n5(t,e||e5),n=r5(r.graph,r.buckets,r.zeroIdx);return Rr.flatten(Rr.map(n,function(i){return t.outEdges(i.v,i.w)}),!0)}function r5(t,e,r){for(var n=[],i=e[e.length-1],s=e[0],o;t.nodeCount();){for(;o=s.dequeue();)qd(t,e,r,o);for(;o=i.dequeue();)qd(t,e,r,o);if(t.nodeCount()){for(var a=e.length-2;a>0;--a)if(o=e[a].dequeue(),o){n=n.concat(qd(t,e,r,o,!0));break}}}return n}function qd(t,e,r,n,i){var s=i?[]:void 0;return Rr.forEach(t.inEdges(n.v),function(o){var a=t.edge(o),c=t.node(o.v);i&&s.push({v:o.v,w:o.w}),c.out-=a,Dd(e,r,c)}),Rr.forEach(t.outEdges(n.v),function(o){var a=t.edge(o),c=o.w,u=t.node(c);u.in-=a,Dd(e,r,u)}),t.removeNode(n.v),s}function n5(t,e){var r=new ZY,n=0,i=0;Rr.forEach(t.nodes(),function(a){r.setNode(a,{v:a,in:0,out:0})}),Rr.forEach(t.edges(),function(a){var c=r.edge(a.v,a.w)||0,u=e(a),f=c+u;r.setEdge(a.v,a.w,f),i=Math.max(i,r.node(a.v).out+=u),n=Math.max(n,r.node(a.w).in+=u)});var s=Rr.range(i+n+3).map(function(){return new JY}),o=n+1;return Rr.forEach(r.nodes(),function(a){Dd(s,o,r.node(a))}),{graph:r,buckets:s,zeroIdx:o}}function Dd(t,e,r){r.out?r.in?t[r.out-r.in+e].enqueue(r):t[t.length-1].enqueue(r):t[0].enqueue(r)}});var cC=T((mEe,lC)=>{"use strict";var Kn=Te(),i5=aC();lC.exports={run:s5,undo:a5};function s5(t){var e=t.graph().acyclicer==="greedy"?i5(t,r(t)):o5(t);Kn.forEach(e,function(n){var i=t.edge(n);t.removeEdge(n),i.forwardName=n.name,i.reversed=!0,t.setEdge(n.w,n.v,i,Kn.uniqueId("rev"))});function r(n){return function(i){return n.edge(i).weight}}}function o5(t){var e=[],r={},n={};function i(s){Kn.has(n,s)||(n[s]=!0,r[s]=!0,Kn.forEach(t.outEdges(s),function(o){Kn.has(r,o.w)?e.push(o):i(o.w)}),delete r[s])}return Kn.forEach(t.nodes(),i),e}function a5(t){Kn.forEach(t.edges(),function(e){var r=t.edge(e);if(r.reversed){t.removeEdge(e);var n=r.forwardName;delete r.reversed,delete r.forwardName,t.setEdge(e.w,e.v,r,n)}})}});var xt=T((gEe,dC)=>{"use strict";var ie=Te(),uC=Kt().Graph;dC.exports={addDummyNode:hC,simplify:l5,asNonCompoundGraph:c5,successorWeights:u5,predecessorWeights:h5,intersectRect:f5,buildLayerMatrix:d5,normalizeRanks:p5,removeEmptyRanks:m5,addBorderNode:g5,maxRank:fC,partition:x5,time:E5,notime:y5};function hC(t,e,r,n){var i;do i=ie.uniqueId(n);while(t.hasNode(i));return r.dummy=e,t.setNode(i,r),i}function l5(t){var e=new uC().setGraph(t.graph());return ie.forEach(t.nodes(),function(r){e.setNode(r,t.node(r))}),ie.forEach(t.edges(),function(r){var n=e.edge(r.v,r.w)||{weight:0,minlen:1},i=t.edge(r);e.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})}),e}function c5(t){var e=new uC({multigraph:t.isMultigraph()}).setGraph(t.graph());return ie.forEach(t.nodes(),function(r){t.children(r).length||e.setNode(r,t.node(r))}),ie.forEach(t.edges(),function(r){e.setEdge(r,t.edge(r))}),e}function u5(t){var e=ie.map(t.nodes(),function(r){var n={};return ie.forEach(t.outEdges(r),function(i){n[i.w]=(n[i.w]||0)+t.edge(i).weight}),n});return ie.zipObject(t.nodes(),e)}function h5(t){var e=ie.map(t.nodes(),function(r){var n={};return ie.forEach(t.inEdges(r),function(i){n[i.v]=(n[i.v]||0)+t.edge(i).weight}),n});return ie.zipObject(t.nodes(),e)}function f5(t,e){var r=t.x,n=t.y,i=e.x-r,s=e.y-n,o=t.width/2,a=t.height/2;if(!i&&!s)throw new Error("Not possible to find intersection inside of the rectangle");var c,u;return Math.abs(s)*o>Math.abs(i)*a?(s<0&&(a=-a),c=a*i/s,u=a):(i<0&&(o=-o),c=o,u=o*s/i),{x:r+c,y:n+u}}function d5(t){var e=ie.map(ie.range(fC(t)+1),function(){return[]});return ie.forEach(t.nodes(),function(r){var n=t.node(r),i=n.rank;ie.isUndefined(i)||(e[i][n.order]=r)}),e}function p5(t){var e=ie.min(ie.map(t.nodes(),function(r){return t.node(r).rank}));ie.forEach(t.nodes(),function(r){var n=t.node(r);ie.has(n,"rank")&&(n.rank-=e)})}function m5(t){var e=ie.min(ie.map(t.nodes(),function(s){return t.node(s).rank})),r=[];ie.forEach(t.nodes(),function(s){var o=t.node(s).rank-e;r[o]||(r[o]=[]),r[o].push(s)});var n=0,i=t.graph().nodeRankFactor;ie.forEach(r,function(s,o){ie.isUndefined(s)&&o%i!==0?--n:n&&ie.forEach(s,function(a){t.node(a).rank+=n})})}function g5(t,e,r,n){var i={width:0,height:0};return arguments.length>=4&&(i.rank=r,i.order=n),hC(t,"border",i,e)}function fC(t){return ie.max(ie.map(t.nodes(),function(e){var r=t.node(e).rank;if(!ie.isUndefined(r))return r}))}function x5(t,e){var r={lhs:[],rhs:[]};return ie.forEach(t,function(n){e(n)?r.lhs.push(n):r.rhs.push(n)}),r}function E5(t,e){var r=ie.now();try{return e()}finally{console.log(t+" time: "+(ie.now()-r)+"ms")}}function y5(t,e){return e()}});var gC=T((xEe,mC)=>{"use strict";var pC=Te(),S5=xt();mC.exports={run:T5,undo:L5};function T5(t){t.graph().dummyChains=[],pC.forEach(t.edges(),function(e){O5(t,e)})}function O5(t,e){var r=e.v,n=t.node(r).rank,i=e.w,s=t.node(i).rank,o=e.name,a=t.edge(e),c=a.labelRank;if(s!==n+1){t.removeEdge(e);var u,f,l;for(l=0,++n;n<s;++l,++n)a.points=[],f={width:0,height:0,edgeLabel:a,edgeObj:e,rank:n},u=S5.addDummyNode(t,"edge",f,"_d"),n===c&&(f.width=a.width,f.height=a.height,f.dummy="edge-label",f.labelpos=a.labelpos),t.setEdge(r,u,{weight:a.weight},o),l===0&&t.graph().dummyChains.push(u),r=u;t.setEdge(r,i,{weight:a.weight},o)}}function L5(t){pC.forEach(t.graph().dummyChains,function(e){var r=t.node(e),n=r.edgeLabel,i;for(t.setEdge(r.edgeObj,n);r.dummy;)i=t.successors(e)[0],t.removeNode(e),n.points.push({x:r.x,y:r.y}),r.dummy==="edge-label"&&(n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height),e=i,r=t.node(e)})}});var jo=T((EEe,xC)=>{"use strict";var zc=Te();xC.exports={longestPath:A5,slack:b5};function A5(t){var e={};function r(n){var i=t.node(n);if(zc.has(e,n))return i.rank;e[n]=!0;var s=zc.min(zc.map(t.outEdges(n),function(o){return r(o.w)-t.edge(o).minlen}));return(s===Number.POSITIVE_INFINITY||s===void 0||s===null)&&(s=0),i.rank=s}zc.forEach(t.sources(),r)}function b5(t,e){return t.node(e.w).rank-t.node(e.v).rank-t.edge(e).minlen}});var $d=T((yEe,EC)=>{"use strict";var Vc=Te(),N5=Kt().Graph,Qc=jo().slack;EC.exports=k5;function k5(t){var e=new N5({directed:!1}),r=t.nodes()[0],n=t.nodeCount();e.setNode(r,{});for(var i,s;C5(e,t)<n;)i=v5(e,t),s=e.hasNode(i.v)?Qc(t,i):-Qc(t,i),I5(e,t,s);return e}function C5(t,e){function r(n){Vc.forEach(e.nodeEdges(n),function(i){var s=i.v,o=n===s?i.w:s;!t.hasNode(o)&&!Qc(e,i)&&(t.setNode(o,{}),t.setEdge(n,o,{}),r(o))})}return Vc.forEach(t.nodes(),r),t.nodeCount()}function v5(t,e){return Vc.minBy(e.edges(),function(r){if(t.hasNode(r.v)!==t.hasNode(r.w))return Qc(e,r)})}function I5(t,e,r){Vc.forEach(t.nodes(),function(n){e.node(n).rank+=r})}});var NC=T((SEe,bC)=>{"use strict";var Mr=Te(),w5=$d(),R5=jo().slack,M5=jo().longestPath,U5=Kt().alg.preorder,_5=Kt().alg.postorder,P5=xt().simplify;bC.exports=Gn;Gn.initLowLimValues=Fd;Gn.initCutValues=Bd;Gn.calcCutValue=SC;Gn.leaveEdge=OC;Gn.enterEdge=LC;Gn.exchangeEdges=AC;function Gn(t){t=P5(t),M5(t);var e=w5(t);Fd(e),Bd(e,t);for(var r,n;r=OC(e);)n=LC(e,t,r),AC(e,t,r,n)}function Bd(t,e){var r=_5(t,t.nodes());r=r.slice(0,r.length-1),Mr.forEach(r,function(n){q5(t,e,n)})}function q5(t,e,r){var n=t.node(r),i=n.parent;t.edge(r,i).cutvalue=SC(t,e,r)}function SC(t,e,r){var n=t.node(r),i=n.parent,s=!0,o=e.edge(r,i),a=0;return o||(s=!1,o=e.edge(i,r)),a=o.weight,Mr.forEach(e.nodeEdges(r),function(c){var u=c.v===r,f=u?c.w:c.v;if(f!==i){var l=u===s,d=e.edge(c).weight;if(a+=l?d:-d,$5(t,r,f)){var h=t.edge(r,f).cutvalue;a+=l?-h:h}}}),a}function Fd(t,e){arguments.length<2&&(e=t.nodes()[0]),TC(t,{},1,e)}function TC(t,e,r,n,i){var s=r,o=t.node(n);return e[n]=!0,Mr.forEach(t.neighbors(n),function(a){Mr.has(e,a)||(r=TC(t,e,r,a,n))}),o.low=s,o.lim=r++,i?o.parent=i:delete o.parent,r}function OC(t){return Mr.find(t.edges(),function(e){return t.edge(e).cutvalue<0})}function LC(t,e,r){var n=r.v,i=r.w;e.hasEdge(n,i)||(n=r.w,i=r.v);var s=t.node(n),o=t.node(i),a=s,c=!1;s.lim>o.lim&&(a=o,c=!0);var u=Mr.filter(e.edges(),function(f){return c===yC(t,t.node(f.v),a)&&c!==yC(t,t.node(f.w),a)});return Mr.minBy(u,function(f){return R5(e,f)})}function AC(t,e,r,n){var i=r.v,s=r.w;t.removeEdge(i,s),t.setEdge(n.v,n.w,{}),Fd(t),Bd(t,e),D5(t,e)}function D5(t,e){var r=Mr.find(t.nodes(),function(i){return!e.node(i).parent}),n=U5(t,r);n=n.slice(1),Mr.forEach(n,function(i){var s=t.node(i).parent,o=e.edge(i,s),a=!1;o||(o=e.edge(s,i),a=!0),e.node(i).rank=e.node(s).rank+(a?o.minlen:-o.minlen)})}function $5(t,e,r){return t.hasEdge(e,r)}function yC(t,e,r){return r.low<=e.lim&&e.lim<=r.lim}});var IC=T((TEe,vC)=>{"use strict";var B5=jo(),CC=B5.longestPath,F5=$d(),K5=NC();vC.exports=G5;function G5(t){switch(t.graph().ranker){case"network-simplex":kC(t);break;case"tight-tree":W5(t);break;case"longest-path":j5(t);break;default:kC(t)}}var j5=CC;function W5(t){CC(t),F5(t)}function kC(t){K5(t)}});var RC=T((OEe,wC)=>{var Kd=Te();wC.exports=H5;function H5(t){var e=V5(t);Kd.forEach(t.graph().dummyChains,function(r){for(var n=t.node(r),i=n.edgeObj,s=z5(t,e,i.v,i.w),o=s.path,a=s.lca,c=0,u=o[c],f=!0;r!==i.w;){if(n=t.node(r),f){for(;(u=o[c])!==a&&t.node(u).maxRank<n.rank;)c++;u===a&&(f=!1)}if(!f){for(;c<o.length-1&&t.node(u=o[c+1]).minRank<=n.rank;)c++;u=o[c]}t.setParent(r,u),r=t.successors(r)[0]}})}function z5(t,e,r,n){var i=[],s=[],o=Math.min(e[r].low,e[n].low),a=Math.max(e[r].lim,e[n].lim),c,u;c=r;do c=t.parent(c),i.push(c);while(c&&(e[c].low>o||a>e[c].lim));for(u=c,c=n;(c=t.parent(c))!==u;)s.push(c);return{path:i.concat(s.reverse()),lca:u}}function V5(t){var e={},r=0;function n(i){var s=r;Kd.forEach(t.children(i),n),e[i]={low:s,lim:r++}}return Kd.forEach(t.children(),n),e}});var _C=T((LEe,UC)=>{var Ur=Te(),Gd=xt();UC.exports={run:Q5,cleanup:Z5};function Q5(t){var e=Gd.addDummyNode(t,"root",{},"_root"),r=Y5(t),n=Ur.max(Ur.values(r))-1,i=2*n+1;t.graph().nestingRoot=e,Ur.forEach(t.edges(),function(o){t.edge(o).minlen*=i});var s=X5(t)+1;Ur.forEach(t.children(),function(o){MC(t,e,i,s,n,r,o)}),t.graph().nodeRankFactor=i}function MC(t,e,r,n,i,s,o){var a=t.children(o);if(!a.length){o!==e&&t.setEdge(e,o,{weight:0,minlen:r});return}var c=Gd.addBorderNode(t,"_bt"),u=Gd.addBorderNode(t,"_bb"),f=t.node(o);t.setParent(c,o),f.borderTop=c,t.setParent(u,o),f.borderBottom=u,Ur.forEach(a,function(l){MC(t,e,r,n,i,s,l);var d=t.node(l),h=d.borderTop?d.borderTop:l,p=d.borderBottom?d.borderBottom:l,x=d.borderTop?n:2*n,m=h!==p?1:i-s[o]+1;t.setEdge(c,h,{weight:x,minlen:m,nestingEdge:!0}),t.setEdge(p,u,{weight:x,minlen:m,nestingEdge:!0})}),t.parent(o)||t.setEdge(e,c,{weight:0,minlen:i+s[o]})}function Y5(t){var e={};function r(n,i){var s=t.children(n);s&&s.length&&Ur.forEach(s,function(o){r(o,i+1)}),e[n]=i}return Ur.forEach(t.children(),function(n){r(n,1)}),e}function X5(t){return Ur.reduce(t.edges(),function(e,r){return e+t.edge(r).weight},0)}function Z5(t){var e=t.graph();t.removeNode(e.nestingRoot),delete e.nestingRoot,Ur.forEach(t.edges(),function(r){var n=t.edge(r);n.nestingEdge&&t.removeEdge(r)})}});var DC=T((AEe,qC)=>{var jd=Te(),J5=xt();qC.exports=e6;function e6(t){function e(r){var n=t.children(r),i=t.node(r);if(n.length&&jd.forEach(n,e),jd.has(i,"minRank")){i.borderLeft=[],i.borderRight=[];for(var s=i.minRank,o=i.maxRank+1;s<o;++s)PC(t,"borderLeft","_bl",r,i,s),PC(t,"borderRight","_br",r,i,s)}}jd.forEach(t.children(),e)}function PC(t,e,r,n,i,s){var o={width:0,height:0,rank:s,borderType:e},a=i[e][s-1],c=J5.addDummyNode(t,"border",o,r);i[e][s]=c,t.setParent(c,n),a&&t.setEdge(a,c,{weight:1})}});var KC=T((bEe,FC)=>{"use strict";var gr=Te();FC.exports={adjust:t6,undo:r6};function t6(t){var e=t.graph().rankdir.toLowerCase();(e==="lr"||e==="rl")&&BC(t)}function r6(t){var e=t.graph().rankdir.toLowerCase();(e==="bt"||e==="rl")&&n6(t),(e==="lr"||e==="rl")&&(i6(t),BC(t))}function BC(t){gr.forEach(t.nodes(),function(e){$C(t.node(e))}),gr.forEach(t.edges(),function(e){$C(t.edge(e))})}function $C(t){var e=t.width;t.width=t.height,t.height=e}function n6(t){gr.forEach(t.nodes(),function(e){Wd(t.node(e))}),gr.forEach(t.edges(),function(e){var r=t.edge(e);gr.forEach(r.points,Wd),gr.has(r,"y")&&Wd(r)})}function Wd(t){t.y=-t.y}function i6(t){gr.forEach(t.nodes(),function(e){Hd(t.node(e))}),gr.forEach(t.edges(),function(e){var r=t.edge(e);gr.forEach(r.points,Hd),gr.has(r,"x")&&Hd(r)})}function Hd(t){var e=t.x;t.x=t.y,t.y=e}});var jC=T((NEe,GC)=>{"use strict";var _r=Te();GC.exports=s6;function s6(t){var e={},r=_r.filter(t.nodes(),function(a){return!t.children(a).length}),n=_r.max(_r.map(r,function(a){return t.node(a).rank})),i=_r.map(_r.range(n+1),function(){return[]});function s(a){if(!_r.has(e,a)){e[a]=!0;var c=t.node(a);i[c.rank].push(a),_r.forEach(t.successors(a),s)}}var o=_r.sortBy(r,function(a){return t.node(a).rank});return _r.forEach(o,s),i}});var HC=T((kEe,WC)=>{"use strict";var fn=Te();WC.exports=o6;function o6(t,e){for(var r=0,n=1;n<e.length;++n)r+=a6(t,e[n-1],e[n]);return r}function a6(t,e,r){for(var n=fn.zipObject(r,fn.map(r,function(u,f){return f})),i=fn.flatten(fn.map(e,function(u){return fn.sortBy(fn.map(t.outEdges(u),function(f){return{pos:n[f.w],weight:t.edge(f).weight}}),"pos")}),!0),s=1;s<r.length;)s<<=1;var o=2*s-1;s-=1;var a=fn.map(new Array(o),function(){return 0}),c=0;return fn.forEach(i.forEach(function(u){var f=u.pos+s;a[f]+=u.weight;for(var l=0;f>0;)f%2&&(l+=a[f+1]),f=f-1>>1,a[f]+=u.weight;c+=u.weight*l})),c}});var QC=T((CEe,VC)=>{var zC=Te();VC.exports=l6;function l6(t,e){return zC.map(e,function(r){var n=t.inEdges(r);if(n.length){var i=zC.reduce(n,function(s,o){var a=t.edge(o),c=t.node(o.v);return{sum:s.sum+a.weight*c.order,weight:s.weight+a.weight}},{sum:0,weight:0});return{v:r,barycenter:i.sum/i.weight,weight:i.weight}}else return{v:r}})}});var XC=T((vEe,YC)=>{"use strict";var wt=Te();YC.exports=c6;function c6(t,e){var r={};wt.forEach(t,function(i,s){var o=r[i.v]={indegree:0,in:[],out:[],vs:[i.v],i:s};wt.isUndefined(i.barycenter)||(o.barycenter=i.barycenter,o.weight=i.weight)}),wt.forEach(e.edges(),function(i){var s=r[i.v],o=r[i.w];!wt.isUndefined(s)&&!wt.isUndefined(o)&&(o.indegree++,s.out.push(r[i.w]))});var n=wt.filter(r,function(i){return!i.indegree});return u6(n)}function u6(t){var e=[];function r(s){return function(o){o.merged||(wt.isUndefined(o.barycenter)||wt.isUndefined(s.barycenter)||o.barycenter>=s.barycenter)&&h6(s,o)}}function n(s){return function(o){o.in.push(s),--o.indegree===0&&t.push(o)}}for(;t.length;){var i=t.pop();e.push(i),wt.forEach(i.in.reverse(),r(i)),wt.forEach(i.out,n(i))}return wt.map(wt.filter(e,function(s){return!s.merged}),function(s){return wt.pick(s,["vs","i","barycenter","weight"])})}function h6(t,e){var r=0,n=0;t.weight&&(r+=t.barycenter*t.weight,n+=t.weight),e.weight&&(r+=e.barycenter*e.weight,n+=e.weight),t.vs=e.vs.concat(t.vs),t.barycenter=r/n,t.weight=n,t.i=Math.min(e.i,t.i),e.merged=!0}});var ev=T((IEe,JC)=>{var Wo=Te(),f6=xt();JC.exports=d6;function d6(t,e){var r=f6.partition(t,function(f){return Wo.has(f,"barycenter")}),n=r.lhs,i=Wo.sortBy(r.rhs,function(f){return-f.i}),s=[],o=0,a=0,c=0;n.sort(p6(!!e)),c=ZC(s,i,c),Wo.forEach(n,function(f){c+=f.vs.length,s.push(f.vs),o+=f.barycenter*f.weight,a+=f.weight,c=ZC(s,i,c)});var u={vs:Wo.flatten(s,!0)};return a&&(u.barycenter=o/a,u.weight=a),u}function ZC(t,e,r){for(var n;e.length&&(n=Wo.last(e)).i<=r;)e.pop(),t.push(n.vs),r++;return r}function p6(t){return function(e,r){return e.barycenter<r.barycenter?-1:e.barycenter>r.barycenter?1:t?r.i-e.i:e.i-r.i}}});var nv=T((wEe,rv)=>{var dn=Te(),m6=QC(),g6=XC(),x6=ev();rv.exports=tv;function tv(t,e,r,n){var i=t.children(e),s=t.node(e),o=s?s.borderLeft:void 0,a=s?s.borderRight:void 0,c={};o&&(i=dn.filter(i,function(p){return p!==o&&p!==a}));var u=m6(t,i);dn.forEach(u,function(p){if(t.children(p.v).length){var x=tv(t,p.v,r,n);c[p.v]=x,dn.has(x,"barycenter")&&y6(p,x)}});var f=g6(u,r);E6(f,c);var l=x6(f,n);if(o&&(l.vs=dn.flatten([o,l.vs,a],!0),t.predecessors(o).length)){var d=t.node(t.predecessors(o)[0]),h=t.node(t.predecessors(a)[0]);dn.has(l,"barycenter")||(l.barycenter=0,l.weight=0),l.barycenter=(l.barycenter*l.weight+d.order+h.order)/(l.weight+2),l.weight+=2}return l}function E6(t,e){dn.forEach(t,function(r){r.vs=dn.flatten(r.vs.map(function(n){return e[n]?e[n].vs:n}),!0)})}function y6(t,e){dn.isUndefined(t.barycenter)?(t.barycenter=e.barycenter,t.weight=e.weight):(t.barycenter=(t.barycenter*t.weight+e.barycenter*e.weight)/(t.weight+e.weight),t.weight+=e.weight)}});var sv=T((REe,iv)=>{var Ho=Te(),S6=Kt().Graph;iv.exports=T6;function T6(t,e,r){var n=O6(t),i=new S6({compound:!0}).setGraph({root:n}).setDefaultNodeLabel(function(s){return t.node(s)});return Ho.forEach(t.nodes(),function(s){var o=t.node(s),a=t.parent(s);(o.rank===e||o.minRank<=e&&e<=o.maxRank)&&(i.setNode(s),i.setParent(s,a||n),Ho.forEach(t[r](s),function(c){var u=c.v===s?c.w:c.v,f=i.edge(u,s),l=Ho.isUndefined(f)?0:f.weight;i.setEdge(u,s,{weight:t.edge(c).weight+l})}),Ho.has(o,"minRank")&&i.setNode(s,{borderLeft:o.borderLeft[e],borderRight:o.borderRight[e]}))}),i}function O6(t){for(var e;t.hasNode(e=Ho.uniqueId("_root")););return e}});var av=T((MEe,ov)=>{var L6=Te();ov.exports=A6;function A6(t,e,r){var n={},i;L6.forEach(r,function(s){for(var o=t.parent(s),a,c;o;){if(a=t.parent(o),a?(c=n[a],n[a]=o):(c=i,i=o),c&&c!==o){e.setEdge(c,o);return}o=a}})}});var fv=T((UEe,hv)=>{"use strict";var pn=Te(),b6=jC(),N6=HC(),k6=nv(),C6=sv(),v6=av(),I6=Kt().Graph,lv=xt();hv.exports=w6;function w6(t){var e=lv.maxRank(t),r=cv(t,pn.range(1,e+1),"inEdges"),n=cv(t,pn.range(e-1,-1,-1),"outEdges"),i=b6(t);uv(t,i);for(var s=Number.POSITIVE_INFINITY,o,a=0,c=0;c<4;++a,++c){R6(a%2?r:n,a%4>=2),i=lv.buildLayerMatrix(t);var u=N6(t,i);u<s&&(c=0,o=pn.cloneDeep(i),s=u)}uv(t,o)}function cv(t,e,r){return pn.map(e,function(n){return C6(t,n,r)})}function R6(t,e){var r=new I6;pn.forEach(t,function(n){var i=n.graph().root,s=k6(n,i,r,e);pn.forEach(s.vs,function(o,a){n.node(o).order=a}),v6(n,r,s.vs)})}function uv(t,e){pn.forEach(e,function(r){pn.forEach(r,function(n,i){t.node(n).order=i})})}});var Ov=T((_Ee,Tv)=>{"use strict";var H=Te(),M6=Kt().Graph,U6=xt();Tv.exports={positionX:q6,findType1Conflicts:dv,findType2Conflicts:pv,addConflict:zd,hasConflict:mv,verticalAlignment:gv,horizontalCompaction:xv,alignCoordinates:yv,findSmallestWidthAlignment:Ev,balance:Sv};function dv(t,e){var r={};function n(i,s){var o=0,a=0,c=i.length,u=H.last(s);return H.forEach(s,function(f,l){var d=_6(t,f),h=d?t.node(d).order:c;(d||f===u)&&(H.forEach(s.slice(a,l+1),function(p){H.forEach(t.predecessors(p),function(x){var m=t.node(x),g=m.order;(g<o||h<g)&&!(m.dummy&&t.node(p).dummy)&&zd(r,x,p)})}),a=l+1,o=h)}),s}return H.reduce(e,n),r}function pv(t,e){var r={};function n(s,o,a,c,u){var f;H.forEach(H.range(o,a),function(l){f=s[l],t.node(f).dummy&&H.forEach(t.predecessors(f),function(d){var h=t.node(d);h.dummy&&(h.order<c||h.order>u)&&zd(r,d,f)})})}function i(s,o){var a=-1,c,u=0;return H.forEach(o,function(f,l){if(t.node(f).dummy==="border"){var d=t.predecessors(f);d.length&&(c=t.node(d[0]).order,n(o,u,l,a,c),u=l,a=c)}n(o,u,o.length,c,s.length)}),o}return H.reduce(e,i),r}function _6(t,e){if(t.node(e).dummy)return H.find(t.predecessors(e),function(r){return t.node(r).dummy})}function zd(t,e,r){if(e>r){var n=e;e=r,r=n}var i=t[e];i||(t[e]=i={}),i[r]=!0}function mv(t,e,r){if(e>r){var n=e;e=r,r=n}return H.has(t[e],r)}function gv(t,e,r,n){var i={},s={},o={};return H.forEach(e,function(a){H.forEach(a,function(c,u){i[c]=c,s[c]=c,o[c]=u})}),H.forEach(e,function(a){var c=-1;H.forEach(a,function(u){var f=n(u);if(f.length){f=H.sortBy(f,function(x){return o[x]});for(var l=(f.length-1)/2,d=Math.floor(l),h=Math.ceil(l);d<=h;++d){var p=f[d];s[u]===u&&c<o[p]&&!mv(r,u,p)&&(s[p]=u,s[u]=i[u]=i[p],c=o[p])}}})}),{root:i,align:s}}function xv(t,e,r,n,i){var s={},o=P6(t,e,r,i),a=i?"borderLeft":"borderRight";function c(l,d){for(var h=o.nodes(),p=h.pop(),x={};p;)x[p]?l(p):(x[p]=!0,h.push(p),h=h.concat(d(p))),p=h.pop()}function u(l){s[l]=o.inEdges(l).reduce(function(d,h){return Math.max(d,s[h.v]+o.edge(h))},0)}function f(l){var d=o.outEdges(l).reduce(function(p,x){return Math.min(p,s[x.w]-o.edge(x))},Number.POSITIVE_INFINITY),h=t.node(l);d!==Number.POSITIVE_INFINITY&&h.borderType!==a&&(s[l]=Math.max(s[l],d))}return c(u,o.predecessors.bind(o)),c(f,o.successors.bind(o)),H.forEach(n,function(l){s[l]=s[r[l]]}),s}function P6(t,e,r,n){var i=new M6,s=t.graph(),o=D6(s.nodesep,s.edgesep,n);return H.forEach(e,function(a){var c;H.forEach(a,function(u){var f=r[u];if(i.setNode(f),c){var l=r[c],d=i.edge(l,f);i.setEdge(l,f,Math.max(o(t,u,c),d||0))}c=u})}),i}function Ev(t,e){return H.minBy(H.values(e),function(r){var n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return H.forIn(r,function(s,o){var a=$6(t,o)/2;n=Math.max(s+a,n),i=Math.min(s-a,i)}),n-i})}function yv(t,e){var r=H.values(e),n=H.min(r),i=H.max(r);H.forEach(["u","d"],function(s){H.forEach(["l","r"],function(o){var a=s+o,c=t[a],u;if(c!==e){var f=H.values(c);u=o==="l"?n-H.min(f):i-H.max(f),u&&(t[a]=H.mapValues(c,function(l){return l+u}))}})})}function Sv(t,e){return H.mapValues(t.ul,function(r,n){if(e)return t[e.toLowerCase()][n];var i=H.sortBy(H.map(t,n));return(i[1]+i[2])/2})}function q6(t){var e=U6.buildLayerMatrix(t),r=H.merge(dv(t,e),pv(t,e)),n={},i;H.forEach(["u","d"],function(o){i=o==="u"?e:H.values(e).reverse(),H.forEach(["l","r"],function(a){a==="r"&&(i=H.map(i,function(l){return H.values(l).reverse()}));var c=(o==="u"?t.predecessors:t.successors).bind(t),u=gv(t,i,r,c),f=xv(t,i,u.root,u.align,a==="r");a==="r"&&(f=H.mapValues(f,function(l){return-l})),n[o+a]=f})});var s=Ev(t,n);return yv(n,s),Sv(n,t.graph().align)}function D6(t,e,r){return function(n,i,s){var o=n.node(i),a=n.node(s),c=0,u;if(c+=o.width/2,H.has(o,"labelpos"))switch(o.labelpos.toLowerCase()){case"l":u=-o.width/2;break;case"r":u=o.width/2;break}if(u&&(c+=r?u:-u),u=0,c+=(o.dummy?e:t)/2,c+=(a.dummy?e:t)/2,c+=a.width/2,H.has(a,"labelpos"))switch(a.labelpos.toLowerCase()){case"l":u=a.width/2;break;case"r":u=-a.width/2;break}return u&&(c+=r?u:-u),u=0,c}}function $6(t,e){return t.node(e).width}});var bv=T((PEe,Av)=>{"use strict";var zo=Te(),Lv=xt(),B6=Ov().positionX;Av.exports=F6;function F6(t){t=Lv.asNonCompoundGraph(t),K6(t),zo.forEach(B6(t),function(e,r){t.node(r).x=e})}function K6(t){var e=Lv.buildLayerMatrix(t),r=t.graph().ranksep,n=0;zo.forEach(e,function(i){var s=zo.max(zo.map(i,function(o){return t.node(o).height}));zo.forEach(i,function(o){t.node(o).y=n+s/2}),n+=s+r})}});var wv=T((qEe,Iv)=>{"use strict";var V=Te(),Nv=cC(),kv=gC(),G6=IC(),j6=xt().normalizeRanks,W6=RC(),H6=xt().removeEmptyRanks,Cv=_C(),z6=DC(),vv=KC(),V6=fv(),Q6=bv(),mn=xt(),Y6=Kt().Graph;Iv.exports=X6;function X6(t,e){var r=e&&e.debugTiming?mn.time:mn.notime;r("layout",function(){var n=r("  buildLayoutGraph",function(){return lX(t)});r("  runLayout",function(){Z6(n,r)}),r("  updateInputGraph",function(){J6(t,n)})})}function Z6(t,e){e("    makeSpaceForEdgeLabels",function(){cX(t)}),e("    removeSelfEdges",function(){EX(t)}),e("    acyclic",function(){Nv.run(t)}),e("    nestingGraph.run",function(){Cv.run(t)}),e("    rank",function(){G6(mn.asNonCompoundGraph(t))}),e("    injectEdgeLabelProxies",function(){uX(t)}),e("    removeEmptyRanks",function(){H6(t)}),e("    nestingGraph.cleanup",function(){Cv.cleanup(t)}),e("    normalizeRanks",function(){j6(t)}),e("    assignRankMinMax",function(){hX(t)}),e("    removeEdgeLabelProxies",function(){fX(t)}),e("    normalize.run",function(){kv.run(t)}),e("    parentDummyChains",function(){W6(t)}),e("    addBorderSegments",function(){z6(t)}),e("    order",function(){V6(t)}),e("    insertSelfEdges",function(){yX(t)}),e("    adjustCoordinateSystem",function(){vv.adjust(t)}),e("    position",function(){Q6(t)}),e("    positionSelfEdges",function(){SX(t)}),e("    removeBorderNodes",function(){xX(t)}),e("    normalize.undo",function(){kv.undo(t)}),e("    fixupEdgeLabelCoords",function(){mX(t)}),e("    undoCoordinateSystem",function(){vv.undo(t)}),e("    translateGraph",function(){dX(t)}),e("    assignNodeIntersects",function(){pX(t)}),e("    reversePoints",function(){gX(t)}),e("    acyclic.undo",function(){Nv.undo(t)})}function J6(t,e){V.forEach(t.nodes(),function(r){var n=t.node(r),i=e.node(r);n&&(n.x=i.x,n.y=i.y,e.children(r).length&&(n.width=i.width,n.height=i.height))}),V.forEach(t.edges(),function(r){var n=t.edge(r),i=e.edge(r);n.points=i.points,V.has(i,"x")&&(n.x=i.x,n.y=i.y)}),t.graph().width=e.graph().width,t.graph().height=e.graph().height}var eX=["nodesep","edgesep","ranksep","marginx","marginy"],tX={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},rX=["acyclicer","ranker","rankdir","align"],nX=["width","height"],iX={width:0,height:0},sX=["minlen","weight","width","height","labeloffset"],oX={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},aX=["labelpos"];function lX(t){var e=new Y6({multigraph:!0,compound:!0}),r=Qd(t.graph());return e.setGraph(V.merge({},tX,Vd(r,eX),V.pick(r,rX))),V.forEach(t.nodes(),function(n){var i=Qd(t.node(n));e.setNode(n,V.defaults(Vd(i,nX),iX)),e.setParent(n,t.parent(n))}),V.forEach(t.edges(),function(n){var i=Qd(t.edge(n));e.setEdge(n,V.merge({},oX,Vd(i,sX),V.pick(i,aX)))}),e}function cX(t){var e=t.graph();e.ranksep/=2,V.forEach(t.edges(),function(r){var n=t.edge(r);n.minlen*=2,n.labelpos.toLowerCase()!=="c"&&(e.rankdir==="TB"||e.rankdir==="BT"?n.width+=n.labeloffset:n.height+=n.labeloffset)})}function uX(t){V.forEach(t.edges(),function(e){var r=t.edge(e);if(r.width&&r.height){var n=t.node(e.v),i=t.node(e.w),s={rank:(i.rank-n.rank)/2+n.rank,e};mn.addDummyNode(t,"edge-proxy",s,"_ep")}})}function hX(t){var e=0;V.forEach(t.nodes(),function(r){var n=t.node(r);n.borderTop&&(n.minRank=t.node(n.borderTop).rank,n.maxRank=t.node(n.borderBottom).rank,e=V.max(e,n.maxRank))}),t.graph().maxRank=e}function fX(t){V.forEach(t.nodes(),function(e){var r=t.node(e);r.dummy==="edge-proxy"&&(t.edge(r.e).labelRank=r.rank,t.removeNode(e))})}function dX(t){var e=Number.POSITIVE_INFINITY,r=0,n=Number.POSITIVE_INFINITY,i=0,s=t.graph(),o=s.marginx||0,a=s.marginy||0;function c(u){var f=u.x,l=u.y,d=u.width,h=u.height;e=Math.min(e,f-d/2),r=Math.max(r,f+d/2),n=Math.min(n,l-h/2),i=Math.max(i,l+h/2)}V.forEach(t.nodes(),function(u){c(t.node(u))}),V.forEach(t.edges(),function(u){var f=t.edge(u);V.has(f,"x")&&c(f)}),e-=o,n-=a,V.forEach(t.nodes(),function(u){var f=t.node(u);f.x-=e,f.y-=n}),V.forEach(t.edges(),function(u){var f=t.edge(u);V.forEach(f.points,function(l){l.x-=e,l.y-=n}),V.has(f,"x")&&(f.x-=e),V.has(f,"y")&&(f.y-=n)}),s.width=r-e+o,s.height=i-n+a}function pX(t){V.forEach(t.edges(),function(e){var r=t.edge(e),n=t.node(e.v),i=t.node(e.w),s,o;r.points?(s=r.points[0],o=r.points[r.points.length-1]):(r.points=[],s=i,o=n),r.points.unshift(mn.intersectRect(n,s)),r.points.push(mn.intersectRect(i,o))})}function mX(t){V.forEach(t.edges(),function(e){var r=t.edge(e);if(V.has(r,"x"))switch((r.labelpos==="l"||r.labelpos==="r")&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}})}function gX(t){V.forEach(t.edges(),function(e){var r=t.edge(e);r.reversed&&r.points.reverse()})}function xX(t){V.forEach(t.nodes(),function(e){if(t.children(e).length){var r=t.node(e),n=t.node(r.borderTop),i=t.node(r.borderBottom),s=t.node(V.last(r.borderLeft)),o=t.node(V.last(r.borderRight));r.width=Math.abs(o.x-s.x),r.height=Math.abs(i.y-n.y),r.x=s.x+r.width/2,r.y=n.y+r.height/2}}),V.forEach(t.nodes(),function(e){t.node(e).dummy==="border"&&t.removeNode(e)})}function EX(t){V.forEach(t.edges(),function(e){if(e.v===e.w){var r=t.node(e.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e,label:t.edge(e)}),t.removeEdge(e)}})}function yX(t){var e=mn.buildLayerMatrix(t);V.forEach(e,function(r){var n=0;V.forEach(r,function(i,s){var o=t.node(i);o.order=s+n,V.forEach(o.selfEdges,function(a){mn.addDummyNode(t,"selfedge",{width:a.label.width,height:a.label.height,rank:o.rank,order:s+ ++n,e:a.e,label:a.label},"_se")}),delete o.selfEdges})})}function SX(t){V.forEach(t.nodes(),function(e){var r=t.node(e);if(r.dummy==="selfedge"){var n=t.node(r.e.v),i=n.x+n.width/2,s=n.y,o=r.x-i,a=n.height/2;t.setEdge(r.e,r.label),t.removeNode(e),r.label.points=[{x:i+2*o/3,y:s-a},{x:i+5*o/6,y:s-a},{x:i+o,y:s},{x:i+5*o/6,y:s+a},{x:i+2*o/3,y:s+a}],r.label.x=r.x,r.label.y=r.y}})}function Vd(t,e){return V.mapValues(V.pick(t,e),Number)}function Qd(t){var e={};return V.forEach(t,function(r,n){e[n.toLowerCase()]=r}),e}});var Mv=T((DEe,Rv)=>{var Yc=Te(),TX=xt(),OX=Kt().Graph;Rv.exports={debugOrdering:LX};function LX(t){var e=TX.buildLayerMatrix(t),r=new OX({compound:!0,multigraph:!0}).setGraph({});return Yc.forEach(t.nodes(),function(n){r.setNode(n,{label:n}),r.setParent(n,"layer"+t.node(n).rank)}),Yc.forEach(t.edges(),function(n){r.setEdge(n.v,n.w,{},n.name)}),Yc.forEach(e,function(n,i){var s="layer"+i;r.setNode(s,{rank:"same"}),Yc.reduce(n,function(o,a){return r.setEdge(o,a,{style:"invis"}),a})}),r}});var _v=T(($Ee,Uv)=>{Uv.exports="0.8.5"});var qv=T((BEe,Pv)=>{Pv.exports={graphlib:Kt(),layout:wv(),debug:Mv(),util:{time:xt().time,notime:xt().notime},version:_v()}});var uI=typeof global=="object"&&global&&global.Object===Object&&global,ia=uI;var hI=typeof self=="object"&&self&&self.Object===Object&&self,fI=ia||hI||Function("return this")(),Be=fI;var dI=Be.Symbol,Ve=dI;var fp=Object.prototype,pI=fp.hasOwnProperty,mI=fp.toString,fs=Ve?Ve.toStringTag:void 0;function gI(t){var e=pI.call(t,fs),r=t[fs];try{t[fs]=void 0;var n=!0}catch{}var i=mI.call(t);return n&&(e?t[fs]=r:delete t[fs]),i}var dp=gI;var xI=Object.prototype,EI=xI.toString;function yI(t){return EI.call(t)}var pp=yI;var SI="[object Null]",TI="[object Undefined]",mp=Ve?Ve.toStringTag:void 0;function OI(t){return t==null?t===void 0?TI:SI:mp&&mp in Object(t)?dp(t):pp(t)}var ht=OI;function LI(t){return t!=null&&typeof t=="object"}var Ue=LI;var AI="[object Symbol]";function bI(t){return typeof t=="symbol"||Ue(t)&&ht(t)==AI}var qr=bI;function NI(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var Yt=NI;var kI=Array.isArray,D=kI;var CI=1/0,gp=Ve?Ve.prototype:void 0,xp=gp?gp.toString:void 0;function Ep(t){if(typeof t=="string")return t;if(D(t))return Yt(t,Ep)+"";if(qr(t))return xp?xp.call(t):"";var e=t+"";return e=="0"&&1/t==-CI?"-0":e}var yp=Ep;var vI=/\s/;function II(t){for(var e=t.length;e--&&vI.test(t.charAt(e)););return e}var Sp=II;var wI=/^\s+/;function RI(t){return t&&t.slice(0,Sp(t)+1).replace(wI,"")}var Tp=RI;function MI(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var be=MI;var Op=NaN,UI=/^[-+]0x[0-9a-f]+$/i,_I=/^0b[01]+$/i,PI=/^0o[0-7]+$/i,qI=parseInt;function DI(t){if(typeof t=="number")return t;if(qr(t))return Op;if(be(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=be(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Tp(t);var r=_I.test(t);return r||PI.test(t)?qI(t.slice(2),r?2:8):UI.test(t)?Op:+t}var Lp=DI;var Ap=1/0,$I=17976931348623157e292;function BI(t){if(!t)return t===0?t:0;if(t=Lp(t),t===Ap||t===-Ap){var e=t<0?-1:1;return e*$I}return t===t?t:0}var bp=BI;function FI(t){var e=bp(t),r=e%1;return e===e?r?e-r:e:0}var Xt=FI;function KI(t){return t}var Ut=KI;var GI="[object AsyncFunction]",jI="[object Function]",WI="[object GeneratorFunction]",HI="[object Proxy]";function zI(t){if(!be(t))return!1;var e=ht(t);return e==jI||e==WI||e==GI||e==HI}var ft=zI;var VI=Be["__core-js_shared__"],sa=VI;var Np=(function(){var t=/[^.]+$/.exec(sa&&sa.keys&&sa.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function QI(t){return!!Np&&Np in t}var kp=QI;var YI=Function.prototype,XI=YI.toString;function ZI(t){if(t!=null){try{return XI.call(t)}catch{}try{return t+""}catch{}}return""}var Lr=ZI;var JI=/[\\^$.*+?()[\]{}|]/g,ew=/^\[object .+?Constructor\]$/,tw=Function.prototype,rw=Object.prototype,nw=tw.toString,iw=rw.hasOwnProperty,sw=RegExp("^"+nw.call(iw).replace(JI,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ow(t){if(!be(t)||kp(t))return!1;var e=ft(t)?sw:ew;return e.test(Lr(t))}var Cp=ow;function aw(t,e){return t?.[e]}var vp=aw;function lw(t,e){var r=vp(t,e);return Cp(r)?r:void 0}var St=lw;var cw=St(Be,"WeakMap"),oa=cw;var Ip=Object.create,uw=(function(){function t(){}return function(e){if(!be(e))return{};if(Ip)return Ip(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})(),wp=uw;function hw(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var Rp=hw;function fw(){}var Ne=fw;function dw(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var Mp=dw;var pw=800,mw=16,gw=Date.now;function xw(t){var e=0,r=0;return function(){var n=gw(),i=mw-(n-r);if(r=n,i>0){if(++e>=pw)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Up=xw;function Ew(t){return function(){return t}}var _p=Ew;var yw=(function(){try{var t=St(Object,"defineProperty");return t({},"",{}),t}catch{}})(),Zn=yw;var Sw=Zn?function(t,e){return Zn(t,"toString",{configurable:!0,enumerable:!1,value:_p(e),writable:!0})}:Ut,Pp=Sw;var Tw=Up(Pp),qp=Tw;function Ow(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}var aa=Ow;function Lw(t,e,r,n){for(var i=t.length,s=r+(n?1:-1);n?s--:++s<i;)if(e(t[s],s,t))return s;return-1}var la=Lw;function Aw(t){return t!==t}var Dp=Aw;function bw(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}var $p=bw;function Nw(t,e,r){return e===e?$p(t,e,r):la(t,Dp,r)}var Jn=Nw;function kw(t,e){var r=t==null?0:t.length;return!!r&&Jn(t,e,0)>-1}var ca=kw;var Cw=9007199254740991,vw=/^(?:0|[1-9]\d*)$/;function Iw(t,e){var r=typeof t;return e=e??Cw,!!e&&(r=="number"||r!="symbol"&&vw.test(t))&&t>-1&&t%1==0&&t<e}var Dr=Iw;function ww(t,e,r){e=="__proto__"&&Zn?Zn(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var ei=ww;function Rw(t,e){return t===e||t!==t&&e!==e}var Zt=Rw;var Mw=Object.prototype,Uw=Mw.hasOwnProperty;function _w(t,e,r){var n=t[e];(!(Uw.call(t,e)&&Zt(n,r))||r===void 0&&!(e in t))&&ei(t,e,r)}var $r=_w;function Pw(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(r[a],t[a],a,r,t):void 0;c===void 0&&(c=t[a]),i?ei(r,a,c):$r(r,a,c)}return r}var Jt=Pw;var Bp=Math.max;function qw(t,e,r){return e=Bp(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=Bp(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Rp(t,this,a)}}var Fp=qw;function Dw(t,e){return qp(Fp(t,e,Ut),t+"")}var ti=Dw;var $w=9007199254740991;function Bw(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=$w}var ri=Bw;function Fw(t){return t!=null&&ri(t.length)&&!ft(t)}var Fe=Fw;function Kw(t,e,r){if(!be(r))return!1;var n=typeof e;return(n=="number"?Fe(r)&&Dr(e,r.length):n=="string"&&e in r)?Zt(r[e],t):!1}var Br=Kw;function Gw(t){return ti(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&Br(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}var Kp=Gw;var jw=Object.prototype;function Ww(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||jw;return t===r}var er=Ww;function Hw(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Gp=Hw;var zw="[object Arguments]";function Vw(t){return Ue(t)&&ht(t)==zw}var lu=Vw;var jp=Object.prototype,Qw=jp.hasOwnProperty,Yw=jp.propertyIsEnumerable,Xw=lu((function(){return arguments})())?lu:function(t){return Ue(t)&&Qw.call(t,"callee")&&!Yw.call(t,"callee")},Fr=Xw;function Zw(){return!1}var Wp=Zw;var Vp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hp=Vp&&typeof module=="object"&&module&&!module.nodeType&&module,Jw=Hp&&Hp.exports===Vp,zp=Jw?Be.Buffer:void 0,eR=zp?zp.isBuffer:void 0,tR=eR||Wp,Ar=tR;var rR="[object Arguments]",nR="[object Array]",iR="[object Boolean]",sR="[object Date]",oR="[object Error]",aR="[object Function]",lR="[object Map]",cR="[object Number]",uR="[object Object]",hR="[object RegExp]",fR="[object Set]",dR="[object String]",pR="[object WeakMap]",mR="[object ArrayBuffer]",gR="[object DataView]",xR="[object Float32Array]",ER="[object Float64Array]",yR="[object Int8Array]",SR="[object Int16Array]",TR="[object Int32Array]",OR="[object Uint8Array]",LR="[object Uint8ClampedArray]",AR="[object Uint16Array]",bR="[object Uint32Array]",Ee={};Ee[xR]=Ee[ER]=Ee[yR]=Ee[SR]=Ee[TR]=Ee[OR]=Ee[LR]=Ee[AR]=Ee[bR]=!0;Ee[rR]=Ee[nR]=Ee[mR]=Ee[iR]=Ee[gR]=Ee[sR]=Ee[oR]=Ee[aR]=Ee[lR]=Ee[cR]=Ee[uR]=Ee[hR]=Ee[fR]=Ee[dR]=Ee[pR]=!1;function NR(t){return Ue(t)&&ri(t.length)&&!!Ee[ht(t)]}var Qp=NR;function kR(t){return function(e){return t(e)}}var tr=kR;var Yp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ds=Yp&&typeof module=="object"&&module&&!module.nodeType&&module,CR=ds&&ds.exports===Yp,cu=CR&&ia.process,vR=(function(){try{var t=ds&&ds.require&&ds.require("util").types;return t||cu&&cu.binding&&cu.binding("util")}catch{}})(),_t=vR;var Xp=_t&&_t.isTypedArray,IR=Xp?tr(Xp):Qp,ni=IR;var wR=Object.prototype,RR=wR.hasOwnProperty;function MR(t,e){var r=D(t),n=!r&&Fr(t),i=!r&&!n&&Ar(t),s=!r&&!n&&!i&&ni(t),o=r||n||i||s,a=o?Gp(t.length,String):[],c=a.length;for(var u in t)(e||RR.call(t,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Dr(u,c)))&&a.push(u);return a}var ua=MR;function UR(t,e){return function(r){return t(e(r))}}var ha=UR;var _R=ha(Object.keys,Object),Zp=_R;var PR=Object.prototype,qR=PR.hasOwnProperty;function DR(t){if(!er(t))return Zp(t);var e=[];for(var r in Object(t))qR.call(t,r)&&r!="constructor"&&e.push(r);return e}var fa=DR;function $R(t){return Fe(t)?ua(t):fa(t)}var he=$R;var BR=Object.prototype,FR=BR.hasOwnProperty,KR=Kp(function(t,e){if(er(e)||Fe(e)){Jt(e,he(e),t);return}for(var r in e)FR.call(e,r)&&$r(t,r,e[r])}),Xe=KR;function GR(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Jp=GR;var jR=Object.prototype,WR=jR.hasOwnProperty;function HR(t){if(!be(t))return Jp(t);var e=er(t),r=[];for(var n in t)n=="constructor"&&(e||!WR.call(t,n))||r.push(n);return r}var em=HR;function zR(t){return Fe(t)?ua(t,!0):em(t)}var Kr=zR;var VR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,QR=/^\w*$/;function YR(t,e){if(D(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||qr(t)?!0:QR.test(t)||!VR.test(t)||e!=null&&t in Object(e)}var ii=YR;var XR=St(Object,"create"),br=XR;function ZR(){this.__data__=br?br(null):{},this.size=0}var tm=ZR;function JR(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var rm=JR;var eM="__lodash_hash_undefined__",tM=Object.prototype,rM=tM.hasOwnProperty;function nM(t){var e=this.__data__;if(br){var r=e[t];return r===eM?void 0:r}return rM.call(e,t)?e[t]:void 0}var nm=nM;var iM=Object.prototype,sM=iM.hasOwnProperty;function oM(t){var e=this.__data__;return br?e[t]!==void 0:sM.call(e,t)}var im=oM;var aM="__lodash_hash_undefined__";function lM(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=br&&e===void 0?aM:e,this}var sm=lM;function si(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}si.prototype.clear=tm;si.prototype.delete=rm;si.prototype.get=nm;si.prototype.has=im;si.prototype.set=sm;var uu=si;function cM(){this.__data__=[],this.size=0}var om=cM;function uM(t,e){for(var r=t.length;r--;)if(Zt(t[r][0],e))return r;return-1}var Gr=uM;var hM=Array.prototype,fM=hM.splice;function dM(t){var e=this.__data__,r=Gr(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():fM.call(e,r,1),--this.size,!0}var am=dM;function pM(t){var e=this.__data__,r=Gr(e,t);return r<0?void 0:e[r][1]}var lm=pM;function mM(t){return Gr(this.__data__,t)>-1}var cm=mM;function gM(t,e){var r=this.__data__,n=Gr(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var um=gM;function oi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}oi.prototype.clear=om;oi.prototype.delete=am;oi.prototype.get=lm;oi.prototype.has=cm;oi.prototype.set=um;var jr=oi;var xM=St(Be,"Map"),Wr=xM;function EM(){this.size=0,this.__data__={hash:new uu,map:new(Wr||jr),string:new uu}}var hm=EM;function yM(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var fm=yM;function SM(t,e){var r=t.__data__;return fm(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Hr=SM;function TM(t){var e=Hr(this,t).delete(t);return this.size-=e?1:0,e}var dm=TM;function OM(t){return Hr(this,t).get(t)}var pm=OM;function LM(t){return Hr(this,t).has(t)}var mm=LM;function AM(t,e){var r=Hr(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var gm=AM;function ai(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ai.prototype.clear=hm;ai.prototype.delete=dm;ai.prototype.get=pm;ai.prototype.has=mm;ai.prototype.set=gm;var Sn=ai;var bM="Expected a function";function hu(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(bM);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(hu.Cache||Sn),r}hu.Cache=Sn;var xm=hu;var NM=500;function kM(t){var e=xm(t,function(n){return r.size===NM&&r.clear(),n}),r=e.cache;return e}var Em=kM;var CM=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vM=/\\(\\)?/g,IM=Em(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(CM,function(r,n,i,s){e.push(i?s.replace(vM,"$1"):n||r)}),e}),ym=IM;function wM(t){return t==null?"":yp(t)}var Sm=wM;function RM(t,e){return D(t)?t:ii(t,e)?[t]:ym(Sm(t))}var zr=RM;var MM=1/0;function UM(t){if(typeof t=="string"||qr(t))return t;var e=t+"";return e=="0"&&1/t==-MM?"-0":e}var rr=UM;function _M(t,e){e=zr(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[rr(e[r++])];return r&&r==n?t:void 0}var li=_M;function PM(t,e,r){var n=t==null?void 0:li(t,e);return n===void 0?r:n}var Tm=PM;function qM(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var ci=qM;var Om=Ve?Ve.isConcatSpreadable:void 0;function DM(t){return D(t)||Fr(t)||!!(Om&&t&&t[Om])}var Lm=DM;function Am(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=Lm),i||(i=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?Am(a,e-1,r,n,i):ci(i,a):n||(i[i.length]=a)}return i}var ui=Am;function $M(t){var e=t==null?0:t.length;return e?ui(t,1):[]}var We=$M;var BM=ha(Object.getPrototypeOf,Object),da=BM;function FM(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}var pa=FM;function KM(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}var bm=KM;function GM(){this.__data__=new jr,this.size=0}var Nm=GM;function jM(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var km=jM;function WM(t){return this.__data__.get(t)}var Cm=WM;function HM(t){return this.__data__.has(t)}var vm=HM;var zM=200;function VM(t,e){var r=this.__data__;if(r instanceof jr){var n=r.__data__;if(!Wr||n.length<zM-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Sn(n)}return r.set(t,e),this.size=r.size,this}var Im=VM;function hi(t){var e=this.__data__=new jr(t);this.size=e.size}hi.prototype.clear=Nm;hi.prototype.delete=km;hi.prototype.get=Cm;hi.prototype.has=vm;hi.prototype.set=Im;var Vr=hi;function QM(t,e){return t&&Jt(e,he(e),t)}var wm=QM;function YM(t,e){return t&&Jt(e,Kr(e),t)}var Rm=YM;var Pm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Mm=Pm&&typeof module=="object"&&module&&!module.nodeType&&module,XM=Mm&&Mm.exports===Pm,Um=XM?Be.Buffer:void 0,_m=Um?Um.allocUnsafe:void 0;function ZM(t,e){if(e)return t.slice();var r=t.length,n=_m?_m(r):new t.constructor(r);return t.copy(n),n}var qm=ZM;function JM(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}var fi=JM;function eU(){return[]}var ma=eU;var tU=Object.prototype,rU=tU.propertyIsEnumerable,Dm=Object.getOwnPropertySymbols,nU=Dm?function(t){return t==null?[]:(t=Object(t),fi(Dm(t),function(e){return rU.call(t,e)}))}:ma,di=nU;function iU(t,e){return Jt(t,di(t),e)}var $m=iU;var sU=Object.getOwnPropertySymbols,oU=sU?function(t){for(var e=[];t;)ci(e,di(t)),t=da(t);return e}:ma,ga=oU;function aU(t,e){return Jt(t,ga(t),e)}var Bm=aU;function lU(t,e,r){var n=e(t);return D(t)?n:ci(n,r(t))}var xa=lU;function cU(t){return xa(t,he,di)}var ps=cU;function uU(t){return xa(t,Kr,ga)}var Ea=uU;var hU=St(Be,"DataView"),ya=hU;var fU=St(Be,"Promise"),Sa=fU;var dU=St(Be,"Set"),Qr=dU;var Fm="[object Map]",pU="[object Object]",Km="[object Promise]",Gm="[object Set]",jm="[object WeakMap]",Wm="[object DataView]",mU=Lr(ya),gU=Lr(Wr),xU=Lr(Sa),EU=Lr(Qr),yU=Lr(oa),Tn=ht;(ya&&Tn(new ya(new ArrayBuffer(1)))!=Wm||Wr&&Tn(new Wr)!=Fm||Sa&&Tn(Sa.resolve())!=Km||Qr&&Tn(new Qr)!=Gm||oa&&Tn(new oa)!=jm)&&(Tn=function(t){var e=ht(t),r=e==pU?t.constructor:void 0,n=r?Lr(r):"";if(n)switch(n){case mU:return Wm;case gU:return Fm;case xU:return Km;case EU:return Gm;case yU:return jm}return e});var Wt=Tn;var SU=Object.prototype,TU=SU.hasOwnProperty;function OU(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&TU.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Hm=OU;var LU=Be.Uint8Array,pi=LU;function AU(t){var e=new t.constructor(t.byteLength);return new pi(e).set(new pi(t)),e}var mi=AU;function bU(t,e){var r=e?mi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var zm=bU;var NU=/\w*$/;function kU(t){var e=new t.constructor(t.source,NU.exec(t));return e.lastIndex=t.lastIndex,e}var Vm=kU;var Qm=Ve?Ve.prototype:void 0,Ym=Qm?Qm.valueOf:void 0;function CU(t){return Ym?Object(Ym.call(t)):{}}var Xm=CU;function vU(t,e){var r=e?mi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Zm=vU;var IU="[object Boolean]",wU="[object Date]",RU="[object Map]",MU="[object Number]",UU="[object RegExp]",_U="[object Set]",PU="[object String]",qU="[object Symbol]",DU="[object ArrayBuffer]",$U="[object DataView]",BU="[object Float32Array]",FU="[object Float64Array]",KU="[object Int8Array]",GU="[object Int16Array]",jU="[object Int32Array]",WU="[object Uint8Array]",HU="[object Uint8ClampedArray]",zU="[object Uint16Array]",VU="[object Uint32Array]";function QU(t,e,r){var n=t.constructor;switch(e){case DU:return mi(t);case IU:case wU:return new n(+t);case $U:return zm(t,r);case BU:case FU:case KU:case GU:case jU:case WU:case HU:case zU:case VU:return Zm(t,r);case RU:return new n;case MU:case PU:return new n(t);case UU:return Vm(t);case _U:return new n;case qU:return Xm(t)}}var Jm=QU;function YU(t){return typeof t.constructor=="function"&&!er(t)?wp(da(t)):{}}var eg=YU;var XU="[object Map]";function ZU(t){return Ue(t)&&Wt(t)==XU}var tg=ZU;var rg=_t&&_t.isMap,JU=rg?tr(rg):tg,ng=JU;var e1="[object Set]";function t1(t){return Ue(t)&&Wt(t)==e1}var ig=t1;var sg=_t&&_t.isSet,r1=sg?tr(sg):ig,og=r1;var n1=1,i1=2,s1=4,ag="[object Arguments]",o1="[object Array]",a1="[object Boolean]",l1="[object Date]",c1="[object Error]",lg="[object Function]",u1="[object GeneratorFunction]",h1="[object Map]",f1="[object Number]",cg="[object Object]",d1="[object RegExp]",p1="[object Set]",m1="[object String]",g1="[object Symbol]",x1="[object WeakMap]",E1="[object ArrayBuffer]",y1="[object DataView]",S1="[object Float32Array]",T1="[object Float64Array]",O1="[object Int8Array]",L1="[object Int16Array]",A1="[object Int32Array]",b1="[object Uint8Array]",N1="[object Uint8ClampedArray]",k1="[object Uint16Array]",C1="[object Uint32Array]",fe={};fe[ag]=fe[o1]=fe[E1]=fe[y1]=fe[a1]=fe[l1]=fe[S1]=fe[T1]=fe[O1]=fe[L1]=fe[A1]=fe[h1]=fe[f1]=fe[cg]=fe[d1]=fe[p1]=fe[m1]=fe[g1]=fe[b1]=fe[N1]=fe[k1]=fe[C1]=!0;fe[c1]=fe[lg]=fe[x1]=!1;function Ta(t,e,r,n,i,s){var o,a=e&n1,c=e&i1,u=e&s1;if(r&&(o=i?r(t,n,i,s):r(t)),o!==void 0)return o;if(!be(t))return t;var f=D(t);if(f){if(o=Hm(t),!a)return Mp(t,o)}else{var l=Wt(t),d=l==lg||l==u1;if(Ar(t))return qm(t,a);if(l==cg||l==ag||d&&!i){if(o=c||d?{}:eg(t),!a)return c?Bm(t,Rm(o,t)):$m(t,wm(o,t))}else{if(!fe[l])return i?t:{};o=Jm(t,l,a)}}s||(s=new Vr);var h=s.get(t);if(h)return h;s.set(t,o),og(t)?t.forEach(function(m){o.add(Ta(m,e,r,m,t,s))}):ng(t)&&t.forEach(function(m,g){o.set(g,Ta(m,e,r,g,t,s))});var p=u?c?Ea:ps:c?Kr:he,x=f?void 0:p(t);return aa(x||t,function(m,g){x&&(g=m,m=t[g]),$r(o,g,Ta(m,e,r,g,t,s))}),o}var ug=Ta;var v1=4;function I1(t){return ug(t,v1)}var de=I1;function w1(t){for(var e=-1,r=t==null?0:t.length,n=0,i=[];++e<r;){var s=t[e];s&&(i[n++]=s)}return i}var nr=w1;var R1="__lodash_hash_undefined__";function M1(t){return this.__data__.set(t,R1),this}var hg=M1;function U1(t){return this.__data__.has(t)}var fg=U1;function Oa(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Sn;++e<r;)this.add(t[e])}Oa.prototype.add=Oa.prototype.push=hg;Oa.prototype.has=fg;var gi=Oa;function _1(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var La=_1;function P1(t,e){return t.has(e)}var xi=P1;var q1=1,D1=2;function $1(t,e,r,n,i,s){var o=r&q1,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(t),f=s.get(e);if(u&&f)return u==e&&f==t;var l=-1,d=!0,h=r&D1?new gi:void 0;for(s.set(t,e),s.set(e,t);++l<a;){var p=t[l],x=e[l];if(n)var m=o?n(x,p,l,e,t,s):n(p,x,l,t,e,s);if(m!==void 0){if(m)continue;d=!1;break}if(h){if(!La(e,function(g,S){if(!xi(h,S)&&(p===g||i(p,g,r,n,s)))return h.push(S)})){d=!1;break}}else if(!(p===x||i(p,x,r,n,s))){d=!1;break}}return s.delete(t),s.delete(e),d}var Aa=$1;function B1(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var dg=B1;function F1(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Ei=F1;var K1=1,G1=2,j1="[object Boolean]",W1="[object Date]",H1="[object Error]",z1="[object Map]",V1="[object Number]",Q1="[object RegExp]",Y1="[object Set]",X1="[object String]",Z1="[object Symbol]",J1="[object ArrayBuffer]",e_="[object DataView]",pg=Ve?Ve.prototype:void 0,fu=pg?pg.valueOf:void 0;function t_(t,e,r,n,i,s,o){switch(r){case e_:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case J1:return!(t.byteLength!=e.byteLength||!s(new pi(t),new pi(e)));case j1:case W1:case V1:return Zt(+t,+e);case H1:return t.name==e.name&&t.message==e.message;case Q1:case X1:return t==e+"";case z1:var a=dg;case Y1:var c=n&K1;if(a||(a=Ei),t.size!=e.size&&!c)return!1;var u=o.get(t);if(u)return u==e;n|=G1,o.set(t,e);var f=Aa(a(t),a(e),n,i,s,o);return o.delete(t),f;case Z1:if(fu)return fu.call(t)==fu.call(e)}return!1}var mg=t_;var r_=1,n_=Object.prototype,i_=n_.hasOwnProperty;function s_(t,e,r,n,i,s){var o=r&r_,a=ps(t),c=a.length,u=ps(e),f=u.length;if(c!=f&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in e:i_.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var x=!0;s.set(t,e),s.set(e,t);for(var m=o;++l<c;){d=a[l];var g=t[d],S=e[d];if(n)var E=o?n(S,g,d,e,t,s):n(g,S,d,t,e,s);if(!(E===void 0?g===S||i(g,S,r,n,s):E)){x=!1;break}m||(m=d=="constructor")}if(x&&!m){var y=t.constructor,O=e.constructor;y!=O&&"constructor"in t&&"constructor"in e&&!(typeof y=="function"&&y instanceof y&&typeof O=="function"&&O instanceof O)&&(x=!1)}return s.delete(t),s.delete(e),x}var gg=s_;var o_=1,xg="[object Arguments]",Eg="[object Array]",ba="[object Object]",a_=Object.prototype,yg=a_.hasOwnProperty;function l_(t,e,r,n,i,s){var o=D(t),a=D(e),c=o?Eg:Wt(t),u=a?Eg:Wt(e);c=c==xg?ba:c,u=u==xg?ba:u;var f=c==ba,l=u==ba,d=c==u;if(d&&Ar(t)){if(!Ar(e))return!1;o=!0,f=!1}if(d&&!f)return s||(s=new Vr),o||ni(t)?Aa(t,e,r,n,i,s):mg(t,e,c,r,n,i,s);if(!(r&o_)){var h=f&&yg.call(t,"__wrapped__"),p=l&&yg.call(e,"__wrapped__");if(h||p){var x=h?t.value():t,m=p?e.value():e;return s||(s=new Vr),i(x,m,r,n,s)}}return d?(s||(s=new Vr),gg(t,e,r,n,i,s)):!1}var Sg=l_;function Tg(t,e,r,n,i){return t===e?!0:t==null||e==null||!Ue(t)&&!Ue(e)?t!==t&&e!==e:Sg(t,e,r,n,Tg,i)}var Na=Tg;var c_=1,u_=2;function h_(t,e,r,n){var i=r.length,s=i,o=!n;if(t==null)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=r[i];var c=a[0],u=t[c],f=a[1];if(o&&a[2]){if(u===void 0&&!(c in t))return!1}else{var l=new Vr;if(n)var d=n(u,f,c,t,e,l);if(!(d===void 0?Na(f,u,c_|u_,n,l):d))return!1}}return!0}var Og=h_;function f_(t){return t===t&&!be(t)}var ka=f_;function d_(t){for(var e=he(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,ka(i)]}return e}var Lg=d_;function p_(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var Ca=p_;function m_(t){var e=Lg(t);return e.length==1&&e[0][2]?Ca(e[0][0],e[0][1]):function(r){return r===t||Og(r,t,e)}}var Ag=m_;function g_(t,e){return t!=null&&e in Object(t)}var bg=g_;function x_(t,e,r){e=zr(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=rr(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&ri(i)&&Dr(o,i)&&(D(t)||Fr(t)))}var va=x_;function E_(t,e){return t!=null&&va(t,e,bg)}var Ng=E_;var y_=1,S_=2;function T_(t,e){return ii(t)&&ka(e)?Ca(rr(t),e):function(r){var n=Tm(r,t);return n===void 0&&n===e?Ng(r,t):Na(e,n,y_|S_)}}var kg=T_;function O_(t){return function(e){return e?.[t]}}var Cg=O_;function L_(t){return function(e){return li(e,t)}}var vg=L_;function A_(t){return ii(t)?Cg(rr(t)):vg(t)}var Ig=A_;function b_(t){return typeof t=="function"?t:t==null?Ut:typeof t=="object"?D(t)?kg(t[0],t[1]):Ag(t):Ig(t)}var Ke=b_;function N_(t,e,r,n){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(n,o,r(o),t)}return n}var wg=N_;function k_(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[t?a:++i];if(r(s[c],c,s)===!1)break}return e}}var Rg=k_;var C_=Rg(),Mg=C_;function v_(t,e){return t&&Mg(t,e,he)}var Ug=v_;function I_(t,e){return function(r,n){if(r==null)return r;if(!Fe(r))return t(r,n);for(var i=r.length,s=e?i:-1,o=Object(r);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return r}}var _g=I_;var w_=_g(Ug),Tt=w_;function R_(t,e,r,n){return Tt(t,function(i,s,o){e(n,i,r(i),o)}),n}var Pg=R_;function M_(t,e){return function(r,n){var i=D(r)?wg:Pg,s=e?e():{};return i(r,t,Ke(n,2),s)}}var qg=M_;var Dg=Object.prototype,U_=Dg.hasOwnProperty,__=ti(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&Br(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=Kr(s),a=-1,c=o.length;++a<c;){var u=o[a],f=t[u];(f===void 0||Zt(f,Dg[u])&&!U_.call(t,u))&&(t[u]=s[u])}return t}),yi=__;function P_(t){return Ue(t)&&Fe(t)}var du=P_;function q_(t,e,r){for(var n=-1,i=t==null?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1}var Ia=q_;var D_=200;function $_(t,e,r,n){var i=-1,s=ca,o=!0,a=t.length,c=[],u=e.length;if(!a)return c;r&&(e=Yt(e,tr(r))),n?(s=Ia,o=!1):e.length>=D_&&(s=xi,o=!1,e=new gi(e));e:for(;++i<a;){var f=t[i],l=r==null?f:r(f);if(f=n||f!==0?f:0,o&&l===l){for(var d=u;d--;)if(e[d]===l)continue e;c.push(f)}else s(e,l,n)||c.push(f)}return c}var $g=$_;var B_=ti(function(t,e){return du(t)?$g(t,ui(e,1,du,!0)):[]}),Yr=B_;function F_(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var ir=F_;function K_(t,e,r){var n=t==null?0:t.length;return n?(e=r||e===void 0?1:Xt(e),pa(t,e<0?0:e,n)):[]}var _e=K_;function G_(t,e,r){var n=t==null?0:t.length;return n?(e=r||e===void 0?1:Xt(e),e=n-e,pa(t,0,e<0?0:e)):[]}var Nr=G_;function j_(t){return typeof t=="function"?t:Ut}var Bg=j_;function W_(t,e){var r=D(t)?aa:Tt;return r(t,Bg(e))}var P=W_;function H_(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}var Fg=H_;function z_(t,e){var r=!0;return Tt(t,function(n,i,s){return r=!!e(n,i,s),r}),r}var Kg=z_;function V_(t,e,r){var n=D(t)?Fg:Kg;return r&&Br(t,e,r)&&(e=void 0),n(t,Ke(e,3))}var it=V_;function Q_(t,e){var r=[];return Tt(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}var wa=Q_;function Y_(t,e){var r=D(t)?fi:wa;return r(t,Ke(e,3))}var st=Y_;function X_(t){return function(e,r,n){var i=Object(e);if(!Fe(e)){var s=Ke(r,3);e=he(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}var Gg=X_;var Z_=Math.max;function J_(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:Xt(r);return i<0&&(i=Z_(n+i,0)),la(t,Ke(e,3),i)}var jg=J_;var e0=Gg(jg),sr=e0;function t0(t){return t&&t.length?t[0]:void 0}var Qe=t0;function r0(t,e){var r=-1,n=Fe(t)?Array(t.length):[];return Tt(t,function(i,s,o){n[++r]=e(i,s,o)}),n}var Wg=r0;function n0(t,e){var r=D(t)?Yt:Wg;return r(t,Ke(e,3))}var U=n0;function i0(t,e){return ui(U(t,e),1)}var dt=i0;var s0=Object.prototype,o0=s0.hasOwnProperty,a0=qg(function(t,e,r){o0.call(t,r)?t[r].push(e):ei(t,r,[e])}),pu=a0;var l0=Object.prototype,c0=l0.hasOwnProperty;function u0(t,e){return t!=null&&c0.call(t,e)}var Hg=u0;function h0(t,e){return t!=null&&va(t,e,Hg)}var q=h0;var f0="[object String]";function d0(t){return typeof t=="string"||!D(t)&&Ue(t)&&ht(t)==f0}var He=d0;function p0(t,e){return Yt(e,function(r){return t[r]})}var zg=p0;function m0(t){return t==null?[]:zg(t,he(t))}var ce=m0;var g0=Math.max;function x0(t,e,r,n){t=Fe(t)?t:ce(t),r=r&&!n?Xt(r):0;var i=t.length;return r<0&&(r=g0(i+r,0)),He(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&Jn(t,e,r)>-1}var Oe=x0;var E0=Math.max;function y0(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:Xt(r);return i<0&&(i=E0(n+i,0)),Jn(t,e,i)}var Ra=y0;var S0="[object Map]",T0="[object Set]",O0=Object.prototype,L0=O0.hasOwnProperty;function A0(t){if(t==null)return!0;if(Fe(t)&&(D(t)||typeof t=="string"||typeof t.splice=="function"||Ar(t)||ni(t)||Fr(t)))return!t.length;var e=Wt(t);if(e==S0||e==T0)return!t.size;if(er(t))return!fa(t).length;for(var r in t)if(L0.call(t,r))return!1;return!0}var Q=A0;var b0="[object RegExp]";function N0(t){return Ue(t)&&ht(t)==b0}var Vg=N0;var Qg=_t&&_t.isRegExp,k0=Qg?tr(Qg):Vg,Pt=k0;function C0(t){return t===void 0}var ot=C0;var v0="Expected a function";function I0(t){if(typeof t!="function")throw new TypeError(v0);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}var Yg=I0;function w0(t,e,r,n){if(!be(t))return t;e=zr(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=rr(e[i]),u=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var f=a[c];u=n?n(f,c,a):void 0,u===void 0&&(u=be(f)?f:Dr(e[i+1])?[]:{})}$r(a,c,u),a=a[c]}return t}var Xg=w0;function R0(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=li(t,o);r(a,o)&&Xg(s,zr(o,t),a)}return s}var Zg=R0;function M0(t,e){if(t==null)return{};var r=Yt(Ea(t),function(n){return[n]});return e=Ke(e),Zg(t,r,function(n,i){return e(n,i[0])})}var Ot=M0;function U0(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}var Jg=U0;function _0(t,e,r){var n=D(t)?bm:Jg,i=arguments.length<3;return n(t,Ke(e,4),r,i,Tt)}var Ge=_0;function P0(t,e){var r=D(t)?fi:wa;return r(t,Yg(Ke(e,3)))}var Xr=P0;function q0(t,e){var r;return Tt(t,function(n,i,s){return r=e(n,i,s),!r}),!!r}var ex=q0;function D0(t,e,r){var n=D(t)?La:ex;return r&&Br(t,e,r)&&(e=void 0),n(t,Ke(e,3))}var ms=D0;var $0=1/0,B0=Qr&&1/Ei(new Qr([,-0]))[1]==$0?function(t){return new Qr(t)}:Ne,tx=B0;var F0=200;function K0(t,e,r){var n=-1,i=ca,s=t.length,o=!0,a=[],c=a;if(r)o=!1,i=Ia;else if(s>=F0){var u=e?null:tx(t);if(u)return Ei(u);o=!1,i=xi,c=new gi}else c=e?[]:a;e:for(;++n<s;){var f=t[n],l=e?e(f):f;if(f=r||f!==0?f:0,o&&l===l){for(var d=c.length;d--;)if(c[d]===l)continue e;e&&c.push(l),a.push(f)}else i(c,l,r)||(c!==a&&c.push(l),a.push(f))}return a}var rx=K0;function G0(t){return t&&t.length?rx(t):[]}var Si=G0;function Ti(t){console&&console.error&&console.error(`Error: ${t}`)}function gs(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function xs(t){let e=new Date().getTime(),r=t();return{time:new Date().getTime()-e,value:r}}function Es(t){function e(){}e.prototype=t;let r=new e;function n(){return typeof r.bar}return n(),n(),t;(0,eval)(t)}function j0(t){return W0(t)?t.LABEL:t.name}function W0(t){return He(t.LABEL)&&t.LABEL!==""}var kt=class{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),P(this.definition,r=>{r.accept(e)})}},pe=class extends kt{constructor(e){super([]),this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}},pt=class extends kt{constructor(e){super(e.definition),this.orgText="",Xe(this,Ot(e,r=>r!==void 0))}},me=class extends kt{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Xe(this,Ot(e,r=>r!==void 0))}},ye=class extends kt{constructor(e){super(e.definition),this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}},Pe=class extends kt{constructor(e){super(e.definition),this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}},qe=class extends kt{constructor(e){super(e.definition),this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}},oe=class extends kt{constructor(e){super(e.definition),this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}},ve=class extends kt{constructor(e){super(e.definition),this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}},Ie=class extends kt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Xe(this,Ot(e,r=>r!==void 0))}},te=class{constructor(e){this.idx=1,Xe(this,Ot(e,r=>r!==void 0))}accept(e){e.visit(this)}};function Ma(t){return U(t,Oi)}function Oi(t){function e(r){return U(r,Oi)}if(t instanceof pe){let r={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return He(t.label)&&(r.label=t.label),r}else{if(t instanceof me)return{type:"Alternative",definition:e(t.definition)};if(t instanceof ye)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Pe)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof qe)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Oi(new te({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ve)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Oi(new te({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof oe)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Ie)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof te){let r={type:"Terminal",name:t.terminalType.name,label:j0(t.terminalType),idx:t.idx};He(t.label)&&(r.terminalLabel=t.label);let n=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(r.pattern=Pt(n)?n.source:n),r}else{if(t instanceof pt)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}var mt=class{visit(e){let r=e;switch(r.constructor){case pe:return this.visitNonTerminal(r);case me:return this.visitAlternative(r);case ye:return this.visitOption(r);case Pe:return this.visitRepetitionMandatory(r);case qe:return this.visitRepetitionMandatoryWithSeparator(r);case ve:return this.visitRepetitionWithSeparator(r);case oe:return this.visitRepetition(r);case Ie:return this.visitAlternation(r);case te:return this.visitTerminal(r);case pt:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}};function mu(t){return t instanceof me||t instanceof ye||t instanceof oe||t instanceof Pe||t instanceof qe||t instanceof ve||t instanceof te||t instanceof pt}function On(t,e=[]){return t instanceof ye||t instanceof oe||t instanceof ve?!0:t instanceof Ie?ms(t.definition,n=>On(n,e)):t instanceof pe&&Oe(e,t)?!1:t instanceof kt?(t instanceof pe&&e.push(t),it(t.definition,n=>On(n,e))):!1}function gu(t){return t instanceof Ie}function Lt(t){if(t instanceof pe)return"SUBRULE";if(t instanceof ye)return"OPTION";if(t instanceof Ie)return"OR";if(t instanceof Pe)return"AT_LEAST_ONE";if(t instanceof qe)return"AT_LEAST_ONE_SEP";if(t instanceof ve)return"MANY_SEP";if(t instanceof oe)return"MANY";if(t instanceof te)return"CONSUME";throw Error("non exhaustive match")}var kr=class{walk(e,r=[]){P(e.definition,(n,i)=>{let s=_e(e.definition,i+1);if(n instanceof pe)this.walkProdRef(n,s,r);else if(n instanceof te)this.walkTerminal(n,s,r);else if(n instanceof me)this.walkFlat(n,s,r);else if(n instanceof ye)this.walkOption(n,s,r);else if(n instanceof Pe)this.walkAtLeastOne(n,s,r);else if(n instanceof qe)this.walkAtLeastOneSep(n,s,r);else if(n instanceof ve)this.walkManySep(n,s,r);else if(n instanceof oe)this.walkMany(n,s,r);else if(n instanceof Ie)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(e,r,n){}walkProdRef(e,r,n){}walkFlat(e,r,n){let i=r.concat(n);this.walk(e,i)}walkOption(e,r,n){let i=r.concat(n);this.walk(e,i)}walkAtLeastOne(e,r,n){let i=[new ye({definition:e.definition})].concat(r,n);this.walk(e,i)}walkAtLeastOneSep(e,r,n){let i=nx(e,r,n);this.walk(e,i)}walkMany(e,r,n){let i=[new ye({definition:e.definition})].concat(r,n);this.walk(e,i)}walkManySep(e,r,n){let i=nx(e,r,n);this.walk(e,i)}walkOr(e,r,n){let i=r.concat(n);P(e.definition,s=>{let o=new me({definition:[s]});this.walk(o,i)})}};function nx(t,e,r){return[new ye({definition:[new te({terminalType:t.separator})].concat(t.definition)})].concat(e,r)}function Ln(t){if(t instanceof pe)return Ln(t.referencedRule);if(t instanceof te)return V0(t);if(mu(t))return H0(t);if(gu(t))return z0(t);throw Error("non exhaustive match")}function H0(t){let e=[],r=t.definition,n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=On(s),e=e.concat(Ln(s)),n=n+1,i=r.length>n;return Si(e)}function z0(t){let e=U(t.definition,r=>Ln(r));return Si(We(e))}function V0(t){return[t.terminalType]}var Ua="_~IN~_";var xu=class extends kr{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,r,n){}walkProdRef(e,r,n){let i=Q0(e.referencedRule,e.idx)+this.topProd.name,s=r.concat(n),o=new me({definition:s}),a=Ln(o);this.follows[i]=a}};function ix(t){let e={};return P(t,r=>{let n=new xu(r).startWalking();Xe(e,n)}),e}function Q0(t,e){return t.name+e+Ua}function B(t){return t.charCodeAt(0)}function _a(t,e){Array.isArray(t)?t.forEach(function(r){e.push(r)}):e.push(t)}function Li(t,e){if(t[e]===!0)throw"duplicate flag "+e;let r=t[e];t[e]=!0}function An(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function ys(){throw Error("Internal Error - Should never get here!")}function Eu(t){return t.type==="Character"}var Ss=[];for(let t=B("0");t<=B("9");t++)Ss.push(t);var Ts=[B("_")].concat(Ss);for(let t=B("a");t<=B("z");t++)Ts.push(t);for(let t=B("A");t<=B("Z");t++)Ts.push(t);var yu=[B(" "),B("\f"),B(`
`),B("\r"),B("	"),B("\v"),B("	"),B("\xA0"),B("\u1680"),B("\u2000"),B("\u2001"),B("\u2002"),B("\u2003"),B("\u2004"),B("\u2005"),B("\u2006"),B("\u2007"),B("\u2008"),B("\u2009"),B("\u200A"),B("\u2028"),B("\u2029"),B("\u202F"),B("\u205F"),B("\u3000"),B("\uFEFF")];var Y0=/[0-9a-fA-F]/,Pa=/[0-9]/,X0=/[1-9]/,Os=class{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");let r=this.disjunction();this.consumeChar("/");let n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Li(n,"global");break;case"i":Li(n,"ignoreCase");break;case"m":Li(n,"multiLine");break;case"u":Li(n,"unicode");break;case"y":Li(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){let e=[],r=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(r)}}alternative(){let e=[],r=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){let e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}An(r);let n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(e)}}return ys()}quantifier(e=!1){let r,n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":let i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&r===void 0)return;An(r);break}if(!(e===!0&&r===void 0)&&An(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let e,r=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}return e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),An(e)?(e.loc=this.loc(r),this.isQuantifier()&&(e.quantifier=this.quantifier()),e):ys()}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[B(`
`),B("\r"),B("\u2028"),B("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,r=!1;switch(this.popChar()){case"d":e=Ss;break;case"D":e=Ss,r=!0;break;case"s":e=yu;break;case"S":e=yu,r=!0;break;case"w":e=Ts;break;case"W":e=Ts,r=!0;break}return An(e)?{type:"Set",value:e,complement:r}:ys()}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=B("\f");break;case"n":e=B(`
`);break;case"r":e=B("\r");break;case"t":e=B("	");break;case"v":e=B("\v");break}return An(e)?{type:"Character",value:e}:ys()}controlLetterEscapeAtom(){this.consumeChar("c");let e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:B("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){let e=this.popChar();return{type:"Character",value:B(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:let e=this.popChar();return{type:"Character",value:B(e)}}}characterClass(){let e=[],r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){let n=this.classAtom(),i=n.type==="Character";if(Eu(n)&&this.isRangeDash()){this.consumeChar("-");let s=this.classAtom(),o=s.type==="Character";if(Eu(s)){if(s.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:s.value})}else _a(n.value,e),e.push(B("-")),_a(s.value,e)}else _a(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:r,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:B("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}let r=this.disjunction();this.consumeChar(")");let n={type:"Group",capturing:e,value:r};return e&&(n.idx=this.groupIdx),n}positiveInteger(){let e=this.popChar();if(X0.test(e)===!1)throw Error("Expecting a positive integer");for(;Pa.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Pa.test(e)===!1)throw Error("Expecting an integer");for(;Pa.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){let e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:B(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Pa.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){let e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let r="";for(let i=0;i<e;i++){let s=this.popChar();if(Y0.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){let e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}};var Zr=class{visitChildren(e){for(let r in e){let n=e[r];e.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}};var qa={},Z0=new Os;function Ai(t){let e=t.toString();if(qa.hasOwnProperty(e))return qa[e];{let r=Z0.pattern(e);return qa[e]=r,r}}function sx(){qa={}}var ax="Complement Sets are not supported for first char optimization",Ls=`Unable to use "first char" lexer optimizations:
`;function lx(t,e=!1){try{let r=Ai(t);return Su(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===ax)e&&gs(`${Ls}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Ti(`${Ls}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function Su(t,e,r){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)Su(t.value[i],e,r);break;case"Alternative":let n=t.value;for(let i=0;i<n.length;i++){let s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}let o=s;switch(o.type){case"Character":Da(o.value,e,r);break;case"Set":if(o.complement===!0)throw Error(ax);P(o.value,c=>{if(typeof c=="number")Da(c,e,r);else{let u=c;if(r===!0)for(let f=u.from;f<=u.to;f++)Da(f,e,r);else{for(let f=u.from;f<=u.to&&f<bi;f++)Da(f,e,r);if(u.to>=bi){let f=u.from>=bi?u.from:bi,l=u.to,d=or(f),h=or(l);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":Su(o.value,e,r);break;default:throw Error("Non Exhaustive Match")}let a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Tu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return ce(e)}function Da(t,e,r){let n=or(t);e[n]=n,r===!0&&J0(t,e)}function J0(t,e){let r=String.fromCharCode(t),n=r.toUpperCase();if(n!==r){let i=or(n.charCodeAt(0));e[i]=i}else{let i=r.toLowerCase();if(i!==r){let s=or(i.charCodeAt(0));e[s]=s}}}function ox(t,e){return sr(t.value,r=>{if(typeof r=="number")return Oe(e,r);{let n=r;return sr(e,i=>n.from<=i&&i<=n.to)!==void 0}})}function Tu(t){let e=t.quantifier;return e&&e.atLeast===0?!0:t.value?D(t.value)?it(t.value,Tu):Tu(t.value):!1}var Ou=class extends Zr{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Oe(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?ox(e,this.targetCharCodes)===void 0&&(this.found=!0):ox(e,this.targetCharCodes)!==void 0&&(this.found=!0)}};function $a(t,e){if(e instanceof RegExp){let r=Ai(e),n=new Ou(t);return n.visit(r),n.found}else return sr(e,r=>Oe(t,r.charCodeAt(0)))!==void 0}var bn="PATTERN",Ni="defaultMode",Ba="modes",Au=typeof new RegExp("(?:)").sticky=="boolean";function hx(t,e){e=yi(e,{useSticky:Au,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(S,E)=>E()});let r=e.tracer;r("initCharCodeToOptimizedIndexMap",()=>{xP()});let n;r("Reject Lexer.NA",()=>{n=Xr(t,S=>S[bn]===Y.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=U(n,S=>{let E=S[bn];if(Pt(E)){let y=E.source;return y.length===1&&y!=="^"&&y!=="$"&&y!=="."&&!E.ignoreCase?y:y.length===2&&y[0]==="\\"&&!Oe(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],y[1])?y[1]:e.useSticky?ux(E):cx(E)}else{if(ft(E))return i=!0,{exec:E};if(typeof E=="object")return i=!0,E;if(typeof E=="string"){if(E.length===1)return E;{let y=E.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),O=new RegExp(y);return e.useSticky?ux(O):cx(O)}}else throw Error("non exhaustive match")}})});let o,a,c,u,f;r("misc mapping",()=>{o=U(n,S=>S.tokenTypeIdx),a=U(n,S=>{let E=S.GROUP;if(E!==Y.SKIPPED){if(He(E))return E;if(ot(E))return!1;throw Error("non exhaustive match")}}),c=U(n,S=>{let E=S.LONGER_ALT;if(E)return D(E)?U(E,O=>Ra(n,O)):[Ra(n,E)]}),u=U(n,S=>S.PUSH_MODE),f=U(n,S=>q(S,"POP_MODE"))});let l;r("Line Terminator Handling",()=>{let S=yx(e.lineTerminatorCharacters);l=U(n,E=>!1),e.positionTracking!=="onlyOffset"&&(l=U(n,E=>q(E,"LINE_BREAKS")?!!E.LINE_BREAKS:Ex(E,S)===!1&&$a(S,E.PATTERN)))});let d,h,p,x;r("Misc Mapping #2",()=>{d=U(n,gx),h=U(s,mP),p=Ge(n,(S,E)=>{let y=E.GROUP;return He(y)&&y!==Y.SKIPPED&&(S[y]=[]),S},{}),x=U(s,(S,E)=>({pattern:s[E],longerAlt:c[E],canLineTerminator:l[E],isCustom:d[E],short:h[E],group:a[E],push:u[E],pop:f[E],tokenTypeIdx:o[E],tokenType:n[E]}))});let m=!0,g=[];return e.safeMode||r("First Char Optimization",()=>{g=Ge(n,(S,E,y)=>{if(typeof E.PATTERN=="string"){let O=E.PATTERN.charCodeAt(0),L=or(O);Lu(S,L,x[y])}else if(D(E.START_CHARS_HINT)){let O;P(E.START_CHARS_HINT,L=>{let b=typeof L=="string"?L.charCodeAt(0):L,C=or(b);O!==C&&(O=C,Lu(S,C,x[y]))})}else if(Pt(E.PATTERN))if(E.PATTERN.unicode)m=!1,e.ensureOptimizations&&Ti(`${Ls}	Unable to analyze < ${E.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{let O=lx(E.PATTERN,e.ensureOptimizations);Q(O)&&(m=!1),P(O,L=>{Lu(S,L,x[y])})}else e.ensureOptimizations&&Ti(`${Ls}	TokenType: <${E.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),m=!1;return S},[])}),{emptyGroups:p,patternIdxToConfig:x,charCodeToPatternIdxToConfig:g,hasCustom:i,canBeOptimized:m}}function fx(t,e){let r=[],n=tP(t);r=r.concat(n.errors);let i=rP(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(eP(s)),r=r.concat(uP(s)),r=r.concat(hP(s,e)),r=r.concat(fP(s)),r}function eP(t){let e=[],r=st(t,n=>Pt(n[bn]));return e=e.concat(iP(r)),e=e.concat(aP(r)),e=e.concat(lP(r)),e=e.concat(cP(r)),e=e.concat(sP(r)),e}function tP(t){let e=st(t,i=>!q(i,bn)),r=U(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Le.MISSING_PATTERN,tokenTypes:[i]})),n=Yr(t,e);return{errors:r,valid:n}}function rP(t){let e=st(t,i=>{let s=i[bn];return!Pt(s)&&!ft(s)&&!q(s,"exec")&&!He(s)}),r=U(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Le.INVALID_PATTERN,tokenTypes:[i]})),n=Yr(t,e);return{errors:r,valid:n}}var nP=/[^\\][$]/;function iP(t){class e extends Zr{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}let r=st(t,i=>{let s=i.PATTERN;try{let o=Ai(s),a=new e;return a.visit(o),a.found}catch{return nP.test(s.source)}});return U(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Le.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function sP(t){let e=st(t,n=>n.PATTERN.test(""));return U(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:Le.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}var oP=/[^\\[][\^]|^\^/;function aP(t){class e extends Zr{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}let r=st(t,i=>{let s=i.PATTERN;try{let o=Ai(s),a=new e;return a.visit(o),a.found}catch{return oP.test(s.source)}});return U(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Le.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function lP(t){let e=st(t,n=>{let i=n[bn];return i instanceof RegExp&&(i.multiline||i.global)});return U(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Le.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function cP(t){let e=[],r=U(t,s=>Ge(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Oe(e,a)&&a.PATTERN!==Y.NA&&(e.push(a),o.push(a)),o),[]));r=nr(r);let n=st(r,s=>s.length>1);return U(n,s=>{let o=U(s,c=>c.name);return{message:`The same RegExp pattern ->${Qe(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Le.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function uP(t){let e=st(t,n=>{if(!q(n,"GROUP"))return!1;let i=n.GROUP;return i!==Y.SKIPPED&&i!==Y.NA&&!He(i)});return U(e,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Le.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function hP(t,e){let r=st(t,i=>i.PUSH_MODE!==void 0&&!Oe(e,i.PUSH_MODE));return U(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Le.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function fP(t){let e=[],r=Ge(t,(n,i,s)=>{let o=i.PATTERN;return o===Y.NA||(He(o)?n.push({str:o,idx:s,tokenType:i}):Pt(o)&&pP(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return P(t,(n,i)=>{P(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&dP(s,n.PATTERN)){let c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Le.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),e}function dP(t,e){if(Pt(e)){let r=e.exec(t);return r!==null&&r.index===0}else{if(ft(e))return e(t,0,[],{});if(q(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function pP(t){return sr([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>t.source.indexOf(r)!==-1)===void 0}function cx(t){let e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function ux(t){let e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function dx(t,e,r){let n=[];return q(t,Ni)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ni+`> property in its definition
`,type:Le.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),q(t,Ba)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ba+`> property in its definition
`,type:Le.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),q(t,Ba)&&q(t,Ni)&&!q(t.modes,t.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Ni}: <${t.defaultMode}>which does not exist
`,type:Le.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),q(t,Ba)&&P(t.modes,(i,s)=>{P(i,(o,a)=>{if(ot(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Le.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(q(o,"LONGER_ALT")){let c=D(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];P(c,u=>{!ot(u)&&!Oe(i,u)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Le.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function px(t,e,r){let n=[],i=!1,s=nr(We(ce(t.modes))),o=Xr(s,c=>c[bn]===Y.NA),a=yx(r);return e&&P(o,c=>{let u=Ex(c,a);if(u!==!1){let l={message:gP(c,u),type:u.issue,tokenType:c};n.push(l)}else q(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):$a(a,c.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Le.NO_LINE_BREAKS_FLAGS}),n}function mx(t){let e={},r=he(t);return P(r,n=>{let i=t[n];if(D(i))e[n]=[];else throw Error("non exhaustive match")}),e}function gx(t){let e=t.PATTERN;if(Pt(e))return!1;if(ft(e))return!0;if(q(e,"exec"))return!0;if(He(e))return!1;throw Error("non exhaustive match")}function mP(t){return He(t)&&t.length===1?t.charCodeAt(0):!1}var xx={test:function(t){let e=t.length;for(let r=this.lastIndex;r<e;r++){let n=t.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return t.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function Ex(t,e){if(q(t,"LINE_BREAKS"))return!1;if(Pt(t.PATTERN)){try{$a(e,t.PATTERN)}catch(r){return{issue:Le.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(He(t.PATTERN))return!1;if(gx(t))return{issue:Le.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function gP(t,e){if(e.issue===Le.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Le.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function yx(t){return U(t,r=>He(r)?r.charCodeAt(0):r)}function Lu(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}var bi=256,Fa=[];function or(t){return t<bi?t:Fa[t]}function xP(){if(Q(Fa)){Fa=new Array(65536);for(let t=0;t<65536;t++)Fa[t]=t>255?255+~~(t/255):t}}function Cr(t,e){let r=t.tokenTypeIdx;return r===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[r]===!0}function ki(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}var Sx=1,Ox={};function vr(t){let e=EP(t);yP(e),TP(e),SP(e),P(e,r=>{r.isParent=r.categoryMatches.length>0})}function EP(t){let e=de(t),r=t,n=!0;for(;n;){r=nr(We(U(r,s=>s.CATEGORIES)));let i=Yr(r,e);e=e.concat(i),Q(i)?n=!1:r=i}return e}function yP(t){P(t,e=>{bu(e)||(Ox[Sx]=e,e.tokenTypeIdx=Sx++),Tx(e)&&!D(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Tx(e)||(e.CATEGORIES=[]),OP(e)||(e.categoryMatches=[]),LP(e)||(e.categoryMatchesMap={})})}function SP(t){P(t,e=>{e.categoryMatches=[],P(e.categoryMatchesMap,(r,n)=>{e.categoryMatches.push(Ox[n].tokenTypeIdx)})})}function TP(t){P(t,e=>{Lx([],e)})}function Lx(t,e){P(t,r=>{e.categoryMatchesMap[r.tokenTypeIdx]=!0}),P(e.CATEGORIES,r=>{let n=t.concat(e);Oe(n,r)||Lx(n,r)})}function bu(t){return q(t,"tokenTypeIdx")}function Tx(t){return q(t,"CATEGORIES")}function OP(t){return q(t,"categoryMatches")}function LP(t){return q(t,"categoryMatchesMap")}function Ax(t){return q(t,"tokenTypeIdx")}var Nu={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,r,n,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${r} characters.`}};var Le;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Le||(Le={}));var As={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:Nu,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(As);var Y=class{constructor(e,r=As){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;let o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);let{time:a,value:c}=xs(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Xe({},As,r);let n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===As.lineTerminatorsPattern)this.config.lineTerminatorsPattern=xx;else if(this.config.lineTerminatorCharacters===As.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),D(e)?i={modes:{defaultMode:de(e)},defaultMode:Ni}:(s=!1,i=de(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(dx(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(px(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},P(i.modes,(a,c)=>{i.modes[c]=Xr(a,u=>ot(u))});let o=he(i.modes);if(P(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(fx(a,o))}),Q(this.lexerDefinitionErrors)){vr(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=hx(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=Xe({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Q(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){let c=U(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}P(this.lexerDefinitionWarning,a=>{gs(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Au?(this.chopInput=Ut,this.match=this.matchWithTest):(this.updateLastIndex=Ne,this.match=this.matchWithExec),s&&(this.handleModes=Ne),this.trackStartLines===!1&&(this.computeNewColumn=Ut),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Ne),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{let a=Ge(this.canModeBeOptimized,(c,u,f)=>(u===!1&&c.push(f),c),[]);if(r.ensureOptimizations&&!Q(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{sx()}),this.TRACE_INIT("toFastProperties",()=>{Es(this)})})}tokenize(e,r=this.defaultMode){if(!Q(this.lexerDefinitionErrors)){let i=U(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,r)}tokenizeInternal(e,r){let n,i,s,o,a,c,u,f,l,d,h,p,x,m,g,S,E=e,y=E.length,O=0,L=0,b=this.hasCustom?0:Math.floor(e.length/10),C=new Array(b),k=[],R=this.trackStartLines?1:void 0,N=this.trackStartLines?1:void 0,I=mx(this.emptyGroups),v=this.trackStartLines,w=this.config.lineTerminatorsPattern,M=0,_=[],$=[],K=[],J=[];Object.freeze(J);let ee;function le(){return _}function ae(Me){let rt=or(Me),Sr=$[rt];return Sr===void 0?J:Sr}let tt=Me=>{if(K.length===1&&Me.tokenType.PUSH_MODE===void 0){let rt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Me);k.push({offset:Me.startOffset,line:Me.startLine,column:Me.startColumn,length:Me.image.length,message:rt})}else{K.pop();let rt=ir(K);_=this.patternIdxToConfig[rt],$=this.charCodeToPatternIdxToConfig[rt],M=_.length;let Sr=this.canModeBeOptimized[rt]&&this.config.safeMode===!1;$&&Sr?ee=ae:ee=le}};function ct(Me){K.push(Me),$=this.charCodeToPatternIdxToConfig[Me],_=this.patternIdxToConfig[Me],M=_.length,M=_.length;let rt=this.canModeBeOptimized[Me]&&this.config.safeMode===!1;$&&rt?ee=ae:ee=le}ct.call(this,r);let Ce,bt=this.config.recoveryEnabled;for(;O<y;){c=null;let Me=E.charCodeAt(O),rt=ee(Me),Sr=rt.length;for(n=0;n<Sr;n++){Ce=rt[n];let nt=Ce.pattern;u=null;let Nt=Ce.short;if(Nt!==!1?Me===Nt&&(c=nt):Ce.isCustom===!0?(S=nt.exec(E,O,C,I),S!==null?(c=S[0],S.payload!==void 0&&(u=S.payload)):c=null):(this.updateLastIndex(nt,O),c=this.match(nt,e,O)),c!==null){if(a=Ce.longerAlt,a!==void 0){let jt=a.length;for(s=0;s<jt;s++){let Rt=_[a[s]],G=Rt.pattern;if(f=null,Rt.isCustom===!0?(S=G.exec(E,O,C,I),S!==null?(o=S[0],S.payload!==void 0&&(f=S.payload)):o=null):(this.updateLastIndex(G,O),o=this.match(G,e,O)),o&&o.length>c.length){c=o,u=f,Ce=Rt;break}}}break}}if(c!==null){if(l=c.length,d=Ce.group,d!==void 0&&(h=Ce.tokenTypeIdx,p=this.createTokenInstance(c,O,h,Ce.tokenType,R,N,l),this.handlePayload(p,u),d===!1?L=this.addToken(C,L,p):I[d].push(p)),e=this.chopInput(e,l),O=O+l,N=this.computeNewColumn(N,l),v===!0&&Ce.canLineTerminator===!0){let nt=0,Nt,jt;w.lastIndex=0;do Nt=w.test(c),Nt===!0&&(jt=w.lastIndex-1,nt++);while(Nt===!0);nt!==0&&(R=R+nt,N=l-jt,this.updateTokenEndLineColumnLocation(p,d,jt,nt,R,N,l))}this.handleModes(Ce,tt,ct,p)}else{let nt=O,Nt=R,jt=N,Rt=bt===!1;for(;Rt===!1&&O<y;)for(e=this.chopInput(e,1),O++,i=0;i<M;i++){let G=_[i],se=G.pattern,ut=G.short;if(ut!==!1?E.charCodeAt(O)===ut&&(Rt=!0):G.isCustom===!0?Rt=se.exec(E,O,C,I)!==null:(this.updateLastIndex(se,O),Rt=se.exec(e)!==null),Rt===!0)break}if(x=O-nt,N=this.computeNewColumn(N,x),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(E,nt,x,Nt,jt),k.push({offset:nt,line:Nt,column:jt,length:x,message:g}),bt===!1)break}}return this.hasCustom||(C.length=L),{tokens:C,groups:I,errors:k}}handleModes(e,r,n,i){if(e.pop===!0){let s=e.push;r(i),s!==void 0&&n.call(this,s)}else e.push!==void 0&&n.call(this,e.push)}chopInput(e,r){return e.substring(r)}updateLastIndex(e,r){e.lastIndex=r}updateTokenEndLineColumnLocation(e,r,n,i,s,o,a){let c,u;r!==void 0&&(c=n===a-1,u=c?-1:0,i===1&&c===!0||(e.endLine=s+u,e.endColumn=o-1+-u))}computeNewColumn(e,r){return e+r}createOffsetOnlyToken(e,r,n,i){return{image:e,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(e,r,n,i,s,o){return{image:e,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(e,r,n){return e.push(n),r}addTokenUsingMemberAccess(e,r,n){return e[r]=n,r++,r}handlePayloadNoCustom(e,r){}handlePayloadWithCustom(e,r){r!==null&&(e.payload=r)}matchWithTest(e,r,n){return e.test(r)===!0?r.substring(n,e.lastIndex):null}matchWithExec(e,r){let n=e.exec(r);return n!==null?n[0]:null}};Y.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Y.NA=/NOT_APPLICABLE/;function Nn(t){return ku(t)?t.LABEL:t.name}function ku(t){return He(t.LABEL)&&t.LABEL!==""}var AP="parent",bx="categories",Nx="label",kx="group",Cx="push_mode",vx="pop_mode",Ix="longer_alt",wx="line_breaks",Rx="start_chars_hint";function A(t){return bP(t)}function bP(t){let e=t.pattern,r={};if(r.name=t.name,ot(e)||(r.PATTERN=e),q(t,AP))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return q(t,bx)&&(r.CATEGORIES=t[bx]),vr([r]),q(t,Nx)&&(r.LABEL=t[Nx]),q(t,kx)&&(r.GROUP=t[kx]),q(t,vx)&&(r.POP_MODE=t[vx]),q(t,Cx)&&(r.PUSH_MODE=t[Cx]),q(t,Ix)&&(r.LONGER_ALT=t[Ix]),q(t,wx)&&(r.LINE_BREAKS=t[wx]),q(t,Rx)&&(r.START_CHARS_HINT=t[Rx]),r}var re=A({name:"EOF",pattern:Y.NA});vr([re]);function kn(t,e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function Cu(t,e){return Cr(t,e)}var Ka={buildMismatchTokenMessage({expected:t,actual:e,previous:r,ruleName:n}){return`Expecting ${ku(t)?`--> ${Nn(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:r,customUserDescription:n,ruleName:i}){let s="Expecting: ",a=`
but found: '`+Qe(e).image+"'";if(n)return s+n+a;{let c=Ge(t,(d,h)=>d.concat(h),[]),u=U(c,d=>`[${U(d,h=>Nn(h)).join(", ")}]`),l=`one of these possible Token sequences:
${U(u,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+l+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:r,ruleName:n}){let i="Expecting: ",o=`
but found: '`+Qe(e).image+"'";if(r)return i+r+o;{let c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${U(t,u=>`[${U(u,f=>Nn(f)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Ka);var Mx={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Ht={buildDuplicateFoundError(t,e){function r(f){return f instanceof te?f.terminalType.name:f instanceof pe?f.nonTerminalName:""}let n=t.name,i=Qe(e),s=i.idx,o=Lt(i),a=r(i),c=s>0,u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){let e=U(t.prefixPath,i=>Nn(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){let e=U(t.prefixPath,i=>Nn(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx,n=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(t){let e=Lt(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){let e=t.topLevelRule.name,r=U(t.leftRecursionPath,s=>s.name),n=`${e} --> ${r.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof pt?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function Ux(t,e){let r=new vu(t,e);return r.resolveRefs(),r.errors}var vu=class extends mt{constructor(e,r){super(),this.nameToTopRule=e,this.errMsgProvider=r,this.errors=[]}resolveRefs(){P(ce(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){let r=this.nameToTopRule[e.nonTerminalName];if(r)e.referencedRule=r;else{let n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:ze.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}};var Iu=class extends kr{constructor(e,r){super(),this.topProd=e,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=de(this.path.ruleStack).reverse(),this.occurrenceStack=de(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,r=[]){this.found||super.walk(e,r)}walkProdRef(e,r,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){let i=r.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Q(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}},Ga=class extends Iu{constructor(e,r){super(e,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,r,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){let i=r.concat(n),s=new me({definition:i});this.possibleTokTypes=Ln(s),this.found=!0}}},Ci=class extends kr{constructor(e,r){super(),this.topRule=e,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}},ja=class extends Ci{walkMany(e,r,n){if(e.idx===this.occurrence){let i=Qe(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,r,n)}},bs=class extends Ci{walkManySep(e,r,n){if(e.idx===this.occurrence){let i=Qe(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,r,n)}},Wa=class extends Ci{walkAtLeastOne(e,r,n){if(e.idx===this.occurrence){let i=Qe(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,r,n)}},Ns=class extends Ci{walkAtLeastOneSep(e,r,n){if(e.idx===this.occurrence){let i=Qe(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,r,n)}};function Ha(t,e,r=[]){r=de(r);let n=[],i=0;function s(a){return a.concat(_e(t,i+1))}function o(a){let c=Ha(s(a),e,r);return n.concat(c)}for(;r.length<e&&i<t.length;){let a=t[i];if(a instanceof me)return o(a.definition);if(a instanceof pe)return o(a.definition);if(a instanceof ye)n=o(a.definition);else if(a instanceof Pe){let c=a.definition.concat([new oe({definition:a.definition})]);return o(c)}else if(a instanceof qe){let c=[new me({definition:a.definition}),new oe({definition:[new te({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof ve){let c=a.definition.concat([new oe({definition:[new te({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof oe){let c=a.definition.concat([new oe({definition:a.definition})]);n=o(c)}else{if(a instanceof Ie)return P(a.definition,c=>{Q(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof te)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:_e(t,i)}),n}function za(t,e,r,n){let i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE",a=!1,c=e.length,u=c-n-1,f=[],l=[];for(l.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Q(l);){let d=l.pop();if(d===o){a&&ir(l).idx<=u&&l.pop();continue}let h=d.def,p=d.idx,x=d.ruleStack,m=d.occurrenceStack;if(Q(h))continue;let g=h[0];if(g===i){let S={idx:p,def:_e(h),ruleStack:Nr(x),occurrenceStack:Nr(m)};l.push(S)}else if(g instanceof te)if(p<c-1){let S=p+1,E=e[S];if(r(E,g.terminalType)){let y={idx:S,def:_e(h),ruleStack:x,occurrenceStack:m};l.push(y)}}else if(p===c-1)f.push({nextTokenType:g.terminalType,nextTokenOccurrence:g.idx,ruleStack:x,occurrenceStack:m}),a=!0;else throw Error("non exhaustive match");else if(g instanceof pe){let S=de(x);S.push(g.nonTerminalName);let E=de(m);E.push(g.idx);let y={idx:p,def:g.definition.concat(s,_e(h)),ruleStack:S,occurrenceStack:E};l.push(y)}else if(g instanceof ye){let S={idx:p,def:_e(h),ruleStack:x,occurrenceStack:m};l.push(S),l.push(o);let E={idx:p,def:g.definition.concat(_e(h)),ruleStack:x,occurrenceStack:m};l.push(E)}else if(g instanceof Pe){let S=new oe({definition:g.definition,idx:g.idx}),E=g.definition.concat([S],_e(h)),y={idx:p,def:E,ruleStack:x,occurrenceStack:m};l.push(y)}else if(g instanceof qe){let S=new te({terminalType:g.separator}),E=new oe({definition:[S].concat(g.definition),idx:g.idx}),y=g.definition.concat([E],_e(h)),O={idx:p,def:y,ruleStack:x,occurrenceStack:m};l.push(O)}else if(g instanceof ve){let S={idx:p,def:_e(h),ruleStack:x,occurrenceStack:m};l.push(S),l.push(o);let E=new te({terminalType:g.separator}),y=new oe({definition:[E].concat(g.definition),idx:g.idx}),O=g.definition.concat([y],_e(h)),L={idx:p,def:O,ruleStack:x,occurrenceStack:m};l.push(L)}else if(g instanceof oe){let S={idx:p,def:_e(h),ruleStack:x,occurrenceStack:m};l.push(S),l.push(o);let E=new oe({definition:g.definition,idx:g.idx}),y=g.definition.concat([E],_e(h)),O={idx:p,def:y,ruleStack:x,occurrenceStack:m};l.push(O)}else if(g instanceof Ie)for(let S=g.definition.length-1;S>=0;S--){let E=g.definition[S],y={idx:p,def:E.definition.concat(_e(h)),ruleStack:x,occurrenceStack:m};l.push(y),l.push(o)}else if(g instanceof me)l.push({idx:p,def:g.definition.concat(_e(h)),ruleStack:x,occurrenceStack:m});else if(g instanceof pt)l.push(NP(g,p,x,m));else throw Error("non exhaustive match")}return f}function NP(t,e,r,n){let i=de(r);i.push(t.name);let s=de(n);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ke;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ke||(ke={}));function Qa(t){if(t instanceof ye||t==="Option")return ke.OPTION;if(t instanceof oe||t==="Repetition")return ke.REPETITION;if(t instanceof Pe||t==="RepetitionMandatory")return ke.REPETITION_MANDATORY;if(t instanceof qe||t==="RepetitionMandatoryWithSeparator")return ke.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof ve||t==="RepetitionWithSeparator")return ke.REPETITION_WITH_SEPARATOR;if(t instanceof Ie||t==="Alternation")return ke.ALTERNATION;throw Error("non exhaustive match")}function Px(t,e,r,n,i,s){let o=ks(t,e,r),a=Kx(o)?ki:Cr;return s(o,n,a,i)}function qx(t,e,r,n,i,s){let o=Cs(t,e,i,r),a=Kx(o)?ki:Cr;return s(o[0],a,n)}function Dx(t,e,r,n){let i=t.length,s=it(t,o=>it(o,a=>a.length===1));if(e)return function(o){let a=U(o,c=>c.GATE);for(let c=0;c<i;c++){let u=t[c],f=u.length,l=a[c];if(!(l!==void 0&&l.call(this)===!1))e:for(let d=0;d<f;d++){let h=u[d],p=h.length;for(let x=0;x<p;x++){let m=this.LA(x+1);if(r(m,h[x])===!1)continue e}return c}}};if(s&&!n){let o=U(t,c=>We(c)),a=Ge(o,(c,u,f)=>(P(u,l=>{q(c,l.tokenTypeIdx)||(c[l.tokenTypeIdx]=f),P(l.categoryMatches,d=>{q(c,d)||(c[d]=f)})}),c),{});return function(){let c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){let a=t[o],c=a.length;e:for(let u=0;u<c;u++){let f=a[u],l=f.length;for(let d=0;d<l;d++){let h=this.LA(d+1);if(r(h,f[d])===!1)continue e}return o}}}}function $x(t,e,r){let n=it(t,s=>s.length===1),i=t.length;if(n&&!r){let s=We(t);if(s.length===1&&Q(s[0].categoryMatches)){let a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{let o=Ge(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,P(c.categoryMatches,f=>{a[f]=!0}),a),[]);return function(){let a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){let o=t[s],a=o.length;for(let c=0;c<a;c++){let u=this.LA(c+1);if(e(u,o[c])===!1)continue e}return!0}return!1}}var Ru=class extends kr{constructor(e,r,n){super(),this.topProd=e,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,r,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(e,r,n){this.checkIsTarget(e,ke.OPTION,r,n)||super.walkOption(e,r,n)}walkAtLeastOne(e,r,n){this.checkIsTarget(e,ke.REPETITION_MANDATORY,r,n)||super.walkOption(e,r,n)}walkAtLeastOneSep(e,r,n){this.checkIsTarget(e,ke.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}walkMany(e,r,n){this.checkIsTarget(e,ke.REPETITION,r,n)||super.walkOption(e,r,n)}walkManySep(e,r,n){this.checkIsTarget(e,ke.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}},Va=class extends mt{constructor(e,r,n){super(),this.targetOccurrence=e,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(e,r){e.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ke.OPTION)}visitRepetition(e){this.checkIsTarget(e,ke.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ke.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ke.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ke.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ke.ALTERNATION)}};function _x(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=[];return e}function wu(t){let e=[""];for(let r=0;r<t.length;r++){let n=t[r],i=[];for(let s=0;s<e.length;s++){let o=e[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){let c="_"+n.categoryMatches[a];i.push(o+c)}}e=i}return e}function kP(t,e,r){for(let n=0;n<t.length;n++){if(n===r)continue;let i=t[n];for(let s=0;s<e.length;s++){let o=e[s];if(i[o]===!0)return!1}}return!0}function Bx(t,e){let r=U(t,o=>Ha([o],1)),n=_x(r.length),i=U(r,o=>{let a={};return P(o,c=>{let u=wu(c.partialPath);P(u,f=>{a[f]=!0})}),a}),s=r;for(let o=1;o<=e;o++){let a=s;s=_x(a.length);for(let c=0;c<a.length;c++){let u=a[c];for(let f=0;f<u.length;f++){let l=u[f].partialPath,d=u[f].suffixDef,h=wu(l);if(kP(i,h,c)||Q(d)||l.length===e){let x=n[c];if(Ya(x,l)===!1){x.push(l);for(let m=0;m<h.length;m++){let g=h[m];i[c][g]=!0}}}else{let x=Ha(d,o+1,l);s[c]=s[c].concat(x),P(x,m=>{let g=wu(m.partialPath);P(g,S=>{i[c][S]=!0})})}}}}return n}function ks(t,e,r,n){let i=new Va(t,ke.ALTERNATION,n);return e.accept(i),Bx(i.result,r)}function Cs(t,e,r,n){let i=new Va(t,r);e.accept(i);let s=i.result,a=new Ru(e,t,r).startWalking(),c=new me({definition:s}),u=new me({definition:a});return Bx([c,u],n)}function Ya(t,e){e:for(let r=0;r<t.length;r++){let n=t[r];if(n.length===e.length){for(let i=0;i<n.length;i++){let s=e[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function Fx(t,e){return t.length<e.length&&it(t,(r,n)=>{let i=e[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function Kx(t){return it(t,e=>it(e,r=>it(r,n=>Q(n.categoryMatches))))}function Gx(t){let e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return U(e,r=>Object.assign({type:ze.CUSTOM_LOOKAHEAD_VALIDATION},r))}function jx(t,e,r,n){let i=dt(t,c=>CP(c,r)),s=UP(t,e,r),o=dt(t,c=>wP(c,r)),a=dt(t,c=>IP(c,t,n,r));return i.concat(s,o,a)}function CP(t,e){let r=new Mu;t.accept(r);let n=r.allProductions,i=pu(n,vP),s=Ot(i,a=>a.length>1);return U(ce(s),a=>{let c=Qe(a),u=e.buildDuplicateFoundError(t,a),f=Lt(c),l={message:u,type:ze.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:f,occurrence:c.idx},d=Wx(c);return d&&(l.parameter=d),l})}function vP(t){return`${Lt(t)}_#_${t.idx}_#_${Wx(t)}`}function Wx(t){return t instanceof te?t.terminalType.name:t instanceof pe?t.nonTerminalName:""}var Mu=class extends mt{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}};function IP(t,e,r,n){let i=[];if(Ge(e,(o,a)=>a.name===t.name?o+1:o,0)>1){let o=n.buildDuplicateRuleNameError({topLevelRule:t,grammarName:r});i.push({message:o,type:ze.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function Hx(t,e,r){let n=[],i;return Oe(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:ze.INVALID_RULE_OVERRIDE,ruleName:t})),n}function _u(t,e,r,n=[]){let i=[],s=Xa(e.definition);if(Q(s))return[];{let o=t.name;Oe(s,t)&&i.push({message:r.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:n}),type:ze.LEFT_RECURSION,ruleName:o});let c=Yr(s,n.concat([t])),u=dt(c,f=>{let l=de(n);return l.push(f),_u(t,f,r,l)});return i.concat(u)}}function Xa(t){let e=[];if(Q(t))return e;let r=Qe(t);if(r instanceof pe)e.push(r.referencedRule);else if(r instanceof me||r instanceof ye||r instanceof Pe||r instanceof qe||r instanceof ve||r instanceof oe)e=e.concat(Xa(r.definition));else if(r instanceof Ie)e=We(U(r.definition,s=>Xa(s.definition)));else if(!(r instanceof te))throw Error("non exhaustive match");let n=On(r),i=t.length>1;if(n&&i){let s=_e(t);return e.concat(Xa(s))}else return e}var vs=class extends mt{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}};function zx(t,e){let r=new vs;t.accept(r);let n=r.alternations;return dt(n,s=>{let o=Nr(s.definition);return dt(o,(a,c)=>{let u=za([a],[],Cr,1);return Q(u)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:ze.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function Vx(t,e,r){let n=new vs;t.accept(n);let i=n.alternations;return i=Xr(i,o=>o.ignoreAmbiguities===!0),dt(i,o=>{let a=o.idx,c=o.maxLookahead||e,u=ks(a,t,c,o),f=RP(u,o,t,r),l=MP(u,o,t,r);return f.concat(l)})}var Uu=class extends mt{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}};function wP(t,e){let r=new vs;t.accept(r);let n=r.alternations;return dt(n,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:ze.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function Qx(t,e,r){let n=[];return P(t,i=>{let s=new Uu;i.accept(s);let o=s.allProductions;P(o,a=>{let c=Qa(a),u=a.maxLookahead||e,f=a.idx,d=Cs(f,i,c,u)[0];if(Q(We(d))){let h=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:h,type:ze.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function RP(t,e,r,n){let i=[],s=Ge(t,(a,c,u)=>(e.definition[u].ignoreAmbiguities===!0||P(c,f=>{let l=[u];P(t,(d,h)=>{u!==h&&Ya(d,f)&&e.definition[h].ignoreAmbiguities!==!0&&l.push(h)}),l.length>1&&!Ya(i,f)&&(i.push(f),a.push({alts:l,path:f}))}),a),[]);return U(s,a=>{let c=U(a.alts,f=>f+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:ze.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:e.idx,alternatives:a.alts}})}function MP(t,e,r,n){let i=Ge(t,(o,a,c)=>{let u=U(a,f=>({idx:c,path:f}));return o.concat(u)},[]);return nr(dt(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];let c=o.idx,u=o.path,f=st(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&Fx(d.path,u));return U(f,d=>{let h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:ze.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:p,alternatives:h}})}))}function UP(t,e,r){let n=[],i=U(e,s=>s.name);return P(t,s=>{let o=s.name;if(Oe(i,o)){let a=r.buildNamespaceConflictError(s);n.push({message:a,type:ze.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function Yx(t){let e=yi(t,{errMsgProvider:Mx}),r={};return P(t.rules,n=>{r[n.name]=n}),Ux(r,e.errMsgProvider)}function Xx(t){return t=yi(t,{errMsgProvider:Ht}),jx(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}var Zx="MismatchedTokenException",Jx="NoViableAltException",eE="EarlyExitException",tE="NotAllInputParsedException",rE=[Zx,Jx,eE,tE];Object.freeze(rE);function Jr(t){return Oe(rE,t.name)}var vi=class extends Error{constructor(e,r){super(e),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},Cn=class extends vi{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Zx}},Is=class extends vi{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Jx}},ws=class extends vi{constructor(e,r){super(e,r),this.name=tE}},Rs=class extends vi{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=eE}};var Pu={},Du="InRuleRecoveryException",qu=class extends Error{constructor(e){super(e),this.name=Du}},Za=class{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=q(e,"recoveryEnabled")?e.recoveryEnabled:gt.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=_P)}getTokenToInsert(e){let r=kn(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,r,n,i){let s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[],c=!1,u=this.LA(1),f=this.LA(1),l=()=>{let d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:d,ruleName:this.getCurrRuleFullName()}),p=new Cn(h,u,this.LA(0));p.resyncedTokens=Nr(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(f,i)){l();return}else if(n.call(this)){l(),e.apply(this,r);return}else this.tokenMatcher(f,s)?c=!0:(f=this.SKIP_TOKEN(),this.addToResyncTokens(f,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,r)))}getFollowsForInRuleRecovery(e,r){let n=this.getCurrentGrammarPath(e,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,r){if(this.canRecoverWithSingleTokenInsertion(e,r))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){let n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new qu("sad sad panda")}canPerformInRuleRecovery(e,r){return this.canRecoverWithSingleTokenInsertion(e,r)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,r){if(!this.canTokenTypeBeInsertedInRecovery(e)||Q(r))return!1;let n=this.LA(1);return sr(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){let r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Oe(n,e)}findReSyncTokenType(){let e=this.flattenFollowSet(),r=this.LA(1),n=2;for(;;){let i=sr(e,s=>Cu(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Pu;let e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){let e=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return U(e,(n,i)=>i===0?Pu:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){let e=U(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return We(e)}getFollowSetFromFollowKey(e){if(e===Pu)return[re];let r=e.ruleName+e.idxInCallingRule+Ua+e.inRule;return this.resyncFollows[r]}addToResyncTokens(e,r){return this.tokenMatcher(e,re)||r.push(e),r}reSyncTo(e){let r=[],n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Nr(r)}attemptInRepetitionRecovery(e,r,n,i,s,o,a){}getCurrentGrammarPath(e,r){let n=this.getHumanReadableRuleStack(),i=de(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:e,lastTokOccurrence:r}}getHumanReadableRuleStack(){return U(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}};function _P(t,e,r,n,i,s,o){let a=this.getKeyForAutomaticLookahead(n,i),c=this.firstAfterRepMap[a];if(c===void 0){let d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,f=c.occurrence,l=c.isEndOfRule;this.RULE_STACK.length===1&&l&&u===void 0&&(u=re,f=1),!(u===void 0||f===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,f,o)&&this.tryInRepetitionRecovery(t,e,r,u)}function Ja(t,e,r){return r|e|t}var Ms=class{constructor(e){var r;this.maxLookahead=(r=e?.maxLookahead)!==null&&r!==void 0?r:gt.maxLookahead}validate(e){let r=this.validateNoLeftRecursion(e.rules);if(Q(r)){let n=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(e){return dt(e,r=>_u(r,r,Ht))}validateEmptyOrAlternatives(e){return dt(e,r=>zx(r,Ht))}validateAmbiguousAlternationAlternatives(e,r){return dt(e,n=>Vx(n,r,Ht))}validateSomeNonEmptyLookaheadPath(e,r){return Qx(e,r,Ht)}buildLookaheadForAlternation(e){return Px(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,Dx)}buildLookaheadForOptional(e){return qx(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Qa(e.prodType),$x)}};var tl=class{initLooksAhead(e){this.dynamicTokensEnabled=q(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:gt.dynamicTokensEnabled,this.maxLookahead=q(e,"maxLookahead")?e.maxLookahead:gt.maxLookahead,this.lookaheadStrategy=q(e,"lookaheadStrategy")?e.lookaheadStrategy:new Ms({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){P(e,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{let{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=PP(r);P(n,u=>{let f=u.idx===0?"":u.idx;this.TRACE_INIT(`${Lt(u)}${f}`,()=>{let l=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:r,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Ja(this.fullRuleNameToShort[r.name],256,u.idx);this.setLaFuncCache(d,l)})}),P(i,u=>{this.computeLookaheadFunc(r,u.idx,768,"Repetition",u.maxLookahead,Lt(u))}),P(s,u=>{this.computeLookaheadFunc(r,u.idx,512,"Option",u.maxLookahead,Lt(u))}),P(o,u=>{this.computeLookaheadFunc(r,u.idx,1024,"RepetitionMandatory",u.maxLookahead,Lt(u))}),P(a,u=>{this.computeLookaheadFunc(r,u.idx,1536,"RepetitionMandatoryWithSeparator",u.maxLookahead,Lt(u))}),P(c,u=>{this.computeLookaheadFunc(r,u.idx,1280,"RepetitionWithSeparator",u.maxLookahead,Lt(u))})})})}computeLookaheadFunc(e,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{let a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Ja(this.fullRuleNameToShort[e.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,r){let n=this.getLastExplicitRuleShortName();return Ja(n,e,r)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,r){this.lookAheadFuncsCache.set(e,r)}},$u=class extends mt{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}},el=new $u;function PP(t){el.reset(),t.accept(el);let e=el.dslMethods;return el.reset(),e}function Ku(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function Gu(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function nE(t,e,r){t.children[r]===void 0?t.children[r]=[e]:t.children[r].push(e)}function iE(t,e,r){t.children[e]===void 0?t.children[e]=[r]:t.children[e].push(r)}var qP="name";function ju(t,e){Object.defineProperty(t,qP,{enumerable:!1,configurable:!0,writable:!1,value:e})}function DP(t,e){let r=he(t),n=r.length;for(let i=0;i<n;i++){let s=r[i],o=t[s],a=o.length;for(let c=0;c<a;c++){let u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,e)}}}function sE(t,e){let r=function(){};ju(r,t+"BaseSemantics");let n={visit:function(i,s){if(D(i)&&(i=i[0]),!ot(i))return this[i.name](i.children,s)},validateVisitor:function(){let i=$P(this,e);if(!Q(i)){let s=U(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=e,r}function oE(t,e,r){let n=function(){};ju(n,t+"BaseSemanticsWithDefaults");let i=Object.create(r.prototype);return P(e,s=>{i[s]=DP}),n.prototype=i,n.prototype.constructor=n,n}var Wu;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Wu||(Wu={}));function $P(t,e){return BP(t,e)}function BP(t,e){let r=st(e,i=>ft(t[i])===!1),n=U(r,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Wu.MISSING_METHOD,methodName:i}));return nr(n)}var sl=class{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=q(e,"nodeLocationTracking")?e.nodeLocationTracking:gt.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ne,this.cstFinallyStateUpdate=Ne,this.cstPostTerminal=Ne,this.cstPostNonTerminal=Ne,this.cstPostRule=Ne;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Gu,this.setNodeLocationFromNode=Gu,this.cstPostRule=Ne,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ne,this.setNodeLocationFromNode=Ne,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ku,this.setNodeLocationFromNode=Ku,this.cstPostRule=Ne,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ne,this.setNodeLocationFromNode=Ne,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ne,this.setNodeLocationFromNode=Ne,this.cstPostRule=Ne,this.setInitialNodeLocation=Ne;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){let r=this.LA(1);e.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){let r={name:e,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){let r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){let r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(e,r){let n=this.CST_STACK[this.CST_STACK.length-1];nE(n,r,e),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(e,r){let n=this.CST_STACK[this.CST_STACK.length-1];iE(n,r,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(ot(this.baseCstVisitorConstructor)){let e=sE(this.className,he(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ot(this.baseCstVisitorWithDefaultsConstructor)){let e=oE(this.className,he(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){let e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}};var ol=class{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ii}LA(e){let r=this.currIdx+e;return r<0||this.tokVectorLength<=r?Ii:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}};var al=class{ACTION(e){return e.call(this)}consume(e,r,n){return this.consumeInternal(r,e,n)}subrule(e,r,n){return this.subruleInternal(r,e,n)}option(e,r){return this.optionInternal(r,e)}or(e,r){return this.orInternal(r,e)}many(e,r){return this.manyInternal(e,r)}atLeastOne(e,r){return this.atLeastOneInternal(e,r)}CONSUME(e,r){return this.consumeInternal(e,0,r)}CONSUME1(e,r){return this.consumeInternal(e,1,r)}CONSUME2(e,r){return this.consumeInternal(e,2,r)}CONSUME3(e,r){return this.consumeInternal(e,3,r)}CONSUME4(e,r){return this.consumeInternal(e,4,r)}CONSUME5(e,r){return this.consumeInternal(e,5,r)}CONSUME6(e,r){return this.consumeInternal(e,6,r)}CONSUME7(e,r){return this.consumeInternal(e,7,r)}CONSUME8(e,r){return this.consumeInternal(e,8,r)}CONSUME9(e,r){return this.consumeInternal(e,9,r)}SUBRULE(e,r){return this.subruleInternal(e,0,r)}SUBRULE1(e,r){return this.subruleInternal(e,1,r)}SUBRULE2(e,r){return this.subruleInternal(e,2,r)}SUBRULE3(e,r){return this.subruleInternal(e,3,r)}SUBRULE4(e,r){return this.subruleInternal(e,4,r)}SUBRULE5(e,r){return this.subruleInternal(e,5,r)}SUBRULE6(e,r){return this.subruleInternal(e,6,r)}SUBRULE7(e,r){return this.subruleInternal(e,7,r)}SUBRULE8(e,r){return this.subruleInternal(e,8,r)}SUBRULE9(e,r){return this.subruleInternal(e,9,r)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,r,n=wi){if(Oe(this.definedRulesNames,e)){let o={message:Ht.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:ze.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);let i=this.defineRule(e,r,n);return this[e]=i,i}OVERRIDE_RULE(e,r,n=wi){let i=Hx(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);let s=this.defineRule(e,r,n);return this[e]=s,s}BACKTRACK(e,r){return function(){this.isBackTrackingStack.push(1);let n=this.saveRecogState();try{return e.apply(this,r),!0}catch(i){if(Jr(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return Ma(ce(this.gastProductionsCache))}};var ll=class{initRecognizerEngine(e,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ki,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},q(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(D(e)){if(Q(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(D(e))this.tokensMap=Ge(e,(s,o)=>(s[o.name]=o,s),{});else if(q(e,"modes")&&it(We(ce(e.modes)),Ax)){let s=We(ce(e.modes)),o=Si(s);this.tokensMap=Ge(o,(a,c)=>(a[c.name]=c,a),{})}else if(be(e))this.tokensMap=de(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=re;let n=q(e,"modes")?We(ce(e.modes)):ce(e),i=it(n,s=>Q(s.categoryMatches));this.tokenMatcher=i?ki:Cr,vr(ce(this.tokensMap))}defineRule(e,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);let i=q(n,"resyncEnabled")?n.resyncEnabled:wi.resyncEnabled,s=q(n,"recoveryValueFunc")?n.recoveryValueFunc:wi.recoveryValueFunc,o=this.ruleShortNameIdx<<12;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...f){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,f);let l=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(l),l}catch(l){return this.invokeRuleCatch(l,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...f){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,f)}catch(l){return this.invokeRuleCatch(l,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:r})}invokeRuleCatch(e,r,n){let i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(Jr(e)){let o=e;if(s){let a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){let c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(e);else{if(this.outputCst){let c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(e);throw o}}else throw e}optionInternal(e,r){let n=this.getKeyForAutomaticLookahead(512,r);return this.optionInternalLogic(e,r,n)}optionInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof e!="function"){s=e.DEF;let o=e.GATE;if(o!==void 0){let a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,r){let n=this.getKeyForAutomaticLookahead(1024,e);return this.atLeastOneInternalLogic(e,r,n)}atLeastOneInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;let o=r.GATE;if(o!==void 0){let a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ke.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,r],i,1024,e,Wa)}atLeastOneSepFirstInternal(e,r){let n=this.getKeyForAutomaticLookahead(1536,e);this.atLeastOneSepFirstInternalLogic(e,r,n)}atLeastOneSepFirstInternalLogic(e,r,n){let i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);let a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Ns],a,1536,e,Ns)}else throw this.raiseEarlyExitException(e,ke.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(e,r){let n=this.getKeyForAutomaticLookahead(768,e);return this.manyInternalLogic(e,r,n)}manyInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;let a=r.GATE;if(a!==void 0){let c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,r],i,768,e,ja,o)}manySepFirstInternal(e,r){let n=this.getKeyForAutomaticLookahead(1280,e);this.manySepFirstInternalLogic(e,r,n)}manySepFirstInternalLogic(e,r,n){let i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);let a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,bs],a,1280,e,bs)}}repetitionSepSecondInternal(e,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,r,n,i,s],n,1536,e,s)}doSingleRepetition(e){let r=this.getLexerPosition();return e.call(this),this.getLexerPosition()>r}orInternal(e,r){let n=this.getKeyForAutomaticLookahead(256,r),i=D(e)?e:e.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){let e=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new ws(r,e))}}subruleInternal(e,r,n){let i;try{let s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=e.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,n,e.ruleName)}}subruleInternalError(e,r,n){throw Jr(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,r,n){let i;try{let s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,n)}catch(s){i=this.consumeInternalRecovery(e,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,i),i}consumeInternalError(e,r,n){let i,s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Cn(i,r,s))}consumeInternalRecovery(e,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){let i=this.getFollowsForInRuleRecovery(e,r);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Du?n:s}}else throw n}saveRecogState(){let e=this.errors,r=de(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){let e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),re)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}};var cl=class{initErrorHandler(e){this._errors=[],this.errorMessageProvider=q(e,"errorMessageProvider")?e.errorMessageProvider:gt.errorMessageProvider}SAVE_ERROR(e){if(Jr(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:de(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return de(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,r,n){let i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Cs(e,s,r,this.maxLookahead)[0],c=[];for(let f=1;f<=this.maxLookahead;f++)c.push(this.LA(f));let u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new Rs(u,this.LA(1),this.LA(0)))}raiseNoAltException(e,r){let n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=ks(e,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));let a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Is(c,this.LA(1),a))}};var ul=class{initContentAssist(){}computeContentAssist(e,r){let n=this.gastProductionsCache[e];if(ot(n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return za([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){let r=Qe(e.ruleStack),i=this.getGAstProductions()[r];return new Ga(i,e).startWalking()}};var dl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(dl);var aE=!0,lE=Math.pow(2,8)-1,uE=A({name:"RECORDING_PHASE_TOKEN",pattern:Y.NA});vr([uE]);var hE=kn(uE,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(hE);var KP={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}},hl=class{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){let r=e>0?e:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,e,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,e,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${r}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,r,n){return this.consumeInternalRecord(r,e,n)},this.subrule=function(e,r,n){return this.subruleInternalRecord(r,e,n)},this.option=function(e,r){return this.optionInternalRecord(r,e)},this.or=function(e,r){return this.orInternalRecord(r,e)},this.many=function(e,r){this.manyInternalRecord(e,r)},this.atLeastOne=function(e,r){this.atLeastOneInternalRecord(e,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{let e=this;for(let r=0;r<10;r++){let n=r>0?r:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,r){return()=>!0}LA_RECORD(e){return Ii}topLevelRuleRecord(e,r){try{let n=new pt({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(e,r){return _s.call(this,ye,e,r)}atLeastOneInternalRecord(e,r){_s.call(this,Pe,r,e)}atLeastOneSepFirstInternalRecord(e,r){_s.call(this,qe,r,e,aE)}manyInternalRecord(e,r){_s.call(this,oe,r,e)}manySepFirstInternalRecord(e,r){_s.call(this,ve,r,e,aE)}orInternalRecord(e,r){return GP.call(this,e,r)}subruleInternalRecord(e,r,n){if(fl(r),!e||q(e,"ruleName")===!1){let a=new Error(`<SUBRULE${cE(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}let i=ir(this.recordingProdStack),s=e.ruleName,o=new pe({idx:r,nonTerminalName:s,label:n?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?KP:dl}consumeInternalRecord(e,r,n){if(fl(r),!bu(e)){let o=new Error(`<CONSUME${cE(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}let i=ir(this.recordingProdStack),s=new te({idx:r,terminalType:e,label:n?.LABEL});return i.definition.push(s),hE}};function _s(t,e,r,n=!1){fl(r);let i=ir(this.recordingProdStack),s=ft(e)?e:e.DEF,o=new t({definition:[],idx:r});return n&&(o.separator=e.SEP),q(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),dl}function GP(t,e){fl(e);let r=ir(this.recordingProdStack),n=D(t)===!1,i=n===!1?t:t.DEF,s=new Ie({definition:[],idx:e,ignoreAmbiguities:n&&t.IGNORE_AMBIGUITIES===!0});q(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);let o=ms(i,a=>ft(a.GATE));return s.hasPredicates=o,r.definition.push(s),P(i,a=>{let c=new me({definition:[]});s.definition.push(c),q(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:q(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),dl}function cE(t){return t===0?"":`${t}`}function fl(t){if(t<0||t>lE){let e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${lE+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}var pl=class{initPerformanceTracer(e){if(q(e,"traceInitPerf")){let r=e.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=gt.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,r){if(this.traceInitPerf===!0){this.traceInitIndent++;let n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);let{time:i,value:s}=xs(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}};function fE(t,e){e.forEach(r=>{let n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;let s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=r.prototype[i]})})}var Ii=kn(re,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ii);var gt=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Ka,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),wi=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0}),ze;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(ze||(ze={}));var Ps=class t{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;let r=this.className;this.TRACE_INIT("toFastProps",()=>{Es(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),P(this.definedRulesNames,i=>{let o=this[i].originalGrammarAction,a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=Yx({rules:ce(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Q(n)&&this.skipValidations===!1){let i=Xx({rules:ce(this.gastProductionsCache),tokenTypes:ce(this.tokensMap),errMsgProvider:Ht,grammarName:r}),s=Gx({lookaheadStrategy:this.lookaheadStrategy,rules:ce(this.gastProductionsCache),tokenTypes:ce(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Q(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{let i=ix(ce(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:ce(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(ce(this.gastProductionsCache))})),!t.DEFER_DEFINITION_ERRORS_HANDLING&&!Q(this.definitionErrors))throw e=U(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,r){this.definitionErrors=[],this.selfAnalysisDone=!1;let n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(e,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),q(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=q(r,"skipValidations")?r.skipValidations:gt.skipValidations}};Ps.DEFER_DEFINITION_ERRORS_HANDLING=!1;fE(Ps,[Za,tl,sl,ol,ll,al,cl,ul,hl,pl]);var Ct=class extends Ps{constructor(e,r=gt){let n=de(r);n.outputCst=!0,super(e,n)}};var j=A({name:"Identifier",pattern:/[a-zA-Z_][a-zA-Z0-9_]*(?:-[a-zA-Z0-9_]+)*/}),Ze=A({name:"NumberLiteral",pattern:/[0-9]+/}),ml=A({name:"FlowchartKeyword",pattern:/flowchart/,longer_alt:j}),gl=A({name:"GraphKeyword",pattern:/graph/,longer_alt:j}),qs=A({name:"Direction",pattern:/TD|TB|BT|RL|LR/,longer_alt:j}),xl=A({name:"SubgraphKeyword",pattern:/subgraph/,longer_alt:j}),El=A({name:"EndKeyword",pattern:/end/,longer_alt:j}),yl=A({name:"ClassKeyword",pattern:/class/,longer_alt:j}),Sl=A({name:"StyleKeyword",pattern:/style/,longer_alt:j}),Tl=A({name:"ClassDefKeyword",pattern:/classDef/,longer_alt:j}),Ol=A({name:"ClickKeyword",pattern:/click/,longer_alt:j}),Ll=A({name:"LinkStyleKeyword",pattern:/linkStyle/,longer_alt:j}),Ds=A({name:"Ampersand",pattern:/&/}),zt=A({name:"Comma",pattern:/,/}),$s=A({name:"Semicolon",pattern:/;/}),en=A({name:"Colon",pattern:/:/}),Al=A({name:"TripleColon",pattern:/:::/}),zu=A({name:"BiDirectionalArrow",pattern:/<-->/}),Vu=A({name:"CircleEndLine",pattern:/o--o|o---o|o----o/}),Qu=A({name:"CrossEndLine",pattern:/x--x|x---x|x----x/}),bl=A({name:"DottedArrowRight",pattern:/-\.->|-\.\.->|-\.\.\.->/}),Yu=A({name:"DottedArrowLeft",pattern:/<-\.-|<-\.\.-|<-\.\.\.-/}),Nl=A({name:"ThickArrowRight",pattern:/==>|===>|====>/}),Xu=A({name:"ThickArrowLeft",pattern:/<==|<===|<====/}),kl=A({name:"ArrowRight",pattern:/-->|--->|---->/}),Zu=A({name:"ArrowLeft",pattern:/<--|<---|<----/}),Bs=A({name:"DottedLine",pattern:/-\.-|-\.\.-|-\.\.\.-/}),Fs=A({name:"ThickLine",pattern:/===|====|=====/}),Cl=A({name:"Line",pattern:/---|----/}),vl=A({name:"TwoDashes",pattern:/--/}),Ks=A({name:"InvalidArrow",pattern:/->(?!>)/}),Ju=A({name:"DoubleSquareOpen",pattern:/\[\[/}),eh=A({name:"DoubleSquareClose",pattern:/\]\]/}),th=A({name:"DoubleRoundOpen",pattern:/\(\(/}),rh=A({name:"DoubleRoundClose",pattern:/\)\)/}),nh=A({name:"HexagonOpen",pattern:/\{\{/}),ih=A({name:"HexagonClose",pattern:/\}\}/}),sh=A({name:"StadiumOpen",pattern:/\(\[/}),oh=A({name:"StadiumClose",pattern:/\]\)/}),ah=A({name:"CylinderOpen",pattern:/\[\(/}),lh=A({name:"CylinderClose",pattern:/\)\]/}),Gs=A({name:"SquareOpen",pattern:/\[/}),js=A({name:"SquareClose",pattern:/\]/}),Il=A({name:"RoundOpen",pattern:/\(/}),wl=A({name:"RoundClose",pattern:/\)/}),Rl=A({name:"DiamondOpen",pattern:/\{/}),Ml=A({name:"DiamondClose",pattern:/\}/}),Ws=A({name:"AngleOpen",pattern:/>/}),Ul=A({name:"AngleLess",pattern:/</}),_l=A({name:"AtSign",pattern:/@/}),Hs=A({name:"Pipe",pattern:/\|/}),Pl=A({name:"ForwardSlash",pattern:/\//}),ql=A({name:"Backslash",pattern:/\\/}),qt=A({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),ch=A({name:"MultilineText",pattern:/"""[\s\S]*?"""/,line_breaks:!0}),WP=A({name:"Comment",pattern:/%%[^\n\r]*/,group:Y.SKIPPED}),zs=A({name:"ColorValue",pattern:/#[0-9a-fA-F]{3,6}/}),Dt=A({name:"Text",pattern:/[^[\](){}|<>\n\r\t &,;:]+/}),HP=A({name:"WhiteSpace",pattern:/[ \t]+/,group:Y.SKIPPED}),at=A({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),uh=[WP,ch,qt,ml,gl,xl,El,Tl,yl,Sl,Ol,Ll,qs,Ju,eh,th,rh,nh,ih,sh,oh,ah,lh,zu,Vu,Qu,bl,Yu,Nl,Xu,kl,Zu,Bs,Fs,Cl,vl,Ks,Gs,js,Il,wl,Rl,Ml,Ws,Ul,_l,Pl,ql,Hs,Al,Ds,zt,$s,en,zs,Ze,j,Dt,HP,at],zP=new Y(uh);function Dl(t){return zP.tokenize(t)}var hh=class extends Ct{constructor(){super(uh),this.diagram=this.RULE("diagram",()=>{this.OR([{ALT:()=>this.CONSUME(ml)},{ALT:()=>this.CONSUME(gl)}]),this.CONSUME(qs),this.OPTION(()=>{this.CONSUME(at)}),this.MANY(()=>{this.SUBRULE(this.statement)})}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.nodeStatement)},{ALT:()=>this.SUBRULE(this.subgraph)},{ALT:()=>this.SUBRULE(this.directionStatement)},{ALT:()=>this.SUBRULE(this.classStatement)},{ALT:()=>this.SUBRULE(this.styleStatement)},{ALT:()=>this.SUBRULE(this.classDefStatement)},{ALT:()=>this.SUBRULE(this.clickStatement)},{ALT:()=>this.SUBRULE(this.linkStyleStatement)},{ALT:()=>this.CONSUME(at)}])}),this.nodeStatement=this.RULE("nodeStatement",()=>{this.SUBRULE(this.nodeOrParallelGroup),this.OPTION(()=>{this.SUBRULE(this.link),this.SUBRULE2(this.nodeOrParallelGroup),this.MANY(()=>{this.SUBRULE2(this.link),this.SUBRULE3(this.nodeOrParallelGroup)})}),this.OPTION2(()=>this.CONSUME($s)),this.OR2([{ALT:()=>this.CONSUME(at)},{ALT:()=>this.CONSUME(re)}])}),this.nodeOrParallelGroup=this.RULE("nodeOrParallelGroup",()=>{this.SUBRULE(this.node),this.MANY(()=>{this.CONSUME(Ds),this.SUBRULE2(this.node)})}),this.node=this.RULE("node",()=>{this.OR([{ALT:()=>{this.CONSUME(j,{LABEL:"nodeId"}),this.OPTION(()=>{this.CONSUME(Ze,{LABEL:"nodeIdSuffix"})}),this.OPTION1(()=>this.SUBRULE(this.attrObject))}},{ALT:()=>{this.CONSUME2(Ze,{LABEL:"nodeIdNum"})}}]),this.OPTION2(()=>{this.SUBRULE(this.nodeShape)}),this.OPTION3(()=>{this.CONSUME(Al),this.CONSUME3(j,{LABEL:"nodeClass"})})}),this.attrObject=this.RULE("attrObject",()=>{this.CONSUME(_l),this.CONSUME(Rl,{LABEL:"attrLCurly"}),this.OPTION(()=>{this.SUBRULE(this.attrPair),this.MANY(()=>{this.CONSUME(zt),this.SUBRULE2(this.attrPair)})}),this.CONSUME(Ml,{LABEL:"attrRCurly"})}),this.attrPair=this.RULE("attrPair",()=>{this.CONSUME(j,{LABEL:"attrKey"}),this.CONSUME(en),this.OR([{GATE:()=>{let e=this.LA(-1),r=this.LA(-2);return r&&/^(shape)$/i.test(String(r.image||""))},ALT:()=>this.SUBRULE(this.attrShapeValue)},{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME2(j)},{ALT:()=>this.CONSUME(Ze)},{ALT:()=>this.CONSUME(Dt)}])}),this.attrShapeValue=this.RULE("attrShapeValue",()=>{let e=()=>{let n=this.LA(1);if(!n||n.tokenType!==j)return!1;let i=String(n.image||"").toLowerCase();return i==="rect"||i==="round"||i==="rounded"||i==="stadium"||i==="subroutine"||i==="circle"||i==="cylinder"||i==="diamond"||i==="trapezoid"||i==="trapezoidalt"||i==="parallelogram"||i==="hexagon"||i==="lean-l"||i==="lean-r"||i==="icon"||i==="image"},r=()=>{let n=this.LA(1);if(!n||n.tokenType!==qt)return!1;let i=String(n.image||""),o=(i.length>=2&&(i.startsWith('"')||i.startsWith("'"))?i.slice(1,-1):i).toLowerCase();return o==="rect"||o==="round"||o==="rounded"||o==="stadium"||o==="subroutine"||o==="circle"||o==="cylinder"||o==="diamond"||o==="trapezoid"||o==="trapezoidalt"||o==="parallelogram"||o==="hexagon"||o==="lean-l"||o==="lean-r"||o==="icon"||o==="image"};this.OR([{GATE:e,ALT:()=>this.CONSUME(j,{LABEL:"shapeId"})},{GATE:r,ALT:()=>this.CONSUME(qt,{LABEL:"shapeQuoted"})},{ALT:()=>this.CONSUME2(j)},{ALT:()=>this.CONSUME2(qt)},{ALT:()=>this.CONSUME(Ze)},{ALT:()=>this.CONSUME(Dt)}])}),this.clickStatement=this.RULE("clickStatement",()=>{this.CONSUME(Ol),this.CONSUME(j,{LABEL:"clickTarget"}),this.OR([{GATE:()=>this.LA(1).tokenType===j&&/^(href)$/i.test(this.LA(1).image||""),ALT:()=>this.SUBRULE(this.clickHref)},{GATE:()=>this.LA(1).tokenType===j&&/^(call|callback)$/i.test(this.LA(1).image||""),ALT:()=>this.SUBRULE(this.clickCall)}]),this.OPTION(()=>this.CONSUME(at))}),this.clickHref=this.RULE("clickHref",()=>{this.CONSUME(j,{LABEL:"mode"}),this.CONSUME(qt,{LABEL:"url"}),this.OPTION(()=>this.CONSUME2(qt,{LABEL:"tooltip"})),this.OPTION2(()=>this.CONSUME2(j,{LABEL:"target"}))}),this.clickCall=this.RULE("clickCall",()=>{this.CONSUME1(j,{LABEL:"mode"}),this.OPTION1(()=>{this.CONSUME2(j,{LABEL:"fn"}),this.OPTION2(()=>{this.CONSUME3(Il),this.OPTION3(()=>{this.OR([{ALT:()=>this.CONSUME4(j)},{ALT:()=>this.CONSUME5(Ze)},{ALT:()=>this.CONSUME6(Dt)}])}),this.CONSUME7(wl)})}),this.OPTION4(()=>this.CONSUME8(qt,{LABEL:"tooltip"}))}),this.linkStyleStatement=this.RULE("linkStyleStatement",()=>{this.CONSUME(Ll),this.SUBRULE(this.linkStyleIndexList),this.SUBRULE(this.linkStylePairs),this.OPTION2(()=>this.CONSUME2(at))}),this.linkStyleIndexList=this.RULE("linkStyleIndexList",()=>{this.CONSUME(Ze,{LABEL:"index"}),this.MANY(()=>{this.CONSUME(zt),this.CONSUME2(Ze,{LABEL:"index"})})}),this.linkStylePairs=this.RULE("linkStylePairs",()=>{this.SUBRULE(this.linkStylePair),this.MANY(()=>{this.CONSUME(zt),this.OPTION(()=>this.CONSUME(at)),this.SUBRULE2(this.linkStylePair)})}),this.linkStylePair=this.RULE("linkStylePair",()=>{this.CONSUME1(j,{LABEL:"key"}),this.CONSUME(en),this.SUBRULE(this.linkStyleValueChunk)}),this.linkStyleValueChunk=this.RULE("linkStyleValueChunk",()=>{this.AT_LEAST_ONE({GATE:()=>{let e=this.LA(1);return e&&e.tokenType!==zt&&e.tokenType!==at},DEF:()=>{this.OR([{ALT:()=>this.CONSUME(zs)},{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME(Ze)},{ALT:()=>this.CONSUME(j)},{ALT:()=>this.CONSUME(Dt)}])}})}),this.nodeShape=this.RULE("nodeShape",()=>{this.OR([{ALT:()=>{this.CONSUME(Gs),this.OPTION(()=>this.SUBRULE(this.nodeContent)),this.CONSUME(js)}},{ALT:()=>{this.CONSUME(Ju),this.OPTION2(()=>this.SUBRULE2(this.nodeContent)),this.CONSUME(eh)}},{ALT:()=>{this.CONSUME(Il),this.OPTION3(()=>this.SUBRULE3(this.nodeContent)),this.CONSUME(wl)}},{ALT:()=>{this.CONSUME(th),this.OPTION4(()=>this.SUBRULE4(this.nodeContent)),this.CONSUME(rh)}},{ALT:()=>{this.CONSUME(Rl),this.OPTION5(()=>this.SUBRULE5(this.nodeContent)),this.CONSUME(Ml)}},{ALT:()=>{this.CONSUME(nh),this.OPTION6(()=>this.SUBRULE6(this.nodeContent)),this.CONSUME(ih)}},{ALT:()=>{this.CONSUME(sh),this.OPTION7(()=>this.SUBRULE7(this.nodeContent)),this.CONSUME(oh)}},{ALT:()=>{this.CONSUME(ah),this.OPTION8(()=>this.SUBRULE8(this.nodeContent)),this.CONSUME(lh)}}])}),this.nodeContent=this.RULE("nodeContent",()=>{this.OR([{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME(ch)},{ALT:()=>{this.AT_LEAST_ONE(()=>{this.OR2([{ALT:()=>this.CONSUME(j)},{ALT:()=>this.CONSUME(Dt)},{ALT:()=>this.CONSUME(Ze)},{ALT:()=>this.CONSUME(Ul)},{ALT:()=>this.CONSUME(Ws)},{ALT:()=>this.CONSUME(Pl)},{ALT:()=>this.CONSUME(ql)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(en)},{ALT:()=>this.CONSUME(Ds)},{ALT:()=>this.CONSUME($s)},{ALT:()=>this.CONSUME(vl)},{ALT:()=>this.CONSUME(Cl)},{ALT:()=>this.CONSUME(Fs)},{ALT:()=>this.CONSUME(Bs)},{ALT:()=>this.CONSUME(ml)},{ALT:()=>this.CONSUME(gl)},{ALT:()=>this.CONSUME(xl)},{ALT:()=>this.CONSUME(El)},{ALT:()=>this.CONSUME(qs)},{ALT:()=>this.CONSUME(yl)},{ALT:()=>this.CONSUME(Sl)},{ALT:()=>this.CONSUME(Tl)},{ALT:()=>this.CONSUME(Ol)},{ALT:()=>this.CONSUME(Ll)}])})}}])}),this.link=this.RULE("link",()=>{this.OPTION1(()=>{this.CONSUME(j,{LABEL:"edgeId"}),this.CONSUME(_l)}),this.OR([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Bs)},{ALT:()=>this.CONSUME(Fs)},{ALT:()=>this.CONSUME(vl)}]),this.SUBRULE(this.linkTextInline),this.OR3([{ALT:()=>this.CONSUME(kl)},{ALT:()=>this.CONSUME(bl)},{ALT:()=>this.CONSUME(Nl)}])}},{ALT:()=>{this.CONSUME(Dt,{LABEL:"inlineCarrier"}),this.CONSUME(Ws)}},{ALT:()=>this.CONSUME2(zu)},{ALT:()=>this.CONSUME2(Vu)},{ALT:()=>this.CONSUME2(Qu)},{ALT:()=>this.CONSUME2(kl)},{ALT:()=>this.CONSUME2(Zu)},{ALT:()=>this.CONSUME2(bl)},{ALT:()=>this.CONSUME2(Yu)},{ALT:()=>this.CONSUME2(Nl)},{ALT:()=>this.CONSUME2(Xu)},{ALT:()=>this.CONSUME2(Cl)},{ALT:()=>this.CONSUME2(Bs)},{ALT:()=>this.CONSUME2(Fs)},{ALT:()=>this.CONSUME(Ks)}]),this.OPTION2(()=>{this.CONSUME(Hs),this.SUBRULE(this.linkText),this.CONSUME2(Hs)})}),this.linkText=this.RULE("linkText",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(j)},{ALT:()=>this.CONSUME(Dt)},{ALT:()=>this.CONSUME(Ze)},{ALT:()=>this.CONSUME(Ul)},{ALT:()=>this.CONSUME(Ws)},{ALT:()=>this.CONSUME(Pl)},{ALT:()=>this.CONSUME(ql)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(en)},{ALT:()=>this.CONSUME(Ds)},{ALT:()=>this.CONSUME($s)}])})}),this.linkTextInline=this.RULE("linkTextInline",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(j)},{ALT:()=>this.CONSUME(Dt)},{ALT:()=>this.CONSUME(Ze)},{ALT:()=>this.CONSUME(Hs)}])})}),this.subgraph=this.RULE("subgraph",()=>{this.CONSUME(xl),this.OR([{ALT:()=>{this.CONSUME(j,{LABEL:"subgraphId"}),this.OPTION(()=>{this.CONSUME1(Gs),this.SUBRULE(this.nodeContent),this.CONSUME1(js)})}},{ALT:()=>{this.CONSUME(qt,{LABEL:"subgraphTitleQ"})}},{ALT:()=>{this.CONSUME2(Gs),this.SUBRULE2(this.nodeContent),this.CONSUME2(js)}}]),this.CONSUME(at),this.MANY(()=>{this.SUBRULE(this.subgraphStatement)}),this.CONSUME(El),this.OPTION3(()=>{this.CONSUME2(at)})}),this.subgraphStatement=this.RULE("subgraphStatement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStatement)},{ALT:()=>this.SUBRULE(this.nodeStatement)},{ALT:()=>this.SUBRULE(this.subgraph)},{ALT:()=>this.SUBRULE(this.classStatement)},{ALT:()=>this.SUBRULE(this.styleStatement)},{ALT:()=>this.SUBRULE(this.classDefStatement)},{ALT:()=>this.CONSUME(at)}])}),this.directionStatement=this.RULE("directionStatement",()=>{this.CONSUME(j,{LABEL:"dirKw"}),this.CONSUME(qs),this.OPTION(()=>this.CONSUME(at))}),this.classStatement=this.RULE("classStatement",()=>{this.CONSUME(yl),this.CONSUME(j),this.MANY(()=>{this.CONSUME(zt),this.CONSUME2(j)}),this.CONSUME3(j,{LABEL:"className"}),this.OPTION(()=>{this.CONSUME(at)})}),this.styleStatement=this.RULE("styleStatement",()=>{this.CONSUME(Sl),this.CONSUME(j),this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(Dt)},{ALT:()=>this.CONSUME2(j)},{ALT:()=>this.CONSUME(zs)},{ALT:()=>this.CONSUME(en)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Ze)}])}),this.OPTION(()=>{this.CONSUME(at)})}),this.classDefStatement=this.RULE("classDefStatement",()=>{this.CONSUME(Tl),this.CONSUME(j),this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(Dt)},{ALT:()=>this.CONSUME2(j)},{ALT:()=>this.CONSUME(zs)},{ALT:()=>this.CONSUME(en)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Ze)}])}),this.OPTION(()=>{this.CONSUME(at)})}),this.performSelfAnalysis()}_augmentNodeRule(){let e=this.node;this.node=this.RULE("node",()=>{this.OR([{ALT:()=>{this.CONSUME(j,{LABEL:"nodeId"}),this.OPTION(()=>{this.CONSUME(Ze,{LABEL:"nodeIdSuffix"})})}},{ALT:()=>{this.CONSUME2(Ze,{LABEL:"nodeIdNum"})}}]),this.OPTION2(()=>{this.SUBRULE(this.nodeShape)}),this.OPTION3(()=>{this.CONSUME(Al),this.CONSUME3(j,{LABEL:"nodeClass"})})})}},$t=new hh;function dE(t){return $t.input=t,{cst:$t.diagram(),errors:$t.errors}}var pE=$t.getBaseCstVisitorConstructorWithDefaults(),fh=class extends pE{constructor(e,r,n){super(),this.edgeCount=0,this.validateVisitor(),this.ctx=e,this.knownIds=r,this.knownEdgeIds=n}diagram(e){e.statement&&e.statement.forEach(r=>this.visit(r))}classStatement(e){let r=e.Identifier||[],n=e.className&&e.className[0];for(let i of r){if(n&&i.startOffset===n.startOffset)continue;let s=String(i.image);this.knownIds.has(s)||this.knownEdgeIds.has(s)||this.ctx.errors.push({line:i.startLine??1,column:i.startColumn??1,severity:"warning",code:"FL-CLASS-TARGET-UNKNOWN",message:`Unknown id '${s}' in class statement.`,hint:"Define the node/link before applying classes, or move the class line after it."})}}styleStatement(e){let r=e.Identifier&&e.Identifier[0];if(r){let n=String(r.image);this.knownIds.has(n)||this.ctx.errors.push({line:r.startLine??1,column:r.startColumn??1,severity:"warning",code:"FL-STYLE-TARGET-UNKNOWN",message:`Unknown node id '${n}' in style statement.`,hint:"Define the node before styling it, or move the style line after the node definition."})}}statement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}clickStatement(e){let r=e.clickHref?.[0],n=r?void 0:e.clickCall?.[0];if(r){let u=r.children||{},f=u.mode?.[0],l=u.url?.[0],d=u.tooltip?.[0],h=u.target?.[0];if(String(f?.image||"").toLowerCase()!=="href"){this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-MODE-INVALID",message:`Unknown click mode '${f?.image}'. Use 'href' or 'call'.`,hint:'Examples: href "\u2026" | call fn()'});return}l||this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-HREF-URL-MISSING",message:"'click \u2026 href' requires a quoted URL.",hint:'Example: click A href "https://example.com" "Open" _blank'}),h&&!/^_(blank|self|parent|top)$/i.test(String(h.image||""))&&this.ctx.errors.push({line:h.startLine??1,column:h.startColumn??1,severity:"warning",code:"FL-CLICK-TARGET-UNKNOWN",message:`Unknown target '${h.image}'. Use _blank/_self/_parent/_top.`,hint:"Example: \u2026 _blank"});return}if(n){let u=n.children||{},f=u.mode?.[0],l=String(f?.image||"").toLowerCase();if(!(l==="call"||l==="callback")){this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-MODE-INVALID",message:`Unknown click mode '${f?.image}'. Use 'href' or 'call'.`,hint:'Examples: href "\u2026" | call fn()'});return}u.fn?.[0]||this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-CALL-NAME-MISSING",message:"'click \u2026 call' requires a function name.",hint:"Example: click A call doThing()"});let h=u.tooltip?.[0];h&&this.ctx.errors.push({line:h.startLine??1,column:h.startColumn??1,severity:"error",code:"FL-CLICK-CALL-EXTRA-TEXT",message:"Tooltip/text after 'call()' is not supported by Mermaid CLI.",hint:"Use: click A call doThing()"});return}let i=e.Identifier||[],s=e.QuotedString||[],o=i[0],a=i[1],c=(a?.image||"").toLowerCase();if(!c){this.ctx.errors.push({line:o?.startLine??1,column:o?.startColumn??1,severity:"error",code:"FL-CLICK-MODE-MISSING",message:"After 'click <id>' specify 'href' or 'call'.",hint:'Examples: click A href "https://\u2026" "Tip" _blank | click A call doThing() "Tip"'});return}if(c==="href"){s.length<1&&this.ctx.errors.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"FL-CLICK-HREF-URL-MISSING",message:"'click \u2026 href' requires a quoted URL.",hint:'Example: click A href "https://example.com" "Open" _blank'});let u=i[2];u&&!/^_(blank|self|parent|top)$/i.test(u.image||"")&&this.ctx.errors.push({line:u.startLine??1,column:u.startColumn??1,severity:"warning",code:"FL-CLICK-TARGET-UNKNOWN",message:`Unknown target '${u.image}'. Use _blank/_self/_parent/_top.`,hint:"Example: \u2026 _blank"});return}if(c==="call"||c==="callback"){i[2]||this.ctx.errors.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"FL-CLICK-CALL-NAME-MISSING",message:"'click \u2026 call' requires a function name.",hint:"Example: click A call doThing()"});return}this.ctx.errors.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"FL-CLICK-MODE-INVALID",message:`Unknown click mode '${a.image}'. Use 'href' or 'call'.`,hint:'Examples: href "\u2026" | call fn()'})}linkStyleStatement(e){let r=e.linkStyleIndexList?.[0],n=e.linkStylePairs?.[0],s=((f,l)=>f?(f.children||{})[l]||[]:[])(r,"index"),o=s.map(f=>parseInt(f.image,10)).filter(f=>Number.isFinite(f));if(o.length===0){let f=e.LinkStyleKeyword?.[0]||s[0];this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-LINKSTYLE-NO-INDICES",message:"'linkStyle' requires one or more link indices (comma separated).",hint:"Example: linkStyle 0,1 stroke:#f66,stroke-width:2px"});return}if(!((n?.children||{}).linkStylePair||[]).length){let f=s[0];this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-LINKSTYLE-MISSING-STYLE",message:"Missing style declarations after indices.",hint:"Example: linkStyle 0 stroke:#f00,stroke-width:2px"})}let u=new Set;for(let f of o){if(u.has(f)){let l=s.find(d=>parseInt(d.image,10)===f);this.ctx.errors.push({line:l?.startLine??1,column:l?.startColumn??1,severity:"warning",code:"FL-LINKSTYLE-DUPLICATE-INDEX",message:`Duplicate linkStyle index ${f}.`,hint:"Remove duplicates."})}u.add(f)}for(let f of o)if(!(f>=0&&f<this.edgeCount)){let l=s.find(d=>parseInt(d.image,10)===f);this.ctx.errors.push({line:l?.startLine??1,column:l?.startColumn??1,severity:"error",code:"FL-LINKSTYLE-INDEX-OUT-OF-RANGE",message:`linkStyle index ${f} is out of range (0..${Math.max(0,this.edgeCount-1)}).`,hint:`Use an index between 0 and ${Math.max(0,this.edgeCount-1)} or add more links first.`})}}subgraph(e){e.subgraphStatement&&e.subgraphStatement.forEach(r=>this.visit(r))}subgraphStatement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}directionStatement(e){let r=e.dirKw?.[0];r&&r.image!=="direction"&&this.ctx.errors.push({line:r.startLine??1,column:r.startColumn??1,severity:"error",code:"FL-DIR-KW-INVALID",message:`Unknown keyword '${r.image}' before direction. Use 'direction TB' / 'LR' / etc.`,hint:"Example inside subgraph: 'direction TB'",length:r.image?.length??0})}nodeStatement(e){e.nodeOrParallelGroup&&e.nodeOrParallelGroup.forEach(n=>this.visit(n));let r=Array.isArray(e.link)?e.link.length:0;r>0&&(this.edgeCount+=r),e.link&&e.link.forEach(n=>this.visit(n))}nodeOrParallelGroup(e){e.node&&e.node.forEach(r=>this.visit(r))}node(e){let r=Array.isArray(e.attrObject)&&e.attrObject.length>0,n=Array.isArray(e.nodeShape)&&e.nodeShape.length>0;if(r&&n){let s=(e.attrObject?.[0]?.children?.attrLCurly||[])[0];this.ctx.errors.push({line:s?.startLine??1,column:s?.startColumn??1,severity:"warning",code:"FL-TYPED-SHAPE-CONFLICT",message:"Both bracket shape and '@{ shape: \u2026 }' provided. Bracket shape will be used.",hint:'Pick one style: either A[Label] or A@{ shape: rect, label: "Label" }'})}if(e.nodeShape&&e.nodeShape.forEach(i=>this.visit(i)),r){let s=e.attrObject?.[0]?.children?.attrPair||[],o=new Set(["shape","label","padding","cornerRadius","icon","image"]),a=new Set(["rect","round","rounded","stadium","subroutine","circle","cylinder","diamond","trapezoid","trapezoidAlt","parallelogram","hexagon","lean-l","lean-r","icon","image"]);for(let c of s){let u=c.children?.attrKey?.[0],f=c.children?.QuotedString?.[0]||c.children?.Identifier?.[0]||c.children?.NumberLiteral?.[0]||c.children?.Text?.[0];if(!u)continue;let l=u.image;if(!o.has(l)){this.ctx.errors.push({line:u.startLine??1,column:u.startColumn??1,severity:"warning",code:"FL-TYPED-KEY-UNKNOWN",message:`Unknown typed-shape key '${l}'.`,hint:"Allowed keys: shape, label, padding, cornerRadius, icon, image"});continue}if(l==="shape"&&f){let d=String(f.image).replace(/^"|"$/g,"");a.has(d)?new Set(["rect","round","rounded","diamond","circle","cylinder","stadium","subroutine","lean-l","lean-r"]).has(d)||this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"error",code:"FL-TYPED-SHAPE-UNSUPPORTED",message:`Typed shape '${d}' is not supported by current Mermaid CLI.`,hint:'Use one of: rect, rounded, diamond, circle, cylinder, stadium, subroutine, "lean-l", "lean-r"'}):this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"error",code:"FL-TYPED-SHAPE-UNKNOWN",message:`Unknown shape '${d}' in '@{ shape: \u2026 }'.`,hint:'Use one of: rect, rounded, stadium, subroutine, circle, cylinder, diamond, trapezoid, parallelogram, hexagon, "lean-l", "lean-r", icon, image'})}if(l==="label"&&f&&f.tokenType?.name!=="QuotedString"&&this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"warning",code:"FL-TYPED-LABEL-NOT-STRING",message:"Typed-shape 'label' should be a quoted string.",hint:'Example: A@{ shape: rect, label: "Start" }'}),(l==="padding"||l==="cornerRadius")&&f){let d=String(f.image).replace(/^"|"$/g,"");/^\d+(px)?$/.test(d)||this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"warning",code:"FL-TYPED-NUMERIC-EXPECTED",message:`'${l}' expects a number (optionally with px).`,hint:`Use: ${l}: 8 or ${l}: "8px"`})}}}}checkEmptyContent(e,r){if(!r||r.length===0){this.ctx.errors.push({line:e.startLine??1,column:e.startColumn??1,severity:"error",message:"Empty label inside a shape.",code:"FL-NODE-EMPTY",hint:'Write non-empty text inside the brackets, e.g., A["Start"] or A[Start]. If you want no label, omit the brackets and just use A.'});return}for(let n of r){let i=n.children||{},s=[].concat(i.QuotedString||[]).concat(i.MultilineText||[]);for(let o of s){let a=o.image;if(!a)continue;(a.startsWith('"')||a.startsWith("'")?a.slice(1,-1):a).trim().length===0&&this.ctx.errors.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",message:"Empty label inside a shape (only empty quotes/whitespace).",code:"FL-NODE-EMPTY",hint:'Provide non-empty text, e.g., A["Start"] or A[Start]. If you want no label, omit the brackets and just use A.'})}}}checkEscapedQuotes(e){if(e)for(let r of e){let n=r.children||{},i=[].concat(n.QuotedString||[]).concat(n.Text||[]).concat(n.Identifier||[]).concat(n.NumberLiteral||[]);for(let s of i)s.image&&s.image.includes('\\"')&&this.ctx.errors.push({line:s.startLine??1,column:s.startColumn??1,severity:"error",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',code:"FL-LABEL-ESCAPED-QUOTE",hint:'Prefer "He said &quot;Hi&quot;".'})}}checkDoubleInSingleQuoted(e){if(e)for(let r of e){let i=(r.children||{}).QuotedString||[];for(let s of i){let o=s.image||"";if(o.startsWith("'")&&o.endsWith("'")&&o.includes('"')){let a=o.indexOf('"'),c=(s.startColumn??1)+Math.max(0,a);this.ctx.errors.push({line:s.startLine??1,column:c,severity:"error",message:'Double quotes inside a single-quoted label are not supported by Mermaid. Replace inner " with &quot; or use a double-quoted label with &quot;.',code:"FL-LABEL-DOUBLE-IN-SINGLE",hint:'Change to "She said &quot;Hello&quot;" or replace inner " with &quot;.',length:1})}}}}checkDoubleInDoubleQuoted(e){if(e)for(let r of e){let i=(r.children||{}).QuotedString||[];if(i.length>=2){let s=i[1];this.ctx.errors.push({line:s.startLine??1,column:s.startColumn??1,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1})}}}checkCurlyInQuoted(e){if(e)for(let r of e){let i=(r.children||{}).QuotedString||[];for(let s of i){let o=String(s.image||""),a=o.length>=2&&(o.startsWith('"')||o.startsWith("'"))?o.slice(1,-1):o,c=a.indexOf("{"),u=a.indexOf("}");if(c>=0||u>=0){let f=c>=0?c:u,l=(s.startColumn??1)+1+Math.max(0,f);this.ctx.errors.push({line:s.startLine??1,column:l,severity:"error",code:"FL-LABEL-CURLY-IN-QUOTED",message:"Curly braces inside quoted label text may be parsed as a shape by Mermaid. Replace { and } with HTML entities.",hint:'Use &#123; and &#125; for { and } inside quoted text, e.g., "tyk-trace-&#123;id&#125;".',length:1});break}}}}warnParensInUnquoted(e){if(e)for(let r of e){let n=r.children||{};if(Array.isArray(n.QuotedString)&&n.QuotedString.length>0)continue;let s=[];for(let u of Object.keys(n))Array.isArray(n[u])&&s.push(...n[u]);if(s.sort((u,f)=>(u.startOffset??0)-(f.startOffset??0)),s.length>=2){let u=s[0],f=s[s.length-1],l=d=>d.image==="/"||d.image==="\\";if(l(u)&&l(f))continue}let o=n.RoundOpen||[],a=n.RoundClose||[],c=[...o,...a];if(c.length>0){let u=c[0];this.ctx.errors.push({line:u.startLine??1,column:u.startColumn??1,severity:"error",code:"FL-LABEL-PARENS-UNQUOTED",message:"Parentheses inside an unquoted label are not supported by Mermaid.",hint:'Wrap the label in quotes, e.g., A["Mark (X)"] \u2014 or replace ( and ) with HTML entities: &#40; and &#41;'})}}}nodeShape(e){let r=e.SquareOpen&&e.SquareOpen[0]||e.DoubleSquareOpen&&e.DoubleSquareOpen[0]||e.RoundOpen&&e.RoundOpen[0]||e.DoubleRoundOpen&&e.DoubleRoundOpen[0]||e.DiamondOpen&&e.DiamondOpen[0]||e.HexagonOpen&&e.HexagonOpen[0]||e.StadiumOpen&&e.StadiumOpen[0]||e.CylinderOpen&&e.CylinderOpen[0],n=[];for(let i of Object.keys(e))if(i.startsWith("nodeContent")){let s=e[i];Array.isArray(s)&&n.push(...s)}if(r&&(this.checkEmptyContent(r,n.length?n:void 0),this.checkDoubleInSingleQuoted(n),this.checkCurlyInQuoted(n),this.checkBackticksInContent(n),this.warnParensInUnquoted(n),this.ctx.strict)){let i=!1,s;for(let o of n){let a=o.children||{};if(a.QuotedString&&a.QuotedString.length||a.MultilineText&&a.MultilineText.length){i=!0;break}let c=[].concat(a.Identifier||[]).concat(a.Text||[]).concat(a.NumberLiteral||[]).concat(a.RoundOpen||[]).concat(a.RoundClose||[]).concat(a.Comma||[]).concat(a.Colon||[]).concat(a.Pipe||[]);!s&&c.length&&(s=c[0])}if(n.length>0&&!i){let o=s??r;this.ctx.errors.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",code:"FL-STRICT-LABEL-QUOTES-REQUIRED",message:"Strict mode: Node label must be quoted (use double quotes and &quot; inside).",hint:'Example: A["Label with &quot;quotes&quot; and (parens)"]'})}}}link(e){let r=e.linkTextInline?.[0];if(r){let n=r.children||{},i=[].concat(n.Identifier||[]).concat(n.Text||[]).concat(n.NumberLiteral||[]).concat(n.Pipe||[]);if(i.length){let s=i.map(o=>String(o.image||"")).join("").trim();if(s==="x"||s==="o"){let o=i[0];this.ctx.errors.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",code:"FL-LINK-UNSUPPORTED-MARKER",message:`Unsupported one-sided link marker '${s}'. Use symmetric '${s}--${s}' or a plain arrow with a label.`,hint:s==="x"?"Example: A x--x B  (or)  A --> B  and label it: A --|Skipped|--> B":"Example: A o--o B  (or)  A --> B",length:o.image?.length??1})}}}}checkBackticksInContent(e){if(e)for(let r of e){let n=r.children||{},i=(a,c=!1)=>{if(!a)return!1;let f=String(a.image||"").indexOf("`");if(f>=0){let l=(a.startColumn??1)+f;return this.ctx.errors.push({line:a.startLine??1,column:l,severity:c?"error":"warning",code:"FL-LABEL-BACKTICK",message:"Backticks (`\u2026`) inside node labels are not supported by Mermaid.",hint:'Remove the backticks or use quotes instead, e.g., "GITHUB_ACTIONS" and "--cli".',length:1}),!0}return!1},s=n.Text||[];for(let a of s)if(i(a,!1))return;let o=n.QuotedString||[];for(let a of o)if(i(a,!0))return}}},dh=class extends pE{constructor(){super(),this.ids=new Set,this.edgeIds=new Set,this.validateVisitor()}node(e){let r=e.nodeId&&e.nodeId[0],n=e.nodeIdNum&&e.nodeIdNum[0];r?this.ids.add(String(r.image)):n&&this.ids.add(String(n.image))}link(e){let r=e.edgeId?.[0];r&&this.edgeIds.add(String(r.image))}nodeOrParallelGroup(e){e.node&&e.node.forEach(r=>this.visit(r))}nodeStatement(e){e.nodeOrParallelGroup&&e.nodeOrParallelGroup.forEach(r=>this.visit(r)),e.link&&e.link.forEach(r=>this.visit(r))}edgeAttrStatement(e){let r=e.edgeId?.[0];r&&this.edgeIds.add(String(r.image))}statement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}diagram(e){e.statement&&e.statement.forEach(r=>this.visit(r))}};function mE(t,e,r){let n={errors:[],strict:r?.strict},i=new dh;return i.visit(t),new fh(n,i.ids,i.edgeIds).visit(t),n.errors}function Vs(t,e){let r=[],n=e.code,i=e.message||'Escaped quotes (\\") are not supported by Mermaid. Use &quot; instead.',s=e.hint||'Use &quot; for inner quotes, e.g., "He said &quot;Hi&quot;".',o=new Set;for(let a of t)if(typeof a.image=="string"){let c=a.image.indexOf('\\"');if(c!==-1){let u=a.startLine??1;if(o.has(u))continue;o.add(u);let f=(a.startColumn??1)+c,{line:l,column:d}=ar(u,f,1,1);r.push({line:l,column:d,severity:"error",code:n,message:i,hint:s,length:2})}}return r}function Ri(t,e){let r=[],n=new Map;for(let o of t){let a=o.startLine??1;n.has(a)||n.set(a,[]),n.get(a).push(o)}let i=new Set(e.scopeEndTokenNames||[]),s=new Set(e.scopeStartTokenNames||[]);for(let[o,a]of n)for(let c=0;c<a.length;c++){let u=a[c];if(u.tokenType?.name==="QuotedString"){if(s.size>0){let f=-1;for(let h=c-1;h>=0;h--){let p=a[h];if(s.has(p.tokenType?.name||"")){f=h;break}}if(f===-1)continue;let l=a[f],d=a[f-1];if(l.tokenType?.name==="DiamondOpen"&&d?.tokenType?.name==="AtSign")continue}for(let f=c+1;f<a.length;f++){let l=a[f];if(i.size>0&&i.has(l.tokenType?.name||""))break;if(l.tokenType?.name==="QuotedString"){if((u.image||"").startsWith('"')){let{line:p,column:x}=ar(l.startLine??null,l.startColumn??null,o,1);r.push({line:p,column:x,severity:"error",code:e.code,message:e.message,hint:e.hint,length:1})}f=a.length;break}if(l.tokenType?.name==="Text"&&typeof l.image=="string"&&l.image.includes('"')){let d=l.image.indexOf('"'),h=(l.startColumn??1)+(d>=0?d:0),{line:p,column:x}=ar(l.startLine??null,h,o,1);r.push({line:p,column:x,severity:"error",code:e.code,message:e.message,hint:e.hint,length:1}),f=a.length;break}}if(r.length>0&&r[r.length-1].line===o)break}}return r}function tn(t,e){let r=[],n=t.split(/\r?\n/),i=e.message||"Unclosed quote in label or name.",s=e.hint||'Close the quote, e.g., "Text"',o=e.limitPerFile??1;for(let a=0;a<n.length;a++){let c=n[a]??"";if(!c)continue;let u=c.split("&quot;").join("").split('\\"').join(""),f=[],l=[];for(let p=0;p<u.length;p++){let x=u[p];x==='"'?f.push(p):x==="'"&&l.push(p)}let d=f.length%2===1,h=l.length%2===1;if(d||h){let p=d?f[0]??0:l[0]??0;if(r.push({line:a+1,column:p+1,severity:"error",code:e.code,message:i,hint:s,length:1}),r.length>=o)break}}return r}function ar(t,e,r=1,n=1){let i=Number.isFinite(t)&&t>0?t:r,s=Number.isFinite(e)&&e>0?e:n;return{line:i,column:s}}function Qs(t){let e=t.split(/\r?\n/),r=e.length,n=e[e.length-1]??"",i=Math.max(1,n.length+1);return{line:r,column:i}}function gE(t){let{line:e,column:r}=ar(t.line,t.column);return{line:e,column:r,severity:"error",message:t.message}}function ph(t){let e=t?.image??"";return e===`
`?"\\n":e}function je(t,e){let r=t?.context?.ruleStack;return Array.isArray(r)&&r.includes(e)}function De(t,e){return(t.message||"").includes(`--> ${e} <--`)}function mh(t){let e=t?.context?.ruleStack;return Array.isArray(e)&&e.length===1&&e[0]==="diagram"}function xE(t,e){let r=t.token,n=Qs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=ph(r),a=r?.tokenType?.name,c=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,u=e.split(/\r?\n/),f=u[Math.max(0,i-1)]??"",l=d=>{let h=Math.max(0,s-1),x=f.slice(0,h).lastIndexOf(d);if(x===-1)return null;let m=f.slice(x+1),g=m.indexOf('\\"');if(g!==-1)return{kind:"escaped",column:x+1+g+1};let S=[];for(let E=0;E<m.length;E++)m[E]==='"'&&S.push(E);if(S.length>=3){let E=S[2];return{kind:"double-in-double",column:x+1+E+1}}return null};if(mh(t)&&De(t,"Direction"))return a==="EOF"||a==="Newline"?{line:i,column:s,severity:"error",code:"FL-DIR-MISSING",message:"Missing direction after diagram header. Use TD, TB, BT, RL, or LR.",hint:"Example: 'flowchart TD' for top-down layout.",length:1}:{line:i,column:s,severity:"error",code:"FL-DIR-INVALID",message:`Invalid direction '${o}'. Use one of: TD, TB, BT, RL, LR.`,hint:"Try 'TD' (top-down) or 'LR' (left-to-right).",length:c};if(t.name==="MismatchedTokenException"){let d=t.message||"";if(a==="Identifier"&&["right","left","over","of"].includes(o)){let h=u[Math.max(0,i-1)]?.slice(0,Math.max(0,s-1))?.trim()?.split(/\s+/)||[];if(h[h.length-1]==="note"||h.length>=2&&h[h.length-2]==="note")return{line:i,column:Math.max(1,u[Math.max(0,i-1)]?.lastIndexOf("note")+1||s),severity:"error",code:"FL-NOTE-NOT-SUPPORTED",message:"'note' syntax is not supported in flowchart/graph diagrams.",hint:"Notes are only available in sequence diagrams. Use node labels or HTML comments (%%comment%%) instead.",length:4}}if(d.includes("AtSign")&&o==="of"){let h=u[Math.max(0,i-1)]||"";if(h.includes("note")){let p=h.indexOf("note");return{line:i,column:p+1,severity:"error",code:"FL-NOTE-NOT-SUPPORTED",message:"'note' syntax is not supported in flowchart/graph diagrams.",hint:"Notes are only available in sequence diagrams. Use node labels or HTML comments (%%comment%%) instead.",length:4}}}}if(je(t,"linkStylePairs")&&a==="Newline"){let d=Math.min(u.length,i+1),p=((u[d-1]||"").match(/\S/)||{index:0}).index||0;return{line:d,column:Math.max(1,p+1),severity:"error",code:"FL-LINKSTYLE-MULTILINE",message:"'linkStyle' styles must be on the same line as the indices.",hint:"Example: linkStyle 0,1 stroke:#f00,stroke-width:2px",length:1}}if((je(t,"linkStyleIndexList")||je(t,"linkStyleStatement"))&&a==="Colon")return{line:i,column:s,severity:"error",code:"FL-LINKSTYLE-RANGE-NOT-SUPPORTED",message:"Ranges in 'linkStyle' indices are not supported. Use comma-separated indices.",hint:"Example: linkStyle 0,1 stroke:#f00,stroke-width:2px",length:c};if(a==="QuotedString"){let d=t?.context,h=d?.ruleStack?.includes("linkTextInline")||d?.ruleStack?.includes("link")||!1,m=(u[Math.max(0,i-1)]||"").slice(0,Math.max(0,s-1)).match(/--\s*$|==\s*$|-\.\s*$|-\.-\s*$|\[\s*$/);if(h||m){let g=o.startsWith('"')?o.slice(1,-1):o;return{line:i,column:s,severity:"error",code:"FL-EDGE-LABEL-QUOTED",message:"Edge labels must use pipe syntax, not quotes.",hint:`Change -- "${g}" --> to --|${g}|--> or use -- |${g}| -->`,length:c}}}if(t.name==="NoViableAltException"||t.name==="MismatchedTokenException"){let d=t.message||"";if(a==="Identifier"&&d.includes("Newline")&&d.includes("EOF"))return{line:i,column:s,severity:"error",code:"FL-LINK-MISSING",message:`Two nodes on one line must be connected with an arrow before '${o}'.`,hint:"Insert --> between nodes, e.g., A --> B.",length:c}}if(je(t,"nodeShape")&&t.name==="MismatchedTokenException"&&a==="SquareClose"&&De(t,"RoundClose"))return{line:i,column:s,severity:"error",code:"FL-NODE-MIXED-BRACKETS",message:"Mismatched brackets: opened '(' but closed with ']'.",hint:"Close with ')' or change the opening bracket to '['.",length:c};if(je(t,"nodeShape")&&t.name==="MismatchedTokenException"){if(De(t,"SquareClose")){if(a==="RoundOpen"||a==="RoundClose")return{line:i,column:s,severity:"error",code:"FL-LABEL-PARENS-UNQUOTED",message:"Parentheses inside an unquoted label are not supported by Mermaid.",hint:'Wrap the label in quotes, e.g., A["Mark (X)"] \u2014 or replace ( and ) with HTML entities: &#40; and &#41;.',length:c};{let h=Math.max(0,s-1),p=f.lastIndexOf("[",h);if(p!==-1){let x=f.indexOf("]",p+1),m=x!==-1?f.slice(p+1,x):f.slice(p+1);if(m.includes('"'))return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &quot; for quotes or wrap the entire label in quotes.",hint:'Example: I[Log &quot;processing N items&quot;] or I["Log \\"processing N items\\""]',length:c};if(m.includes("(")||m.includes(")"))return{line:i,column:s,severity:"error",code:"FL-LABEL-PARENS-UNQUOTED",message:"Parentheses inside an unquoted label are not supported by Mermaid.",hint:'Wrap the label in quotes, e.g., A["Mark (X)"] \u2014 or replace ( and ) with HTML entities: &#40; and &#41;.',length:c}}}if(a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &quot; for quotes or wrap the entire label in quotes.",hint:'Example: I[Log &quot;processing N items&quot;] or I["Log \\"processing N items\\""]',length:c};let d=l("[");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '['. Add a matching ']' before the arrow or newline.",hint:"Example: A[Label] --> B",length:1}}if(De(t,"RoundClose")){if(a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &quot; for quotes or wrap the entire label in quotes.",hint:'Example: E(Log &quot;message&quot;) or E["Log \\"message\\""]',length:c};{let h=Math.max(0,s-1),p=f.lastIndexOf("(",h);if(p!==-1){let x=f.slice(p+1);if(x.includes("(")||x.includes(")"))return{line:i,column:s,severity:"error",code:"FL-LABEL-PARENS-UNQUOTED",message:"Parentheses inside an unquoted label are not supported by Mermaid.",hint:'Wrap the label in quotes, e.g., A["Mark (X)"] \u2014 or replace ( and ) with HTML entities: &#40; and &#41;.',length:c}}}let d=l("(");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '('. Add a matching ')'.",hint:"Example: B(Label)",length:1}}if(De(t,"DiamondClose")){if(a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &apos; for single quotes or &quot; for double quotes.",hint:"Example: B{Does &apos;B&apos; depend on a forEach check &apos;A&apos;?}",length:c};{let h=Math.max(0,s-1),p=f.lastIndexOf("{",h);if(p!==-1){let x=f.indexOf("}",p+1),m=x!==-1?f.slice(p+1,x):f.slice(p+1);if(m.includes("(")||m.includes(")"))return{line:i,column:s,severity:"error",code:"FL-LABEL-PARENS-UNQUOTED",message:"Parentheses inside an unquoted label are not supported by Mermaid.",hint:'Wrap the label in quotes, e.g., A["Mark (X)"] \u2014 or replace ( and ) with HTML entities: &#40; and &#41;.',length:c}}}let d=l("{");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Example: D{"Is &quot;Driver&quot; AND &quot;AuthCheck.Path&quot; configured?"}',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported by Mermaid. Use &quot; for inner quotes.",hint:'Example: D{"Is &quot;Driver&quot; and &quot;AuthCheck.Path&quot; configured?"}',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '{'. Add a matching '}'.",hint:"Example: C{Decision}",length:1}}if(De(t,"DoubleRoundClose")){let d=l("(");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '(( '. Add a matching '))'.",hint:"Example: A((Circle))",length:2}}if(De(t,"DoubleSquareClose")){let d=l("[");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '[[ '. Add a matching ']]'.",hint:"Example: [[Subroutine]]",length:2}}if(De(t,"StadiumClose")){let d=l("(")||l("[");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '([ '. Add a matching '])'.",hint:"Example: A([Stadium])",length:c}}if(De(t,"CylinderClose")){let d=l("(")||l("[");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '[( '. Add a matching ')]'.",hint:"Example: A[(Cylinder)]",length:c}}if(De(t,"HexagonClose")){let d=l("{");return d?.kind==="escaped"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:d?.kind==="double-in-double"?{line:i,column:d.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '{{ '. Add a matching '}}'.",hint:"Example: A{{Hexagon}}",length:c}}}if(je(t,"nodeContent")&&t.name==="MismatchedTokenException"&&a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Double quotes inside an unquoted label are not allowed. Wrap the entire label in quotes or use &quot;.",hint:'Example: A["Calls logger.debug(&quot;message&quot;, data)"]',length:c};if(je(t,"classStatement"))return{line:i,column:s,severity:"error",code:"FL-CLASS-MALFORMED",message:"Invalid class statement. Provide node id(s) then a class name.",hint:"Example: class A,B important",length:c};if(je(t,"subgraph")&&t.name==="NoViableAltException")return{line:i,column:s,severity:"error",code:"FL-SUBGRAPH-MISSING-HEADER",message:"Subgraph header is missing. Add an ID or a [Title] after the keyword.",hint:"Example: subgraph API [API Layer]",length:c};if(je(t,"subgraph")&&t.name==="MismatchedTokenException"&&De(t,"Newline")){let d=f.indexOf("subgraph");if(d!==-1){let h=f.slice(d+8).trim();if(h&&!h.startsWith('"')&&!h.startsWith("'")&&h.includes(" "))return{line:i,column:s,severity:"error",code:"FL-SUBGRAPH-UNQUOTED-TITLE",message:"Subgraph titles with spaces must be quoted.",hint:'Example: subgraph "Existing Logic Path" or use underscores: subgraph Existing_Logic_Path',length:h.length}}}return t.name==="NotAllInputParsedException"&&a==="EndKeyword"?{line:i,column:s,severity:"error",code:"FL-END-WITHOUT-SUBGRAPH",message:"'end' without a matching 'subgraph'.",hint:"Remove this end or add a subgraph above.",length:c}:{line:i,column:s,severity:"error",message:t.message||"Parser error",length:c}}function EE(t,e){let r=t.token,n=Qs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=ph(r),a=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,u=e.split(/\r?\n/)[Math.max(0,i-1)]||"";if(t.name==="NotAllInputParsedException"&&r?.tokenType?.name==="Colon")return{line:i,column:s,severity:"error",code:"PI-LABEL-REQUIRES-QUOTES",message:"Slice labels must be quoted (single or double quotes).",hint:'Example: "Dogs" : 10',length:a};if(t.name==="NotAllInputParsedException"){let f=u.indexOf(":");if(f>0){let l=u.slice(0,f);if(!(l.trimStart().startsWith('"')||l.trimStart().startsWith("'")))return{line:i,column:Math.max(1,f),severity:"error",code:"PI-LABEL-REQUIRES-QUOTES",message:"Slice labels must be quoted (single or double quotes).",hint:'Example: "Dogs" : 10',length:1}}}if(t.name==="NotAllInputParsedException"&&typeof r?.image=="string"){let f=r.image;if(f.startsWith('"')&&!f.slice(1).includes('"')||f.startsWith("'")&&!f.slice(1).includes("'"))return{line:i,column:s,severity:"error",code:"PI-QUOTE-UNCLOSED",message:"Unclosed quote in slice label.",hint:'Close the quote: "Dogs" : 10',length:a}}if(De(t,"Colon")){let f=(u.match(/\"/g)||[]).length;if((u.match(/"/g)||[]).length-f>=3){let d=[];for(let p=0;p<u.length;p++)u[p]==='"'&&d.push(p);let h=(d[2]??s-1)+1;return{line:i,column:h,severity:"error",code:"PI-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted slice label are not supported. Use &quot; for inner quotes.",hint:'Example: "He said &quot;Hi&quot;" : 1',length:1}}return{line:i,column:s,severity:"error",code:"PI-MISSING-COLON",message:"Missing colon between slice label and value.",hint:'Use: "Label" : 10',length:a}}return De(t,"NumberLiteral")?{line:i,column:s,severity:"error",code:"PI-MISSING-NUMBER",message:"Missing numeric value after colon.",hint:"Use a number like 10 or 42.5",length:a}:De(t,"QuotedString")?{line:i,column:s,severity:"error",code:"PI-LABEL-REQUIRES-QUOTES",message:"Slice labels must be quoted (single or double quotes).",hint:'Example: "Dogs" : 10',length:a}:{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}}function yE(t,e){let r=t.token,n=Qs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=ph(r),a=r?.tokenType?.name,c=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,f=e.split(/\r?\n/)[Math.max(0,i-1)]||"",l=L=>je(t,L),d=l("actorRef")||l("participantDecl"),h=L=>De(t,L),p=t?.context?.ruleStack?.[0]==="diagram"&&t?.context?.ruleStack?.length===1,x=[{tok:"ElseKeyword",key:"else",allowedRule:"altBlock",allowedLabel:"alt",example:`alt Condition
  \u2026
else
  \u2026
end`},{tok:"AndKeyword",key:"and",allowedRule:"parBlock",allowedLabel:"par",example:`par
  \u2026
and
  \u2026
end`},{tok:"OptionKeyword",key:"option",allowedRule:"criticalBlock",allowedLabel:"critical",example:`critical
  \u2026
option Label
  \u2026
end`}],g=(t?.context?.ruleStack||[]).slice().reverse().find(L=>/Block$/.test(L)),S=x.find(L=>L.tok===a);if(S){if(!g)return S.key==="else"?{line:i,column:s,severity:"error",code:"SE-ELSE-OUTSIDE-ALT",message:"'else' is only allowed inside 'alt' blocks.",hint:"Use: alt Condition \u2026 else \u2026 end",length:c}:S.key==="and"?{line:i,column:s,severity:"error",code:"SE-AND-OUTSIDE-PAR",message:"'and' is only allowed inside 'par' blocks.",hint:"Example: par \u2026 and \u2026 end (parallel branches).",length:c}:{line:i,column:s,severity:"error",code:"SE-BRANCH-OUTSIDE-BLOCK",message:`'${S.key}' is only allowed inside a '${S.allowedLabel}' block.`,hint:`Start a ${S.allowedLabel} section:
${S.example}`,length:c};if(g!==S.allowedRule){if(S.key==="else"&&g==="criticalBlock")return{line:i,column:s,severity:"error",code:"SE-ELSE-IN-CRITICAL",message:"'else' is not allowed inside a 'critical' block. Use 'option' or close the block with 'end'.",hint:`Replace with: option <label>
Example:
option Retry`,length:c};let L=(g||"").replace(/Block$/,"")||"block";return{line:i,column:s,severity:"error",code:"SE-BRANCH-IN-WRONG-BLOCK",message:`'${S.key}' is only valid in '${S.allowedLabel}' blocks (not inside '${L}').`,hint:`Use the proper branch for '${L}' or close it with 'end'.
For '${S.allowedLabel}', use:
${S.example}`,length:c}}}if(p&&h("SequenceKeyword"))return{line:i,column:s,severity:"error",code:"SE-HEADER-MISSING",message:"Missing 'sequenceDiagram' header.",hint:"Start with: sequenceDiagram",length:c};if(l("messageStmt")&&t.name==="MismatchedTokenException"&&h("Colon"))return{line:i,column:s,severity:"error",code:"SE-MSG-COLON-MISSING",message:"Missing colon after target actor in message.",hint:"Use: A->>B: Message text",length:c};if(d&&(t.name==="NoViableAltException"||t.name==="MismatchedTokenException"||t.name==="EarlyExitException")){let b=tn(e,{code:"SE-QUOTE-UNCLOSED",message:"Unclosed quote in participant/actor name.",hint:'Close the quote: participant "Bob"  or  participant Alice as "Alias"',limitPerFile:Number.MAX_SAFE_INTEGER}).find(N=>N.line===i);if(b)return{...b,severity:"warning"};let C=(f.match(/\"/g)||[]).length,k=(f.match(/"/g)||[]).length-C,R=(f.match(/'/g)||[]).length;if(k>=3){let N=[];for(let v=0;v<f.length;v++)f[v]==='"'&&N.push(v);let I=(N[2]??s-1)+1;return{line:i,column:I,severity:"warning",code:"SE-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label are not supported. Use &quot; for inner quotes.",hint:'Example: participant "Logger &quot;debug&quot;" as L',length:1}}}if(l("arrow")&&t.name==="NoViableAltException")return{line:i,column:s,severity:"error",code:"SE-ARROW-INVALID",message:`Invalid sequence arrow near '${o}'.`,hint:"Use ->, -->, ->>, -->>, -x, --x, -), --), <<->>, or <<-->>",length:c};if((t.name==="NoViableAltException"||t.name==="MismatchedTokenException")&&a==="Minus")return{line:i,column:s,severity:"error",code:"SE-BULLET-LINE-UNSUPPORTED",message:"Bullet list lines starting with '-' are not supported in sequence diagrams.",hint:`Wrap free\u2011form text in a note block instead, for example:
Note over A : Item 1
Note over A
  - Item 1
  - Item 2
end note`,length:c};if(l("noteStmt")){if(t.name==="MismatchedTokenException"&&h("Colon"))return{line:i,column:s,severity:"error",code:"SE-NOTE-MALFORMED",message:"Malformed note: missing colon before the note text.",hint:"Example: Note right of Alice: Hello",length:c};if(t.name==="NoViableAltException")return{line:i,column:s,severity:"error",code:"SE-NOTE-MALFORMED",message:"Malformed note statement. Use left|right of X or over X[,Y]: text",hint:"Examples: Note over A,B: hi",length:c}}if(a==="ElseKeyword"&&je(t,"criticalBlock"))return{line:i,column:s,severity:"error",code:"SE-ELSE-IN-CRITICAL",message:"'else' is not allowed inside a 'critical' block. Use 'option' or close the block with 'end'.",hint:`Replace with: option <label>
Example:
option Retry`,length:c};if(l("boxBlock")&&(t.name==="NoViableAltException"||t.name==="MismatchedTokenException")){let L=/->|-->>|-->/.test(f),b=/note\s+(left|right|over)/i.test(f),C=/activate\s+/i.test(f),k=/deactivate\s+/i.test(f);if(L||b||C||k||a==="NoteKeyword"||a==="ActivateKeyword"||a==="DeactivateKeyword"){let R=e.split(/\r?\n/),N=Math.max(0,i-1),I=!1,v=-1;for(let w=N;w>=0;w--)if(/^\s*box\b/.test(R[w]||"")){v=w;break}if(v!==-1)for(let w=N;w<R.length;w++){if(/^\s*end\s*$/.test(R[w]||"")){I=!0;break}if(w>N&&/^\s*(sequenceDiagram|box|alt|opt|loop|par|rect|critical|break)\b/.test(R[w]||""))break}if(I){let w=!1;for(let M=v+1;M<R.length;M++){let _=R[M]||"";if(/^\s*end\s*$/.test(_))break;if(/^\s*(participant|actor)\b/i.test(_)){w=!0;break}}return w?{line:i,column:s,severity:"error",code:"SE-BOX-INVALID-CONTENT",message:"Box blocks can only contain participant/actor declarations.",hint:`Move messages, notes, and other statements outside the box block.
Example:
box "Group"
  participant A
  participant B
end
A->>B: Message`,length:c}:{line:v+1,column:1,severity:"error",code:"SE-BOX-EMPTY",message:"Box block has no participant/actor declarations. Use 'rect' to group messages visually.",hint:`Replace 'box' with 'rect' if you want to group messages:
rect rgb(240, 240, 255)
  A->>B: Message
  Note over A: Info
end`,length:3}}}}let E=[{rule:"altBlock",label:"alt"},{rule:"optBlock",label:"opt"},{rule:"loopBlock",label:"loop"},{rule:"parBlock",label:"par"},{rule:"rectBlock",label:"rect"},{rule:"criticalBlock",label:"critical"},{rule:"breakBlock",label:"break"},{rule:"boxBlock",label:"box"}];if(t.name==="MismatchedTokenException"&&h("EndKeyword")){let L=E.find(b=>je(t,b.rule));if(L){let b=e.split(/\r?\n/),C=/^(\s*)(alt\b|opt\b|loop\b|par\b|rect\b|critical\b|break\b|box\b)/,k=-1,R="";for(let I=Math.max(0,i-1);I>=0;I--){let v=C.exec(b[I]||"");if(v){k=I,R=v[1]||"";break}}if(L.label==="box"&&k!==-1){let I=-1;for(let v=k+1;v<b.length;v++){let w=b[v]||"",M=w.match(/^(\s*)/)?.[1]||"";if(/^\s*end\s*$/.test(w)&&M.length<=R.length){I=v;break}}if(I!==-1&&b.slice(k+1,I).map(M=>(M||"").trim()).some(M=>/->/.test(M)&&/[+-]/.test(M)))return{line:k+1,column:1,severity:"error",code:"SE-BOX-EMPTY",message:"Box block has no participant/actor declarations. Use 'rect' to group messages visually.",hint:`Replace 'box' with 'rect' if you want to group messages:
rect rgb(240, 240, 255)
  A->>B: Message
  Note over A: Info
end`,length:3}}let N=i;if(k!==-1){N=b.length;for(let I=k+1;I<b.length;I++){let v=b[I]||"";if(v.trim()==="")continue;if((v.match(/^(\s*)/)?.[1]||"").length<=R.length){N=I+1;break}}N>b.length&&(N=b.length+1)}return{line:N,column:1,severity:"error",code:"SE-BLOCK-MISSING-END",message:`Missing 'end' to close a '${L.label}' block.`,hint:"Add 'end' on its own line aligned with the block's start.",length:1}}}if((t.name==="NotAllInputParsedException"||t.name==="NoViableAltException")&&o==="-")return{line:i,column:s,severity:"error",code:"SE-BULLET-LINE-UNSUPPORTED",message:"Bullet list lines starting with '-' are not supported in sequence diagrams.",hint:`Wrap free\u2011form text in a note block, for example:
Note over A : Item 1
Note over A
  - Item 1
  - Item 2
end note`,length:c};if((t.name==="NoViableAltException"||t.name==="NotAllInputParsedException")&&a==="ElseKeyword")return{line:i,column:s,severity:"error",code:"SE-ELSE-OUTSIDE-ALT",message:"'else' is only allowed inside 'alt' blocks.",hint:"Use: alt Condition \u2026 else \u2026 end",length:c};if((t.name==="NoViableAltException"||t.name==="NotAllInputParsedException")&&a==="AndKeyword")return{line:i,column:s,severity:"error",code:"SE-AND-OUTSIDE-PAR",message:"'and' is only allowed inside 'par' blocks.",hint:"Example: par \u2026 and \u2026 end (parallel branches).",length:c};if((t.name==="NoViableAltException"||t.name==="NotAllInputParsedException")&&a==="EndKeyword")return{line:i,column:s,severity:"error",code:"SE-END-WITHOUT-BLOCK",message:"'end' without an open block (alt/opt/loop/par/rect/critical/break/box).",hint:"Add a block above (e.g., par \u2026 end | alt \u2026 end) or remove this end.",length:c};if(l("autonumberStmt")){if(a==="Identifier")return{line:i,column:s,severity:"error",code:"SE-AUTONUMBER-NON-NUMERIC",message:`Autonumber values must be numbers. Found '${o}'.`,hint:"Use numbers: autonumber 10 or autonumber 10 10 (start and step).",length:c};if(a==="ParticipantKeyword"||a==="ActorKeyword")return{line:i,column:s,severity:"error",code:"SE-AUTONUMBER-EXTRANEOUS",message:"Unexpected token after 'autonumber'. Put 'autonumber' on its own line.",hint:`Example:
autonumber 10 10
participant A`,length:c};if(t.name==="NoViableAltException"||t.name==="MismatchedTokenException"||t.name==="NotAllInputParsedException")return{line:i,column:s,severity:"error",code:"SE-AUTONUMBER-MALFORMED",message:"Malformed autonumber statement.",hint:"Use: autonumber | autonumber off | autonumber 10 10",length:c}}if(l("createStmt")&&(a==="Newline"||a==="EOF"))return{line:i,column:s,severity:"error",code:"SE-CREATE-MISSING-NAME",message:"Missing name after 'create'.",hint:"Use: create participant A  or  create actor B",length:c};if(l("createStmt")&&(t.name==="MismatchedTokenException"||t.name==="NoViableAltException"))return{line:i,column:s,severity:"error",code:"SE-CREATE-MALFORMED",message:"After 'create', specify 'participant' or 'actor' before the name.",hint:`Examples:
create participant B
create actor D as Donald`,length:c};if(l("destroyStmt")&&t.name==="MismatchedTokenException")return{line:i,column:s,severity:"error",code:"SE-DESTROY-MALFORMED",message:"After 'destroy', specify 'participant' or 'actor' and a name.",hint:`Examples:
destroy participant A
destroy actor B`,length:c};if(l("destroyStmt")&&(a==="Newline"||a==="EOF"))return{line:i,column:s,severity:"error",code:"SE-DESTROY-MISSING-NAME",message:"Missing name after 'destroy'.",hint:"Use: destroy participant A  or  destroy actor B",length:c};let y=(f.match(/\"/g)||[]).length;if((f.match(/"/g)||[]).length-y>=3){let L=[];for(let C=0;C<f.length;C++)f[C]==='"'&&L.push(C);let b=(L[2]??s-1)+1;return{line:i,column:b,severity:"error",code:"SE-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label are not supported. Use &quot; for inner quotes.",hint:'Example: participant "Logger &quot;debug&quot;" as L',length:1}}return{line:i,column:s,severity:"error",message:t.message||"Parser error",length:c}}function SE(t,e){let r=t.token,n=Qs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=r?.tokenType?.name,a=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,u=e.split(/\r?\n/)[Math.max(0,i-1)]||"";return mh(t)&&!De(t,"ClassDiagramKeyword")?{line:i,column:s,severity:"error",code:"CL-HEADER-MISSING",message:"Missing 'classDiagram' header.",hint:"Start with: classDiagram",length:a}:je(t,"relationOp")?/^\s*class\b/.test(u)?{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}:{line:i,column:s,severity:"error",code:"CL-REL-INVALID",message:"Invalid relationship operator. Use <|--, *--, o--, --, ..> or ..|>.",hint:"Example: Foo <|-- Bar",length:a}:(je(t,"classBlock")||je(t,"classLine"))&&t.name==="MismatchedTokenException"&&De(t,"RCurly")?{line:i,column:s,severity:"error",code:"CL-BLOCK-MISSING-RBRACE",message:"Missing '}' to close class block.",hint:"Close the block: class Foo { ... }",length:a}:je(t,"memberLine")&&(t.name==="MismatchedTokenException"||t.name==="NoViableAltException")?{line:i,column:s,severity:"error",code:"CL-MEMBER-MALFORMED",message:"Malformed class member. Use visibility + name [()][: type].",hint:"Examples: +foo() : void  |  -bar: int",length:a}:je(t,"relationStmt")&&t.name==="MismatchedTokenException"?{line:i,column:s,severity:"error",code:"CL-REL-MALFORMED",message:"Malformed relationship. Use: A <op> B [: label]",hint:"Example: Foo <|-- Bar : extends",length:a}:{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}}function TE(t,e){let r=t.token,n=Qs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=r?.tokenType?.name,a=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,u=e.split(/\r?\n/)[Math.max(0,i-1)]||"";if(mh(t)&&!(De(t,"StateDiagram")||De(t,"StateDiagramV2")))return{line:i,column:s,severity:"error",code:"ST-HEADER-MISSING",message:"Missing 'stateDiagram' header.",hint:"Start with: stateDiagram-v2",length:a};if(je(t,"noteStmt")&&t.name==="MismatchedTokenException"&&De(t,"Colon"))return{line:i,column:s,severity:"error",code:"ST-NOTE-MALFORMED",message:"Malformed note: missing colon before note text.",hint:"Example: Note right of A: message",length:a};if(je(t,"stateBlock")&&t.name==="MismatchedTokenException"&&De(t,"RCurly"))return{line:i,column:s,severity:"error",code:"ST-BLOCK-MISSING-RBRACE",message:"Missing '}' to close a state block.",hint:"Close the block: state Foo { ... }",length:a};if((t.name==="NoViableAltException"||t.name==="MismatchedTokenException")&&o==="Dashes"&&!je(t,"innerStatement"))return{line:i,column:s,severity:"error",code:"ST-CONCURRENCY-OUTSIDE-BLOCK",message:"'---' is only allowed inside 'state { \u2026 }' blocks.",hint:"Move '---' inside a composite state block: state A { \u2026 --- \u2026 }",length:a};let f=(u.match(/\\\"/g)||[]).length;if((u.match(/\"/g)||[]).length-f>=3){let d=[];for(let p=0;p<u.length;p++)u[p]==='"'&&d.push(p);let h=(d[2]??s-1)+1;return{line:i,column:h,severity:"warning",code:"ST-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label may be invalid. Use &quot; for inner quotes.",hint:'Example: state "Logger &quot;core&quot;" as L',length:1}}return{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}}function lr(t,e){let r=[],n=e.tokenize(t);if(n.errors.length>0&&r.push(...n.errors.map(gE)),e.postLex)try{r.push(...e.postLex(t,n.tokens)||[])}catch{}let i=null;if(n.errors.length===0){let s=e.parse(n.tokens);i=s.cst,s.errors.length>0&&r.push(...s.errors.map(o=>e.mapParserError(o,t)))}if(i)try{r.push(...e.analyze(i,n.tokens)||[])}catch(s){r.push({line:1,column:1,severity:"error",message:`Internal semantic analysis error: ${s.message}`})}if(e.postParse)try{r.push(...e.postParse(t,n.tokens,i,r)||[])}catch{}return r}function OE(t,e={}){return lr(t,{tokenize:Dl,parse:dE,analyze:(r,n)=>mE(r,n,{strict:!!e.strict}),mapParserError:(r,n)=>xE(r,n),postLex:(r,n)=>{let i=[];for(let s of n)s.tokenType===Ks&&i.push({line:s.startLine??1,column:s.startColumn??1,message:"Invalid arrow syntax: -> (use --> instead)",severity:"error",code:"FL-ARROW-INVALID",hint:"Replace -> with -->, or use -- text --> for inline labels.",length:s.image?.length??2});return i},postParse:(r,n,i,s)=>{{let x=n,m=new Map;for(let g of x){let S=g.startLine??1,E=g.startColumn??1,y=m.get(S);(!y||(y.startColumn??1/0)>E)&&m.set(S,g)}for(let g of x)g.image==="title"&&m.get(g.startLine??1)===g&&s.push({line:g.startLine??1,column:g.startColumn??1,severity:"error",code:"FL-META-UNSUPPORTED",message:"'title' is not supported in flowcharts by the current Mermaid CLI.",hint:'Use a Markdown heading above the code block, or draw a labeled node at the top (e.g., T["Dependency Relationship"]).',length:g.image?.length??5})}let o=Vs(n,{code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are accepted by Mermaid, but using &quot; is preferred for portability.',hint:'Prefer &quot; inside quoted labels, e.g., A["He said &quot;Hi&quot;"]'}).map(x=>({...x,severity:"error"})),a=new Set(s.filter(x=>x.code==="FL-LABEL-DOUBLE-IN-DOUBLE").map(x=>x.line)),c=new Set(Vs(n,{code:"x"}).map(x=>x.line)),u=Ri(n,{code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',scopeEndTokenNames:["SquareClose","RoundClose","DiamondClose","DoubleSquareClose","DoubleRoundClose","StadiumClose","CylinderClose","HexagonClose"],scopeStartTokenNames:["SquareOpen","RoundOpen","DiamondOpen","DoubleSquareOpen","DoubleRoundOpen","StadiumOpen","CylinderOpen","HexagonOpen"]}).filter(x=>!a.has(x.line)&&!c.has(x.line)),f=o.concat(u),l=(s||[]).filter(x=>x.severity==="error"&&!("code"in x)&&typeof x.message=="string");for(let x of l){let m=String(x.message||"");m.includes("Newline")&&m.includes("EOF")&&f.push({line:x.line??1,column:x.column??1,severity:"error",code:"FL-LINK-MISSING",message:"Two nodes on one line must be connected with an arrow.",hint:"Insert --> between nodes, e.g., A --> B."})}{let x=r.split(/\r?\n/),m=String.raw`[A-Za-z0-9_]+(?:\[[^\]]*\]|\([^\)]*\)|\{[^}]*\}|\[\[[^\]]*\]\]|\(\([^\)]*\)\))?`,g=new RegExp(String.raw`^\s*(${m})\s+(${m})\s*;?\s*$`),S=/^(?:\s*)(style|classDef|class|click|linkStyle|subgraph|end|graph|flowchart|direction)\b/;for(let E=0;E<x.length;E++){let y=x[E]||"",O=E+1;if(!y.trim()||S.test(y))continue;let L=g.exec(y);if(L){let b=y.indexOf(L[2]),C=b>=0?b+1:1;f.push({line:O,column:C,severity:"error",code:"FL-LINK-MISSING",message:"Two nodes on one line must be connected with an arrow.",hint:"Insert --> between nodes, e.g., A --> B."})}}}let d=(r.match(/\\\"/g)||[]).length,h=(r.match(/\"/g)||[]).length-d,p=(r.match(/'/g)||[]).length;return(h%2===1||p%2===1)&&f.push(...tn(r,{code:"FL-QUOTE-UNCLOSED",message:"Unclosed quote in node label.",hint:'Close the quote: A["Label"]',limitPerFile:1})),f}})}var gh=A({name:"PieKeyword",pattern:/pie/}),xh=A({name:"TitleKeyword",pattern:/title/}),Eh=A({name:"ShowDataKeyword",pattern:/showData/}),yh=A({name:"Colon",pattern:/:/}),$l=A({name:"NumberLiteral",pattern:/-?[0-9]+(\.[0-9]+)?/}),Bl=A({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),Sh=A({name:"Text",pattern:/[^:\n\r]+/}),QP=A({name:"Comment",pattern:/%%[^\n\r]*/,group:Y.SKIPPED}),YP=A({name:"WhiteSpace",pattern:/[ \t]+/,group:Y.SKIPPED}),Mi=A({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),Th=[QP,Bl,gh,xh,Eh,YP,yh,$l,Sh,Mi],XP=new Y(Th);function Fl(t){return XP.tokenize(t)}var Oh=class extends Ct{constructor(){super(Th),this.diagram=this.RULE("diagram",()=>{this.CONSUME(gh),this.OPTION(()=>this.CONSUME(Eh)),this.OPTION2(()=>this.CONSUME(Mi)),this.MANY(()=>this.SUBRULE(this.statement))}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.titleStmt)},{ALT:()=>this.SUBRULE(this.sliceStmt)},{ALT:()=>this.CONSUME(Mi)}])}),this.titleStmt=this.RULE("titleStmt",()=>{this.CONSUME(xh),this.AT_LEAST_ONE(()=>this.OR([{ALT:()=>this.CONSUME(Bl)},{ALT:()=>this.CONSUME(Sh)},{ALT:()=>this.CONSUME($l)}])),this.OPTION2(()=>this.CONSUME(Mi))}),this.sliceStmt=this.RULE("sliceStmt",()=>{this.SUBRULE(this.sliceLabel),this.CONSUME(yh),this.CONSUME($l),this.OPTION3(()=>this.CONSUME(Mi))}),this.sliceLabel=this.RULE("sliceLabel",()=>{this.CONSUME(Bl)}),this.performSelfAnalysis()}},cr=new Oh;function LE(t){return cr.input=t,{cst:cr.diagram(),errors:cr.errors}}var JP=cr.getBaseCstVisitorConstructorWithDefaults(),Lh=class extends JP{constructor(e){super(),this.validateVisitor(),this.ctx=e}diagram(e){e.statement&&e.statement.forEach(r=>this.visit(r))}statement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}};function AE(t,e){let r={errors:[]};return new Lh(r).visit(t),r.errors}function bE(t,e={}){return lr(t,{tokenize:Fl,parse:LE,analyze:(r,n)=>AE(r,n),mapParserError:(r,n)=>EE(r,n),postLex:(r,n)=>{let i=[];i.push(...tn(r,{code:"PI-QUOTE-UNCLOSED",message:"Unclosed quote in slice label.",hint:'Close the quote: "Dogs" : 10',limitPerFile:1}));let s=n,o=new Set;for(let c of s)typeof c.image=="string"&&c.image.includes('\\"')&&o.add(c.startLine??1);let a=Ri(s,{code:"PI-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted slice label are not supported. Use &quot; for inner quotes.",hint:'Example: "He said &quot;Hi&quot;" : 1',scopeEndTokenNames:["Colon"]}).filter(c=>!o.has(c.line));return i.push(...a),i}})}var z=A({name:"Identifier",pattern:/[A-Za-z_][A-Za-z0-9_]*/}),rn=A({name:"NumberLiteral",pattern:/[0-9]+/}),Ah=A({name:"SequenceKeyword",pattern:/sequenceDiagram/,longer_alt:z}),nn=A({name:"ParticipantKeyword",pattern:/participant/i,longer_alt:z}),sn=A({name:"ActorKeyword",pattern:/actor/i,longer_alt:z}),Kl=A({name:"AsKeyword",pattern:/as/i,longer_alt:z}),Gl=A({name:"AutonumberKeyword",pattern:/autonumber/i,longer_alt:z}),jl=A({name:"OffKeyword",pattern:/off/i,longer_alt:z}),Wl=A({name:"NoteKeyword",pattern:/note/i,longer_alt:z}),Hl=A({name:"LeftKeyword",pattern:/left/i,longer_alt:z}),zl=A({name:"RightKeyword",pattern:/right/i,longer_alt:z}),Ui=A({name:"OverKeyword",pattern:/over/i,longer_alt:z}),Vl=A({name:"OfKeyword",pattern:/of/i,longer_alt:z}),_i=A({name:"TitleKeyword",pattern:/title/i,longer_alt:z}),Pi=A({name:"AccTitleKeyword",pattern:/acc_title|accTitle/i,longer_alt:z}),qi=A({name:"AccDescrKeyword",pattern:/acc_descr|accDescr/i,longer_alt:z}),vn=A({name:"ActivateKeyword",pattern:/activate/i,longer_alt:z}),In=A({name:"DeactivateKeyword",pattern:/deactivate/i,longer_alt:z}),wn=A({name:"CreateKeyword",pattern:/create/i,longer_alt:z}),Ql=A({name:"DestroyKeyword",pattern:/destroy/i,longer_alt:z}),Ys=A({name:"AltKeyword",pattern:/alt/i,longer_alt:z}),Rn=A({name:"ElseKeyword",pattern:/else/i,longer_alt:z}),Yl=A({name:"OptionKeyword",pattern:/option/i,longer_alt:z}),Xl=A({name:"OptKeyword",pattern:/opt/i,longer_alt:z}),Zl=A({name:"LoopKeyword",pattern:/loop/i,longer_alt:z}),Di=A({name:"ParKeyword",pattern:/par/i,longer_alt:z}),Mn=A({name:"AndKeyword",pattern:/and/i,longer_alt:z}),Jl=A({name:"RectKeyword",pattern:/rect/i,longer_alt:z}),ec=A({name:"CriticalKeyword",pattern:/critical/i,longer_alt:z}),tc=A({name:"BoxKeyword",pattern:/box/i,longer_alt:z}),Vt=A({name:"EndKeyword",pattern:/end/i,longer_alt:z}),rc=A({name:"LinksKeyword",pattern:/links/i,longer_alt:z}),nc=A({name:"LinkKeyword",pattern:/link/i,longer_alt:z}),Xs=A({name:"PropertiesKeyword",pattern:/properties/i,longer_alt:z}),Zs=A({name:"DetailsKeyword",pattern:/details/i,longer_alt:z}),ic=A({name:"BreakKeyword",pattern:/break/i,longer_alt:z}),$i=A({name:"BidirAsyncDotted",pattern:/<<-->>/}),Bi=A({name:"BidirAsync",pattern:/<<->>/}),Fi=A({name:"DottedAsync",pattern:/-->>/}),Ki=A({name:"Async",pattern:/->>/}),Gi=A({name:"Dotted",pattern:/-->/}),ji=A({name:"Solid",pattern:/->/}),Js=A({name:"DottedCross",pattern:/--x/}),eo=A({name:"Cross",pattern:/-x/}),to=A({name:"DottedOpen",pattern:/--\)/}),ro=A({name:"Open",pattern:/-\)/}),Wi=A({name:"Plus",pattern:/\+/}),Hi=A({name:"Minus",pattern:/-/}),no=A({name:"Comma",pattern:/,/}),ur=A({name:"Colon",pattern:/:/}),bh=A({name:"LParen",pattern:/\(/}),Nh=A({name:"RParen",pattern:/\)/}),zi=A({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),eq=A({name:"Comment",pattern:/%%[^\n\r]*/,group:Y.SKIPPED}),tq=A({name:"WhiteSpace",pattern:/[ \t]+/,group:Y.SKIPPED}),X=A({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),Vi=A({name:"Text",pattern:/[^\n\r]+/}),kh=[eq,zi,tq,X,Ah,_i,Pi,qi,nn,sn,Kl,Gl,jl,Wl,Hl,zl,Ui,Vl,vn,In,wn,Ql,Ys,Rn,Yl,Xl,Zl,Di,Mn,Jl,ec,ic,tc,Vt,rc,nc,Xs,Zs,$i,Bi,Fi,Ki,Gi,ji,Js,eo,to,ro,no,ur,bh,Nh,Wi,Hi,rn,z,Vi],rq=new Y(kh);function sc(t){return rq.tokenize(t)}var vh=class extends Ct{constructor(){super(kh),this.diagram=this.RULE("diagram",()=>{this.CONSUME(Ah),this.MANY(()=>this.CONSUME(X)),this.MANY2(()=>{this.SUBRULE(this.line)}),this.OPTION(()=>this.CONSUME(re))}),this.line=this.RULE("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.metaStmt)},{ALT:()=>this.SUBRULE(this.participantDecl)},{ALT:()=>this.SUBRULE(this.autonumberStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.activateStmt)},{ALT:()=>this.SUBRULE(this.deactivateStmt)},{ALT:()=>this.SUBRULE(this.createStmt)},{ALT:()=>this.SUBRULE(this.destroyStmt)},{ALT:()=>this.SUBRULE(this.linkStmt)},{ALT:()=>this.SUBRULE(this.propertiesStmt)},{ALT:()=>this.SUBRULE(this.detailsStmt)},{ALT:()=>this.SUBRULE(this.altBlock)},{ALT:()=>this.SUBRULE(this.optBlock)},{ALT:()=>this.SUBRULE(this.loopBlock)},{ALT:()=>this.SUBRULE(this.parBlock)},{ALT:()=>this.SUBRULE(this.criticalBlock)},{ALT:()=>this.SUBRULE(this.breakBlock)},{ALT:()=>this.SUBRULE(this.rectBlock)},{ALT:()=>this.SUBRULE(this.boxBlock)},{ALT:()=>this.SUBRULE(this.messageStmt)},{ALT:()=>this.SUBRULE(this.blankLine)}])}),this.metaStmt=this.RULE("metaStmt",()=>{this.OR([{ALT:()=>this.CONSUME(_i)},{ALT:()=>this.CONSUME(Pi)},{ALT:()=>this.CONSUME(qi)}]),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.blankLine=this.RULE("blankLine",()=>{this.AT_LEAST_ONE(()=>this.CONSUME(X))}),this.actorRef=this.RULE("actorRef",()=>{this.AT_LEAST_ONE(()=>this.OR([{ALT:()=>this.CONSUME(z)},{ALT:()=>this.CONSUME(zi)},{ALT:()=>this.CONSUME(rn)},{ALT:()=>this.CONSUME(Vi)}]))}),this.participantDecl=this.RULE("participantDecl",()=>{this.OR([{ALT:()=>this.CONSUME(nn)},{ALT:()=>this.CONSUME(sn)}]),this.SUBRULE(this.actorRef),this.OPTION(()=>{this.CONSUME(Kl),this.SUBRULE2(this.actorRef)}),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.autonumberStmt=this.RULE("autonumberStmt",()=>{this.CONSUME(Gl),this.OPTION(()=>{this.OR([{ALT:()=>this.CONSUME(jl)},{ALT:()=>{this.CONSUME(rn),this.OPTION2(()=>this.CONSUME2(rn))}}])}),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.noteStmt=this.RULE("noteStmt",()=>{this.CONSUME(Wl),this.OR([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Hl)},{ALT:()=>this.CONSUME(zl)}]),this.CONSUME(Vl),this.SUBRULE(this.actorRef)}},{ALT:()=>{this.CONSUME(Ui),this.SUBRULE2(this.actorRef),this.OPTION(()=>{this.CONSUME(no),this.SUBRULE3(this.actorRef)})}}]),this.CONSUME(ur),this.OPTION2(()=>this.SUBRULE(this.lineRemainder)),this.OR3([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.activateStmt=this.RULE("activateStmt",()=>{this.CONSUME(vn),this.SUBRULE(this.actorRef),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.deactivateStmt=this.RULE("deactivateStmt",()=>{this.CONSUME(In),this.SUBRULE(this.actorRef),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.createStmt=this.RULE("createStmt",()=>{this.CONSUME(wn),this.OR([{ALT:()=>this.CONSUME(nn)},{ALT:()=>this.CONSUME(sn)}]),this.SUBRULE(this.actorRef),this.OPTION(()=>{this.CONSUME(Kl),this.OPTION2(()=>this.SUBRULE(this.lineRemainder))}),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.destroyStmt=this.RULE("destroyStmt",()=>{this.CONSUME(Ql),this.OPTION(()=>{this.OR([{ALT:()=>this.CONSUME(nn)},{ALT:()=>this.CONSUME(sn)}])}),this.SUBRULE(this.actorRef),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.linkStmt=this.RULE("linkStmt",()=>{this.OR([{ALT:()=>this.CONSUME(nc)},{ALT:()=>this.CONSUME(rc)}]),this.SUBRULE(this.actorRef),this.CONSUME(ur),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.propertiesStmt=this.RULE("propertiesStmt",()=>{this.CONSUME(Xs),this.OPTION(()=>this.CONSUME(ur)),this.OPTION1(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.detailsStmt=this.RULE("detailsStmt",()=>{this.CONSUME(Zs),this.OPTION(()=>this.CONSUME(ur)),this.OPTION1(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.messageStmt=this.RULE("messageStmt",()=>{this.SUBRULE(this.actorRef),this.SUBRULE(this.arrow),this.OPTION(()=>this.OR([{ALT:()=>this.CONSUME(Wi)},{ALT:()=>this.CONSUME(Hi)}])),this.SUBRULE2(this.actorRef),this.CONSUME(ur),this.OPTION2(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.arrow=this.RULE("arrow",()=>{this.OR([{ALT:()=>this.CONSUME($i)},{ALT:()=>this.CONSUME(Bi)},{ALT:()=>this.CONSUME(Fi)},{ALT:()=>this.CONSUME(Ki)},{ALT:()=>this.CONSUME(Gi)},{ALT:()=>this.CONSUME(ji)},{ALT:()=>this.CONSUME(Js)},{ALT:()=>this.CONSUME(eo)},{ALT:()=>this.CONSUME(to)},{ALT:()=>this.CONSUME(ro)}])}),this.altBlock=this.RULE("altBlock",()=>{this.CONSUME(Ys),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2(()=>{this.CONSUME(Rn),this.OPTION2(()=>this.SUBRULE2(this.lineRemainder)),this.AT_LEAST_ONE2(()=>this.CONSUME2(X)),this.MANY3(()=>this.SUBRULE2(this.line))}),this.CONSUME(Vt),this.OR3([{ALT:()=>this.AT_LEAST_ONE3(()=>this.CONSUME3(X))},{ALT:()=>this.CONSUME3(re)}])}),this.optBlock=this.RULE("optBlock",()=>{this.CONSUME(Xl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Vt),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.loopBlock=this.RULE("loopBlock",()=>{this.CONSUME(Zl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Vt),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.parBlock=this.RULE("parBlock",()=>{this.CONSUME(Di),this.OPTION(()=>this.SUBRULE(this.parHeader)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2(()=>{this.CONSUME(Mn),this.OPTION2(()=>this.SUBRULE2(this.lineRemainder)),this.AT_LEAST_ONE2(()=>this.CONSUME2(X)),this.MANY3(()=>this.SUBRULE2(this.line))}),this.CONSUME(Vt),this.OR3([{ALT:()=>this.AT_LEAST_ONE3(()=>this.CONSUME3(X))},{ALT:()=>this.CONSUME3(re)}])}),this.parHeader=this.RULE("parHeader",()=>{this.OR([{GATE:()=>this.LA(1).tokenType===Ui,ALT:()=>{this.CONSUME(Ui),this.SUBRULE(this.actorRef),this.OPTION(()=>{this.CONSUME(no),this.SUBRULE2(this.actorRef)}),this.OPTION1(()=>this.SUBRULE(this.lineRemainder))}},{ALT:()=>this.SUBRULE2(this.lineRemainder)}])}),this.criticalBlock=this.RULE("criticalBlock",()=>{this.CONSUME(ec),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2(()=>{this.CONSUME(Yl),this.OPTION2(()=>this.SUBRULE2(this.lineRemainder)),this.AT_LEAST_ONE2(()=>this.CONSUME2(X)),this.MANY3(()=>this.SUBRULE2(this.line))}),this.CONSUME(Vt),this.AT_LEAST_ONE3(()=>this.CONSUME3(X))}),this.breakBlock=this.RULE("breakBlock",()=>{this.CONSUME(ic),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Vt),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.rectBlock=this.RULE("rectBlock",()=>{this.CONSUME(Jl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Vt),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.boxBlock=this.RULE("boxBlock",()=>{this.CONSUME(tc),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.OR([{ALT:()=>this.SUBRULE(this.participantDecl)},{ALT:()=>this.SUBRULE(this.blankLine)}])),this.CONSUME(Vt),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.lineRemainder=this.RULE("lineRemainder",()=>{this.AT_LEAST_ONE(()=>this.OR([{ALT:()=>this.CONSUME(z)},{ALT:()=>this.CONSUME(rn)},{ALT:()=>this.CONSUME(zi)},{ALT:()=>this.CONSUME(Vi)},{ALT:()=>this.CONSUME(Wi)},{ALT:()=>this.CONSUME(Hi)},{ALT:()=>this.CONSUME(no)},{ALT:()=>this.CONSUME(ur)},{ALT:()=>this.CONSUME(bh)},{ALT:()=>this.CONSUME(Nh)},{ALT:()=>this.CONSUME(Mn)},{ALT:()=>this.CONSUME(Rn)},{ALT:()=>this.CONSUME(Xl)},{ALT:()=>this.CONSUME(Yl)},{ALT:()=>this.CONSUME(Zl)},{ALT:()=>this.CONSUME(Di)},{ALT:()=>this.CONSUME(Jl)},{ALT:()=>this.CONSUME(ec)},{ALT:()=>this.CONSUME(ic)},{ALT:()=>this.CONSUME(tc)},{ALT:()=>this.CONSUME(Vt)},{ALT:()=>this.CONSUME(_i)},{ALT:()=>this.CONSUME(Pi)},{ALT:()=>this.CONSUME(qi)},{ALT:()=>this.CONSUME(Wl)},{ALT:()=>this.CONSUME(Hl)},{ALT:()=>this.CONSUME(zl)},{ALT:()=>this.CONSUME(Ui)},{ALT:()=>this.CONSUME(Vl)},{ALT:()=>this.CONSUME(Gl)},{ALT:()=>this.CONSUME(jl)},{ALT:()=>this.CONSUME(nc)},{ALT:()=>this.CONSUME(rc)},{ALT:()=>this.CONSUME(wn)},{ALT:()=>this.CONSUME(Ql)},{ALT:()=>this.CONSUME(nn)},{ALT:()=>this.CONSUME(sn)},{ALT:()=>this.CONSUME(vn)},{ALT:()=>this.CONSUME(In)}]))}),this.performSelfAnalysis()}},on=new vh;function NE(t){return on.input=t,{cst:on.diagram(),errors:on.errors}}var nq=on.getBaseCstVisitorConstructorWithDefaults(),Ih=class extends nq{constructor(e){super(),this.ctx=e,this.validateVisitor()}};function kE(t,e){let r={tokens:e},n=new Ih(r),i=[],s=new Map;for(let l of e){let d=l.startLine??1,h=l.startColumn??1,p=s.get(d);(!p||(p.startColumn??1/0)>h)&&s.set(d,l)}for(let l of e)(l.tokenType===_i||l.tokenType===Pi||l.tokenType===qi)&&s.get(l.startLine??1)===l&&i.push({line:l.startLine??1,column:l.startColumn??1,severity:"error",code:"SE-META-UNSUPPORTED",message:"Title/accTitle/accDescr are not accepted by current Mermaid CLI for sequence diagrams.",hint:"Remove this line (e.g., 'title \u2026') to match mermaid-cli.",length:l.image?.length??5}),l.tokenType===Xs&&s.get(l.startLine??1)===l&&i.push({line:l.startLine??1,column:l.startColumn??1,severity:"error",code:"SE-PROPERTIES-UNSUPPORTED",message:"'properties' is not accepted by current Mermaid CLI for sequence diagrams.",hint:"Remove the 'properties:' line to match mermaid-cli.",length:l.image?.length??10}),l.tokenType===Zs&&s.get(l.startLine??1)===l&&i.push({line:l.startLine??1,column:l.startColumn??1,severity:"error",code:"SE-DETAILS-UNSUPPORTED",message:"'details' is not accepted by current Mermaid CLI for sequence diagrams.",hint:"Remove the 'details:' line to match mermaid-cli.",length:l.image?.length??7});let o=new Map;for(let l of e){if(l.tokenType===X)continue;let d=l.startLine??1;(o.get(d)||o.set(d,[]).get(d)).push(l)}let a=[],c=Array.from(o.entries()).sort((l,d)=>l[0]-d[0]),u=(l,d)=>{let h=[];for(let x=d;x<l.length;x++){let m=l[x];if(m.tokenType===ur||m.tokenType===X||((m.tokenType===z||m.tokenType===zi||m.tokenType===rn||m.tokenType===Vi)&&h.push(m.image),m.tokenType===Ki||m.tokenType===ji||m.tokenType===Gi||m.tokenType===Fi||m.tokenType===Bi||m.tokenType===$i))break}return h.join(" ").trim().replace(/^"|"$/g,"")};for(let[l,d]of c){if(d.some(p=>p.tokenType===vn)){let p=d.findIndex(m=>m.tokenType===vn),x=u(d,p+1);x&&a.push({kind:"activate",line:l,actor:x});continue}if(d.some(p=>p.tokenType===In)){let p=d.findIndex(m=>m.tokenType===In),x=u(d,p+1);x&&a.push({kind:"deactivate",line:l,actor:x});continue}if(d.some(p=>p.tokenType===wn)){let p=d.findIndex(S=>S.tokenType===wn),x=d.slice(p+1),m=x.findIndex(S=>S.tokenType===nn||S.tokenType===sn),g=m>=0?u(x,m+1):u(d,p+1);g&&a.push({kind:"create",line:l,actor:g});continue}let h=d.findIndex(p=>[Ki,Fi,ji,Gi,eo,Js,to,ro,Bi,$i].includes(p.tokenType));if(h>0){let p=u(d,0),x=u(d,h+1);if(p||x){let m=d.find(S=>S.tokenType===Wi),g=d.find(S=>S.tokenType===Hi);a.push({kind:"message",line:l,from:p,to:x,plus:!!m,minus:!!g,plusTok:m,minusTok:g})}}}let f=new Map;for(let l of a)if(l.kind==="activate"&&l.actor){let d=f.get(l.actor)||[];d.push({line:l.line}),f.set(l.actor,d)}else if(l.kind==="deactivate"&&l.actor){let d=f.get(l.actor)||[];d.pop(),f.set(l.actor,d)}else if(l.kind==="message"&&l.to){let d=l.to,h=!!l.plus,p=!!l.minus,x=l.plusTok,m=l.minusTok;if(h){let g=f.get(d)||[];if(g.length>0){let S=x?.startColumn??1;i.push({line:l.line,column:S,severity:"warning",code:"SE-ACTIVATION-ALREADY-ACTIVE",message:`Message indicates '+ (activate)' but '${d}' is already active.`,hint:`Remove '+' or deactivate first: deactivate ${d}`,length:1})}else g.push({line:l.line}),f.set(d,g)}if(p){let g=f.get(d)||[];if(g.length===0){let S=m?.startColumn??1;i.push({line:l.line,column:S,severity:"warning",code:"SE-DEACTIVATE-NO-ACTIVE",message:`Message indicates '- (deactivate)' but '${d}' is not active.`,hint:`Remove '-' or ensure 'activate ${d}' occurred before.`,length:1})}else g.pop(),f.set(d,g)}}for(let[l,d]of f.entries())if(d.length){let h=d[d.length-1];i.push({line:h.line,column:1,severity:"warning",code:"SE-ACTIVATION-UNBALANCED",message:`Unbalanced activation: '${l}' was activated but not deactivated.`,hint:`Add 'deactivate ${l}' after the active section.`,length:l.length})}for(let l=0;l<a.length;l++){let d=a[l];if(d.kind==="create"&&d.actor){let h=a[l+1];h&&h.kind==="message"&&(h.from===d.actor||h.to===d.actor)||i.push({line:d.line,column:1,severity:"warning",code:"SE-CREATE-NO-CREATING-MESSAGE",message:`Actor '${d.actor}' is created but the next line is not a message involving it.`,hint:`Add a creating message to or from '${d.actor}' immediately after the create line.`,length:d.actor.length})}}return i}function CE(t,e={}){return lr(t,{tokenize:sc,parse:NE,analyze:(r,n)=>kE(r,n),mapParserError:(r,n)=>yE(r,n),postLex:(r,n)=>{let i=n,o=Vs(i,{code:"SE-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in names or labels are not supported by Mermaid. Use &quot; instead.',hint:'Example: participant "Logger &quot;debug&quot;" as L'}).map(f=>({...f,severity:e.strict?"error":"warning"})),a=new Map;for(let f of i){let l=f.startLine??1;a.has(l)||a.set(l,[]),a.get(l).push(f)}let c=new Set(o.map(f=>f.line)),u=Ri(i,{code:"SE-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label are not supported. Use &quot; for inner quotes.",hint:'Example: participant "Logger &quot;debug&quot;" as L',scopeEndTokenNames:["Newline"]}).filter(f=>!c.has(f.line)).map(f=>({...f,severity:e.strict?"error":"warning"}));return o.push(...u),o},postParse:(r,n,i,s)=>{let o=[],a=n,c=a.some(h=>h.tokenType===Di),u=a.some(h=>h.tokenType===Mn),f=a.some(h=>h.tokenType===Ys),l=a.some(h=>h.tokenType===Rn);if(s.some(h=>h.severity==="error")){if(!s.some(x=>x.code==="SE-QUOTE-UNCLOSED")){let x=tn(r,{code:"SE-QUOTE-UNCLOSED",message:"Unclosed quote in participant/actor name.",hint:'Close the quote: participant "Bob"  or  participant Alice as "Alias"',limitPerFile:1});x.length&&o.push(...x.map(m=>({...m,severity:e.strict?"error":"warning"})))}let h=s.some(x=>x.code==="SE-AND-OUTSIDE-PAR"),p=s.some(x=>x.code==="SE-ELSE-OUTSIDE-ALT");if(u&&!c&&!h){let x=a.find(m=>m.tokenType===Mn);o.push({line:x.startLine??1,column:x.startColumn??1,severity:"warning",code:"SE-HINT-PAR-BLOCK-SUGGEST",message:"Found 'and' but no 'par' block in the file.",hint:"Start a parallel section with: par \u2026 and \u2026 end",length:x.image?.length??3})}if(l&&!f&&!p){let x=a.find(m=>m.tokenType===Rn);o.push({line:x.startLine??1,column:x.startColumn??1,severity:"warning",code:"SE-HINT-ALT-BLOCK-SUGGEST",message:"Found 'else' but no 'alt' block in the file.",hint:"Use: alt Condition \u2026 else \u2026 end",length:x.image?.length??4})}}return o}})}var ue=A({name:"Identifier",pattern:/[A-Za-z_][A-Za-z0-9_$]*/}),Qi=A({name:"NumberLiteral",pattern:/[0-9]+/}),wh=A({name:"ClassDiagramKeyword",pattern:/classDiagram/,longer_alt:ue}),Rh=A({name:"DirectionKw",pattern:/direction/,longer_alt:ue}),Mh=A({name:"Direction",pattern:/LR|RL|TB|BT|TD/,longer_alt:ue}),Uh=A({name:"TitleKw",pattern:/title/,longer_alt:ue}),io=A({name:"NamespaceKw",pattern:/namespace/,longer_alt:ue}),so=A({name:"ClassKw",pattern:/class/,longer_alt:ue}),oo=A({name:"InterfaceKw",pattern:/interface\b/,longer_alt:ue}),oc=A({name:"AsKw",pattern:/as/,longer_alt:ue}),_h=A({name:"NoteKw",pattern:/note/,longer_alt:ue}),Ph=A({name:"ForKw",pattern:/for/,longer_alt:ue}),qh=A({name:"RelCompToAgg",pattern:/\*--o/}),Dh=A({name:"RelAggToComp",pattern:/o--\*/}),$h=A({name:"RelCompBoth",pattern:/\*--\*/}),Bh=A({name:"RelAggBoth",pattern:/o--o/}),Fh=A({name:"LollipopLeft",pattern:/\(\)--/}),Kh=A({name:"LollipopRight",pattern:/--\(\)/}),ao=A({name:"RelExtends",pattern:/<\|--/}),lo=A({name:"RelComposition",pattern:/\*--/}),co=A({name:"RelAggregation",pattern:/o--/}),uo=A({name:"RelDependency",pattern:/\.\.>/}),ho=A({name:"RelRealization",pattern:/\.\.\|>/}),fo=A({name:"RelAssociation",pattern:/--/}),Gh=A({name:"RelDependencyLeft",pattern:/<\.\./}),jh=A({name:"RelRealizationLeft",pattern:/<\|\.\./}),Wh=A({name:"RelExtendsRight",pattern:/--\|>/}),Hh=A({name:"InvalidRelArrow",pattern:/->(?!>)/}),po=A({name:"LCurly",pattern:/\{/}),mo=A({name:"RCurly",pattern:/\}/}),ac=A({name:"LParen",pattern:/\(/}),zh=A({name:"RParen",pattern:/\)/}),Ir=A({name:"Colon",pattern:/:/}),lc=A({name:"Comma",pattern:/,/}),Vh=A({name:"Visibility",pattern:/[+\-#~]/}),an=A({name:"LTlt",pattern:/<</}),go=A({name:"GTgt",pattern:/>>/}),cc=A({name:"GenericAngle",pattern:/<[^\n\r>]+>/}),Je=A({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),Qh=A({name:"BacktickName",pattern:/`(?:\\.|[^`\\])*`/}),uc=A({name:"SquareOpen",pattern:/\[/}),hc=A({name:"SquareClose",pattern:/\]/}),iq=A({name:"Comment",pattern:/%%[^\n\r]*/,group:Y.SKIPPED}),sq=A({name:"WhiteSpace",pattern:/[ \t]+/,group:Y.SKIPPED}),et=A({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),Yh=[iq,Je,wh,Rh,Uh,io,oo,so,oc,_h,Ph,Mh,qh,Dh,$h,Bh,Fh,Kh,ho,uo,ao,Gh,jh,Wh,lo,co,fo,Hh,an,go,cc,po,mo,ac,zh,uc,hc,Ir,lc,Vh,Qi,Qh,ue,sq,et],oq=new Y(Yh);function fc(t){return oq.tokenize(t)}var Xh=class extends Ct{constructor(){super(Yh),this.diagram=this.RULE("diagram",()=>{this.CONSUME(wh),this.OPTION(()=>this.CONSUME(et)),this.MANY(()=>this.SUBRULE(this.statement))}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.titleStmt)},{ALT:()=>this.SUBRULE(this.directionStmt)},{ALT:()=>this.SUBRULE(this.namespaceStmt)},{ALT:()=>this.SUBRULE(this.classLine)},{ALT:()=>this.SUBRULE(this.interfaceLine)},{ALT:()=>this.SUBRULE(this.relationStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.memberAssignStmt)},{ALT:()=>this.CONSUME(et)}])}),this.directionStmt=this.RULE("directionStmt",()=>{this.CONSUME(Rh),this.CONSUME(Mh),this.OPTION(()=>this.CONSUME(et))}),this.titleStmt=this.RULE("titleStmt",()=>{this.CONSUME(Uh),this.OR([{ALT:()=>this.CONSUME(Je)},{ALT:()=>{this.AT_LEAST_ONE(()=>{this.OR2([{ALT:()=>this.CONSUME(ue)},{ALT:()=>this.CONSUME(Qi)}])})}}]),this.OPTION(()=>this.CONSUME(et))}),this.namespaceStmt=this.RULE("namespaceStmt",()=>{this.CONSUME(io),this.OR([{ALT:()=>this.CONSUME(Je)},{ALT:()=>this.CONSUME(ue)}]),this.CONSUME(po),this.MANY(()=>{this.OR2([{ALT:()=>this.CONSUME(et)},{ALT:()=>this.SUBRULE(this.classLine)},{ALT:()=>this.SUBRULE(this.interfaceLine)},{ALT:()=>this.SUBRULE(this.relationStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.memberAssignStmt)}])}),this.CONSUME(mo),this.OPTION(()=>this.CONSUME2(et))}),this.classLine=this.RULE("classLine",()=>{this.CONSUME(so),this.SUBRULE(this.classRef),this.OR([{ALT:()=>{this.CONSUME(po),this.MANY(()=>{this.OR2([{ALT:()=>this.CONSUME3(et)},{ALT:()=>this.SUBRULE(this.memberLineStmt)}])}),this.CONSUME(mo),this.OPTION(()=>this.CONSUME(et))}},{ALT:()=>{this.OPTION1(()=>{this.CONSUME(uc),this.CONSUME(Je),this.CONSUME(hc)}),this.OPTION2(()=>{this.CONSUME(an),this.CONSUME2(ue),this.CONSUME(go)}),this.OPTION3(()=>{this.CONSUME(oc),this.CONSUME3(ue)}),this.OPTION4(()=>this.CONSUME2(et))}}])}),this.interfaceLine=this.RULE("interfaceLine",()=>{this.CONSUME(oo),this.SUBRULE(this.classRef),this.OR([{ALT:()=>{this.CONSUME(po),this.MANY(()=>{this.OR2([{ALT:()=>this.CONSUME3(et)},{ALT:()=>this.SUBRULE(this.memberLineStmt)}])}),this.CONSUME(mo),this.OPTION(()=>this.CONSUME(et))}},{ALT:()=>{this.OPTION1(()=>{this.CONSUME(uc),this.CONSUME(Je),this.CONSUME(hc)}),this.OPTION2(()=>{this.CONSUME(an),this.CONSUME2(ue),this.CONSUME(go)}),this.OPTION3(()=>{this.CONSUME(oc),this.CONSUME3(ue)}),this.OPTION4(()=>this.CONSUME2(et))}}])}),this.memberAssignStmt=this.RULE("memberAssignStmt",()=>{this.SUBRULE(this.classRef),this.CONSUME(Ir),this.SUBRULE(this.memberLine),this.OPTION(()=>this.CONSUME(et))}),this.memberLineStmt=this.RULE("memberLineStmt",()=>{this.SUBRULE(this.memberLine)}),this.memberLine=this.RULE("memberLine",()=>{this.OR([{GATE:()=>this.LA(1).tokenType===an,ALT:()=>{this.CONSUME(an),this.CONSUME(ue),this.CONSUME(go)}},{ALT:()=>{this.OPTION(()=>this.CONSUME(Vh)),this.OPTION1({GATE:()=>this.LA(1).tokenType!==ac,DEF:()=>this.SUBRULE(this.memberName)}),this.OPTION2(()=>{this.CONSUME(ac),this.OPTION3(()=>this.SUBRULE(this.argList)),this.CONSUME(zh)}),this.OPTION4(()=>{this.CONSUME(Ir),this.SUBRULE(this.typeRef)})}}])}),this.memberName=this.RULE("memberName",()=>{this.OR([{ALT:()=>this.CONSUME(ue)},{ALT:()=>this.CONSUME(Je)}])}),this.param=this.RULE("param",()=>{this.OPTION(()=>{this.CONSUME(ue),this.CONSUME(Ir)}),this.SUBRULE(this.typeRef)}),this.argList=this.RULE("argList",()=>{this.SUBRULE(this.param),this.MANY(()=>{this.CONSUME(lc),this.SUBRULE2(this.param)})}),this.typeRef=this.RULE("typeRef",()=>{this.OR([{ALT:()=>this.CONSUME(ue)},{ALT:()=>this.CONSUME(Qi)},{ALT:()=>this.CONSUME(Je)}])}),this.noteStmt=this.RULE("noteStmt",()=>{this.CONSUME(_h),this.OPTION(()=>this.CONSUME(Ph)),this.SUBRULE(this.classRef),this.OPTION1(()=>this.CONSUME(Ir)),this.OR([{ALT:()=>this.CONSUME(Je)},{ALT:()=>this.CONSUME(ue)},{ALT:()=>this.CONSUME(Qi)}]),this.OPTION2(()=>this.CONSUME(et))}),this.relationOp=this.RULE("relationOp",()=>{this.OR([{ALT:()=>this.CONSUME(qh)},{ALT:()=>this.CONSUME(Dh)},{ALT:()=>this.CONSUME($h)},{ALT:()=>this.CONSUME(Bh)},{ALT:()=>this.CONSUME(Fh)},{ALT:()=>this.CONSUME(Kh)},{ALT:()=>this.CONSUME(ao)},{ALT:()=>this.CONSUME(Wh)},{ALT:()=>this.CONSUME(lo)},{ALT:()=>this.CONSUME(co)},{ALT:()=>this.CONSUME(ho)},{ALT:()=>this.CONSUME(uo)},{ALT:()=>this.CONSUME(jh)},{ALT:()=>this.CONSUME(Gh)},{ALT:()=>this.CONSUME(fo)}])}),this.classRef=this.RULE("classRef",()=>{this.OR([{ALT:()=>{this.CONSUME(ue),this.OPTION(()=>this.CONSUME(cc))}},{ALT:()=>this.CONSUME(Je)},{ALT:()=>this.CONSUME(Qh)}])}),this.labelText=this.RULE("labelText",()=>{this.OR([{ALT:()=>this.CONSUME(Je)},{ALT:()=>this.CONSUME(ue)},{ALT:()=>this.CONSUME(Qi)},{ALT:()=>this.CONSUME(cc)}])}),this.relationStmt=this.RULE("relationStmt",()=>{this.SUBRULE(this.classRef),this.OPTION1(()=>this.CONSUME(Je,{LABEL:"leftCard"})),this.SUBRULE(this.relationOp),this.OPTION2(()=>this.CONSUME2(Je,{LABEL:"rightCard"})),this.SUBRULE2(this.classRef),this.OPTION3(()=>{this.CONSUME(Ir),this.AT_LEAST_ONE_SEP({SEP:lc,DEF:()=>this.SUBRULE(this.labelText)})}),this.OPTION4(()=>this.CONSUME(et))}),this.performSelfAnalysis()}},Yi=new Xh;function IE(t){return Yi.input=t,{cst:Yi.diagram(),errors:Yi.errors}}function wE(t,e){return[]}function RE(t,e={}){return lr(t,{tokenize:fc,parse:IE,analyze:wE,mapParserError:SE,postLex:(r,n)=>{let i=[],s=n;for(let o=0;o<s.length-1;o++){let a=s[o],c=s[o+1];if(a.tokenType===so&&c.tokenType===Je&&i.push({line:c.startLine??1,column:c.startColumn??1,severity:"error",code:"CL-NAME-DOUBLE-QUOTED",message:"Double-quoted class name is not supported. Use backticks for names with spaces/punctuation, or use a label.",hint:'Example: class `Logger "core"` as L  or  class L["Logger "core""]',length:c.image?.length??1}),a.tokenType===io&&c.tokenType===Je&&i.push({line:c.startLine??1,column:c.startColumn??1,severity:"error",code:"CL-NAMESPACE-NAME-QUOTED",message:"Quoted namespace names are not supported by mermaid.js. Use an unquoted identifier.",hint:'Change: namespace "ProbeAgent Core" { ... } \u2192 namespace ProbeAgentCore { ... }',length:c.image?.length??1}),a.tokenType===oo){let u=o>0?s[o-1]:null;(!u||u.tokenType!==an)&&i.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"CL-INTERFACE-KEYWORD-UNSUPPORTED",message:'The "interface" keyword is not supported by mermaid.js. Use the <<interface>> annotation instead.',hint:'Auto-fix converts to "class". Then manually add: <<interface>> ClassName after the class definition',length:a.image?.length??9})}}for(let o of s)o.tokenType===Hh&&i.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",code:"CL-REL-INVALID",message:"Invalid relationship operator '->'. Use <|--, *--, o--, --, ..> or ..|>.",hint:"Example: Foo <|-- Bar",length:o.image?.length??2});for(let o=0;o<s.length;o++){let a=s[o];if(!(a.tokenType===ao||a.tokenType===lo||a.tokenType===co||a.tokenType===uo||a.tokenType===ho||a.tokenType===fo))continue;let u=a.startLine??-1,f=o+1,l=null,d=!1;for(;f<s.length;){let h=s[f];if((h.startLine??-1)!==u)break;if(h.tokenType===ue||h.tokenType===Je){d=!0;break}if(h.tokenType===Ir){l=h;break}f++}l&&!d&&i.push({line:u,column:l.startColumn??1,severity:"error",code:"CL-REL-MALFORMED",message:"Malformed relationship. Provide a target class before the label.",hint:"Use: A <|-- B : label",length:l.image?.length??1})}return i},postParse:(r,n,i,s)=>{let o=[],a=(l,d)=>(s||[]).some(h=>h.code===l&&h.line===d&&h.severity==="error"),c=r.split(/\r?\n/),u=[],f=[];for(let l=0;l<c.length;l++){let d=c[l]||"";/^\s*class\b.*\{\s*$/.test(d)&&u.push(l+1),/^\s*namespace\b.*\{\s*$/.test(d)&&f.push(l+1)}if(u.length>0&&!c.some(d=>/\}/.test(d))&&!a("CL-BLOCK-MISSING-RBRACE",Math.max(1,c.length))){let d=u[u.length-1];o.push({line:Math.max(1,c.length),column:1,severity:"error",code:"CL-BLOCK-MISSING-RBRACE",message:"Missing '}' to close class block.",hint:"Close the block: class Foo { ... }"})}if(f.length>0&&!c.some(d=>/\}/.test(d))&&!a("CL-NAMESPACE-MISSING-RBRACE",Math.max(1,c.length))){let d=f[f.length-1];o.push({line:Math.max(1,c.length),column:1,severity:"error",code:"CL-NAMESPACE-MISSING-RBRACE",message:"Missing '}' to close namespace block.",hint:'Close the block: namespace "Name" { ... }'})}return o}})}var Ae=A({name:"Identifier",pattern:/[A-Za-z_][A-Za-z0-9_]*/}),xo=A({name:"NumberLiteral",pattern:/[0-9]+/}),Zh=A({name:"StateDiagramV2",pattern:/stateDiagram-v2/}),Jh=A({name:"StateDiagram",pattern:/stateDiagram/,longer_alt:Ae}),dc=A({name:"StateKw",pattern:/state/,longer_alt:Ae}),ef=A({name:"AsKw",pattern:/as/,longer_alt:Ae}),tf=A({name:"DirectionKw",pattern:/direction/,longer_alt:Ae}),rf=A({name:"Direction",pattern:/LR|RL|TB|BT|TD/,longer_alt:Ae}),Eo=A({name:"NoteKw",pattern:/note/i,longer_alt:Ae}),nf=A({name:"LeftKw",pattern:/left/,longer_alt:Ae}),sf=A({name:"RightKw",pattern:/right/,longer_alt:Ae}),pc=A({name:"OfKw",pattern:/of/,longer_alt:Ae}),of=A({name:"OverKw",pattern:/over/,longer_alt:Ae}),mc=A({name:"AngleAngleOpen",pattern:/<</}),gc=A({name:"AngleAngleClose",pattern:/>>/}),af=A({name:"Dashes",pattern:/---+/}),lf=A({name:"StyleClassDefKw",pattern:/classDef/,longer_alt:Ae}),cf=A({name:"StyleClassKw",pattern:/class(?!Diagram)/,longer_alt:Ae}),uf=A({name:"Start",pattern:/\[\*\]/}),hf=A({name:"HistoryShallow",pattern:/\[H\]/}),ff=A({name:"HistoryDeep",pattern:/\[H\*\]/}),df=A({name:"Arrow",pattern:/-->/}),pf=A({name:"InvalidArrow",pattern:/->(?!>)/}),mf=A({name:"Hyphen",pattern:/-/}),gf=A({name:"LCurly",pattern:/\{/}),xf=A({name:"RCurly",pattern:/\}/}),yo=A({name:"Colon",pattern:/:/}),Ef=A({name:"Comma",pattern:/,/}),hr=A({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),aq=A({name:"Comment",pattern:/%%[^\n\r]*/,group:Y.SKIPPED}),lq=A({name:"WhiteSpace",pattern:/[ \t]+/,group:Y.SKIPPED}),At=A({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),Un=A({name:"LabelChunk",pattern:/[^\n\r<\-][^\n\r]*/}),yf=[aq,hr,Zh,Jh,dc,ef,tf,rf,Eo,nf,sf,pc,of,mc,gc,uf,ff,hf,df,pf,af,mf,lf,cf,gf,xf,yo,Ef,xo,Ae,lq,Un,At],cq=new Y(yf);function xc(t){return cq.tokenize(t)}var Sf=class extends Ct{constructor(){super(yf),this.diagram=this.RULE("diagram",()=>{this.OR([{ALT:()=>this.CONSUME(Zh)},{ALT:()=>this.CONSUME(Jh)}]),this.OPTION(()=>this.CONSUME(At)),this.MANY(()=>this.SUBRULE(this.statement))}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStmt)},{ALT:()=>this.SUBRULE(this.transitionStmt)},{ALT:()=>this.SUBRULE(this.stateBlock)},{ALT:()=>this.SUBRULE(this.stateDecl)},{ALT:()=>this.SUBRULE(this.stateDescriptionStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.styleStmt)},{ALT:()=>this.CONSUME(At)}])}),this.styleStmt=this.RULE("styleStmt",()=>{this.OR([{ALT:()=>{this.CONSUME(lf),this.OPTION1(()=>this.CONSUME1(Un))}},{ALT:()=>{this.CONSUME(cf),this.OPTION2(()=>this.CONSUME2(Un))}}]),this.OPTION3(()=>this.CONSUME(At))}),this.directionStmt=this.RULE("directionStmt",()=>{this.CONSUME(tf),this.CONSUME(rf),this.OPTION(()=>this.CONSUME(At))}),this.actorRef=this.RULE("actorRef",()=>{this.OR([{ALT:()=>this.CONSUME(uf)},{ALT:()=>this.CONSUME(ff)},{ALT:()=>this.CONSUME(hf)},{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Ae)},{ALT:()=>this.CONSUME(hr)}]),this.OPTION(()=>{this.CONSUME(mc),this.CONSUME2(Ae),this.CONSUME(gc)})}}])}),this.labelText=this.RULE("labelText",()=>{this.OR([{ALT:()=>this.CONSUME(hr)},{ALT:()=>this.CONSUME(Ae)},{ALT:()=>this.CONSUME(xo)},{ALT:()=>this.CONSUME(mf)},{ALT:()=>this.CONSUME(Un)}])}),this.transitionStmt=this.RULE("transitionStmt",()=>{this.SUBRULE(this.actorRef),this.CONSUME(df),this.SUBRULE2(this.actorRef),this.OPTION(()=>{this.CONSUME(yo),this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(hr)},{ALT:()=>this.CONSUME(Ae)},{ALT:()=>this.CONSUME(xo)},{ALT:()=>this.CONSUME(Un)}])})}),this.OPTION2(()=>this.CONSUME(At))}),this.stateDecl=this.RULE("stateDecl",()=>{this.CONSUME(dc),this.OR([{GATE:()=>this.LA(1).tokenType===hr,ALT:()=>{this.CONSUME(hr),this.CONSUME(ef),this.CONSUME(Ae)}},{ALT:()=>{this.CONSUME2(Ae),this.OPTION1(()=>{this.CONSUME(mc),this.CONSUME3(Ae),this.CONSUME(gc)})}}]),this.OPTION2(()=>this.CONSUME(At))}),this.stateBlock=this.RULE("stateBlock",()=>{this.CONSUME(dc),this.OR([{ALT:()=>this.CONSUME(Ae)},{ALT:()=>this.CONSUME(hr)}]),this.CONSUME(gf),this.MANY(()=>this.SUBRULE(this.innerStatement)),this.CONSUME(xf),this.OPTION(()=>this.CONSUME(At))}),this.innerStatement=this.RULE("innerStatement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStmt)},{ALT:()=>this.SUBRULE(this.transitionStmt)},{ALT:()=>this.SUBRULE(this.stateBlock)},{ALT:()=>this.SUBRULE(this.stateDecl)},{ALT:()=>this.CONSUME(af)},{ALT:()=>this.SUBRULE(this.stateDescriptionStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.styleStmt)},{ALT:()=>this.CONSUME(At)}])}),this.noteStmt=this.RULE("noteStmt",()=>{this.CONSUME(Eo),this.OR([{ALT:()=>{this.CONSUME(nf),this.CONSUME(pc),this.SUBRULE(this.actorRef)}},{ALT:()=>{this.CONSUME(sf),this.CONSUME2(pc),this.SUBRULE2(this.actorRef)}},{ALT:()=>{this.CONSUME(of),this.SUBRULE3(this.actorRef),this.OPTION1(()=>{this.CONSUME(Ef),this.SUBRULE4(this.actorRef)})}}]),this.CONSUME(yo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.labelText)),this.OPTION2(()=>this.CONSUME(At))}),this.stateDescriptionStmt=this.RULE("stateDescriptionStmt",()=>{this.OR1([{ALT:()=>this.CONSUME1(Ae)},{ALT:()=>this.CONSUME1(hr)}]),this.CONSUME(yo),this.AT_LEAST_ONE(()=>{this.OR2([{ALT:()=>this.CONSUME2(hr)},{ALT:()=>this.CONSUME2(Ae)},{ALT:()=>this.CONSUME1(xo)},{ALT:()=>this.CONSUME1(Un)}])}),this.OPTION(()=>this.CONSUME(At))}),this.performSelfAnalysis()}},Xi=new Sf;function UE(t){return Xi.input=t,{cst:Xi.diagram(),errors:Xi.errors}}function _E(t,e){return[]}function PE(t,e={}){return lr(t,{tokenize:xc,parse:UE,analyze:_E,mapParserError:TE,postLex:(r,n)=>{let i=[],s=n;for(let o=0;o<s.length;o++){let a=s[o];a.tokenType===pf&&i.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"ST-ARROW-INVALID",message:"Invalid arrow '->'. Use '-->' in state transitions.",hint:"Example: A --> B : event",length:a.image?.length??2})}for(let o=0;o<s.length;o++){let a=s[o];if(a.tokenType===Eo){let c=s[o-1];c&&c.tokenType!==At&&c.startLine===a.startLine&&i.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"ST-NOTE-GLUED",message:"'Note' must start on a new line (not glued to the previous statement).",hint:"Put 'Note \u2026' on its own line: Note right of Auth: \u2026",length:a.image?.length??4})}}return i},postParse:(r,n,i,s)=>{let o=[],a=(h,p)=>(s||[]).some(x=>x.code===h&&x.line===p&&x.severity==="error")||o.some(x=>x.code===h&&x.line===p),c=r.split(/\r?\n/),u=[];for(let h=0;h<c.length;h++){let p=c[h]||"",x=h+1;if(/^\s*state\b.*\{\s*$/.test(p)&&u.push(x),/^\s*Note\b/i.test(p)&&!/:/.test(p)){let m=p.length-p.trimStart().length;if(p.replace(/^\s*Note\s+(left|right)\s+of\s+[^:]+/i,"").replace(/^\s*Note\s+over\s+[^:]+/i,"")!==p){if(p.indexOf(":")===-1){let E=/(Note\s+(left|right)\s+of\s+[^:]+|Note\s+over\s+[^:]+)/i.exec(p),y=E?E.index+(E[0]?.length||0)+1:1;a("ST-NOTE-MALFORMED",x)||o.push({line:x,column:y,severity:"error",code:"ST-NOTE-MALFORMED",message:"Malformed note: missing colon before note text.",hint:"Example: Note right of A: message"})}}}}u.length>0&&!c.some(p=>/\}/.test(p))&&!a("ST-BLOCK-MISSING-RBRACE",Math.max(1,c.length))&&o.push({line:Math.max(1,c.length),column:1,severity:"error",code:"ST-BLOCK-MISSING-RBRACE",message:"Missing '}' to close a state block.",hint:"Close the block: state Foo { ... }"});let f=[],l=h=>f.push({start:h,content:[],seps:[]}),d=()=>f[f.length-1];for(let h=0;h<c.length;h++){let p=c[h]||"",x=h+1;if(/^\s*state\b.*\{\s*$/.test(p)){l(x);continue}if(/^\s*\}\s*$/.test(p)){let m=f.pop();if(m){let g=[...m.content.map(E=>({ln:E,kind:"content"})),...m.seps.map(E=>({ln:E,kind:"sep"}))].sort((E,y)=>E.ln-y.ln),S=g.map((E,y)=>({i:y,x:E})).filter(E=>E.x.kind==="sep").map(E=>E.i);for(let E of S){let y=g[E].ln,O=!1;for(let b=E-1;b>=0&&g[b].kind!=="sep";b--)if(g[b].kind==="content"){O=!0;break}let L=!1;for(let b=E+1;b<g.length&&g[b].kind!=="sep";b++)if(g[b].kind==="content"){L=!0;break}(!O||!L)&&o.push({line:y,column:1,severity:"error",code:"ST-CONCURRENCY-MISPLACED",message:"Concurrency separator '---' must be between regions, not at the start or end of a block.",hint:"Place '---' between two sets of state lines inside the same block."})}}continue}f.length>0&&(/^\s*---\s*$/.test(p)?(d().seps.push(x),a("ST-CONCURRENCY-UNSUPPORTED",x)||o.push({line:x,column:1,severity:"error",code:"ST-CONCURRENCY-UNSUPPORTED",message:"Concurrency separator '---' is not supported by Mermaid CLI in state diagrams.",hint:"Remove '---' or split logic into separate composite states."})):p.trim()!==""&&d().content.push(x))}return o}})}function qE(t){let e=t.split(/\r?\n/);for(let r of e){let n=r.trim();if(n&&!n.startsWith("%%"))return n}}function DE(t){let e=qE(t);return e?/^(flowchart|graph)\b/i.test(e)?"flowchart":/^pie\b/i.test(e)?"pie":/^sequenceDiagram\b/i.test(e)?"sequence":/^classDiagram\b/.test(e)?"class":/^stateDiagram(?:-v2)?\b/.test(e)?"state":"unknown":"unknown"}function uq(t){if(!t)return!1;let r=/^(\w[\w-]*)/.exec(t)?.[1]||"";return new Set(["classDiagram","stateDiagram","stateDiagram-v2","erDiagram","journey","userJourney","gantt","gitGraph","mindmap","timeline","quadrantChart","xychart","xychart-beta","xyChart","sankey","sankey-beta","requirementDiagram","C4Context","C4Container","C4Component","C4Deployment","C4Dynamic","block","block-beta","blockDiagram","treemap","treemap-beta"]).has(r)}function Ec(t,e={}){let r=DE(t);switch(r){case"flowchart":return{type:r,errors:OE(t,e)};case"pie":return{type:r,errors:bE(t,e)};case"sequence":return{type:r,errors:CE(t,e)};case"class":return{type:r,errors:RE(t,e)};case"state":return{type:r,errors:PE(t,e)};default:let n=qE(t);return uq(n)?{type:r,errors:[]}:{type:r,errors:[{line:1,column:1,message:'Diagram must start with "graph", "flowchart", "pie", "sequenceDiagram", "classDiagram" or "stateDiagram[-v2]"',severity:"error",code:"GEN-HEADER-INVALID",hint:"Start with: flowchart TD | pie | sequenceDiagram | classDiagram | stateDiagram-v2."}]}}}function BE(t){return t.split(/\r?\n/)}function $E(t,e){let r=BE(t),n=Math.max(0,Math.min(r.length-1,e.line-1)),i=r[n]??"",s=Math.max(1,e.column),o=0;for(let a=0;a<n;a++)o+=(r[a]?.length??0)+1;return o+=Math.min(i.length,s-1),o}function Tf(t,e){if(!e||e.length===0)return t;let r=e.map(i=>{let s=$E(t,i.start),o=i.end?$E(t,i.end):s;return{startOff:s,endOff:o,newText:i.newText}}).sort((i,s)=>s.startOff-i.startOff),n=t;for(let i of r)n=n.slice(0,i.startOff)+i.newText+n.slice(i.endOff);return n}function we(t,e,r,n){return{start:e,end:{line:e.line,column:e.column+Math.max(0,r)},newText:n}}function ge(t,e,r){return{start:e,newText:r}}function ne(t,e){let r=BE(t);return r[Math.max(0,Math.min(r.length-1,e-1))]??""}function fr(t){let e=/^(\s*)/.exec(t);return e&&e[1]||""}function Ye(t){return{line:t.line,column:t.column}}function F(t,e){return e.code===t}function Of(t,e,r="safe"){let n=[],i=new Set,s=new Set,o=new Set;function a(l,d){let h=[{open:"[[",close:"]]"},{open:"((",close:"))"},{open:"{{",close:"}}"},{open:"[(",close:")]"},{open:"([",close:"])"},{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"}],p=0,x=0;for(;p<l.length;){let m=null;for(let y of h){let O=l.indexOf(y.open,p);O!==-1&&(m===null||O<m.i)&&(m={...y,i:O})}if(!m)break;let g=m.i+m.open.length,S=l.indexOf(m.close,g);if(S===-1){p=g;continue}let E=-1;for(let y=g;y<S;y++)if(l[y]==='"'&&l[y-1]!=="\\"){E=y;break}if(E!==-1){let y=-1;for(let O=S-1;O>E;O--)if(l[O]==='"'&&l[O-1]!=="\\"){y=O;break}if(y!==-1){let O=l.slice(E+1,y),L=c(O);L!==O&&(n.push({start:{line:d,column:E+2},end:{line:d,column:y+1},newText:L}),x++)}}p=S+m.close.length}return x}function c(l){let d="\0__Q__",h=l.split("&quot;").join(d);return h=h.replace(/`/g,""),h=h.replace(/\\\"/g,"&quot;"),h=h.replace(/\"/g,"&quot;"),h=h.replace(/"/g,"&quot;"),h=h.split(d).join("&quot;"),h}for(let l of e){let d=`${l.code}@${l.line}:${l.column}:${l.length??1}`;if(!s.has(d)){if(s.add(d),(l.code==="FL-LABEL-ESCAPED-QUOTE"||l.code==="FL-LABEL-CURLY-IN-QUOTED"||l.code==="FL-LABEL-DOUBLE-IN-DOUBLE"||l.code==="FL-LABEL-BACKTICK")&&!i.has(l.line)){let h=ne(t,l.line),p=a(h,l.line);if(i.add(l.line),p>0)continue}if(F("FL-ARROW-INVALID",l)){n.push(we(t,Ye(l),l.length??2,"-->"));continue}if(F("FL-LINK-UNSUPPORTED-MARKER",l)){n.push(we(t,Ye(l),l.length??1,""));continue}if(F("FL-EDGE-LABEL-QUOTED",l)){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=h.indexOf('"',p);if(x!==-1){let m=h.indexOf('"',x+1);if(m!==-1){let g=h.slice(x+1,m),S=h.slice(0,x).trim(),E=h.slice(m+1).trim(),y="--",O="-->";S.endsWith("==")?(y="==",O="==>"):S.endsWith("-.-")?(y="-.-",O=".->"):S.endsWith("-.")&&(y="-.",O=".->");let b=h.slice(0,x).lastIndexOf(y);if(b===-1)continue;let C=h.slice(0,b),k=E;k.startsWith("-->")||k.startsWith("==>")||k.startsWith(".->")?k=k.slice(3).trim():k.startsWith("->")&&(k=k.slice(2).trim()),k&&!k.startsWith(" ")&&(k=" "+k);let R=`${C}${y}|${g}|${O}${k}`;n.push({start:{line:l.line,column:1},end:{line:l.line,column:h.length+1},newText:R})}}continue}if(F("CL-NAME-DOUBLE-QUOTED",l)){let h=ne(t,l.line),p=h.indexOf("class"),x=p>=0?p+5:0,m=h.indexOf('"',x);if(m!==-1){let g=h.indexOf(" as ",m+1),S=g!==-1?h.lastIndexOf('"',g-1):h.lastIndexOf('"');if(S>m)if(g!==-1){let y='"'+h.slice(m+1,S).replace(/\"/g,'"').replace(/"/g,"&quot;")+'"',O=h.slice(g+4).trim(),b=`${h.slice(0,x).trimEnd()} ${O}[${y}]`;n.push({start:{line:l.line,column:1},end:{line:l.line,column:h.length+1},newText:b})}else n.push(we(t,{line:l.line,column:m+1},1,"`")),n.push(we(t,{line:l.line,column:S+1},1,"`"))}continue}if(F("CL-NAMESPACE-NAME-QUOTED",l)){let h=ne(t,l.line),p=h.indexOf("namespace"),x=p>=0?p+9:0,m=h.indexOf('"',x);if(m!==-1){let g=h.indexOf('"',m+1);if(g>m){let E=h.slice(m+1,g).replace(/[^A-Za-z0-9_]/g,"");n.push(we(t,{line:l.line,column:m+1},g-m+1,E))}}continue}if(F("CL-INTERFACE-KEYWORD-UNSUPPORTED",l)){let p=ne(t,l.line).indexOf("interface");p!==-1&&n.push(we(t,{line:l.line,column:p+1},9,"class"));continue}if(F("FL-LABEL-ESCAPED-QUOTE",l)){if(i.has(l.line))continue;let h=ne(t,l.line),p=Math.max(0,l.column-1),m=[{tok:"[[",idx:h.lastIndexOf("[[",p),delta:2},{tok:"{",idx:h.lastIndexOf("{",p),delta:1},{tok:"[",idx:h.lastIndexOf("[",p),delta:1},{tok:"((",idx:h.lastIndexOf("((",p),delta:2}].filter(g=>g.idx!==-1).sort((g,S)=>g.idx-S.idx).pop();if(m){let g=[h.indexOf("]]",p),h.indexOf("}",p),h.indexOf("]",p),h.indexOf("))",p)].filter(E=>E!==-1).sort((E,y)=>E-y),S=g.length?g[0]:-1;if(S!==-1){let E=h.indexOf('"',m.idx+m.delta),y=h.lastIndexOf('"',S-1);if(E!==-1&&y!==-1&&y>E){let O=h.slice(E+1,y),L=c(O);if(L!==O){n.push({start:{line:l.line,column:E+2},end:{line:l.line,column:y+1},newText:L});continue}}}}n.push(we(t,Ye(l),l.length??2,"&quot;"));continue}if(F("FL-META-UNSUPPORTED",l)){if(r==="all"){let h=ne(t,l.line);n.push({start:{line:l.line,column:1},end:{line:l.line+1,column:1},newText:""})}continue}if(F("FL-LABEL-BACKTICK",l)&&l.severity==="warning"){n.push(we(t,Ye(l),l.length??1,""));continue}if(F("FL-LABEL-CURLY-IN-QUOTED",l)){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=-1,m=null;for(let g=p;g>=0;g--){let S=h[g],E=S?S.charCodeAt(0):-1;if((E===34||E===39)&&!(g>0&&h[g-1]==="\\")){x=g,m=S;break}}if(x!==-1&&m){let g=-1;for(let S=x+1;S<h.length;S++){let E=h[S];if((E?E.charCodeAt(0):-1)===(m?m.charCodeAt(0):-1)&&!(h[S-1]==="\\")){g=S;break}}if(g>x){let S=h.slice(x+1,g),E=c(S);if(E!==S){n.push({start:{line:l.line,column:x+2},end:{line:l.line,column:g+1},newText:E});continue}}}continue}if(F("FL-END-WITHOUT-SUBGRAPH",l)){r==="all"&&n.push({start:{line:l.line,column:1},end:{line:l.line+1,column:1},newText:""});continue}if(F("FL-LABEL-DOUBLE-IN-DOUBLE",l)){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=(h.match(/\"/g)||[]).length,m=(h.replace(/\\\"/g,"").match(/\"/g)||[]).length;if(x+m>8&&r!=="all")continue;let S=[{tok:"[[",idx:h.lastIndexOf("[[",p)},{tok:"((",idx:h.lastIndexOf("((",p)},{tok:"{",idx:h.lastIndexOf("{",p)},{tok:"(",idx:h.lastIndexOf("(",p)},{tok:"[",idx:h.lastIndexOf("[",p)}].sort((y,O)=>(y.idx||-1)-(O.idx||-1)).pop(),E=S&&S.idx>=0?S.idx:-1;if(E>=0){let O=[{tok:"]]",idx:h.indexOf("]]",p)},{tok:"))",idx:h.indexOf("))",p)},{tok:"}",idx:h.indexOf("}",p)},{tok:")",idx:h.indexOf(")",p)},{tok:"]",idx:h.indexOf("]",p)}].filter(k=>k.idx!==-1).sort((k,R)=>k.idx-R.idx)[0],L=O?O.idx:h.length,b=h.indexOf('"',E+1),C=h.lastIndexOf('"',L-1);if(b!==-1&&C!==-1&&C>b){let k=h.slice(b+1,C),R=c(k);if(R!==k){let N={line:l.line,column:b+2},I={line:l.line,column:C+1};n.push({start:N,end:I,newText:R});continue}}}n.push(we(t,Ye(l),l.length??1,"&quot;"));continue}if(F("FL-LABEL-DOUBLE-IN-SINGLE",l)){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=h.lastIndexOf("'",p),m=h.indexOf("'",Math.max(p+1,x+1));if(x!==-1&&m!==-1&&m>x){let g=h.slice(x+1,m),S=g.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");if(S!==g){let E={line:l.line,column:x+2},y={line:l.line,column:m+1};n.push({start:E,end:y,newText:S}),i.add(l.line);continue}}if(i.has(l.line))continue;n.push(we(t,Ye(l),l.length??1,"&quot;"));continue}if(F("FL-NODE-MIXED-BRACKETS",l)){let h=l.message||"",p=ne(t,l.line),x=Math.max(0,l.column-1);{let g=p.indexOf("([");if(g!==-1){let S=p.indexOf("})",g+2);if(S!==-1){n.push({start:{line:l.line,column:S+1},end:{line:l.line,column:S+2},newText:"]"}),i.add(l.line);continue}}}{let g=p.indexOf("[(");if(g!==-1){let S=p.indexOf("))",g+2);if(S!==-1){n.push({start:{line:l.line,column:S+2},end:{line:l.line,column:S+3},newText:"]"}),i.add(l.line);continue}}}{let g=p.indexOf("([");if(g!==-1){let S=p.indexOf("})",g+2);if(S!==-1){n.push({start:{line:l.line,column:S+1},end:{line:l.line,column:S+2},newText:"]"});continue}}}if(/\(\[/.test(p)&&p.indexOf("})",Math.max(0,x-1))!==-1){n.push(we(t,Ye(l),l.length??1,"]"));continue}if(h.includes("opened '('")&&h.includes("closed with ']'")){let g=p.lastIndexOf("(",x);if(g!==-1){n.push({start:{line:l.line,column:g+1},end:{line:l.line,column:g+2},newText:"["});continue}}let m=")";h.includes("opened '['")?m="]":h.includes("opened '('")?m=")":h.includes("opened '{'")?m="}":h.includes("opened '[[ '")?m="]]":h.includes("opened '(( '")&&(m="))"),n.push(we(t,Ye(l),l.length??1,m));continue}if(F("FL-NODE-EMPTY",l)){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=h[p]==="["?p:h.lastIndexOf("[",p);if(x>=0){let m=h.indexOf("]",Math.max(x+1,p));if(m!==-1){let g={line:l.line,column:x+1},S=m-x+1;n.push(we(t,g,S,""))}}continue}if(F("FL-DIR-KW-INVALID",l)){n.push(we(t,Ye(l),l.length??0,"direction"));continue}if(F("FL-DIR-MISSING",l)){(r==="safe"||r==="all")&&n.push(ge(t,Ye(l)," TD"));continue}if(F("FL-LINK-MISSING",l)){if(r==="all"){let h=l.line,p=ne(t,h);if(!/-->/.test(p)){let x="(?:\\[[^\\]]*\\]|\\([^\\)]*\\)|\\{[^}]*\\}|\\[\\[[^\\]]*\\]\\]|\\(\\([^\\)]*\\)\\))?",m="[A-Za-z0-9_]+",S=new RegExp(`^\\s*(${m}${x})\\s+(${m})`).exec(p);if(S){let O=S[0].length-S[2].length+1;n.push(ge(t,{line:h,column:O}," --> "))}else n.push(ge(t,Ye(l)," --> "))}}continue}if(F("FL-NODE-UNCLOSED-BRACKET",l)){if(r==="safe"||r==="all"){let h=ne(t,l.line),p=Math.max(0,l.column-1),m=(l.message||"").match(/Unclosed '(.+?)'/),g=m?(m[1]||"").trim():null;if(g==="(("){if(r==="all"){let L=h.lastIndexOf("((",p);if(L!==-1){let b=L+2,C=[],k=w=>{w>=0&&C.push(w)};k(h.indexOf("-",b)),k(h.indexOf("=",b)),k(h.indexOf(".",b)),k(h.indexOf("|",b));let R=C.length?Math.min(...C):h.length,I=h.slice(0,L).match(/([A-Za-z0-9_]+)\s*$/),v=I?I[1]:"";if(v){n.push({start:{line:l.line,column:b+1},end:{line:l.line,column:R+1},newText:v+"))"}),i.add(l.line);continue}i.add(l.line);continue}}continue}let E=g?{"[":"]","{":"}","(":")","[[":"]]","{{":"}}","((":"))","([":"])","[(":")]"}[g]:null,y=null;if(g&&E){let L=h.lastIndexOf(g,p);L!==-1&&(y={open:g,close:E,idx:L,len:g.length})}if(!y&&(y=[{open:"{{",close:"}}",idx:h.lastIndexOf("{{",p),len:2},{open:"[[",close:"]]",idx:h.lastIndexOf("[[",p),len:2},{open:"([",close:"])",idx:h.lastIndexOf("([",p),len:2},{open:"[(",close:")]",idx:h.lastIndexOf("[(",p),len:2},{open:"{",close:"}",idx:h.lastIndexOf("{",p),len:1},{open:"(",close:")",idx:h.lastIndexOf("(",p),len:1},{open:"[",close:"]",idx:h.lastIndexOf("[",p),len:1}].filter(b=>b.idx!==-1).sort((b,C)=>b.idx-C.idx).pop()||null,y)){if(y.open==="{"){let b=h.lastIndexOf("{{",p);b!==-1&&b+1===y.idx&&(y={open:"{{",close:"}}",idx:b,len:2})}else if(y.open==="["){let b=h.lastIndexOf("[[",p),C=h.lastIndexOf("[(",p);b!==-1&&b===y.idx?y={open:"[[",close:"]]",idx:b,len:2}:C!==-1&&C===y.idx&&(y={open:"[(",close:")]",idx:C,len:2})}else if(y.open==="("){let b=h.lastIndexOf("((",p),C=h.lastIndexOf("([",p),k=h.lastIndexOf("[(",p);b!==-1&&b===y.idx?y={open:"((",close:"))",idx:b,len:2}:C!==-1&&C===y.idx-1?y={open:"([",close:"])",idx:C,len:2}:k!==-1&&k===y.idx-1&&(y={open:"[(",close:")]",idx:k,len:2})}}if(y){let L=h.indexOf(y.close,p);if(L!==-1){let b=h.slice(y.idx+y.len,L);if(process.env.DEBUG_FIXES&&(console.log("DEBUG FL-NODE-UNCLOSED-BRACKET:"),console.log("  opened.idx:",y.idx,"opened.len:",y.len,"opened.open:",y.open,"opened.close:",y.close),console.log("  closerIdx:",L),console.log("  innerSeg:",b),console.log("  caret0:",p,"lineText[caret0]:",h[p])),b.includes('"')||b.includes("'")){let C=b.match(/^\s*/)?.[0]??"",k=b.match(/\s*$/)?.[0]??"",R=b.slice(C.length,b.length-k.length),N=R.slice(0,1),I=R.slice(-1),v=(M,_)=>M==="/"&&_==="/"||M==="\\"&&_==="\\"||M==="/"&&_==="\\"||M==="\\"&&_==="/",w;if(R.length>=2&&v(N,I)){let _=R.slice(1,-1).split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");w=C+N+_+I+k}else w='"'+b.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;")+'"';n.push({start:{line:l.line,column:y.idx+y.len+1},end:{line:l.line,column:L+1},newText:w}),i.add(l.line);continue}if(b.includes("(")||b.includes(")")){let C=b.replace(/\(/g,"&#40;").replace(/\)/g,"&#41;");if(C!==b){n.push({start:{line:l.line,column:y.idx+y.len+1},end:{line:l.line,column:L+1},newText:C}),i.add(l.line);continue}}}}if(i.has(l.line))continue;let O="]";if(y&&(O=y.close),O==="]"){let L=h.lastIndexOf("[",p);if(L!==-1){let b=[],C=v=>{v>=0&&b.push(v)};C(h.indexOf("-",L+1)),C(h.indexOf("=",L+1)),C(h.indexOf(".",L+1)),C(h.indexOf("|",L+1));let k=b.length?Math.min(...b):h.length,R=k-1;for(;R>=0&&/\s/.test(h[R]);)R--;let N=R+1+1,I=k+1;n.push({start:{line:l.line,column:N},end:{line:l.line,column:I},newText:O})}else{let b=h.slice(p),C=Math.min(O.length,Math.max(1,b.length));n.push({start:{line:l.line,column:p+1},end:{line:l.line,column:p+1+C},newText:O})}}else{let L=h.slice(p),b=Math.min(O.length,Math.max(1,L.length));n.push({start:{line:l.line,column:p+1},end:{line:l.line,column:p+1+b},newText:O})}}continue}if(F("FL-QUOTE-UNCLOSED",l)){if(i.has(l.line))continue;if(r==="all"){let h=ne(t,l.line),p=Math.max(0,l.column-1);if((h.replace(/\\\"/g,"").match(/\"/g)||[]).length%2===1){let g=[],S=E=>{E>=0&&g.push({idx:E})};if(S(h.indexOf("]]",p)),S(h.indexOf("))",p)),S(h.indexOf("}",p)),S(h.indexOf("]",p)),S(h.indexOf(")",p)),g.length){let E=g.reduce((O,L)=>O.idx!==-1&&O.idx<=L.idx?O:L),y=(E.idx>=0?E.idx:h.length)+1;n.push(ge(t,{line:l.line,column:y},'"'))}}}continue}if(F("FL-SUBGRAPH-UNQUOTED-TITLE",l)){if(r==="safe"||r==="all"){let h=ne(t,l.line),p=h.indexOf("subgraph");if(p!==-1){let x=h.slice(0,p+8),m=h.slice(p+8),g=m.trim(),S=m.match(/^(\s*)/)?.[1]||"",E=`"${g}"`,y=x+S+E;n.push({start:{line:l.line,column:1},end:{line:l.line,column:h.length+1},newText:y})}}continue}if(F("FL-LABEL-QUOTE-IN-UNQUOTED",l)){if(r==="safe"||r==="all"){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=(h.replace(/\\\"/g,"").match(/\"/g)||[]).length;if(h.length>600||x>8)continue;let g=[{open:"[[",close:"]]",idx:h.lastIndexOf("[[",p),delta:2},{open:"((",close:"))",idx:h.lastIndexOf("((",p),delta:2},{open:"{",close:"}",idx:h.lastIndexOf("{",p),delta:1},{open:"[",close:"]",idx:h.lastIndexOf("[",p),delta:1}].filter(S=>S.idx!==-1).sort((S,E)=>S.idx-E.idx).pop();if(g){let S=g.idx+g.delta,E=h.indexOf(g.close,Math.max(p,S));if(E!==-1){let y=h.slice(S,E),O=y.match(/^\s*/)?.[0]??"",L=y.match(/\s*$/)?.[0]??"",b=y.slice(O.length,y.length-L.length),C=b.slice(0,1),k=b.slice(-1),R=(I,v)=>I==="/"&&v==="/"||I==="\\"&&v==="\\"||I==="/"&&v==="\\"||I==="\\"&&v==="/",N;if(b.length>=2&&R(C,k)){let v=b.slice(1,-1).split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");N=O+C+v+k+L}else N=y.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");n.push({start:{line:l.line,column:S+1},end:{line:l.line,column:E+1},newText:N}),i.add(l.line)}}}continue}if(F("FL-LABEL-PARENS-UNQUOTED",l)){if(r==="safe"||r==="all"){if(i.has(l.line))continue;let h=ne(t,l.line),p=Math.max(0,l.column-1),x=[{open:"{{",close:"}}"},{open:"[[",close:"]]"},{open:"((",close:"))"},{open:"([",close:"])"},{open:"[(",close:")]"},{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"}],m=(g,S,E,y)=>{let O=S+E.length,L=1;for(;O<g.length&&L>0;)if(g.slice(O,O+E.length)===E)L++,O+=E.length;else if(g.slice(O,O+y.length)===y){if(L--,L===0)return O;O+=y.length}else O++;return-1};for(let g of x){let S=0;for(;;){let E=h.indexOf(g.open,S);if(E===-1)break;let y=E+g.open.length,O=g.open==="("&&g.close===")"?m(h,E,g.open,g.close):h.indexOf(g.close,y);if(O===-1)break;if(E<=p&&p<O){let L=h.slice(y,O),b=L.trim();if(b.startsWith('"')&&b.endsWith('"')||g.open==="("&&(p===E||p===O-1))break;let C=L.match(/^\s*/)?.[0]??"",k=L.match(/\s*$/)?.[0]??"",R=L.slice(C.length,L.length-k.length),N=R.slice(0,1),I=R.slice(-1),v=(_,$)=>_==="/"&&$==="/"||_==="\\"&&$==="\\"||_==="/"&&$==="\\"||_==="\\"&&$==="/",w=R.length>=2&&v(N,I),M=L.replace(/\(/g,"&#40;").replace(/\)/g,"&#41;");w&&(M=M.replace(/"/g,"&quot;")),M!==L&&(n.push({start:{line:l.line,column:y+1},end:{line:l.line,column:O+1},newText:M}),i.add(l.line));break}S=E+1}if(i.has(l.line))break}}continue}if(F("PI-LABEL-ESCAPED-QUOTE",l)){n.push(we(t,Ye(l),l.length??1,"&quot;"));continue}if(F("PI-MISSING-COLON",l)){n.push(ge(t,Ye(l)," : "));continue}if(F("PI-LABEL-DOUBLE-IN-DOUBLE",l)){let h=ne(t,l.line),p=h.indexOf('"'),x=h.indexOf(":"),m=x!==-1?h.lastIndexOf('"',x-1):h.lastIndexOf('"');if(p!==-1&&m!==-1&&m>p){let g=h.slice(p+1,m),S=g.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");S!==g&&n.push({start:{line:l.line,column:p+2},end:{line:l.line,column:m+1},newText:S})}continue}if(F("PI-LABEL-REQUIRES-QUOTES",l)){let h=ne(t,l.line),p=h.indexOf(":");if(p>0){let x=h.slice(0,p),m=x.search(/\S/),g=x.replace(/\s+$/,"").length;m>=0&&g>m&&(n.push(ge(t,{line:l.line,column:m+1},'"')),n.push(ge(t,{line:l.line,column:g+1},'"')))}continue}if(F("PI-QUOTE-UNCLOSED",l)){if(r==="all"){if(o.has(l.line))continue;let h=ne(t,l.line),p=h.indexOf(":"),x=p>0?p+1:h.length+1;n.push(ge(t,{line:l.line,column:x},'"')),o.add(l.line)}continue}if(F("SE-MSG-COLON-MISSING",l)){let h=ne(t,l.line),p=["<<-->>","<<->>","-->>","->>","-->","->","--x","-x","--)","-)"],x=-1,m=0;for(let g of p){let S=h.indexOf(g);S!==-1&&(x===-1||S<x)&&(x=S,m=g.length)}if(x!==-1){let g=x+m;for((h[g]==="+"||h[g]==="-")&&g++;g<h.length&&/\s/.test(h[g]);)g++;let S=g;if(h[g]==='"'||h[g]==="'"){let O=h[g];for(S=g+1;S<h.length;){if(h[S]==="\\"){S+=2;continue}if(h[S]===O){S++;break}S++}}else for(;S<h.length&&!/\s/.test(h[S])&&h[S]!==":";)S++;let E=S+1;(h[S]||"")===" "?n.push(we(t,{line:l.line,column:E},1," : ")):n.push(ge(t,{line:l.line,column:E}," : "))}else n.push(ge(t,Ye(l),": "));continue}if(F("SE-NOTE-MALFORMED",l)){let h=ne(t,l.line),p=/^(\s*)Note\s+(left|right)\s+of\s+(.+?)\s+(.+)$/.exec(h),x=/^(\s*)Note\s+over\s+(.+?)\s+(.+)$/.exec(h),m=/^(\s*)Note\s+(left|right)\s+of\s+([^:]+?)\s*$/.exec(h),g=/^(\s*)Note\s+over\s+([^:]+?)\s*$/.exec(h),S=l.column;if(p)S=`${p[1]||""}Note ${p[2]} of ${p[3]}`.length+1;else if(x)S=`${x[1]||""}Note over ${x[2]}`.length+1;else if(m||g){let O=t.split(/\r?\n/),L=Math.max(0,l.line-1),b=-1;for(let v=L+1;v<O.length;v++)if(/^\s*end\s+note\s*$/i.test(O[v]||"")){b=v;break}let C=(m?m[1]:g[1])||"",k=m?`${C}Note ${m[2]} of ${m[3].trimEnd()}`:`${C}Note over ${g[2].trimEnd()}`,R=b!==-1?O.slice(L+1,b).map(v=>v.trim()).join(" "):"",N=`${k} : ${R}`.replace(/\s+$/,""),I=ne(t,l.line);n.push({start:{line:l.line,column:1},end:{line:l.line,column:I.length+1},newText:N}),b!==-1&&n.push({start:{line:L+2,column:1},end:{line:b+2,column:1},newText:""});continue}let E=Math.max(0,S-1);(h[E]||"")===" "?n.push(we(t,{line:l.line,column:S},1," : ")):n.push(ge(t,{line:l.line,column:S}," : "));continue}if(F("SE-ELSE-IN-CRITICAL",l)){n.push(we(t,Ye(l),l.length??4,"option"));continue}if(F("SE-BOX-EMPTY",l)){if(r==="all"){let h=t.split(/\r?\n/),p=Math.max(0,l.line-1),x=h[p]||"",m=(x.match(/^(\s*)/)?.[1]||"").length,g=-1;for(let E=p+1;E<h.length;E++){let y=h[E]||"",O=(y.match(/^(\s*)/)?.[1]||"").length;if(/^\s*end\s*$/.test(y)&&O<=m){g=E;break}}let S=!1;if(g!==-1&&(S=h.slice(p+1,g).map(y=>(y||"").trim()).some(y=>/->/.test(y)&&/[+-]/.test(y))),!S&&/^\s*box\s+(.+)$/.exec(x)){let O=`${x.match(/^\s*/)?.[0]||""}rect rgb(240, 240, 255)`;n.push({start:{line:l.line,column:1},end:{line:l.line,column:x.length+1},newText:O})}}continue}if(F("SE-BOX-INVALID-CONTENT",l)){let h=t.split(/\r?\n/),p=Math.max(0,l.line-1),x=/^(\s*)box\b/,m=-1,g="";for(let S=p;S>=0;S--){let E=x.exec(h[S]||"");if(E){m=S,g=E[1]||"";break}}if(m!==-1){let S=-1;for(let E=m+1;E<h.length;E++)if((h[E]||"").trim()==="end"){S=E;break}if(S!==-1){let E=[];for(let y=m+1;y<S;y++){let O=h[y]||"";O.trim()!==""&&(/^\s*(participant|actor)\b/i.test(O)||E.push(y))}if(E.length>0){let y=g,O=E.map(L=>{let C=(h[L]||"").trimStart();return y+C}).join(`
`)+`
`;for(let L=E.length-1;L>=0;L--){let b=E[L];n.push({start:{line:b+1,column:1},end:{line:b+2,column:1},newText:""})}n.push(ge(t,{line:S+2,column:1},O))}}}continue}if(F("SE-BLOCK-MISSING-END",l)){let h=t.split(/\r?\n/),p=Math.max(0,l.line-1),x=/^(\s*)(alt\b|opt\b|loop\b|par\b|rect\b|critical\b|break\b|box\b)/,m=-1,g="";for(let y=p;y>=0;y--){let O=x.exec(h[y]||"");if(O){m=y,g=O[1]||"";break}}if(m===-1){let y=fr(h[p]||"");n.push(ge(t,{line:p+1,column:1},`${y}end
`));continue}let S=h.length;for(let y=m+1;y<h.length;y++){let O=h[y]||"";if(O.trim()==="")continue;if(fr(O).length<=g.length){S=y;break}}let E=S;n.push(ge(t,{line:E+1,column:1},`${g}end
`));continue}if(F("SE-AUTONUMBER-EXTRANEOUS",l)){let h=ne(t,l.line),p=h.length,x=fr(h),m=l.column,E=h.slice(0,Math.max(0,m-1)).replace(/\s+$/,"").length+1,y=h.slice(Math.max(0,m-1)).replace(/^\s+/,"");n.push({start:{line:l.line,column:E},end:{line:l.line,column:p+1},newText:`
${x}${y}`});continue}if(F("SE-AUTONUMBER-MALFORMED",l)||F("SE-AUTONUMBER-NON-NUMERIC",l)){if(r==="all"){let h=ne(t,l.line),p=h.indexOf("autonumber");p>=0&&n.push({start:{line:l.line,column:p+1},end:{line:l.line,column:h.length+1},newText:"autonumber"})}continue}if(F("SE-LABEL-ESCAPED-QUOTE",l)){n.push(we(t,Ye(l),l.length??1,"&quot;"));continue}if(F("SE-LABEL-DOUBLE-IN-DOUBLE",l)){let h=ne(t,l.line),p=h.trimStart();if(/^(participant|actor)\b/.test(p)){let x=h.indexOf("participant"),m=x===-1?h.indexOf("actor"):x,g=m>=0?m:0,S=h.indexOf('"',g);if(S!==-1){let E=h.indexOf(" as ",S+1),y=E!==-1?h.lastIndexOf('"',E-1):h.lastIndexOf('"');if(y>S){let O=h.slice(S+1,y),L=O.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");if(L!==O){let b={line:l.line,column:S+2},C={line:l.line,column:y+1};n.push({start:b,end:C,newText:L})}}}}continue}if(F("SE-QUOTE-UNCLOSED",l)){if(r==="all"){let p=ne(t,l.line).length+1;n.push(ge(t,{line:l.line,column:p},'"'))}continue}if(F("ST-ARROW-INVALID",l)){n.push(we(t,Ye(l),l.length??2,"-->"));continue}if(F("ST-NOTE-MALFORMED",l)){let h=t.split(/\r?\n/),p=ne(t,l.line),x=/^(\s*)Note\s+(left|right)\s+of\s+([^:]+?)\s+(.+)$/.exec(p),m=/^(\s*)Note\s+over\s+([^:]+?)\s+(.+)$/.exec(p),g="",S="right",E="",y="";if(x?(g=x[1]||"",S=(x[2]||"right").toLowerCase(),E=(x[3]||"").trim(),y=(x[4]||"").trim()):m&&(g=m[1]||"",S="right",E=(m[2]||"").split(",").map(L=>L.trim()).filter(Boolean)[0]||"",y=(m[3]||"").trim()),E){let O=`${g}Note ${S} of ${E} : ${y}`,L=h.slice(0,Math.max(0,l.line-1)).join(`
`);if(new RegExp(`(^|
|\b)${E}(\b)`).test(L))n.push({start:{line:l.line,column:1},end:{line:l.line,column:p.length+1},newText:O});else{let C=h.length+1;for(let k=l.line;k<h.length;k++){let R=h[k]||"";if(new RegExp(`(^|\\b)${E}(\\b)`).test(R)){C=k+2;break}}n.push({start:{line:l.line,column:1},end:{line:l.line+1,column:1},newText:""}),n.push(ge(t,{line:C,column:1},O+`
`))}}else{let O=/^(\s*Note\s+(?:left|right)\s+of\s+[^:]+|\s*Note\s+over\s+[^:]+)/i.exec(p),L=O?(O[0]||"").length+1:l.column;n.push(ge(t,{line:l.line,column:L}," : "))}continue}if(F("ST-BLOCK-MISSING-RBRACE",l)){let h=t.split(/\r?\n/),p=Math.max(0,l.line-1),x=/^(\s*)state\b/,m=-1,g="";for(let E=p;E>=0;E--){let y=x.exec(h[E]||"");if(y){m=E,g=y[1]||"";break}}if(m===-1){let E=fr(h[p]||"");n.push(ge(t,{line:p+1,column:1},`${E}}
`));continue}let S=h.length;for(let E=m+1;E<h.length;E++){let y=h[E]||"";if(y.trim()==="")continue;if(fr(y).length<=g.length){S=E;break}}n.push(ge(t,{line:S+1,column:1},`${g}}
`));continue}if(F("CL-REL-INVALID",l)){let p=ne(t,l.line).indexOf("->");p>=0&&n.push({start:{line:l.line,column:p+1},end:{line:l.line,column:p+3},newText:"--"});continue}if(F("CL-BLOCK-MISSING-RBRACE",l)){let h=t.split(/\r?\n/),p=Math.max(0,l.line-1),x=/^(\s*)class\b.*\{\s*$/,m=-1,g="";for(let E=p;E>=0;E--){let y=x.exec(h[E]||"");if(y){m=E,g=y[1]||"";break}}if(m===-1){let E=fr(h[p]||"");n.push(ge(t,{line:p+1,column:1},`${E}}
`));continue}let S=h.length;for(let E=m+1;E<h.length;E++){let y=h[E]||"";if(y.trim()==="")continue;if(fr(y).length<=g.length){S=E;break}}n.push(ge(t,{line:S+1,column:1},`${g}}
`));continue}if(F("CL-NAMESPACE-MISSING-RBRACE",l)){let h=t.split(/\r?\n/),p=Math.max(0,l.line-1),x=/^(\s*)namespace\b.*\{\s*$/,m=-1,g="";for(let E=p;E>=0;E--){let y=x.exec(h[E]||"");if(y){m=E,g=y[1]||"";break}}if(m===-1){let E=fr(h[p]||"");n.push(ge(t,{line:p+1,column:1},`${E}}
`));continue}let S=h.length;for(let E=m+1;E<h.length;E++){let y=h[E]||"";if(y.trim()==="")continue;if(fr(y).length<=g.length){S=E;break}}n.push(ge(t,{line:S+1,column:1},`${g}}
`));continue}if(F("CL-LABEL-DOUBLE-IN-DOUBLE",l)){let h=ne(t,l.line),p=h.indexOf('"');if(p!==-1){let x=h.indexOf(" as ",p+1),m=x!==-1?h.lastIndexOf('"',x-1):h.lastIndexOf('"');if(m>p){let g=h.slice(p+1,m),S=g.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");S!==g&&n.push({start:{line:l.line,column:p+2},end:{line:l.line,column:m+1},newText:S})}}else n.push(we(t,Ye(l),l.length??1,"&quot;"));continue}if(F("FL-STRICT-LABEL-QUOTES-REQUIRED",l)){if(r==="all"){let h=ne(t,l.line),p=Math.max(0,l.column-1),x=h.slice(0,p),m=h.slice(p),g=Math.max(x.lastIndexOf("["),x.lastIndexOf("("),x.lastIndexOf("{"));if(g>=0){let S=x[g],E=S==="["?"]":S==="("?")":"}",y=h.indexOf(E,p);y>g&&(n.push(ge(t,{line:l.line,column:g+2},'"')),n.push(ge(t,{line:l.line,column:y+1},'"')))}}continue}}}let u=[],f=new Set;for(let l of n){let d=`${l.start.line}:${l.start.column}:${l.end?.line??0}:${l.end?.column??0}:${l.newText}`;f.has(d)||(f.add(d),u.push(l))}return u}var yc=class{constructor(){this.nodes=new Map,this.edges=[],this.nodeCounter=0,this.edgeCounter=0,this.subgraphs=[],this.currentSubgraphStack=[],this.pendingLinkStyles=[],this.classStyles=new Map,this.nodeStyles=new Map,this.nodeClasses=new Map,this.edgeClasses=new Map,this.edgeStyles=new Map,this.nodeLinks=new Map}build(e){if(this.reset(),!e||!e.children)return{nodes:[],edges:[],direction:"TD",subgraphs:[]};let r=this.extractDirection(e);this.processStatements(e);for(let[n,i]of this.nodeLinks.entries()){let s=this.nodes.get(n);s&&(s.link=i)}return{nodes:Array.from(this.nodes.values()),edges:this.edges,direction:r,subgraphs:this.subgraphs}}reset(){this.nodes.clear(),this.edges=[],this.nodeCounter=0,this.edgeCounter=0,this.subgraphs=[],this.currentSubgraphStack=[],this.classStyles.clear(),this.nodeStyles.clear(),this.nodeClasses.clear(),this.edgeClasses.clear(),this.edgeStyles.clear(),this.pendingLinkStyles=[],this.nodeLinks.clear()}extractDirection(e){switch(e.children?.Direction?.[0]?.image?.toUpperCase()){case"TB":case"TD":return"TD";case"BT":return"BT";case"LR":return"LR";case"RL":return"RL";default:return"TD"}}processStatements(e){let r=e.children?.statement;if(r){for(let n of r)n.children?.nodeStatement?this.processNodeStatement(n.children.nodeStatement[0]):n.children?.subgraph?this.processSubgraph(n.children.subgraph[0]):n.children?.classDefStatement?this.processClassDef(n.children.classDefStatement[0]):n.children?.classStatement?this.processClassAssign(n.children.classStatement[0]):n.children?.styleStatement?this.processStyle(n.children.styleStatement[0]):n.children?.linkStyleStatement?this.processLinkStyle(n.children.linkStyleStatement[0]):n.children?.clickStatement?this.processClick(n.children.clickStatement[0]):n.children?.edgeAttrStatement&&this.processEdgeAttr(n.children.edgeAttrStatement[0]);this.applyLinkStyles()}}unquote(e){return e&&(e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e)}processClick(e){let r=e.children||{},n=r.clickTarget?.[0];if(!n)return;let i=n.image,s={};if(r.clickHref&&r.clickHref[0]){let o=r.clickHref[0].children||{};o.url&&o.url[0]&&(s.href=this.unquote(o.url[0].image)),o.tooltip&&o.tooltip[0]&&(s.tooltip=this.unquote(o.tooltip[0].image)),o.target&&o.target[0]&&(s.target=o.target[0].image)}else if(r.clickCall&&r.clickCall[0]){let o=r.clickCall[0].children||{};o.fn&&o.fn[0]&&(s.call=o.fn[0].image),o.tooltip&&o.tooltip[0]&&(s.tooltip=this.unquote(o.tooltip[0].image))}else{let o=r.Identifier||[],a=r.Text||[],c=r.QuotedString||[],u=o.find(l=>/^(href|call|callback)$/i.test(l.image)),f=u?.image?.toLowerCase();if(f==="href"){let l=c[0],d=c[1],h=o.find(p=>/^_(blank|self|parent|top)$/i.test(p.image));l&&(s.href=this.unquote(l.image)),d&&(s.tooltip=this.unquote(d.image)),h&&(s.target=h.image)}else if(f==="call"||f==="callback"){let l=new Set(["href","call","callback","_blank","_self","_parent","_top"]),h=o.filter(m=>(m.startOffset??0)>(u?.startOffset??-1)).find(m=>!l.has(m.image.toLowerCase())),p=a.map(m=>m.image).join(" ").trim();s.call=h?h.image+(p?` ${p}`:""):p||void 0;let x=c[0];x&&(s.tooltip=this.unquote(x.image))}}Object.keys(s).length&&this.nodeLinks.set(i,{...this.nodeLinks.get(i)||{},...s})}processNodeStatement(e){let r=e.children?.nodeOrParallelGroup,n=e.children?.link;if(!r||r.length===0)return;if((!n||n.length===0)&&r.length===1){let o=r[0].children?.node||[];if(o.length===1){let a=o[0],c=!!(a.children.attrObject&&a.children.attrObject.length),u=!!a.children?.nodeShape;if(c&&!u){let f=a.children.nodeId?.[0]||a.children.Identifier?.[0]||void 0;if(f){let l=f.image;if(this.edges.some(h=>h.id===l)){let h={children:{edgeId:[{image:l}],attrObject:a.children.attrObject}};this.processEdgeAttr(h);return}}}}}let i=this.processNodeGroup(r[0]);if(r.length>1&&n&&n.length>0){let s=this.processNodeGroup(r[1]),o=this.extractLinkInfo(n[0]);for(let a of i)for(let c of s)this.edges.push({id:o.edgeId||`e${this.edgeCounter++}`,source:a,target:c,label:o.label,type:o.type,markerStart:o.markerStart,markerEnd:o.markerEnd});for(let a=2;a<r.length;a++){let c=this.processNodeGroup(r[a]),u=n[a-1]?this.extractLinkInfo(n[a-1]):o;for(let f of s)for(let l of c)this.edges.push({id:u.edgeId||`e${this.edgeCounter++}`,source:f,target:l,label:u.label,type:u.type,markerStart:u.markerStart,markerEnd:u.markerEnd});s.length=0,s.push(...c)}}}processNodeGroup(e){let r=e.children?.node;if(!r)return[];let n=[];for(let i of r){let s=this.extractNodeInfo(i);if(s){if(!this.subgraphs.some(a=>a.id===s.id)){if(!this.nodes.has(s.id))s.style=this.computeNodeStyle(s.id),this.nodes.set(s.id,s);else{let a=this.nodes.get(s.id);(s.shape!=="rectangle"||s.label!==s.id)&&(s.label!==s.id&&(a.label=s.label),s.shape!=="rectangle"&&(a.shape=s.shape));let c=this.computeNodeStyle(s.id);Object.keys(c).length&&(a.style={...a.style||{},...c})}if(this.currentSubgraphStack.length)for(let a of this.currentSubgraphStack){let c=this.subgraphs.find(u=>u.id===a);c&&!c.nodes.includes(s.id)&&c.nodes.push(s.id)}}n.push(s.id)}}return n}extractNodeInfo(e){let r=e.children;if(!r)return null;let n;if(r.nodeId)n=r.nodeId[0].image,r.nodeIdSuffix&&(n+=r.nodeIdSuffix[0].image);else if(r.nodeIdNum)n=r.nodeIdNum[0].image;else if(r.Identifier)n=r.Identifier[0].image;else return null;let i="rectangle",s=n,o=r.nodeShape?.[0];if(o?.children){let l=this.extractShapeAndLabel(o);i=l.shape,l.label&&(s=l.label)}let a=r.attrObject?.[0],c;if(a&&!o){if(c=this.parseTypedAttrObject(a),c.shape){let l=c.shape;l==="rect"?i="rectangle":l==="round"||l==="rounded"?i="round":l==="stadium"?i="stadium":l==="subroutine"?i="subroutine":l==="circle"?i="circle":l==="cylinder"?i="cylinder":l==="diamond"?i="diamond":l==="trapezoid"?i="trapezoid":l==="trapezoidAlt"?i="trapezoidAlt":l==="parallelogram"||l==="lean-l"||l==="lean-r"?(i="parallelogram",c.lean=l==="lean-l"?"l":l==="lean-r"?"r":void 0):l==="hexagon"?i="hexagon":(l==="icon"||l==="image")&&(i="rectangle")}typeof c.label=="string"&&c.label.length>0&&(s=c.label)}let u=r.nodeClass?.[0];if(u){let l=this.nodeClasses.get(n)||new Set;l.add(u.image),this.nodeClasses.set(n,l)}let f={id:n,label:s,shape:i};if(c){let l=c.padding,d=c.cornerRadius,h=c.lean,p=c.icon||c.image?{icon:c.icon,image:c.image}:void 0;f.typed={padding:l,cornerRadius:d,lean:h,media:p}}return f}parseTypedAttrObject(e){let n=(e.children||{}).attrPair||[],i={};for(let s of n){let o=s.children?.attrKey?.[0];if(!o)continue;let a=o.image,c=s.children?.QuotedString?.[0]||s.children?.Identifier?.[0]||s.children?.NumberLiteral?.[0]||s.children?.Text?.[0];if(!c)continue;let u=c.image;switch((u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'"))&&(u=u.slice(1,-1)),a){case"shape":i.shape=u;break;case"label":i.label=u;break;case"padding":{let f=parseFloat(u);Number.isFinite(f)&&(i.padding=f);break}case"cornerRadius":{let f=parseFloat(u);Number.isFinite(f)&&(i.cornerRadius=f);break}case"icon":i.icon=u;break;case"image":i.image=u;break}}return i}extractShapeAndLabel(e){let r=e.children,n="rectangle",i="",s=r?.nodeContent;if(s&&s.length>0&&(i=this.extractTextContent(s[0])),r?.SquareOpen){n="rectangle";let o=r.nodeContent?.[0];if(o){let a=o.children,c=["ForwardSlash","Backslash","Identifier","Text","NumberLiteral","RoundOpen","RoundClose","AngleLess","AngleOpen","Comma","Colon","Ampersand","Semicolon","TwoDashes","Line","ThickLine","DottedLine"],u=[];for(let f of c)a[f]?.forEach(d=>u.push({type:f,t:d,start:d.startOffset??0}));if(u.length>=2){u.sort((d,h)=>d.start-h.start);let f=u[0].type,l=u[u.length-1].type;f==="ForwardSlash"&&l==="ForwardSlash"||f==="Backslash"&&l==="Backslash"?n="parallelogram":f==="ForwardSlash"&&l==="Backslash"?n="trapezoid":f==="Backslash"&&l==="ForwardSlash"&&(n="trapezoidAlt")}}}else r?.RoundOpen?n="round":r?.DiamondOpen?n="diamond":r?.DoubleRoundOpen?n="circle":r?.StadiumOpen?n="stadium":r?.HexagonOpen?n="hexagon":r?.DoubleSquareOpen?n="subroutine":r?.CylinderOpen?n="cylinder":r?.TrapezoidOpen?n="trapezoid":r?.ParallelogramOpen&&(n="parallelogram");return{shape:n,label:i}}extractTextContent(e){let r=e.children;if(!r)return"";let n=["Text","Identifier","QuotedString","NumberLiteral","Ampersand","Comma","Colon","Semicolon","Dot","Underscore","Dash","ForwardSlash","Backslash","AngleLess","AngleOpen"],i=[];for(let o of n){let a=r[o];if(a)for(let c of a){let u=c.image;o==="QuotedString"&&u.startsWith('"')&&u.endsWith('"')&&(u=u.slice(1,-1)),!((o==="ForwardSlash"||o==="Backslash")&&i.length===0)&&i.push({text:u,startOffset:c.startOffset??0,type:o})}}if(i.sort((o,a)=>o.startOffset-a.startOffset),i.length){let o=i[0];(o.type==="ForwardSlash"||o.type==="Backslash")&&i.shift();let a=i[i.length-1];(a.type==="ForwardSlash"||a.type==="Backslash")&&i.pop()}let s=i.map(o=>o.text);return r.Space?s.join(""):s.join(" ").trim()}extractLinkInfo(e){let r=e.children,n="arrow",i,s="none",o="none",a=r.edgeId?.[0];r.BiDirectionalArrow?(n="arrow",s="arrow",o="arrow"):r.CircleEndLine?(n="open",s="circle",o="circle"):r.CrossEndLine?(n="open",s="cross",o="cross"):r?.ArrowRight?(n="arrow",o="arrow"):r?.ArrowLeft?(n="arrow",s="arrow"):r?.DottedArrowRight?(n="dotted",o="arrow"):r?.DottedArrowLeft?(n="dotted",s="arrow"):r?.ThickArrowRight?(n="thick",o="arrow"):r?.ThickArrowLeft?(n="thick",s="arrow"):r?.LinkRight||r?.LinkLeft||r?.Line||r?.TwoDashes||r?.DottedLine||r?.ThickLine?r?.DottedLine?n="dotted":r?.ThickLine?n="thick":n="open":r?.InvisibleLink&&(n="invisible"),o==="none"&&(r?.ArrowRight||r.ThickArrowRight||r.DottedArrowRight)&&(o="arrow"),s==="none"&&(r?.ArrowLeft||r.ThickArrowLeft||r.DottedArrowLeft)&&(s="arrow");let c=r?.linkText?.[0];if(c)i=this.extractTextContent(c);else if(r.linkTextInline?.[0])i=this.extractTextContent(r.linkTextInline[0]);else if(r.inlineCarrier?.[0]){let f=r.inlineCarrier[0].image.trim();f.startsWith("-.")&&f.endsWith(".-")?n="dotted":f.startsWith("==")&&f.endsWith("==")?n="thick":f.startsWith("--")&&f.endsWith("--"),(r.ArrowRight||r.DottedArrowRight||r.ThickArrowRight)&&(o="arrow"),(r.ArrowLeft||r.DottedArrowLeft||r.ThickArrowLeft)&&(s="arrow"),i=(d=>d.startsWith("-.")&&d.endsWith(".-")||d.startsWith("==")&&d.endsWith("==")||d.startsWith("--")&&d.endsWith("--")?d.slice(2,-2).trim():d)(f)}return{type:n,label:i,markerStart:s,markerEnd:o,edgeId:a?a.image:void 0}}processSubgraph(e){let r=e.children,n=`subgraph_${this.subgraphs.length}`,i,s=r?.subgraphId?.[0]||r?.Identifier?.[0];if(s&&(n=s.image),r?.SquareOpen&&r?.nodeContent)i=this.extractTextContent(r.nodeContent[0]);else if(r.subgraphTitleQ?.[0]){let f=r.subgraphTitleQ[0].image;i=f&&f.length>=2&&(f.startsWith('"')||f.startsWith("'"))?f.slice(1,-1):f}else r?.subgraphLabel&&(i=this.extractTextContent(r.subgraphLabel[0]));!i&&n!==`subgraph_${this.subgraphs.length}`&&(i=n);let o=this.currentSubgraphStack.length?this.currentSubgraphStack[this.currentSubgraphStack.length-1]:void 0,a={id:n,label:i,nodes:[],parent:o};this.subgraphs.push(a),this.currentSubgraphStack.push(n);let c=r?.subgraphStatement;if(c)for(let u of c)u.children?.nodeStatement?this.processNodeStatement(u.children.nodeStatement[0]):u.children?.subgraph&&this.processSubgraph(u.children.subgraph[0]);this.currentSubgraphStack.pop()}processClassDef(e){let r=e.children?.Identifier?.[0];if(!r)return;let n=r.image,i=this.collectStyleProps(e,{skipFirstIdentifier:!0});if(Object.keys(i).length){this.classStyles.set(n,i);for(let[s,o]of this.nodeClasses.entries())if(o.has(n)){let a=this.nodes.get(s);a&&(a.style={...a.style||{},...this.computeNodeStyle(s)})}}}processClassAssign(e){let r=e.children?.Identifier||[];if(!r.length)return;let n=e.children.className?.[0],i=n?.image||r[r.length-1].image,s=r.slice(0,-1);for(let o of s){let a=o.image,c=this.nodeClasses.get(a)||new Set;c.add(i),this.nodeClasses.set(a,c);let u=this.edgeClasses.get(a)||new Set;u.add(i),this.edgeClasses.set(a,u);let f=this.nodes.get(a);f&&(f.style={...f.style||{},...this.computeNodeStyle(a)})}}processStyle(e){let r=e.children?.Identifier?.[0];if(!r)return;let n=r.image,i=this.collectStyleProps(e,{skipFirstIdentifier:!0});if(Object.keys(i).length){this.nodeStyles.set(n,i);let s=this.nodes.get(n);s&&(s.style={...s.style||{},...this.computeNodeStyle(n)})}}collectStyleProps(e,r={}){let n=[],i=e.children||{},s=(c,u="t")=>c?.forEach(f=>n.push({text:f.image,startOffset:f.startOffset??0,type:u}));if(s(i.Text,"Text"),s(i.Identifier,"Identifier"),s(i.ColorValue,"Color"),s(i.Colon,"Colon"),s(i.Comma,"Comma"),s(i.NumberLiteral,"Number"),n.sort((c,u)=>c.startOffset-u.startOffset),r.skipFirstIdentifier){let c=n.findIndex(u=>u.type==="Identifier");c>=0&&n.splice(c,1)}let o=n.map(c=>c.text).join(""),a={};for(let c of o.split(",").map(u=>u.trim()).filter(Boolean)){let[u,f]=c.split(":");u&&f&&(a[u.trim()]=f.trim())}return a}processEdgeAttr(e){let r=e.children.edgeId?.[0];if(!r)return;let n=r.image,i=e.children.attrObject?.[0];if(!i)return;let o=(i.children||{}).attrPair||[],a={};for(let u of o){let f=u.children.attrKey?.[0],l=u.children.QuotedString?.[0]||u.children.Identifier?.[0]||u.children.NumberLiteral?.[0]||u.children.Text?.[0];if(!f||!l)continue;let d=l.image;(d.startsWith('"')&&d.endsWith('"')||d.startsWith("'")&&d.endsWith("'"))&&(d=d.slice(1,-1));let h=f.image;h==="animate"?/^(true|1|yes|on|fast|slow)$/i.test(d)&&(a.animation=/^slow$/i.test(d)?"dash 8s linear infinite":/^fast$/i.test(d)?"dash 2s linear infinite":"dash 4s linear infinite",a["stroke-dasharray"]||(a["stroke-dasharray"]="5 5")):a[h]=d}let c=this.edgeStyles.get(n)||{};this.edgeStyles.set(n,{...c,...a})}computeEdgeStyle(e){let r={},n=this.edgeClasses.get(e);if(n)for(let s of n){let o=this.classStyles.get(s);o&&Object.assign(r,this.normalizeStyle(o))}let i=this.edgeStyles.get(e);return i&&Object.assign(r,this.normalizeStyle(i)),r}processLinkStyle(e){let r=e.children||{};if(r.linkStyleIndexList&&r.linkStylePairs){let o=r.linkStyleIndexList[0],a=r.linkStylePairs[0],u=((o.children||{}).index||[]).map(d=>parseInt(d.image,10)).filter(d=>Number.isFinite(d)),f=(a.children||{}).linkStylePair||[],l={};for(let d of f){let h=d.children||{},p=h.key?.[0],x=h.valueColor?.[0]||h.valueQuoted?.[0]||h.valueNum?.[0]||h.valueId?.[0]||h.valueText?.[0];if(!p||!x)continue;let m=x.image;x.tokenType?.name==="QuotedString"&&(m.startsWith('"')||m.startsWith("'"))&&(m=m.slice(1,-1)),l[p.image]=m}this.pendingLinkStyles.push({indices:u,props:l});return}let i=(e.children?.NumberLiteral||[]).map(o=>parseInt(o.image,10)).filter(o=>Number.isFinite(o)),s=this.collectStyleProps(e);this.pendingLinkStyles.push({indices:i,props:s})}applyLinkStyles(){if(!this.pendingLinkStyles.length||!this.edges.length)return;let e=r=>{let n={};for(let[i,s]of Object.entries(r)){let o=i.trim().toLowerCase(),a=s.trim();if(o==="stroke")n.stroke=a;else if(o==="stroke-width"){let c=parseFloat(a);Number.isNaN(c)||(n.strokeWidth=c)}else if(o==="opacity"||o==="stroke-opacity"){let c=parseFloat(a);Number.isNaN(c)||(n.strokeOpacity=c)}else o==="stroke-dasharray"&&(n.dasharray=a)}return n};for(let r of this.pendingLinkStyles){let n=e(r.props);for(let i of r.indices)if(i>=0&&i<this.edges.length){let s=this.edges[i];s.style={...s.style||{},stroke:n.stroke??s.style?.stroke,strokeWidth:n.strokeWidth??s.style?.strokeWidth,strokeOpacity:n.strokeOpacity??s.style?.strokeOpacity},n.dasharray&&(s.dasharray=n.dasharray),n.animation&&(s.animation=n.animation)}}}computeNodeStyle(e){let r={},n=this.nodeClasses.get(e);if(n)for(let s of n){let o=this.classStyles.get(s);o&&Object.assign(r,this.normalizeStyle(o))}let i=this.nodeStyles.get(e);return i&&Object.assign(r,this.normalizeStyle(i)),r}normalizeStyle(e){let r={};for(let[n,i]of Object.entries(e)){let s=n.trim().toLowerCase(),o=i.trim();if(s==="stroke-width"){let a=parseFloat(o);Number.isNaN(a)||(r.strokeWidth=a)}else s==="stroke"?r.stroke=o:s==="fill"&&(r.fill=o)}return r}};var Yd=cI(qv(),1),Pr=class{constructor(){this.nodeWidth=120,this.nodeHeight=50,this.rankSep=50,this.nodeSep=50,this.edgeSep=10}layout(e){let r=new Yd.default.graphlib.Graph,n=!!(e.subgraphs&&e.subgraphs.length>0),i=this.mapDirection(e.direction),s=this.rankSep,o=this.nodeSep;n&&(i==="LR"||i==="RL"?(s+=20,o+=70):(s+=70,o+=20));let a={rankdir:i,ranksep:s,nodesep:o,edgesep:this.edgeSep,marginx:20,marginy:20};if(n&&(i==="LR"||i==="RL")&&(a.ranker="network-simplex",a.acyclicer="greedy",o+=40,s=Math.max(30,s-20)),n&&(a.compound=!0),r.setGraph(a),r.setDefaultEdgeLabel(()=>({})),e.subgraphs&&e.subgraphs.length>0)for(let g of e.subgraphs)r.setNode(g.id,{label:g.label||g.id,clusterLabelPos:"top"});for(let g of e.nodes){let S=g.width,E=g.height,y=S&&E?{width:S,height:E}:this.calculateNodeDimensions(g.label,g.shape);r.setNode(g.id,{width:y.width,height:y.height,label:g.label,shape:g.shape})}if(e.subgraphs&&e.subgraphs.length>0)for(let g of e.subgraphs){for(let S of g.nodes)if(r.hasNode(S))try{r.setParent(S,g.id)}catch{}if(g.parent&&r.hasNode(g.parent))try{r.setParent(g.id,g.parent)}catch{}}for(let g of e.edges)r.setEdge(g.source,g.target,{label:g.label,width:g.label?g.label.length*8:0,height:g.label?20:0});Yd.default.layout(r);let c=r.graph(),u=[],f=[];for(let g of e.nodes){let S=r.node(g.id);S&&u.push({...g,x:S.x-S.width/2,y:S.y-S.height/2,width:S.width,height:S.height})}let l=[];if(e.subgraphs&&e.subgraphs.length>0){for(let S of e.subgraphs){let E=u.filter(y=>S.nodes.includes(y.id));if(E.length){let y=Math.min(...E.map(k=>k.x)),O=Math.min(...E.map(k=>k.y)),L=Math.max(...E.map(k=>k.x+k.width)),b=Math.max(...E.map(k=>k.y+k.height)),C=30;l.push({id:S.id,label:S.label||S.id,x:y-C,y:O-C-18,width:L-y+C*2,height:b-O+C*2+18,parent:S.parent})}}let g=Object.fromEntries(l.map(S=>[S.id,S]));for(let S of l){if(!S.parent)continue;let E=g[S.parent];if(!E)continue;let y=Math.min(E.x,S.x),O=Math.min(E.y,S.y),L=Math.max(E.x+E.width,S.x+S.width),b=Math.max(E.y+E.height,S.y+S.height);E.x=y,E.y=O,E.width=L-y,E.height=b-O}}let d=Object.fromEntries(l.map(g=>[g.id,g]));for(let g of e.edges){let S=r.edge(g.source,g.target),E=S&&Array.isArray(S.points)?S.points.slice():[],y=E.some(C=>!Number.isFinite(C.x)||!Number.isFinite(C.y)),O=d[g.source],L=d[g.target],b=!1;if(!E.length||y||O||L){let C=this.mapDirection(e.direction),k=I=>{let v=r.node(I);if(v)return{id:I,label:v.label||I,shape:v.shape||"rectangle",x:v.x-v.width/2,y:v.y-v.height/2,width:v.width,height:v.height,style:{}}},R=O?this.clusterAnchor(O,C,"out"):this.nodeAnchor(k(g.source),C,"out"),N=L?this.clusterAnchor(L,C,"in"):this.nodeAnchor(k(g.target),C,"in");if(R&&N){let w=O&&L&&Math.abs(O.x-L.x)>Math.abs(O.y-L.y);if(C==="LR"||C==="RL"){let M=R.x+(C==="LR"?20:-20),_=N.x+(C==="LR"?-20:20),$={x:O?M:R.x,y:R.y},K={x:L?_:N.x,y:N.y},ee=$.x+(K.x-$.x)*.72,le={x:ee,y:$.y},ae={x:ee,y:K.y};E=L?[R,$,le,ae,K]:[R,$,le,ae,K,N]}else if(w&&O&&L){let M=(O.y+O.height/2+L.y+L.height/2)/2;if(O.x<L.x){let _=O.x+O.width,$=L.x;E=[{x:_,y:M},{x:$,y:M}]}else{let _=O.x,$=L.x+L.width;E=[{x:_,y:M},{x:$,y:M}]}}else{let M=R.y+(C==="TD"?20:-20),_=N.y+(C==="TD"?-20:20),$={x:R.x,y:O?M:R.y},K={x:N.x,y:L?_:N.y},ee=$.y+(K.y-$.y)*.68,le={x:$.x,y:ee},ae={x:K.x,y:ee};E=L?[R,$,le,ae,K]:[R,$,le,ae,K,N]}b=!0}}E.length&&f.push({...g,points:E,pathMode:b?"orthogonal":"smooth"})}let h=c.width,p=c.height,x=Number.isFinite(h)&&h>0?h:800,m=Number.isFinite(p)&&p>0?p:600;return{nodes:u,edges:f,width:x,height:m,subgraphs:l}}mapDirection(e){switch(e){case"TB":case"TD":return"TB";case"BT":return"BT";case"LR":return"LR";case"RL":return"RL";default:return"TB"}}calculateNodeDimensions(e,r){let u=e.split(/<\s*br\s*\/?\s*>/i),f=u.length>1,l,d;if(f){let p=Math.max(...u.map(x=>x.length));l=Math.min(Math.max(p*7+40,80),240),d=u.length}else{l=Math.min(Math.max(e.length*7+40,80),240);let p=Math.max(1,Math.floor((l-40)/7));d=Math.ceil(e.length/p)}let h=Math.max(d*18+20,40);switch(r){case"circle":let p=Math.max(l,h);l=p,h=p;break;case"diamond":{let x=Math.max(l,h)*1.2;l=x,h=x;break}case"hexagon":l*=1.3,h*=1.2;break;case"stadium":l*=1.2;break;case"cylinder":h*=1.5;break;case"subroutine":case"double":l+=10,h+=10;break;case"parallelogram":case"trapezoid":l*=1.3;break}return{width:Math.round(l),height:Math.round(h)}}clusterAnchor(e,r,n){switch(r){case"LR":return{x:n==="out"?e.x+e.width:e.x,y:e.y+e.height/2};case"RL":return{x:n==="out"?e.x:e.x+e.width,y:e.y+e.height/2};case"BT":return{x:e.x+e.width/2,y:n==="out"?e.y:e.y+e.height};case"TB":default:return{x:e.x+e.width/2,y:n==="out"?e.y+e.height:e.y}}}nodeAnchor(e,r,n){if(!e)return{x:0,y:0};switch(r){case"LR":return{x:n==="in"?e.x:e.x+e.width,y:e.y+e.height/2};case"RL":return{x:n==="in"?e.x+e.width:e.x,y:e.y+e.height/2};case"BT":return{x:e.x+e.width/2,y:n==="in"?e.y+e.height:e.y};case"TB":default:return{x:e.x+e.width/2,y:n==="in"?e.y:e.y+e.height}}}};function Vo(t,e,r="#333",n=8,i=6){let s=e.x-t.x,o=e.y-t.y,a=Math.hypot(s,o)||1,c=s/a,u=o/a,f=-u,l=c,d=e.x-c*n,h=e.y-u*n,p=d+f*(i/2),x=h+l*(i/2),m=d-f*(i/2),g=h-l*(i/2);return`<path d="M${e.x},${e.y} L${p},${x} L${m},${g} Z" fill="${r}" />`}function Qo(t,e,r="#333",n=8,i=6){let s=e.x-t.x,o=e.y-t.y,a=Math.hypot(s,o)||1,c=s/a,u=o/a,f=-u,l=c,d=t.x-c*n,h=t.y-u*n,p=t.x+f*(i/2),x=t.y+l*(i/2),m=t.x-f*(i/2),g=t.y-l*(i/2);return`<path d="M${d},${h} L${p},${x} L${m},${g} Z" fill="${r}" />`}function gn(t={}){let e=t.fontFamily||"Arial, sans-serif",r=t.fontSize??14,n=t.nodeFill||"#eef0ff",i=t.nodeStroke||"#3f3f3f",s=t.edgeStroke||"#555555";return`
    .node-shape { fill: ${n}; stroke: ${i}; stroke-width: 1px; }
    .node-label { fill: #333; font-family: ${e}; font-size: ${r}px; }
    .edge-path { stroke: ${s}; stroke-width: 2px; fill: none; }
    .edge-label-bg { fill: rgba(232,232,232, 0.8); opacity: 0.5; }
    .edge-label-text { fill: #333; font-family: ${e}; font-size: ${Math.max(10,r-2)}px; }
    .edge-marker { stroke: ${s}; }
    .edge-marker-fill { fill: ${s}; }

    /* Basic stroke dash animation used by flowchart link animation presets */
    @keyframes dash { to { stroke-dashoffset: -1000; } }

    /* Cluster (flowchart + sequence blocks) */
    .cluster-bg { fill: #ffffde; }
    .cluster-border { fill: none; stroke: #aaaa33; stroke-width: 1px; }
    .cluster-title-bg { fill: rgba(255,255,255,0.8); }
    .cluster-label-text { fill: #333; font-family: ${e}; font-size: 12px; }

    /* Notes */
    .note { fill: #fff5ad; stroke: #aaaa33; stroke-width: 1px; }
    .note-text { fill: #333; font-family: ${e}; font-size: 12px; }

    /* Sequence-specific add-ons (safe for flowcharts too) */
    .actor-rect { fill: #eaeaea; stroke: #666; stroke-width: 1.5px; }
    .actor-label { fill: #111; font-family: ${e}; font-size: 16px; }
    .lifeline { stroke: #999; stroke-width: 1px; }
    .activation { fill: #f4f4f4; stroke: #666; stroke-width: 1px; }
    .msg-line { stroke: #333; stroke-width: 1.5px; fill: none; }
    .msg-line.dotted { stroke-dasharray: 2 2; }
    .msg-line.thick { stroke-width: 3px; }
    .openhead { fill: none; stroke: #333; stroke-width: 1.5px; }
    .crosshead path { stroke: #333; stroke-width: 1.5px; }
    .msg-label { fill: #333; font-family: ${e}; font-size: 12px; dominant-baseline: middle; }
    .msg-label-bg { fill: #ffffff; stroke: #cccccc; stroke-width: 1px; rx: 3; }

    /* State overlays */
    .lane-divider { stroke: #aaaaaa; stroke-width: 1px; stroke-dasharray: 4 3; }
    .end-double { stroke: #3f3f3f; stroke-width: 1px; fill: none; }
  `}function Yo(t,e){if(!e)return t;let r=t;if((e.nodeBkg||e.nodeBorder)&&(r=r.replace(/\.node-shape\s*\{[^}]*\}/,n=>{let i=n;return e.nodeBkg&&(i=i.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeBkg)};`)),e.nodeBorder&&(i=i.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.nodeBorder)};`)),i})),e.nodeTextColor&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeTextColor)};`)),r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeTextColor)};`))),e.edgeLabelTextColor){let n=String(e.edgeLabelTextColor);r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,i=>i.replace(/fill:\s*[^;]+;/,`fill: ${n};`))}if(e.lineColor&&(r=r.replace(/\.edge-path\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lineColor)};`))),e.arrowheadColor&&(r=r.replace(/\.edge-marker\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`)),r=r.replace(/\.edge-marker-fill\s*\{[^}]*\}/,n=>n.includes("fill:")?n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.arrowheadColor)};`):n.replace(/\}/,` fill: ${String(e.arrowheadColor)}; }`)),r=r.replace(/\.openhead\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`)),r=r.replace(/\.crosshead path\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`))),e.clusterBkg&&(r=r.replace(/\.cluster-bg\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterBkg)};`))),e.clusterBorder&&(r=r.replace(/\.cluster-border\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.clusterBorder)};`))),e.clusterTextColor&&(r=r.replace(/\.cluster-label-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterTextColor)};`))),e.clusterTitleBg||e.clusterTitleBackground){let n=String(e.clusterTitleBg||e.clusterTitleBackground);r=r.replace(/\.cluster-title-bg\s*\{[^}]*\}/,i=>i.replace(/fill:\s*[^;]+;/,`fill: ${n};`))}if(e.fontFamily){let n=String(e.fontFamily);r=r.replace(/\.node-label\s*\{[^}]*\}/,i=>i.replace(/font-family:\s*[^;]+;/,`font-family: ${n};`)),r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,i=>i.replace(/font-family:\s*[^;]+;/,`font-family: ${n};`)),r=r.replace(/\.note-text\s*\{[^}]*\}/,i=>i.replace(/font-family:\s*[^;]+;/,`font-family: ${n};`))}if(e.fontSize){let n=String(e.fontSize);r=r.replace(/\.node-label\s*\{[^}]*\}/,s=>s.replace(/font-size:\s*[^;]+;/,`font-size: ${n}px;`));let i=Math.max(10,Number(e.fontSize)-2);r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,s=>s.replace(/font-size:\s*[^;]+;/,`font-size: ${i}px;`)),r=r.replace(/\.note-text\s*\{[^}]*\}/,s=>s.replace(/font-size:\s*[^;]+;/,`font-size: ${i}px;`))}return r}function Re(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&apos;")}function lt(t,e=12){let r=.6*e;return Math.max(0,Math.round(t.length*r))}var Xd=["#ECECFF","#ffffde","hsl(80, 100%, 56.2745098039%)","hsl(240, 100%, 86.2745098039%)","hsl(60, 100%, 63.5294117647%)","hsl(80, 100%, 76.2745098039%)","hsl(300, 100%, 76.2745098039%)","hsl(180, 100%, 56.2745098039%)","hsl(0, 100%, 56.2745098039%)","hsl(300, 100%, 56.2745098039%)","hsl(150, 100%, 56.2745098039%)","hsl(0, 100%, 66.2745098039%)"];function Zd(t){return t<Xd.length?Xd[t]:`hsl(${(t-Xd.length)*47%360} 60% 55%)`}function Jd(t){return Number.isInteger(t)?String(t):(Math.round(t*100)/100).toString()}function Dv(t,e){if(!(e>0))return"0%";let r=t/e*100;return`${Math.round(r)}%`}function Xc(t,e,r,n,i=0){return`<g class="cluster-bg-layer" transform="translate(${t},${e})">
  <rect class="cluster-bg" x="0" y="0" width="${r}" height="${n}" rx="${i}"/>
</g>`}function Zc(t,e,r,n,i,s=[],o=0,a="center",c="left",u=0){let f=[];f.push(`<g class="cluster-overlay" transform="translate(${t},${e})">`),f.push(`<rect class="cluster-border" x="0" y="0" width="${r}" height="${n}" rx="${u}"/>`);let l=i?Re(i):"";if(l){let d=Math.max(24,lt(l,12)+10),h=-2+o,p=11+o;a==="left"?(f.push(`<rect class="cluster-title-bg" x="6" y="${h}" width="${d}" height="18" rx="3"/>`),f.push(`<text class="cluster-label-text" x="12" y="${p}" text-anchor="start">${l}</text>`)):(f.push(`<rect class="cluster-title-bg" x="6" y="${h}" width="${d}" height="18" rx="3"/>`),f.push(`<text class="cluster-label-text" x="${6+d/2}" y="${p}" text-anchor="middle">${l}</text>`))}for(let d of s){let h=d.y-e;if(f.push(`<line x1="0" y1="${h}" x2="${r}" y2="${h}" class="cluster-border" />`),d.title){let p=Re(d.title),x=Math.max(24,lt(p,12)+10),m=6;f.push(`<rect class="cluster-title-bg" x="${m}" y="${h-10}" width="${x}" height="18" rx="3"/>`),c==="left"?f.push(`<text class="cluster-label-text" x="${m+6}" y="${h+1}" text-anchor="start">${p}</text>`):f.push(`<text class="cluster-label-text" x="${m+x/2}" y="${h+1}" text-anchor="middle">${p}</text>`)}}return f.push("</g>"),f.join(`
`)}var jn=class{constructor(){this.padding=20,this.fontSize=14,this.fontFamily="Arial, sans-serif",this.defaultStroke="#3f3f3f",this.defaultFill="#eef0ff",this.arrowStroke="#555555",this.arrowMarkerSize=9}render(e){let r=1/0,n=1/0,i=-1/0,s=-1/0;for(let y of e.nodes)r=Math.min(r,y.x),n=Math.min(n,y.y),i=Math.max(i,y.x+y.width),s=Math.max(s,y.y+y.height);if(e.subgraphs)for(let y of e.subgraphs)r=Math.min(r,y.x),n=Math.min(n,y.y),i=Math.max(i,y.x+y.width),s=Math.max(s,y.y+y.height);for(let y of e.edges)if(y.points)for(let O of y.points)r=Math.min(r,O.x),n=Math.min(n,O.y),i=Math.max(i,O.x),s=Math.max(s,O.y);isFinite(r)||(r=0),isFinite(n)||(n=0),isFinite(i)||(i=e.width),isFinite(s)||(s=e.height);let o=Math.max(0,-Math.floor(r)+1),a=Math.max(0,-Math.floor(n)+1),c=this.padding+o,u=this.padding+a,f=Math.ceil(i)-Math.min(0,Math.floor(r)),l=Math.ceil(s)-Math.min(0,Math.floor(n)),d=f+this.padding*2+o,h=l+this.padding*2+a,p=[],x=[];if(p.push(this.generateDefs()),e.subgraphs&&e.subgraphs.length){let O=e.subgraphs.slice().sort((k,R)=>(k.parent?1:0)-(R.parent?1:0)),L=new Map(O.map(k=>[k.id,k])),b=k=>{let R=0,N=k.parent;for(;N;)R++,N=L.get(N)?.parent;return R},C=[];for(let k of O){if(k.id&&k.id.includes("__lane"))continue;let R=k.x+c,N=k.y+u;C.push(Xc(R,N,k.width,k.height,0));let I=b(k),v=k.label?this.escapeXml(k.label):void 0,w=7+I*12;x.push(Zc(R,N,k.width,k.height,v,[],w,"center","left",0))}p.push(`<g class="subgraph-bg">${C.join("")}</g>`)}let m={};for(let y of e.nodes)m[y.id]={x:y.x+c,y:y.y+u,width:y.width,height:y.height,shape:y.shape};if(e.subgraphs&&e.subgraphs.length)for(let y of e.subgraphs)m[y.id]={x:y.x+c,y:y.y+u,width:y.width,height:y.height,shape:"rectangle"};for(let y of e.nodes)p.push(this.generateNodeWithPad(y,c,u));for(let y of e.edges){let{path:O,overlay:L}=this.generateEdge(y,c,u,m);p.push(O),L&&x.push(L)}let g=`<rect x="0" y="0" width="${d}" height="${h}" fill="#ffffff" />`,E=`<style>${gn({fontFamily:this.fontFamily,fontSize:this.fontSize,nodeFill:this.defaultFill,nodeStroke:this.defaultStroke,edgeStroke:this.arrowStroke})}</style>`;return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${d}" height="${h}" viewBox="0 0 ${d} ${h}">
  ${g}
  ${E}
  ${p.join(`
  `)}
  ${x.join(`
  `)}
</svg>`}buildNodeStyleAttrs(e){let r=[];return e.fill&&r.push(`fill:${e.fill}`),e.stroke&&r.push(`stroke:${e.stroke}`),e.strokeWidth!=null&&r.push(`stroke-width:${e.strokeWidth}`),r.length?`style="${r.join(";")}"`:""}buildNodeStrokeStyle(e){let r=[];return e.stroke&&r.push(`stroke:${e.stroke}`),e.strokeWidth!=null&&r.push(`stroke-width:${e.strokeWidth}`),r.length?`style="${r.join(";")}"`:""}generateDefs(){let e=Math.max(8,this.arrowMarkerSize+2),r=Math.max(8,this.arrowMarkerSize+2),n=Math.max(6,e),i=Math.max(4,Math.round(r/2));return`<defs>
    <marker id="arrow" viewBox="0 0 ${e} ${r}" markerWidth="${e}" markerHeight="${r}" refX="${n}" refY="${i}" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L0,${r} L${e},${i} z" fill="${this.arrowStroke}" />
    </marker>
    <marker id="circle-marker" viewBox="0 0 9 9" markerWidth="9" markerHeight="9" refX="4.5" refY="4.5" orient="auto" markerUnits="userSpaceOnUse">
      <circle cx="4.5" cy="4.5" r="4.5" fill="${this.arrowStroke}" />
    </marker>
    <marker id="cross-marker" viewBox="0 0 12 12" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M1.5,1.5 L10.5,10.5 M10.5,1.5 L1.5,10.5" stroke="${this.arrowStroke}" stroke-width="2.25" />
    </marker>
  </defs>`}generateNodeWithPad(e,r,n){let i=e.x+r,s=e.y+n,o=i+e.width/2,a=s+e.height/2,c="",u=a,f=e.style?.strokeWidth??void 0,l=e.style?.stroke??void 0,d=e.style?.fill??void 0,h=this.buildNodeStyleAttrs({stroke:l,strokeWidth:f,fill:d}),p=e.typed,x=Math.max(0,p?.padding??10);switch(e.shape){case"rectangle":c=`<rect class="node-shape" ${h} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />`;break;case"round":{let N=Math.max(0,p?.cornerRadius??5);c=`<rect class="node-shape" ${h} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="${N}" ry="${N}" />`;break}case"stadium":let y=e.height/2;c=`<rect class="node-shape" ${h} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="${y}" ry="${y}" />`;break;case"circle":let O=Math.min(e.width,e.height)/2;c=`<circle class="node-shape" ${h} cx="${o}" cy="${a}" r="${O}" />`;break;case"diamond":{let N=[`${o},${s}`,`${i+e.width},${a}`,`${o},${s+e.height}`,`${i},${a}`].join(" ");c=`<polygon class="node-shape" ${h} points="${N}" />`;break}case"hexagon":{let N=e.width*.25,I=[`${i+N},${s}`,`${i+e.width-N},${s}`,`${i+e.width},${a}`,`${i+e.width-N},${s+e.height}`,`${i+N},${s+e.height}`,`${i},${a}`].join(" ");c=`<polygon class="node-shape" ${h} points="${I}" />`;break}case"parallelogram":{let N=e.width*.15,v=(p?.lean==="l"?[`${i},${s}`,`${i+e.width-N},${s}`,`${i+e.width},${s+e.height}`,`${i+N},${s+e.height}`]:[`${i+N},${s}`,`${i+e.width},${s}`,`${i+e.width-N},${s+e.height}`,`${i},${s+e.height}`]).join(" ");c=`<polygon class="node-shape" ${h} points="${v}" />`;break}case"trapezoid":{let N=e.width*.15,I=[`${i+N},${s}`,`${i+e.width-N},${s}`,`${i+e.width},${s+e.height}`,`${i},${s+e.height}`].join(" ");c=`<polygon class="node-shape" ${h} points="${I}" />`;break}case"trapezoidAlt":{let N=e.width*.15,I=[`${i},${s}`,`${i+e.width},${s}`,`${i+e.width-N},${s+e.height}`,`${i+N},${s+e.height}`].join(" ");c=`<polygon class="node-shape" ${h} points="${I}" />`;break}case"cylinder":{let N=Math.max(8,e.width/2),I=Math.max(6,Math.min(e.height*.22,e.width*.25)),v=s+I,w=s+e.height-I,M=Math.max(0,e.height-I*2),_=this.buildNodeStrokeStyle({stroke:l,strokeWidth:f});c=`<g>
          <rect class="node-shape" ${h} x="${i}" y="${v}" width="${e.width}" height="${M}" />
          <ellipse class="node-shape" ${h} cx="${o}" cy="${v}" rx="${e.width/2}" ry="${I}" />
          <path class="node-shape" ${_} d="M${i},${v} L${i},${w} A${e.width/2},${I} 0 0,0 ${i+e.width},${w} L${i+e.width},${v}" fill="none" />
        </g>`,u=v+M/2;break}case"subroutine":let L=5,b=this.buildNodeStrokeStyle({stroke:l,strokeWidth:f});c=`<g>
          <rect class="node-shape" ${h} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />
          <line class="node-shape" ${b} x1="${i+L}" y1="${s}" x2="${i+L}" y2="${s+e.height}" />
          <line class="node-shape" ${b} x1="${i+e.width-L}" y1="${s}" x2="${i+e.width-L}" y2="${s+e.height}" />
        </g>`;break;case"double":let C=4,k=this.buildNodeStrokeStyle({stroke:l,strokeWidth:f});c=`<g>
          <rect class="node-shape" ${h} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />
          <rect class="node-shape" ${k} x="${i+C}" y="${s+C}" width="${e.width-C*2}" height="${e.height-C*2}" rx="0" ry="0" fill="none" />
        </g>`;break;default:c=`<rect ${this.buildNodeStyleAttrs({stroke:l,strokeWidth:f,fill:d})} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />`}let m=this.generateWrappedText(e.label,o,u,e.width-x*2),g="";if(p?.media?.image){let y=Math.min(24,Math.max(12,e.height-10)),O=y,L=i+4,b=s+(e.height-O)/2;g=`<image xlink:href="${this.escapeXml(p.media.image)}" x="${L}" y="${b}" width="${y}" height="${O}" />`}let S=`<g id="${e.id}">
    ${c}
    ${g}
    ${m}
  </g>`,E=e.link;if(E&&E.href){let y=E.tooltip?`<title>${this.escapeXml(E.tooltip)}</title>`:"",O=E.target?` target="${this.escapeXml(E.target)}" rel="noopener noreferrer"`:"";return`<a xlink:href="${this.escapeXml(E.href)}"${O} class="node-link">${y}${S}</a>`}return E&&E.tooltip?`<g class="node-call">
<title>${this.escapeXml(E.tooltip)}</title>
${S}
</g>`:S}generateWrappedText(e,r,n,i){if(e.includes("<"))return this.generateRichText(e,r,n,i);let o=Math.floor(i/7);if(o<=0||e.length<=o){let p=this.fontSize*.35;return`<text class="node-label" x="${r}" y="${n+p}" text-anchor="middle">${this.escapeXml(e)}</text>`}let a=e.split(" "),c=[],u="";for(let p of a){let x=u?`${u} ${p}`:p;x.length>o&&u?(c.push(u),u=p):u=x}u&&c.push(u);let f=18,l=(c.length-1)*f,d=n-l/2+this.fontSize*.35;return`<text class="node-label">
    ${c.map((p,x)=>{let m=d+x*f;return`<tspan x="${r}" y="${m}" text-anchor="middle">${this.escapeXml(p)}</tspan>`}).join(`
    `)}
  </text>`}generateRichText(e,r,n,i){e=this.normalizeHtml(e);let s=[],o=/<\/?(br|b|strong|i|em|u)\s*\/?\s*>/gi,a=0,c={bold:!1,italic:!1,underline:!1},u=L=>{L&&s.push({text:this.htmlDecode(L),bold:c.bold,italic:c.italic,underline:c.underline})},f;for(;f=o.exec(e);){u(e.slice(a,f.index));let L=f[0].toLowerCase(),b=f[1].toLowerCase(),C=L.startsWith("</");b==="br"?s.push({text:"",br:!0}):b==="b"||b==="strong"?c.bold=!C:b==="i"||b==="em"?c.italic=!C:b==="u"&&(c.underline=!C),a=o.lastIndex}u(e.slice(a));let l=[],h=Math.max(1,Math.floor(i/7)),p=[],x=0,m=()=>{p.length&&(l.push(p),p=[],x=0)},g=L=>L.text?L.text.split(/(\s+)/).map(C=>({...L,text:C})):[L];for(let L of s){if(L.br){m();continue}for(let b of g(L)){let C=b.text.length;x+C>h&&x>0&&m(),p.push(b),x+=C}}m();let S=18,E=(l.length-1)*S,y=n-E/2+this.fontSize*.35,O=[];for(let L=0;L<l.length;L++){let b=y+L*S,C="",k=r,R=[],N="",I={bold:!1,italic:!1,underline:!1},v=()=>{if(!N)return;let w=`${I.bold?'font-weight="bold" ':""}${I.italic?'font-style="italic" ':""}${I.underline?'text-decoration="underline" ':""}`;R.push(`<tspan ${w}>${this.escapeXml(N)}</tspan>`),N=""};for(let w of l[L]){let M={bold:!!w.bold,italic:!!w.italic,underline:!!w.underline};(M.bold!==I.bold||M.italic!==I.italic||M.underline!==I.underline)&&(v(),I=M),N+=w.text}v(),O.push(`<tspan x="${r}" y="${b}" text-anchor="middle">${R.join("")}</tspan>`)}return`<text font-family="${this.fontFamily}" font-size="${this.fontSize}" fill="#333">${O.join(`
    `)}</text>`}normalizeHtml(e){return e.replace(/<\s+/g,"<").replace(/\s+>/g,">").replace(/<\s*\//g,"</").replace(/\s*\/\s*>/g,"/>").replace(/<\s*(br)\s*>/gi,"<$1/>")}htmlDecode(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`").replace(/&#123;/g,"{").replace(/&#125;/g,"}").replace(/&#40;/g,"(").replace(/&#41;/g,")")}generateEdge(e,r,n,i){if(!e.points||e.points.length<2)return{path:""};let s=e.points.map(G=>({x:G.x+r,y:G.y+n})),o=this.buildSmoothSegments(s),a="",c=1.5,u="",f="";switch(e.type){case"open":u="";break;case"dotted":a="3,3";break;case"thick":c=3;break;case"invisible":a="0,100000",u="";break}let l=e.markerStart,d=e.markerEnd,h=i[e.source],p=i[e.target],x=s[0],m=s[s.length-1];if(h&&s.length>=2){let G={start:s[0],segs:[{c1:s[1],c2:s[Math.max(0,s.length-2)],to:s[s.length-1]}]};x=this.intersectSegmentsStart(G,h).start}if(p&&s.length>=2){let G={start:s[0],segs:[{c1:s[1],c2:s[Math.max(0,s.length-2)],to:s[s.length-1]}]},se=this.intersectSegmentsEnd(G,p);m=se.segs.length?se.segs[se.segs.length-1].to:m}let g=[];g.push(`M${x.x},${x.y}`);let S=s.length>=2?s[1]:x;if(s.length>=2){let G=s[1].x-x.x,se=s[1].y-x.y,ut=Math.hypot(G,se)||1,Et=Math.min(22,Math.max(10,ut*.15));S={x:x.x+G/ut*Et,y:x.y+se/ut*Et},g.push(`L${S.x},${S.y}`)}let E=e.pathMode==="orthogonal";if(s.length>=4&&!E){let G=[s[0],...s,s[s.length-1]];for(let se=1;se<G.length-3;se++){let ut=G[se-1],Et=G[se],yt=G[se+1],Mt=G[se+2],Tr=Et.x+(yt.x-ut.x)/6,Or=Et.y+(yt.y-ut.y)/6,En=yt.x-(Mt.x-Et.x)/6,yn=yt.y-(Mt.y-Et.y)/6;g.push(`C${Tr},${Or} ${En},${yn} ${yt.x},${yt.y}`)}g.push(`L${m.x},${m.y}`)}else if(s.length===3&&!E){let G=x,se=s[1],ut=m,Et=m.x-se.x,yt=m.y-se.y,Mt=Math.hypot(Et,yt)||1,Tr=Math.min(20,Math.max(10,Mt*.15)),Or={x:m.x-Et/Mt*Tr,y:m.y-yt/Mt*Tr},En=S.x-x.x,yn=S.y-x.y,Hn=En===0&&yn===0?se.x-G.x:En,zn=En===0&&yn===0?se.y-G.y:yn,Vn=Math.hypot(Hn,zn)||1,hs=Math.min(40,Math.max(12,Vn*1.2)),Zo=S.x+Hn/Vn*hs,Jo=S.y+zn/Vn*hs,ea=(m.x-se.x)/Mt,ta=(m.y-se.y)/Mt,ra=Or.x-ea*(Tr*.6),na=Or.y-ta*(Tr*.6);g.push(`C${Zo},${Jo} ${ra},${na} ${Or.x},${Or.y}`),g.push(`L${m.x},${m.y}`)}else g.push(`L${m.x},${m.y}`);if(E){g.length=0,g.push(`M${x.x},${x.y}`);for(let G of s.slice(1,-1))g.push(`L${G.x},${G.y}`);g.push(`L${m.x},${m.y}`)}let O=`<path class="edge-path" d="${g.join(" ")}" stroke-linecap="round" stroke-linejoin="round"`,L=e.style?.stroke,b=e.style?.strokeWidth,C=e.style?.strokeOpacity;e.dasharray&&(a=String(e.dasharray));let k=e.animation;!a&&k&&(a="5 5"),a&&(O+=` stroke-dasharray="${a}"`),b!=null?O+=` stroke-width="${b}"`:c&&c!==1.5&&(O+=` stroke-width="${c}"`),C!=null&&(O+=` stroke-opacity="${C}"`),L&&(O+=` stroke="${L}"`);let R=k?` style="animation:${k}"`:"";if(O+=R+" />",e.label){let G=this.pointAtRatio(s,.55),se=this.escapeXml(e.label),ut=4,Et=this.fontSize-3,yt=Math.max(18,Math.min(220,se.length*6+ut*2)),Mt=14,Tr=G.x-yt/2,Or=G.y-Mt/2,En=`<rect class="edge-label-bg" x="${Tr}" y="${Or}" width="${yt}" height="${Mt}" rx="3" />`,yn=`<text class="edge-label-text" x="${G.x}" y="${G.y}" text-anchor="middle" dominant-baseline="middle">${se}</text>`,Hn="",zn=s.length>=2?s[s.length-2]:m,Vn=m.x-zn.x,hs=m.y-zn.y,Zo=Math.hypot(Vn,hs)||1,Jo=Vn/Zo,ea=hs/Zo,ta=-ea,ra=Jo,na=b??c,Qn=Math.max(6,Math.min(14,6+(na-1.5)*3)),Yn=Math.max(5,Math.min(12,5+(na-1.5)*2.5)),jX=m.x,WX=m.y,ip=m.x-Jo*Qn,sp=m.y-ea*Qn,HX=ip+ta*(Yn/2),zX=sp+ra*(Yn/2),VX=ip-ta*(Yn/2),QX=sp-ra*(Yn/2);if(Hn+=Vo(zn,m,L||this.arrowStroke,Qn,Yn),l==="arrow"&&s.length>=2){let au=s[1],op=x.x-au.x,ap=x.y-au.y,lp=Math.hypot(op,ap)||1,cp=op/lp,up=ap/lp,XX=-up,ZX=cp,JX=x.x-cp*Qn,e8=x.y-up*Qn;Hn+=Qo(x,au,L||this.arrowStroke,Qn,Yn)}return{path:`<g>
    ${O}
    ${En}
    ${yn}
    ${Hn}
  </g>`}}let N="",I=s.length>=2?s[s.length-2]:m,v=m.x-I.x,w=m.y-I.y,M=Math.hypot(v,w)||1,_=v/M,$=w/M,K=-$,J=_,ee=b??c,le=Math.max(6,Math.min(14,6+(ee-1.5)*3)),ae=Math.max(5,Math.min(12,5+(ee-1.5)*2.5)),tt=m.x,ct=m.y,Ce=m.x-_*le,bt=m.y-$*le,Me=Ce+K*(ae/2),rt=bt+J*(ae/2),Sr=Ce-K*(ae/2),nt=bt-J*(ae/2);if(d==="arrow"&&(N+=Vo(I,m,L||this.arrowStroke,le,ae)),l==="arrow"&&s.length>=2){let G=s[1],se=x.x-G.x,ut=x.y-G.y,Et=Math.hypot(se,ut)||1,yt=se/Et,Tr=-(ut/Et),Or=yt;N+=Qo(x,G,L||this.arrowStroke,le,ae)}let Nt=L||this.arrowStroke,jt=G=>`<circle cx="${G.x}" cy="${G.y}" r="4.5" fill="none" stroke="${Nt}" stroke-width="${ee}" />`,Rt=G=>`<g transform="translate(${G.x},${G.y})"><path d="M -4 -4 L 4 4" stroke="${Nt}" stroke-width="${ee}"/><path d="M -4 4 L 4 -4" stroke="${Nt}" stroke-width="${ee}"/></g>`;return d==="circle"&&(N+=jt(m)),d==="cross"&&(N+=Rt(m)),l==="circle"&&(N+=jt(x)),l==="cross"&&(N+=Rt(x)),N?{path:`<g>${O}
${N}</g>`}:{path:O}}buildSmoothSegments(e){if(e.length<2)return{start:e[0]||{x:0,y:0},segs:[]};if(e.length===2){let u=e[0],f=e[1],l={x:u.x+(f.x-u.x)/3,y:u.y+(f.y-u.y)/3},d={x:u.x+2*(f.x-u.x)/3,y:u.y+2*(f.y-u.y)/3};return{start:u,segs:[{c1:l,c2:d,to:f}]}}let r=[e[0],...e,e[e.length-1]],n=[],i=1,s=r.length-3,o=1,a=.35,c=28;for(let u=1;u<r.length-2;u++){let f=r[u-1],l=r[u],d=r[u+1],h=r[u+2],p=u===i?a:o,x=u===s?a:o,m={x:l.x+(d.x-f.x)/6*p,y:l.y+(d.y-f.y)/6*p},g={x:d.x-(h.x-l.x)/6*x,y:d.y-(h.y-l.y)/6*x};if(u===i){let S=d.x-l.x,E=d.y-l.y,y=Math.hypot(S,E)||1,O=Math.min(c,y*.5);m={x:l.x+S/y*O,y:l.y+E/y*O}}if(u===s){let S=d.x-l.x,E=d.y-l.y,y=Math.hypot(S,E)||1,O=Math.min(c,y*.5);g={x:d.x-S/y*O,y:d.y-E/y*O}}n.push({c1:m,c2:g,to:{x:d.x,y:d.y}})}return{start:r[1],segs:n}}pathFromSegments(e){let r=`M${e.start.x},${e.start.y}`;for(let n of e.segs)r+=` C${n.c1.x},${n.c1.y} ${n.c2.x},${n.c2.y} ${n.to.x},${n.to.y}`;return r}trimSegmentsEnd(e,r){let n=e.segs.slice();if(!n.length)return e;let i={...n[n.length-1]},s=i.to.x-i.c2.x,o=i.to.y-i.c2.y,a=Math.hypot(s,o)||1,c=Math.max(.1,Math.min(r,Math.max(0,a-.2))),u=s/a,f=o/a,l={x:i.to.x-u*c,y:i.to.y-f*c};return i.to=l,n[n.length-1]=i,{start:e.start,segs:n}}trimSegmentsStart(e,r){let n=e.segs.slice();if(!n.length)return e;let i={...n[0]},s=i.c1.x-e.start.x,o=i.c1.y-e.start.y,a=Math.hypot(s,o)||1,c=Math.max(.1,Math.min(r,Math.max(0,a-.2))),u=s/a,f=o/a;return{start:{x:e.start.x+u*c,y:e.start.y+f*c},segs:n}}intersectSegmentsEnd(e,r){if(!e.segs.length)return e;let n=e.segs[e.segs.length-1],i=n.c2,s=n.to,o=this.intersectLineWithNode(i,s,r);if(o){let a=e.segs.slice();return a[a.length-1]={...n,to:o},{start:e.start,segs:a}}return e}intersectSegmentsStart(e,r){if(!e.segs.length)return e;let n=e.segs[0],i=e.start,s=n.c1,o=this.intersectLineWithNode(i,s,r);return o?{start:o,segs:e.segs}:e}intersectLineWithNode(e,r,n){let i=n.shape,s=()=>[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];switch(i){case"round":{let o=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];return this.linePolygonIntersection(e,r,o)||this.nearestPointOnPolygon(r,o)}case"circle":{let o=n.x+n.width/2,a=n.y+n.height/2,c=Math.min(n.width,n.height)/2;return this.lineCircleIntersection(e,r,{cx:o,cy:a,r:c})}case"diamond":{let o=n.x+n.width/2,a=n.y+n.height/2,c=[{x:o,y:n.y},{x:n.x+n.width,y:a},{x:o,y:n.y+n.height},{x:n.x,y:a}];return this.linePolygonIntersection(e,r,c)||this.nearestPointOnPolygon(r,c)}case"hexagon":{let o=Math.max(10,n.width*.2),a=[{x:n.x+o,y:n.y},{x:n.x+n.width-o,y:n.y},{x:n.x+n.width,y:n.y+n.height/2},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x+o,y:n.y+n.height},{x:n.x,y:n.y+n.height/2}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"parallelogram":{let o=Math.min(n.width*.25,n.height*.6),a=[{x:n.x+o,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x,y:n.y+n.height}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"trapezoid":{let o=Math.min(n.width*.2,n.height*.5),a=[{x:n.x+o,y:n.y},{x:n.x+n.width-o,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"trapezoidAlt":{let o=Math.min(n.width*.2,n.height*.5),a=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x+o,y:n.y+n.height}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"stadium":{let o=Math.min(n.height/2,n.width/2),a=[{x:n.x+o,y:n.y},{x:n.x+n.width-o,y:n.y},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x+o,y:n.y+n.height}],c=this.linePolygonIntersection(e,r,a);if(c)return c;let u=this.lineCircleIntersection(e,r,{cx:n.x+o,cy:n.y+n.height/2,r:o}),f=this.lineCircleIntersection(e,r,{cx:n.x+n.width-o,cy:n.y+n.height/2,r:o});return((...h)=>{let p=null,x=-1/0;for(let m of h)if(m){let g=-((m.x-r.x)**2+(m.y-r.y)**2);g>x&&(x=g,p=m)}return p})(u,f)||this.nearestPointOnPolygon(r,a)}default:{let o=s();return this.linePolygonIntersection(e,r,o)||this.nearestPointOnPolygon(r,o)}}}lineCircleIntersection(e,r,n){let i=r.x-e.x,s=r.y-e.y,o=e.x-n.cx,a=e.y-n.cy,c=i*i+s*s,u=2*(o*i+a*s),f=o*o+a*a-n.r*n.r,l=u*u-4*c*f;if(l<0)return null;let d=Math.sqrt(l),h=(-u-d)/(2*c),p=(-u+d)/(2*c),x=[h,p].filter(g=>g>=0&&g<=1);if(!x.length)return null;let m=Math.max(...x);return{x:e.x+i*m,y:e.y+s*m}}linePolygonIntersection(e,r,n){let i=-1/0,s=null;for(let o=0;o<n.length;o++){let a=n[o],c=n[(o+1)%n.length],u=this.segmentIntersection(e,r,a,c);u&&u.t>=0&&u.t<=1&&u.u>=0&&u.u<=1&&u.t>i&&(i=u.t,s={x:u.x,y:u.y})}return s}nearestPointOnSegment(e,r,n){let i=n.x-r.x,s=n.y-r.y,o=i*i+s*s||1,a=e.x-r.x,c=e.y-r.y,u=(a*i+c*s)/o;return u=Math.max(0,Math.min(1,u)),{x:r.x+i*u,y:r.y+s*u}}nearestPointOnPolygon(e,r){let n=r[0],i=1/0;for(let s=0;s<r.length;s++){let o=r[s],a=r[(s+1)%r.length],c=this.nearestPointOnSegment(e,o,a),u=(c.x-e.x)*(c.x-e.x)+(c.y-e.y)*(c.y-e.y);u<i&&(i=u,n=c)}return{x:n.x,y:n.y}}segmentIntersection(e,r,n,i){let s={x:r.x-e.x,y:r.y-e.y},o={x:i.x-n.x,y:i.y-n.y},a=s.x*o.y-s.y*o.x;if(Math.abs(a)<1e-6)return null;let c={x:n.x-e.x,y:n.y-e.y},u=(c.x*o.y-c.y*o.x)/a,f=(c.x*s.y-c.y*s.x)/a,l=e.x+u*s.x,d=e.y+u*s.y;return{x:l,y:d,t:u,u:f}}pointAtRatio(e,r){let n=Math.max(0,Math.min(1,r)),i=0,s=[];for(let a=0;a<e.length-1;a++){let c=e[a+1].x-e[a].x,u=e[a+1].y-e[a].y,f=Math.hypot(c,u);s.push(f),i+=f}if(i===0)return e[Math.floor(e.length/2)];let o=i*n;for(let a=0;a<s.length;a++){if(o<=s[a]){let c=s[a]===0?0:o/s[a];return{x:e[a].x+(e[a+1].x-e[a].x)*c,y:e[a].y+(e[a+1].y-e[a].y)*c}}o-=s[a]}return e[e.length-1]}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};function $v(t){if(!t)return t;let e=t.charAt(0),r=t.charAt(t.length-1);return e==='"'&&r==='"'||e==="'"&&r==="'"?t.slice(1,-1).replace(/\\(["'])/g,"$1"):t}function Bv(t){let e=[],r=Fl(t);for(let o of r.errors)e.push({line:o.line??1,column:o.column??1,message:o.message,code:"PIE_LEX",severity:"error"});cr.reset(),cr.input=r.tokens;let n=cr.diagram();for(let o of cr.errors){let a=o.token;e.push({line:a?.startLine??1,column:a?.startColumn??1,message:o.message,code:"PIE_PARSE",severity:"error"})}let i={title:void 0,showData:!1,slices:[]};if(!n||!n.children)return{model:i,errors:e};n.children.ShowDataKeyword&&n.children.ShowDataKeyword.length>0&&(i.showData=!0);let s=n.children.statement??[];for(let o of s)if(o.children?.titleStmt){let a=o.children.titleStmt[0],c=[],u=l=>{let d=a.children?.[l]??[];for(let h of d)c.push($v(h.image))};u("QuotedString"),u("Text"),u("NumberLiteral");let f=c.join(" ").trim();f&&(i.title=f)}else if(o.children?.sliceStmt){let a=o.children.sliceStmt[0],c=a.children?.sliceLabel?.[0]?.children?.QuotedString?.[0],u=a.children?.NumberLiteral?.[0];if(c&&u){let f=$v(c.image).trim(),l=Number(u.image);Number.isNaN(l)||i.slices.push({label:f,value:l})}}return{model:i,errors:e}}function Jc(t,e,r,n){return{x:t+r*Math.cos(n),y:e+r*Math.sin(n)}}function Fv(t,e={}){let r=Math.max(320,Math.floor(e.width??640)),n=Math.max(240,Math.floor(e.height??400)),i=24,s=t.title?28:0,o=r/2,a=(n+s)/2+(t.title?8:0),c=Math.max(40,Math.min(r,n-s)/2-i),u=t.slices.filter(b=>Math.max(0,b.value)>0),f=u.reduce((b,C)=>b+Math.max(0,C.value),0),l=12,d=8,h=18,p=u.map(b=>`${b.label}${t.showData?` ${Jd(Number(b.value))}`:""}`),x=p.length?Math.max(...p.map(b=>lt(b,12))):0,m=p.length?l+d+x+i:0;if(p.length){let b=i+c*2+m+i;b>r&&(r=Math.ceil(b))}let g=c;p.length&&(o=Math.max(i,(r-m-g*2)/2)+g);let S=-Math.PI/2,E=`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${n}" viewBox="0 0 ${r} ${n}">`;E+=`
  <style>
    .pie-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: 600; fill: #222; }
    .slice-label { font-family: Arial, sans-serif; font-size: 12px; fill: #222; dominant-baseline: middle; }
    .leader { stroke: #444; stroke-width: 1; fill: none; }
    .pieCircle { stroke: black; stroke-width: 2px; opacity: 0.7; }
    .pieOuterCircle { stroke: black; stroke-width: 2px; fill: none; }
  </style>`,t.title&&(E+=`
  <text class="pie-title" x="${o}" y="${i+8}" text-anchor="middle">${Re(t.title)}</text>`),E+=`
  <g class="pie" aria-label="pie">`;let y=.35;u.forEach((b,C)=>{let k=f>0?Math.max(0,b.value)/f:0,R=2*Math.PI*k,N=S+R,I=R>Math.PI?1:0,v=Jc(o,a,g,S),w=Jc(o,a,g,N),M=[`M ${o} ${a}`,`L ${v.x.toFixed(2)} ${v.y.toFixed(2)}`,`A ${g} ${g} 0 ${I} 1 ${w.x.toFixed(2)} ${w.y.toFixed(2)}`,"Z"].join(" "),_=b.color||Zd(C);E+=`
    <path d="${M}" class="pieCircle" fill="${_}" />`;let $=(S+N)/2,K=Math.cos($),J=Math.sin($),ee=Re(Dv(b.value,f));if(R<y){let le=g*.9,ae=g*1.06,tt=Jc(o,a,le,$),ct=Jc(o,a,ae,$),Ce=12,bt=K<0,Me=bt?ct.x-Ce:ct.x+Ce,rt=ct.y;E+=`
    <path class="leader" d="M ${tt.x.toFixed(2)} ${tt.y.toFixed(2)} L ${ct.x.toFixed(2)} ${ct.y.toFixed(2)} L ${Me.toFixed(2)} ${rt.toFixed(2)}" />`;let Sr=bt?Me-2:Me+2,nt=bt?"end":"start";E+=`
    <text class="slice-label" x="${Sr.toFixed(2)}" y="${rt.toFixed(2)}" text-anchor="${nt}">${ee}</text>`}else{let le=g*.62,ae={x:o+le*K,y:a+le*J},tt=Math.abs(K)<.2?"middle":K>0?"start":"end",ct=le,bt=lt(ee,12)>ct*1.2?"middle":tt;E+=`
    <text class="slice-label" x="${ae.x.toFixed(2)}" y="${ae.y.toFixed(2)}" text-anchor="${bt}">${ee}</text>`}S=N});let O=e.rimStroke||"black",L=e.rimStrokeWidth!=null?String(e.rimStrokeWidth):"2px";if(E+=`
  </g>
  <circle class="pie-rim pieOuterCircle" cx="${o}" cy="${a}" r="${g}" stroke="${O}" stroke-width="${L}" fill="none" />`,p.length){let b=o+g+i/2,C=p.length*h,k=a-C/2+10;E+=`
  <g class="legend">`,u.forEach((R,N)=>{let I=k+N*h,v=R.color||Zd(N),w=Re(`${R.label}${t.showData?` ${Jd(Number(R.value))}`:""}`);E+=`
    <rect x="${b}" y="${I-l+6}" width="${l}" height="${l}" fill="${v}" stroke="${v}" stroke-width="1" />`,E+=`
    <text class="slice-label legend-text" x="${b+l+d}" y="${I}" text-anchor="start">${w}</text>`}),E+=`
  </g>`}return E+=`
</svg>`,E}function Kv(t){if(!t||t.length===0)return"";let e=[];for(let r of t){let n=r.image??"";r.tokenType?.name==="QuotedString"&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?e.push(n.slice(1,-1)):e.push(n)}return e.join(" ").replace(/\s+/g," ").trim()}function Gt(t){if(!t)return"";let e=t.children||{},r=[];return["Identifier","QuotedString","NumberLiteral","Text"].forEach(n=>{e[n]?.forEach(s=>r.push(s))}),r.sort((n,i)=>(n.startOffset??0)-(i.startOffset??0)),Kv(r)}function Wn(t){if(!t)return;let e=t.children||{},r=[],n=["Identifier","NumberLiteral","QuotedString","Text","Plus","Minus","Comma","Colon","LParen","RParen"];for(let s of n)e[s]?.forEach(o=>r.push(o));return r.sort((s,o)=>(s.startOffset??0)-(o.startOffset??0)),Kv(r)||void 0}function Gv(t){return t.trim().replace(/\s+/g,"_")}function xr(t,e,r,n){let i=Gv(r),s=t.get(i)||(e.get(r)?t.get(e.get(r)):void 0);if(s)return s;let o={id:i,display:n||r};return t.set(o.id,o),e.set(o.display,o.id),o}function AX(t){let e=t.children||{};return e.BidirAsyncDotted?{line:"dotted",start:"arrow",end:"arrow",async:!0}:e.BidirAsync?{line:"solid",start:"arrow",end:"arrow",async:!0}:e.DottedAsync?{line:"dotted",start:"none",end:"arrow",async:!0}:e.Async?{line:"solid",start:"none",end:"arrow",async:!0}:e.Dotted?{line:"dotted",start:"none",end:"arrow"}:e.Solid?{line:"solid",start:"none",end:"arrow"}:e.DottedCross?{line:"dotted",start:"none",end:"cross"}:e.Cross?{line:"solid",start:"none",end:"cross"}:e.DottedOpen?{line:"dotted",start:"none",end:"open"}:e.Open?{line:"solid",start:"none",end:"open"}:{line:"solid",start:"none",end:"arrow"}}function jv(t){let{tokens:e}=sc(t);on.input=e;let r=on.diagram(),n=new Map,i=new Map,s=[],o={on:!1},a,c,u,l=(r.children||{}).line||[],d=[];function h(x){let m=x.children||{};if(m.metaStmt){let y=m.metaStmt[0].children||{},O=Wn(y.lineRemainder?.[0])||"";y.TitleKeyword&&(a=O),y.AccTitleKeyword&&(c=O),y.AccDescrKeyword&&(u=O);return}if(m.participantDecl){let y=m.participantDecl[0].children||{},O=y.actorRef?.[0],L=y.actorRef?.[1],b=Gt(O),C=L?Gt(L):void 0,k=Gv(b),N=xr(n,i,k,C||b);s.push({kind:"create",actor:N.id,display:N.display});return}if(m.autonumberStmt){let y=m.autonumberStmt[0].children||{};o={on:!0};let O=y.NumberLiteral||[];O.length>=1&&(o.start=Number(O[0].image)),O.length>=2&&(o.step=Number(O[1].image)),y.OffKeyword&&(o={on:!1});return}if(m.activateStmt){let y=m.activateStmt[0].children||{},O=Gt(y.actorRef?.[0]),L=xr(n,i,O);s.push({kind:"activate",actor:L.id});return}if(m.deactivateStmt){let y=m.deactivateStmt[0].children||{},O=Gt(y.actorRef?.[0]),L=xr(n,i,O);s.push({kind:"deactivate",actor:L.id});return}if(m.createStmt){let y=m.createStmt[0].children||{},O=Gt(y.actorRef?.[0]),L=y.lineRemainder?Wn(y.lineRemainder[0]):void 0,b=xr(n,i,O,L||O);s.push({kind:"create",actor:b.id,display:b.display});return}if(m.destroyStmt){let y=m.destroyStmt[0].children||{},O=Gt(y.actorRef?.[0]),L=xr(n,i,O);s.push({kind:"destroy",actor:L.id});return}if(m.noteStmt){let y=m.noteStmt[0].children||{},O=Wn(y.lineRemainder?.[0])||"";if(y.LeftKeyword||y.RightKeyword){let L=y.LeftKeyword?"leftOf":"rightOf",b=Gt(y.actorRef?.[0]),C=xr(n,i,b),k={pos:L,actors:[C.id],text:O};s.push({kind:"note",note:k})}else if(y.OverKeyword){let L=Gt(y.actorRef?.[0]),b=y.actorRef?.[1]?Gt(y.actorRef?.[1]):void 0,k=[xr(n,i,L).id];if(b){let R=xr(n,i,b);k.push(R.id)}s.push({kind:"note",note:{pos:"over",actors:k,text:O}})}return}let g=[{key:"altBlock",type:"alt",branchKeys:[{key:"ElseKeyword",kind:"else"}]},{key:"optBlock",type:"opt"},{key:"loopBlock",type:"loop"},{key:"parBlock",type:"par",branchKeys:[{key:"AndKeyword",kind:"and"}]},{key:"criticalBlock",type:"critical",branchKeys:[{key:"OptionKeyword",kind:"option"}]},{key:"breakBlock",type:"break"},{key:"rectBlock",type:"rect"},{key:"boxBlock",type:"box"}],S=!1;for(let E of g)if(m[E.key]){S=!0;let O=m[E.key][0].children||{},L=Wn(O.lineRemainder?.[0]),b={type:E.type,title:L,branches:E.branchKeys?[]:void 0};if(d.push(b),s.push({kind:"block-start",block:b}),E.branchKeys){let C=O.Newline||[],k=E.branchKeys[0].key,R=O[k],N=O.lineRemainder;if(R&&R.length){let I=(N||[]).slice(1);for(let v=0;v<R.length;v++){let w=I[v]?Wn(I[v]):void 0,M={kind:E.branchKeys[0].kind,title:w};b.branches.push(M),s.push({kind:"block-branch",block:b,branch:M})}}}s.push({kind:"block-end",block:b}),d.pop();break}if(!S){if(m.messageStmt){let y=m.messageStmt[0].children||{},O=Gt(y.actorRef?.[0]),L=Gt(y.actorRef?.[1]),b=xr(n,i,O).id,C=xr(n,i,L).id,k=AX(y.arrow?.[0]),R=Wn(y.lineRemainder?.[0]),N=!!y.Plus,I=!!y.Minus,v={from:b,to:C,text:R,line:k.line,startMarker:k.start,endMarker:k.end,async:k.async,activateTarget:N,deactivateTarget:I};s.push({kind:"message",msg:v});return}if(m.linkStmt){s.push({kind:"noop"});return}s.push({kind:"noop"})}}function p(x){let m=[],g=x.children||{};for(let S of Object.keys(g)){let E=g[S];if(Array.isArray(E))for(let y of E)y&&typeof y=="object"&&y.name==="line"&&m.push(y)}return m}for(let x of l){h(x);let m=x.children||{},g=m.altBlock?.[0]||m.optBlock?.[0]||m.loopBlock?.[0]||m.parBlock?.[0]||m.criticalBlock?.[0]||m.breakBlock?.[0]||m.rectBlock?.[0]||m.boxBlock?.[0];if(g)for(let S of p(g))h(S)}return{participants:Array.from(n.values()),events:s,autonumber:o.on===!0||o.on===!1?o:{on:!1},title:a,accTitle:c,accDescr:u}}var ep=24,eu=24,bX=16,tu=30,NX=4,kX=12,CX=110,Er=36,tp=160,xn=8,ru=12,vX=12;function Wv(t){let e=[],r=new Set,n=new Map(t.participants.map(N=>[N.id,N]));function i(N){r.has(N)||(r.add(N),e.push(N))}for(let N of t.events)N.kind==="message"&&(i(N.msg.from),i(N.msg.to)),N.kind==="note"&&N.note.actors.forEach(i),(N.kind==="activate"||N.kind==="deactivate"||N.kind==="create"||N.kind==="destroy")&&i(N.actor);for(let N of t.participants)i(N.id);let s=[],o=ep;for(let N of e){let I=n.get(N)||{id:N,display:N},v=Math.max(CX,lt(I.display,bX)+kX*2);s.push({id:N,display:I.display,x:o,y:eu,width:v,height:tu}),o+=v+ep}let a=Math.max(320,o),c=new Map,u=0,f=[];function l(N){c.set(N,u++)}t.events.forEach((N,I)=>{switch(N.kind){case"message":l(I);break;case"note":l(I);break;case"block-start":f.push({block:N.block,startRow:u,branches:[]}),l(I);break;case"block-branch":{let v=f[f.length-1];v&&v.branches.push({title:N.branch.title,row:u}),l(I);break}case"block-end":break;case"activate":case"deactivate":case"create":case"destroy":case"noop":break}});let d=eu+tu+NX,h=u*Er,p=d+h+eu+tu,x=s.map(N=>({x:N.x+N.width/2,y1:d,y2:p-eu-tu}));function m(N){return d+N*Er+Er/2}let g=new Map(s.map(N=>[N.id,N])),S=[],E=[],y=[],O=[],L=new Map,b=(N,I)=>{let v=L.get(N)||[];v.push(I),L.set(N,v)},C=(N,I)=>{let v=L.get(N)||[],w=v.pop();if(w!=null){let M=g.get(N);M&&O.push({actor:N,x:M.x+M.width/2-3,y:m(w)-Er/2,width:6,height:m(I)-m(w)})}L.set(N,v)},k=[];t.events.forEach((N,I)=>{let v=c.has(I)?c.get(I):null;switch(N.kind){case"message":{let w=g.get(N.msg.from),M=g.get(N.msg.to);if(w&&M&&v!=null){let _=m(v),$=w.x+w.width/2,K=M.x+M.width/2;S.push({from:w.id,to:M.id,text:N.msg.text,y:_,x1:$,x2:K,line:N.msg.line,startMarker:N.msg.startMarker,endMarker:N.msg.endMarker,async:N.msg.async}),N.msg.activateTarget&&b(N.msg.to,v),N.msg.deactivateTarget&&C(N.msg.to,v);let J=k[k.length-1];J&&(J.lastRow=v)}break}case"note":{if(v==null)break;let w=($,K)=>{let J=Math.max(8,Math.floor((K-xn*2)/7)),ee=$?$.length:0;return Math.max(1,Math.ceil(ee/J))},M=m(v)-xn;if(N.note.pos==="over"){let[$,K]=N.note.actors,J=g.get($),ee=K?g.get(K):J;if(J&&ee){let le=Math.min(J.x+J.width/2,ee.x+ee.width/2),tt=Math.max(J.x+J.width/2,ee.x+ee.width/2)-le+xn*2,ct=w(N.note.text,tt),Ce=Math.max(Er-xn,ct*16+xn);E.push({x:le-xn,y:M,width:tt,height:Ce,text:N.note.text,anchor:"over"})}}else{let $=N.note.actors[0],K=g.get($);if(K){let J=N.note.pos==="leftOf",ee=J?K.x-tp-10:K.x+K.width+10,le=w(N.note.text,tp),ae=Math.max(Er-xn,le*16+xn);E.push({x:ee,y:M,width:tp,height:ae,text:N.note.text,anchor:J?"left":"right"})}}let _=k[k.length-1];_&&v!=null&&(_.lastRow=v);break}case"activate":v!=null&&b(N.actor,v);break;case"deactivate":v!=null&&C(N.actor,v);break;case"block-start":{let w=v??u;k.push({block:N.block,startRow:w,branches:[]});break}case"block-branch":{let w=k[k.length-1];w&&v!=null&&(w.branches.push({title:N.branch.title,row:v}),w.lastRow=v);break}case"block-end":{let w=k.pop();if(w){let M=s.length>0?s[0]:void 0,_=s.length>0?s[s.length-1]:void 0,$=M?M.x:ep,K=_?_.x+_.width:$+200,J=m(w.startRow)-Er/2-(ru+vX),ee=w.lastRow!=null?w.lastRow:w.startRow,le=m(ee)+Er/2+ru,ae={type:w.block.type,title:w.block.title,x:$-ru,y:J,width:K-$+ru*2,height:le-J};w.branches.length&&(ae.branches=w.branches.map(tt=>({title:tt.title,y:m(tt.row)-Er/2}))),y.push(ae)}break}default:break}});let R=u;for(let[N,I]of L.entries())for(;I.length;){let v=I.pop(),w=g.get(N);w&&O.push({actor:N,x:w.x+w.width/2-3,y:m(v)-Er/2,width:6,height:m(R)-m(v)})}return{width:a,height:p,participants:s,lifelines:x,messages:S,notes:E,blocks:y,activations:O}}function Hv(t,e={}){let r=Wv(t),n=[],i=Math.ceil(r.width),s=Math.ceil(r.height);n.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${i+50}" height="${s+40}" viewBox="-50 -10 ${i+50} ${s+40}">`);let o=gn({fontFamily:"Arial, sans-serif",fontSize:14,nodeFill:"#eef0ff",nodeStroke:"#3f3f3f",edgeStroke:"#555555"});n.push(`  <style>${o}</style>`);let a=t.accTitle||t.title||void 0,c=t.accDescr||void 0;if(a&&n.push(`  <title>${Re(a)}</title>`),c&&n.push(`  <desc>${Re(c)}</desc>`),t.title){let d=Re(t.title),h=Math.max(20,lt(t.title,16)),p=i/2;n.push(`  <text class="node-label" x="${p}" y="0" text-anchor="middle" font-size="16">${d}</text>`)}for(let d of r.participants)IX(n,d);for(let d of r.blocks)n.push(Xc(d.x,d.y,d.width,d.height,0));for(let d of r.lifelines)n.push(`  <line class="lifeline" x1="${d.x}" y1="${d.y1}" x2="${d.x}" y2="${d.y2}"/>`);for(let d of r.activations)n.push(`  <rect class="activation" x="${d.x}" y="${d.y}" width="${d.width}" height="${d.height}" />`);let u=t.autonumber?.on?t.autonumber.start??1:void 0,f=t.autonumber?.on?t.autonumber.step??1:void 0;for(let d of r.messages){RX(n,d);let h=MX(d.text,u);h&&UX(n,d,h,u),u!=null&&(u+=f)}for(let d of r.notes)_X(n,d);for(let d of r.blocks){let h=d.title?`${d.type}: ${d.title}`:d.type,p=(d.branches||[]).map(x=>({y:x.y,title:x.title}));n.push(Zc(d.x,d.y,d.width,d.height,h,p.map(x=>({...x,y:x.y+.5})),8,"left","left",0))}for(let d of r.participants)wX(n,d,r);n.push("</svg>");let l=n.join(`
`);return e.theme&&(l=PX(Yo(l,e.theme),e.theme)),l}function IX(t,e){t.push(`  <g class="actor" transform="translate(${e.x},${e.y})">`),t.push(`    <rect class="node-shape" width="${e.width}" height="${e.height}" rx="0"/>`),t.push(`    <text class="node-label" x="${e.width/2}" y="${e.height/2}" text-anchor="middle" dominant-baseline="middle">${Re(e.display)}</text>`),t.push("  </g>")}function wX(t,e,r){let n=r.lifelines.find(s=>Math.abs(s.x-(e.x+e.width/2))<.001),i=n?n.y2:r.height-28;t.push(`  <g class="actor" transform="translate(${e.x},${i})">`),t.push(`    <rect class="node-shape" width="${e.width}" height="${e.height}" rx="0"/>`),t.push(`    <text class="node-label" x="${e.width/2}" y="${e.height/2}" text-anchor="middle" dominant-baseline="middle">${Re(e.display)}</text>`),t.push("  </g>")}function RX(t,e){let r=`msg-line ${e.line}`.trim(),n=e.x1,i=e.x2,s=e.y;t.push(`  <path class="${r}" d="M ${n} ${s} L ${i} ${s}" />`);let o={x:n,y:s},a={x:i,y:s};e.endMarker==="arrow"&&t.push("  "+Vo(o,a,void 0,9,7)),e.startMarker==="arrow"&&t.push("  "+Qo(o,a,void 0,9,7)),e.endMarker==="open"&&t.push(`  <circle class="openhead" cx="${i}" cy="${s}" r="4" />`),e.startMarker==="open"&&t.push(`  <circle class="openhead" cx="${n}" cy="${s}" r="4" />`),e.endMarker==="cross"&&t.push(`  <g class="crosshead" transform="translate(${i},${s})"><path d="M -4 -4 L 4 4"/><path d="M -4 4 L 4 -4"/></g>`),e.startMarker==="cross"&&t.push(`  <g class="crosshead" transform="translate(${n},${s})"><path d="M -4 -4 L 4 4"/><path d="M -4 4 L 4 -4"/></g>`)}function MX(t,e){if(!(!t&&e==null))return e!=null&&t?`${e}: ${t}`:e!=null?String(e):t}function UX(t,e,r,n){let i=(e.x1+e.x2)/2,s=16,o=Math.max(20,lt(r,12)+10),a=i-o/2,c=e.y-14-s/2;t.push(`  <rect class="msg-label-bg" x="${a}" y="${c}" width="${o}" height="${s}" rx="3"/>`),t.push(`  <text class="msg-label" x="${i}" y="${c+s/2}" text-anchor="middle">${Re(r)}</text>`)}function _X(t,e){t.push(`  <g class="note" transform="translate(${e.x},${e.y})">`),t.push(`    <rect width="${e.width}" height="${e.height}" rx="0"/>`),t.push(`    <text class="note-text" x="${e.width/2}" y="${e.height/2+4}" text-anchor="middle">${Re(e.text)}</text>`),t.push("  </g>")}function PX(t,e){let r=t;return e.lifelineColor&&(r=r.replace(/\.lifeline\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lifelineColor)};`))),e.lineColor&&(r=r.replace(/\.msg-line\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lineColor)};`))),e.arrowheadColor&&(r=r.replace(/(<path d=\"M[0-9.,\s-]+Z\" fill=\")[^\"]+(\")/g,(n,i,s)=>`${i}${String(e.arrowheadColor)}${s}`),r=r.replace(/\.openhead\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`)),r=r.replace(/\.crosshead\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`))),e.noteBkg&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteBkg)};`))),e.noteBorder&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.noteBorder)};`))),e.noteTextColor&&(r=r.replace(/\.note-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteTextColor)};`))),e.activationBkg&&(r=r.replace(/\.activation\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.activationBkg)};`))),e.activationBorder&&(r=r.replace(/\.activation\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.activationBorder)};`))),r}function nu(t){if(!t||t.length===0)return"";let e=[];for(let r of t){let n=r.image??"";r.tokenType&&r.tokenType.name==="QuotedString"&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?e.push(n.slice(1,-1)):e.push(n)}return e.join(" ").replace(/\s+/g," ").trim()}function rp(t,e={}){if(!t)return{id:"",kind:"simple"};let r=t.children||{};if(r.Start){let a=e.isTarget?"end":"start";return{id:`__${a}_${r.Start[0].startOffset??0}`,kind:a}}if(r.HistoryDeep)return{id:`__histdeep_${r.HistoryDeep[0].startOffset??0}`,label:"H*",kind:"history-deep"};if(r.HistoryShallow)return{id:`__hist_${r.HistoryShallow[0].startOffset??0}`,label:"H",kind:"history"};let n;if(r.AngleAngleOpen&&r.Identifier&&r.AngleAngleClose){let a=String(r.Identifier[0].image).toLowerCase();a==="choice"?n="choice":a==="fork"?n="fork":a==="join"&&(n="join")}let i=[];r.Identifier?.forEach(a=>i.push(a)),r.QuotedString?.forEach(a=>i.push(a)),i.sort((a,c)=>(a.startOffset??0)-(c.startOffset??0));let s=nu(i)||"";return{id:s.trim().replace(/\s+/g,"_"),label:s,kind:n||"simple"}}function zv(t){let{tokens:e}=xc(t);Xi.input=e;let r=Xi.diagram(),n="TD",i=new Map,s=[],o=[],a=[],c=[],f=(r.children||{}).statement||[];function l(h){let p=i.get(h.id);if(p)return p;i.set(h.id,h);let x=c[c.length-1];if(x){let m=x.id,g=`${m}__lane${x.lane}`,S=o.find(y=>y.id===g);S||(o.find(y=>y.id===m)||o.push({id:m,label:m,nodes:[],parent:c.length>1?c[c.length-2].id:void 0}),o.push({id:g,label:void 0,nodes:[],parent:m}),a.push({parentId:m,id:g,nodes:[]})),S=o.find(y=>y.id===g),S.nodes.includes(h.id)||S.nodes.push(h.id);let E=a.find(y=>y.id===g);E&&!E.nodes.includes(h.id)&&E.nodes.push(h.id),h.parent=g}return h}function d(h){let p=h.children||{};if(p.directionStmt){n=p.directionStmt[0].children.Direction?.[0]?.image||"TD";return}if(p.stateDecl){let m=p.stateDecl[0].children||{};if(m.QuotedString&&m.AsKw&&m.Identifier){let g=m.QuotedString[0].image.slice(1,-1),S=m.Identifier[0].image;l({id:S,label:g,kind:"simple"})}else if(m.Identifier){let g=m.Identifier[0].image;l({id:g,label:g,kind:"simple"})}return}if(p.stateBlock){let x=p.stateBlock[0],m=x.children||{},g=m.Identifier?.[0]||m.QuotedString?.[0],S=g?g.image.startsWith('"')?g.image.slice(1,-1):g.image:`__state_${x.location??Math.random()}`,E=S.replace(/\s+/g,"_");l({id:E,label:S,kind:"composite"}),o.find(O=>O.id===E)||o.push({id:E,label:S,nodes:[],parent:c.length?c[c.length-1].id:void 0}),c.push({id:E,lane:0});let y=m.innerStatement||[];for(let O of y)d(O);c.pop();return}if(p.transitionStmt){let m=p.transitionStmt[0].children||{},g=rp(m.actorRef?.[0],{isTarget:!1}),S=rp(m.actorRef?.[1],{isTarget:!0});g.id&&l({id:g.id,label:g.label||g.id,kind:g.kind}),S.id&&l({id:S.id,label:S.label||S.id,kind:S.kind});let E;if(m.Colon&&m.labelText){let y=[];m.labelText.forEach(O=>{let L=O.children||{};["QuotedString","Identifier","NumberLiteral","LabelChunk"].forEach(b=>L[b]?.forEach(C=>y.push(C)))}),y.sort((O,L)=>(O.startOffset??0)-(L.startOffset??0)),E=nu(y)}g.id&&S.id&&s.push({source:g.id,target:S.id,label:E});return}if(h.name==="innerStatement"){let x=h.children||{};if(x.Dashes&&x.Dashes.length&&c.length){c[c.length-1].lane+=1;return}}if(p.noteStmt){let x=p.noteStmt[0],m=x.children||{},g=[],S=m.actorRef?.[0],E=rp(S);["QuotedString","Identifier","NumberLiteral","LabelChunk"].forEach(O=>m[O]?.forEach(L=>g.push(L)));let y=nu(g);if(E.id&&y){let O=`__note_${(x.location??Math.random()).toString().slice(2)}`;l({id:O,label:y,kind:"simple"}),l({id:E.id,label:E.label||E.id,kind:E.kind}),s.push({source:O,target:E.id,label:void 0})}return}if(p.stateDescriptionStmt){let m=p.stateDescriptionStmt[0].children||{},g=m.Identifier?.[0]||m.QuotedString?.[0];if(g){let S=g.image.startsWith('"')?g.image.slice(1,-1):g.image,E=S.replace(/\s+/g,"_"),y=[];["QuotedString","Identifier","NumberLiteral","LabelChunk"].forEach(L=>m[L]?.forEach(b=>y.push(b)));let O=nu(y);l({id:E,label:O||S,kind:"simple"})}return}for(let x of Object.keys(p)){let m=p[x];Array.isArray(m)&&m.forEach(g=>d(g))}}for(let h of f)d(h);return{direction:n,nodes:Array.from(i.values()),transitions:s,composites:o,lanes:a}}function qX(t){let e=[],r=[],n=[];for(let s of t.nodes){let o="rectangle",a=s.label||s.id;s.kind==="start"||s.kind==="end"?(o="circle",a=""):s.kind==="history"?(o="circle",a="H"):s.kind==="history-deep"?(o="circle",a="H*"):s.kind==="choice"?o="diamond":(s.kind==="fork"||s.kind==="join")&&(o="rectangle");let c={id:s.id,label:a,shape:o};(s.kind==="fork"||s.kind==="join")&&(c.width=80,c.height=8),e.push(c)}for(let s of t.transitions)r.push({id:`${s.source}->${s.target}-${Math.random().toString(36).slice(2,7)}`,source:s.source,target:s.target,label:s.label,type:"arrow",markerEnd:"arrow"});for(let s of t.composites)n.push({id:s.id,label:s.label,nodes:s.nodes,parent:s.parent});let i=(t.lanes||[]).slice();return{graph:{nodes:e,edges:r,subgraphs:n,direction:t.direction},laneGroups:i}}function Vv(t){var e;let{graph:r,laneGroups:n}=qX(t),i=new Pr().layout(r),s=new jn().render(i),o=Object.fromEntries(i.nodes.map(l=>[l.id,{x:l.x,y:l.y,width:l.width,height:l.height}])),a=Object.fromEntries((i.subgraphs||[]).map(l=>[l.id,{x:l.x,y:l.y,width:l.width,height:l.height,label:l.label}])),c=[],u={};for(let l of n){if(!a[l.parentId])continue;let h=l.nodes.map(p=>o[p]).filter(Boolean);h.length&&(u[e=l.parentId]||(u[e]=[])).push({id:l.id,nodes:h})}let f=l=>{let d=/(.*)__lane(\d+)/.exec(l);return d?parseInt(d[2],10):Number.POSITIVE_INFINITY};for(let l of Object.keys(u)){let d=a[l];if(!d)continue;let h=u[l].slice();h.every(p=>/__lane\d+/.test(p.id))?h.sort((p,x)=>f(p.id)-f(x.id)):r.direction==="LR"||r.direction==="RL"?h.sort((p,x)=>Math.min(...p.nodes.map(m=>m.x))-Math.min(...x.nodes.map(m=>m.x))):h.sort((p,x)=>Math.min(...p.nodes.map(m=>m.y))-Math.min(...x.nodes.map(m=>m.y)));for(let p=1;p<h.length;p++){let x=h[p-1],m=h[p];if(r.direction==="LR"||r.direction==="RL"){let g=Math.max(...x.nodes.map(y=>y.x+y.width)),S=Math.min(...m.nodes.map(y=>y.x)),E=Math.max(d.x,Math.min(d.x+d.width,(g+S)/2));c.push(`<line class="lane-divider" x1="${E}" y1="${d.y+14}" x2="${E}" y2="${d.y+d.height}" />`)}else{let g=Math.max(...x.nodes.map(y=>y.y+y.height)),S=Math.min(...m.nodes.map(y=>y.y)),E=Math.max(d.y+14,Math.min(d.y+d.height,(g+S)/2));c.push(`<line class="lane-divider" x1="${d.x}" y1="${E}" x2="${d.x+d.width}" y2="${E}" />`)}}}for(let l of i.nodes){let d=(t.nodes||[]).find(m=>m.id===l.id);if(!d||d.kind!=="end")continue;let h=l.x+l.width/2,p=l.y+l.height/2,x=Math.max(1,Math.min(l.width,l.height)/2-3);c.push(`<circle class="end-double" cx="${h}" cy="${p}" r="${x}" fill="none" />`)}if(c.length&&(s=s.replace("</svg>",`<g class="state-overlays">${c.join(`
`)}</g></svg>`)),!/<style>/.test(s)){let l=gn();s=s.replace("<svg ","<svg ").replace("</svg>",`<style>${l}</style></svg>`)}return s}function Yv(t){let r=(t.startsWith("\uFEFF")?t.slice(1):t).split(/\r?\n/);if(r.length<3||r[0].trim()!=="---")return null;let n=1,i=[];for(;n<r.length&&r[n].trim()!=="---";)i.push(r[n]),n++;if(n>=r.length)return null;let s=r.slice(n+1).join(`
`),o=i.join(`
`),a={},c={},u=!1,f="root";for(let l of i){if(!l.trim())continue;let d=l.match(/^\s*/)?.[0].length??0,h=l.match(/^\s*([A-Za-z0-9_\-]+):\s*(.*)$/);if(!h)continue;let p=h[1],x=h[2]||"";if(d===0){if(p==="config"){f="config";continue}if(p==="themeVariables"){f="theme";continue}f="root";continue}if(f==="config"){if(d<=2&&p!=="pie"&&p!=="themeVariables")continue;if(p==="pie"){f="config.pie",np(a,"pie",{});continue}if(p==="themeVariables"){f="theme",u=!0;continue}continue}if(f==="config.pie"){if(d<4){if(p==="pie"){f="config.pie",np(a,"pie",{});continue}if(p==="themeVariables"){f="theme",u=!0;continue}f="config";continue}Qv(a.pie,p,x);continue}if(f==="theme"){if(d<2){f="root";continue}Qv(c,p,x);continue}}return u&&Object.keys(c).length&&(np(a,"themeVariables",{}),Object.assign(a.themeVariables,c)),{raw:o,body:s,config:Object.keys(a).length?a:void 0,themeVariables:Object.keys(c).length?c:void 0}}function np(t,e,r){t[e]==null&&(t[e]=r)}function DX(t){let e=t.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function Qv(t,e,r){let n=DX(r);if(n===""){t[e]="";return}let i=Number(n);if(!Number.isNaN(i)&&/^-?[0-9]+(\.[0-9]+)?$/.test(n)){t[e]=i;return}if(/^(true|false)$/i.test(n)){t[e]=/^true$/i.test(n);return}t[e]=n}function iu(t){if(!t||t.length===0)return"";let e=[];for(let r of t){let n=r.image??"";r.tokenType&&r.tokenType.name==="QuotedString"&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?e.push(n.slice(1,-1)):e.push(n)}return e.join(" ").replace(/\s+/g," ").trim()}function Xo(t){if(!t)return"";let e=t.children||{},r=[];return["Identifier","QuotedString","BacktickName"].forEach(n=>{e[n]?.forEach(s=>r.push(s))}),r.sort((n,i)=>(n.startOffset??0)-(i.startOffset??0)),iu(r)}function Xv(t){let e=t.children||{},r=[],n=["Visibility","Identifier","QuotedString","LParen","RParen","Comma","Colon","NumberLiteral"];for(let o of n)e[o]?.forEach(a=>r.push(a));r.sort((o,a)=>(o.startOffset??0)-(a.startOffset??0));let i=iu(r),s=/(\)\s*:|\)$)/.test(i)||/\(/.test(i);return{text:i,isMethod:s}}function Zv(t){return t.trim().replace(/\s+/g,"_")}function Jv(t){let{tokens:e}=fc(t);Yi.input=e;let r=Yi.diagram(),n=new Map,i=[],s=[],o="TD";function a(f,l){let d=Zv(f),h=n.get(d);if(h)return h;let p={id:d,display:l||f,attributes:[],methods:[]};return n.set(d,p),p}let u=(r.children||{}).statement||[];for(let f of u){let l=f.children||{};if(l.directionStmt){let d=l.directionStmt[0].children.Direction?.[0]?.image||"TD";d==="TB"?o="TB":d==="BT"?o="BT":d==="LR"?o="LR":d==="RL"?o="RL":o="TD";continue}if(l.classLine){let h=l.classLine[0].children||{},p=Xo(h.classRef?.[0]),x=a(p);if(h.LTlt&&h.Identifier&&h.GTgt&&(x.stereotype=h.Identifier[0].image),h.LCurly&&h.memberLineStmt){let m=h.memberLineStmt;for(let g of m){let S=Xv(g.children.memberLine?.[0]);S.text&&(S.isMethod?x.methods:x.attributes).push(S.text)}}continue}if(l.memberAssignStmt){let h=l.memberAssignStmt[0].children||{},p=Xo(h.classRef?.[0]),x=a(p),m=Xv(h.memberLine?.[0]);m.text&&(m.isMethod?x.methods:x.attributes).push(m.text);continue}if(l.noteStmt){let h=l.noteStmt[0].children||{},p=Xo(h.classRef?.[0]),x=[];["QuotedString","Identifier","NumberLiteral"].forEach(g=>h[g]?.forEach(S=>x.push(S)));let m=iu(x);p&&m&&s.push({target:Zv(p),text:m});continue}if(l.relationStmt){let h=l.relationStmt[0].children||{},p=Xo(h.classRef?.[0]),x=Xo(h.classRef?.[1]),m=a(p).id,g=a(x).id,S=h.leftCard?.[0],E=h.rightCard?.[0],y=S?.image?S.image.slice(1,-1):void 0,O=E?.image?E.image.slice(1,-1):void 0,L;if(h.labelText){let I=[];h.labelText.forEach(v=>{let w=v.children||{};["QuotedString","Identifier","NumberLiteral","GenericAngle"].forEach(M=>{w[M]?.forEach(_=>I.push(_))})}),I.sort((v,w)=>(v.startOffset??0)-(w.startOffset??0)),L=iu(I)}let b=[{key:"RelAssociation",kind:"association"},{key:"RelDependency",kind:"dependency"},{key:"RelRealization",kind:"realization"},{key:"RelExtends",kind:"extends"},{key:"RelAggregation",kind:"aggregation"},{key:"RelComposition",kind:"composition"},{key:"RelDependencyLeft",kind:"dependency"},{key:"RelRealizationLeft",kind:"realization"},{key:"RelExtendsRight",kind:"extends"},{key:"RelAggBoth",kind:"aggregation-both"},{key:"RelCompBoth",kind:"composition-both"},{key:"RelAggToComp",kind:"aggregation-to-comp"},{key:"RelCompToAgg",kind:"composition-to-agg"},{key:"LollipopLeft",kind:"lollipop-left"},{key:"LollipopRight",kind:"lollipop-right"}],C="association";for(let I of b)if(h[I.key]){C=I.kind;break}let k=m,R=g;(h.RelExtends||h.RelDependencyLeft||h.RelRealizationLeft||h.LollipopLeft)&&(k=g,R=m);let N={source:k,target:R,kind:C,label:L,leftCard:y,rightCard:O};i.push(N);continue}}return{direction:o,classes:Array.from(n.values()),relations:i,notes:s}}function $X(t,e=14){let r=t.stereotype?`\xAB${t.stereotype}\xBB ${t.display}`:t.display,n=t.attributes.slice(),i=t.methods.slice(),s=Math.max(16,Math.round(e*1.1)),o=12,a=10,c=lt(r,e+1)+o*2,u=Math.max(0,...n.map(p=>lt(p,e)))+o*2,f=Math.max(0,...i.map(p=>lt(p,e)))+o*2,l=Math.max(120,c,u,f),d=(n.length?6:0)+(i.length?6:0),h=a*2+s+n.length*s+(i.length?6:0)+(n.length?6:0)+i.length*s;return{width:l,height:h,title:r,attrLines:n,methodLines:i}}function BX(t,e,r=10,n=8,i=!0){let[s,o]=i?t:[t[1],t[0]],a=o.x-s.x,c=o.y-s.y,u=Math.hypot(a,c)||1,f=a/u,l=c/u,d=-l,h=f,p={x:o.x,y:o.y},x={x:o.x-f*r,y:o.y-l*r},m={x:x.x+d*(n/2),y:x.y+h*(n/2)},g={x:x.x-d*(n/2),y:x.y-h*(n/2)};return`<path class="edge-marker" d="M${p.x},${p.y} L${m.x},${m.y} M${p.x},${p.y} L${g.x},${g.y}" stroke="${e}" fill="none" />`}function eI(t,e,r=12,n=10,i=!0){let[s,o]=i?t:[t[1],t[0]],a=o.x-s.x,c=o.y-s.y,u=Math.hypot(a,c)||1,f=a/u,l=c/u,d=-l,h=f,p={x:o.x,y:o.y},x={x:o.x-f*r,y:o.y-l*r},m={x:x.x+d*(n/2),y:x.y+h*(n/2)},g={x:x.x-d*(n/2),y:x.y-h*(n/2)};return`<path class="edge-marker" d="${`M${p.x},${p.y} L${m.x},${m.y} L${g.x},${g.y} Z`}" fill="white" stroke="${e}" />`}function yr(t,e,r,n=10,i=!0){let[s,o]=i?t:[t[1],t[0]],a=o.x-s.x,c=o.y-s.y,u=Math.hypot(a,c)||1,f=a/u,l=c/u,d=-l,h=f,p={x:s.x,y:s.y},x={x:p.x-f*n,y:p.y-l*n},m={x:p.x+d*(n/1.4),y:p.y+h*(n/1.4)},g={x:p.x-d*(n/1.4),y:p.y-h*(n/1.4)},S={x:p.x+f*n,y:p.y+l*n},E=`M${x.x},${x.y} L${m.x},${m.y} L${S.x},${S.y} L${g.x},${g.y} Z`;return r?`<path class="edge-marker edge-marker-fill" d="${E}" fill="${e}" stroke="${e}"/>`:`<path class="edge-marker" d="${E}" fill="white" stroke="${e}"/>`}function FX(t,e,r=!1,n="#555",i=2){let s=t.map(a=>`${a.x},${a.y}`).join(" ");return`<polyline class="edge-path ${e}" points="${s}" fill="none"${r?' stroke-dasharray="4 3"':""}/>`}function tI(t,e={}){let r=[],n={};for(let E of t.classes){let y=$X(E);n[E.id]=y,r.push({id:E.id,label:E.display,shape:"rectangle",width:y.width,height:y.height})}let i=t.relations.map((E,y)=>({id:`e${y}`,source:E.source,target:E.target,type:"open"})),s={nodes:r,edges:i,direction:t.direction},a=new Pr().layout(s),c=Math.ceil(a.width+40),u=Math.ceil(a.height+40),f=[];f.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${c}" height="${u}" viewBox="${Math.min(0,-20)} ${Math.min(0,-20)} ${c} ${u}">`);let l=gn();f.push(`<style>${l}
    .class-title { font-weight: 600; }
    .class-divider { stroke: #aaa; stroke-width: 1; }
    .class-member { font-size: 12px; }
  </style>`);for(let E of a.nodes){let y=n[E.id],O=E.x,L=E.y,b=E.width,C=E.height,k=y.title,R=y.attrLines,N=y.methodLines,I=16,v=12,w=10,M=L+w+I;f.push(`  <g transform="translate(${O},${L})">`),f.push(`    <rect class="node-shape" width="${b}" height="${C}" rx="0"/>`),f.push(`    <text class="node-label class-title" x="${b/2}" y="${w+12}" text-anchor="middle" dominant-baseline="middle">${Re(k)}</text>`);let _=w+18;if(R.length){f.push(`    <line class="class-divider" x1="0" y1="${_}" x2="${b}" y2="${_}"/>`),_+=8;for(let $ of R)f.push(`    <text class="node-label class-member" x="${v}" y="${_}" dominant-baseline="hanging">${Re($)}</text>`),_+=I}if(N.length){f.push(`    <line class="class-divider" x1="0" y1="${_}" x2="${b}" y2="${_}"/>`),_+=8;for(let $ of N)f.push(`    <text class="node-label class-member" x="${v}" y="${_}" dominant-baseline="hanging">${Re($)}</text>`),_+=I}f.push("  </g>")}let d="#555";for(let E=0;E<a.edges.length;E++){let y=a.edges[E],O=t.relations[E],L=y.points,b=O.kind==="dependency"||O.kind==="realization";f.push(FX(L,"edge-path",b,d,2));let C=(N,I,v,w)=>{let M=I.x-N.x,_=I.y-N.y,$=Math.hypot(M,_)||1,K=M/$,J=_/$,ee=-J,le=K,ae=-6,tt=8,ct=N.x+K*ae+ee*tt,Ce=N.y+J*ae+le*tt,bt=w==="start"?"end":"start";f.push(`<text class="edge-label-text" x="${ct}" y="${Ce}" text-anchor="${bt}">${Re(v)}</text>`)};if(O.leftCard&&L.length>=2&&C(L[0],L[1],O.leftCard,"start"),O.rightCard&&L.length>=2){let N=L[L.length-1],I=L[L.length-2];C(N,I,O.rightCard,"end")}if(O.label){let N=L[Math.floor(L.length/2)],I=String(O.label).split(/\s+/),v=[],w="",M=200;for(let K of I){let J=w?w+" "+K:K;lt(J,12)<=M?w=J:(w&&v.push(w),w=K)}w&&v.push(w);let _=14,$=N.y-(v.length-1)*_/2-10;f.push(`<text class="edge-label-text" x="${N.x}" y="${$}" text-anchor="middle">`+v.map((K,J)=>`<tspan x="${N.x}" dy="${J===0?0:_}">${Re(K)}</tspan>`).join("")+"</text>")}let k=[L[0],L[1]??L[0]],R=[L[L.length-2]??L[L.length-1],L[L.length-1]];switch(O.kind){case"extends":f.push(eI(R,d,12,10,!0));break;case"realization":f.push(eI(R,d,12,10,!0));break;case"dependency":f.push(BX(R,d,10,7,!0));break;case"aggregation":f.push(yr(k,d,!1,8,!0));break;case"composition":f.push(yr(k,d,!0,8,!0));break;case"aggregation-both":f.push(yr(k,d,!1,8,!0)),f.push(yr(R,d,!1,8,!1));break;case"composition-both":f.push(yr(k,d,!0,8,!0)),f.push(yr(R,d,!0,8,!1));break;case"aggregation-to-comp":f.push(yr(k,d,!1,8,!0)),f.push(yr(R,d,!0,8,!1));break;case"composition-to-agg":f.push(yr(k,d,!0,8,!0)),f.push(yr(R,d,!1,8,!1));break;case"lollipop-left":f.push(`<circle class="edge-marker" cx="${k[0].x}" cy="${k[0].y}" r="5" fill="white" stroke="${d}" />`);break;case"lollipop-right":f.push(`<circle class="edge-marker" cx="${R[1].x}" cy="${R[1].y}" r="5" fill="white" stroke="${d}" />`);break;case"association":default:break}}let h=140,p=44,x=20,m=Object.fromEntries(a.nodes.map(E=>[E.id,E])),g={},S=t.notes||[];for(let E of S){let y=m[E.target];if(!y)continue;let O=g[E.target]=(g[E.target]||0)+1,L=y.x+y.width+x,b=y.y+(O-1)*(p+8),C=(I,v)=>a.nodes.some(w=>!(I+h<w.x||I>w.x+w.width||v+p<w.y||v>w.y+w.height)),k=0;for(;C(L,b)&&k<50;)b+=p+6,k++;f.push(`  <g class="note" transform="translate(${L},${b})">`),f.push(`    <rect width="${h}" height="${p}" rx="0"/>`),f.push(`    <text class="note-text" x="${h/2}" y="${p/2+4}" text-anchor="middle">${Re(E.text)}</text>`),f.push("  </g>");let R=y.x+y.width,N=y.y+16;f.push(`<line x1="${R}" y1="${N}" x2="${L}" y2="${b+p/2}" stroke="#999" stroke-dasharray="4 3"/>`)}return f.push("</svg>"),f.join(`
`)}var su=class{constructor(e,r){this.graphBuilder=new yc,this.layoutEngine=e||new Pr,this.renderer=r||new jn}render(e,r={}){let n=[],i=r.layoutEngine||this.layoutEngine,s=r.renderer||this.renderer;try{let o=Dl(e);if(o.errors&&o.errors.length>0)for(let l of o.errors)n.push({line:l.line||1,column:l.column||1,message:l.message,severity:"error",code:"LEXER_ERROR"});$t.reset(),$t.input=o.tokens;let a=$t.diagram();if($t.errors&&$t.errors.length>0)for(let l of $t.errors){let d=l.token;n.push({line:d?.startLine||1,column:d?.startColumn||1,message:l.message,severity:"error",code:"PARSER_ERROR"})}let c=this.graphBuilder.build(a),u;try{u=i.layout(c)}catch(l){return n.push({line:1,column:1,message:l.message||"Layout calculation failed",severity:"error",code:"LAYOUT_ERROR"}),{svg:this.generateErrorSvg(l.message||"Layout calculation failed"),graph:c,errors:n}}let f=s.render(u);return r.showErrors&&n.length>0&&(f=this.addErrorOverlays(f,n)),{svg:f,graph:c,errors:n}}catch(o){let a=this.generateErrorSvg(o.message||"Unknown error occurred");return n.push({line:1,column:1,message:o.message||"Unknown error occurred",severity:"error",code:"RENDER_ERROR"}),{svg:a,graph:{nodes:[],edges:[],direction:"TD"},errors:n}}}renderAny(e,r={}){let n=e,i;if(e.trimStart().startsWith("---")){let a=Yv(e);a&&(n=a.body,i=a.themeVariables||a.config&&a.config.themeVariables||void 0)}let s=n.trim().split(`
`)[0];if(/^(flowchart|graph)\s+/i.test(s)){let a=this.render(n,r);return{svg:i?GX(a.svg,i):a.svg,graph:a.graph,errors:a.errors}}if(/^pie\b/i.test(s))try{let{model:a,errors:c}=Bv(n),u=Fv(a,{width:r.width,height:r.height,rimStroke:i?.pieStrokeColor,rimStrokeWidth:i?.pieOuterStrokeWidth});return{svg:KX(u,i),graph:{nodes:[],edges:[],direction:"TD"},errors:c}}catch(a){let c=a?.message||"Pie render error",u=[{line:1,column:1,message:c,severity:"error",code:"PIE_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:u}}if(/^sequenceDiagram\b/.test(s))try{let a=jv(n);return{svg:Hv(a,{theme:i}),graph:{nodes:[],edges:[],direction:"TD"},errors:[]}}catch(a){let c=a?.message||"Sequence render error",u=[{line:1,column:1,message:c,severity:"error",code:"SEQUENCE_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:u}}if(/^classDiagram\b/.test(s))try{let a=Jv(n),c=tI(a,{theme:i});return{svg:i?Yo(c,i):c,graph:{nodes:[],edges:[],direction:a.direction},errors:[]}}catch(a){let c=a?.message||"Class render error",u=[{line:1,column:1,message:c,severity:"error",code:"CLASS_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:u}}if(/^stateDiagram(?:-v2)?\b/.test(s))try{let a=zv(n),c=Vv(a);return{svg:i?Yo(c,i):c,graph:{nodes:[],edges:[],direction:a.direction},errors:[]}}catch(a){let c=a?.message||"State render error",u=[{line:1,column:1,message:c,severity:"error",code:"STATE_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:u}}return{svg:this.generateErrorSvg("Unsupported diagram type. Rendering supports flowchart, pie, sequence, class, and state."),graph:{nodes:[],edges:[],direction:"TD"},errors:[{line:1,column:1,message:"Unsupported diagram type",severity:"error",code:"UNSUPPORTED_TYPE"}]}}addErrorOverlays(e,r){let n=`
    <style>
      .error-indicator {
        fill: #ff0000;
        opacity: 0.8;
      }
      .error-text {
        fill: white;
        font-family: Arial, sans-serif;
        font-size: 12px;
        font-weight: bold;
      }
    </style>`,i=`
    <g id="errors">
      <rect x="5" y="5" width="100" height="25" rx="3" class="error-indicator" />
      <text x="55" y="20" text-anchor="middle" class="error-text">${r.length} error${r.length!==1?"s":""}</text>
    </g>`;return e.replace("</svg>",`${n}${i}</svg>`)}generateErrorSvg(e){return`<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200">
  <rect width="400" height="200" fill="#fee" stroke="#c00" stroke-width="2" />
  <text x="${400/2}" y="${200/2-20}" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#c00">
    Render Error
  </text>
  <text x="${400/2}" y="${200/2+10}" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    ${this.wrapText(e,40).map((i,s)=>`<tspan x="${400/2}" dy="${s===0?0:15}">${this.escapeXml(i)}</tspan>`).join("")}
  </text>
</svg>`}wrapText(e,r){let n=e.split(" "),i=[],s="";for(let o of n)s.length+o.length+1<=r?s+=(s?" ":"")+o:(s&&i.push(s),s=o);return s&&i.push(s),i.slice(0,3)}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};function KX(t,e){if(!e)return t;let r=t;if((e.pieOuterStrokeWidth!=null||e.pieStrokeColor)&&(r=r.replace(/\.pieOuterCircle\s*\{[^}]*\}/,i=>{let s=i;return e.pieStrokeColor&&(s=s.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.pieStrokeColor)};`)),e.pieOuterStrokeWidth!=null&&(s=s.replace(/stroke-width:\s*[^;]+;/,`stroke-width: ${String(e.pieOuterStrokeWidth)};`)),s}),e.pieStrokeColor&&(r=r.replace(/\.pieCircle\s*\{[^}]*\}/,i=>i.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.pieStrokeColor)};`)))),e.pieSectionTextColor){let i=String(e.pieSectionTextColor);r=r.replace(/\.slice-label \{[^}]*\}/,s=>s.replace(/fill:\s*#[0-9A-Fa-f]{3,8}|fill:\s*rgb\([^)]*\)/,`fill: ${i}`)),r=r.replace(/<text class="slice-label"([^>]*)>/g,`<text class="slice-label"$1 fill="${i}">`)}if(e.pieTitleTextColor){let i=String(e.pieTitleTextColor);r=r.replace(/<text class="pie-title"([^>]*)>/g,`<text class="pie-title"$1 fill="${i}">`)}if(e.pieSectionTextSize){let i=String(e.pieSectionTextSize);r=r.replace(/<text class="slice-label"([^>]*)>/g,`<text class="slice-label"$1 font-size="${i}">`)}if(e.pieTitleTextSize){let i=String(e.pieTitleTextSize);r=r.replace(/<text class="pie-title"([^>]*)>/g,`<text class="pie-title"$1 font-size="${i}">`)}let n=[];for(let i=1;i<=24;i++){let s="pie"+i;e[s]&&n.push(String(e[s]))}if(n.length){let i=0;r=r.replace(/<path[^>]*class="pieCircle"[^>]*\sfill="([^"]+)"/g,s=>{let o=n[i]??null;return i++,o?s.replace(/fill="([^"]+)"/,`fill="${o}"`):s})}return r}function GX(t,e){if(!e)return t;let r=t;if((e.nodeBkg||e.nodeBorder)&&(r=r.replace(/\.node-shape\s*\{[^}]*\}/,n=>{let i=n;return e.nodeBkg&&(i=i.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeBkg)};`)),e.nodeBorder&&(i=i.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.nodeBorder)};`)),i})),e.nodeTextColor&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeTextColor)};`))),e.lineColor&&(r=r.replace(/\.edge-path\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lineColor)};`))),e.arrowheadColor&&(r=r.replace(/(<path d="M0,0 L0,[0-9.]+ L[0-9.]+,[0-9.]+ z"[^>]*)(fill="[^"]*")/g,(n,i)=>`${i}fill="${String(e.arrowheadColor)}"`),r=r.replace(/(<circle cx="4\.5" cy="4\.5" r="4\.5"[^>]*)(fill="[^"]*")/g,(n,i)=>`${i}fill="${String(e.arrowheadColor)}"`)),e.edgeLabelTextColor){let n=String(e.edgeLabelTextColor);r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,i=>i.replace(/fill:\s*[^;]+;/,`fill: ${n};`))}return e.clusterBkg&&(r=r.replace(/\.cluster-bg\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterBkg)};`))),e.clusterBorder&&(r=r.replace(/\.cluster-border\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.clusterBorder)};`))),e.clusterTextColor&&(r=r.replace(/\.cluster-label-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterTextColor)};`))),e.noteBkg&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteBkg)};`))),e.noteBorder&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.noteBorder)};`))),e.noteTextColor&&(r=r.replace(/\.note-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteTextColor)};`))),e.fontFamily&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/font-family:\s*[^;]+;/,`font-family: ${String(e.fontFamily)};`))),e.fontSize&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/font-size:\s*[^;]+;/,`font-size: ${String(e.fontSize)};`))),r}function ou(t,e={}){return new su(e.layoutEngine,e.renderer).renderAny(t,e)}function rI(){return{initialize(t){},async render(t,e,r){try{return{svg:ou(e,r).svg}}catch(n){throw new Error(`Maid render failed: ${n.message||"Unknown error"}`)}},renderSync(t,e,r){try{return{svg:ou(e,r).svg}}catch(n){throw new Error(`Maid render failed: ${n.message||"Unknown error"}`)}}}}var Zye=rI();function nSe(t,e={}){let{strict:r=!1,level:n="safe"}=e,i=t;for(let o=0;o<5;o++){let a=Ec(i,{strict:r}),c=Of(i,a.errors,n);if(c.length===0)return{fixed:i,errors:a.errors};let u=Tf(i,c);if(u===i)return{fixed:i,errors:a.errors};i=u}let s=Ec(i,{strict:r});return{fixed:i,errors:s.errors}}export{su as MermaidRenderer,Tf as applyEdits,Of as computeFixes,rI as createMermaidAPI,DE as detectDiagramType,nSe as fixText,ou as renderMermaid,Ec as validate};
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
