var ew=Object.create;var lp=Object.defineProperty;var tw=Object.getOwnPropertyDescriptor;var rw=Object.getOwnPropertyNames;var nw=Object.getPrototypeOf,iw=Object.prototype.hasOwnProperty;var Qn=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var S=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var sw=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of rw(e))!iw.call(t,i)&&i!==r&&lp(t,i,{get:()=>e[i],enumerable:!(n=tw(e,i))||n.enumerable});return t};var ow=(t,e,r)=>(r=t!=null?ew(nw(t)):{},sw(e||!t||!t.__esModule?lp(r,"default",{value:t,enumerable:!0}):r,t));var $y=S((yde,Dy)=>{function lq(){this.__data__=[],this.size=0}Dy.exports=lq});var _n=S((Ede,By)=>{function cq(t,e){return t===e||t!==t&&e!==e}By.exports=cq});var po=S((Sde,Fy)=>{var uq=_n();function hq(t,e){for(var r=t.length;r--;)if(uq(t[r][0],e))return r;return-1}Fy.exports=hq});var Gy=S((Tde,Ky)=>{var fq=po(),dq=Array.prototype,pq=dq.splice;function mq(t){var e=this.__data__,r=fq(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():pq.call(e,r,1),--this.size,!0}Ky.exports=mq});var Wy=S((Ode,jy)=>{var gq=po();function xq(t){var e=this.__data__,r=gq(e,t);return r<0?void 0:e[r][1]}jy.exports=xq});var zy=S((Ade,Hy)=>{var yq=po();function Eq(t){return yq(this.__data__,t)>-1}Hy.exports=Eq});var Yy=S((Lde,Vy)=>{var Sq=po();function Tq(t,e){var r=this.__data__,n=Sq(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}Vy.exports=Tq});var mo=S((bde,Qy)=>{var Oq=$y(),Aq=Gy(),Lq=Wy(),bq=zy(),kq=Yy();function Qi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Qi.prototype.clear=Oq;Qi.prototype.delete=Aq;Qi.prototype.get=Lq;Qi.prototype.has=bq;Qi.prototype.set=kq;Qy.exports=Qi});var Zy=S((kde,Xy)=>{var Nq=mo();function Cq(){this.__data__=new Nq,this.size=0}Xy.exports=Cq});var eE=S((Nde,Jy)=>{function vq(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}Jy.exports=vq});var rE=S((Cde,tE)=>{function wq(t){return this.__data__.get(t)}tE.exports=wq});var iE=S((vde,nE)=>{function Iq(t){return this.__data__.has(t)}nE.exports=Iq});var Sf=S((wde,sE)=>{var Rq=typeof global=="object"&&global&&global.Object===Object&&global;sE.exports=Rq});var $t=S((Ide,oE)=>{var Mq=Sf(),_q=typeof self=="object"&&self&&self.Object===Object&&self,Uq=Mq||_q||Function("return this")();oE.exports=Uq});var Un=S((Rde,aE)=>{var Pq=$t(),qq=Pq.Symbol;aE.exports=qq});var hE=S((Mde,uE)=>{var lE=Un(),cE=Object.prototype,Dq=cE.hasOwnProperty,$q=cE.toString,go=lE?lE.toStringTag:void 0;function Bq(t){var e=Dq.call(t,go),r=t[go];try{t[go]=void 0;var n=!0}catch{}var i=$q.call(t);return n&&(e?t[go]=r:delete t[go]),i}uE.exports=Bq});var dE=S((_de,fE)=>{var Fq=Object.prototype,Kq=Fq.toString;function Gq(t){return Kq.call(t)}fE.exports=Gq});var on=S((Ude,gE)=>{var pE=Un(),jq=hE(),Wq=dE(),Hq="[object Null]",zq="[object Undefined]",mE=pE?pE.toStringTag:void 0;function Vq(t){return t==null?t===void 0?zq:Hq:mE&&mE in Object(t)?jq(t):Wq(t)}gE.exports=Vq});var Ct=S((Pde,xE)=>{function Yq(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}xE.exports=Yq});var Xi=S((qde,yE)=>{var Qq=on(),Xq=Ct(),Zq="[object AsyncFunction]",Jq="[object Function]",eD="[object GeneratorFunction]",tD="[object Proxy]";function rD(t){if(!Xq(t))return!1;var e=Qq(t);return e==Jq||e==eD||e==Zq||e==tD}yE.exports=rD});var SE=S((Dde,EE)=>{var nD=$t(),iD=nD["__core-js_shared__"];EE.exports=iD});var AE=S(($de,OE)=>{var Tf=SE(),TE=(function(){var t=/[^.]+$/.exec(Tf&&Tf.keys&&Tf.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function sD(t){return!!TE&&TE in t}OE.exports=sD});var Of=S((Bde,LE)=>{var oD=Function.prototype,aD=oD.toString;function lD(t){if(t!=null){try{return aD.call(t)}catch{}try{return t+""}catch{}}return""}LE.exports=lD});var kE=S((Fde,bE)=>{var cD=Xi(),uD=AE(),hD=Ct(),fD=Of(),dD=/[\\^$.*+?()[\]{}|]/g,pD=/^\[object .+?Constructor\]$/,mD=Function.prototype,gD=Object.prototype,xD=mD.toString,yD=gD.hasOwnProperty,ED=RegExp("^"+xD.call(yD).replace(dD,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function SD(t){if(!hD(t)||uD(t))return!1;var e=cD(t)?ED:pD;return e.test(fD(t))}bE.exports=SD});var CE=S((Kde,NE)=>{function TD(t,e){return t?.[e]}NE.exports=TD});var an=S((Gde,vE)=>{var OD=kE(),AD=CE();function LD(t,e){var r=AD(t,e);return OD(r)?r:void 0}vE.exports=LD});var uc=S((jde,wE)=>{var bD=an(),kD=$t(),ND=bD(kD,"Map");wE.exports=ND});var xo=S((Wde,IE)=>{var CD=an(),vD=CD(Object,"create");IE.exports=vD});var _E=S((Hde,ME)=>{var RE=xo();function wD(){this.__data__=RE?RE(null):{},this.size=0}ME.exports=wD});var PE=S((zde,UE)=>{function ID(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}UE.exports=ID});var DE=S((Vde,qE)=>{var RD=xo(),MD="__lodash_hash_undefined__",_D=Object.prototype,UD=_D.hasOwnProperty;function PD(t){var e=this.__data__;if(RD){var r=e[t];return r===MD?void 0:r}return UD.call(e,t)?e[t]:void 0}qE.exports=PD});var BE=S((Yde,$E)=>{var qD=xo(),DD=Object.prototype,$D=DD.hasOwnProperty;function BD(t){var e=this.__data__;return qD?e[t]!==void 0:$D.call(e,t)}$E.exports=BD});var KE=S((Qde,FE)=>{var FD=xo(),KD="__lodash_hash_undefined__";function GD(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=FD&&e===void 0?KD:e,this}FE.exports=GD});var jE=S((Xde,GE)=>{var jD=_E(),WD=PE(),HD=DE(),zD=BE(),VD=KE();function Zi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Zi.prototype.clear=jD;Zi.prototype.delete=WD;Zi.prototype.get=HD;Zi.prototype.has=zD;Zi.prototype.set=VD;GE.exports=Zi});var zE=S((Zde,HE)=>{var WE=jE(),YD=mo(),QD=uc();function XD(){this.size=0,this.__data__={hash:new WE,map:new(QD||YD),string:new WE}}HE.exports=XD});var YE=S((Jde,VE)=>{function ZD(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}VE.exports=ZD});var yo=S((epe,QE)=>{var JD=YE();function e$(t,e){var r=t.__data__;return JD(e)?r[typeof e=="string"?"string":"hash"]:r.map}QE.exports=e$});var ZE=S((tpe,XE)=>{var t$=yo();function r$(t){var e=t$(this,t).delete(t);return this.size-=e?1:0,e}XE.exports=r$});var eS=S((rpe,JE)=>{var n$=yo();function i$(t){return n$(this,t).get(t)}JE.exports=i$});var rS=S((npe,tS)=>{var s$=yo();function o$(t){return s$(this,t).has(t)}tS.exports=o$});var iS=S((ipe,nS)=>{var a$=yo();function l$(t,e){var r=a$(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}nS.exports=l$});var hc=S((spe,sS)=>{var c$=zE(),u$=ZE(),h$=eS(),f$=rS(),d$=iS();function Ji(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ji.prototype.clear=c$;Ji.prototype.delete=u$;Ji.prototype.get=h$;Ji.prototype.has=f$;Ji.prototype.set=d$;sS.exports=Ji});var aS=S((ope,oS)=>{var p$=mo(),m$=uc(),g$=hc(),x$=200;function y$(t,e){var r=this.__data__;if(r instanceof p$){var n=r.__data__;if(!m$||n.length<x$-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new g$(n)}return r.set(t,e),this.size=r.size,this}oS.exports=y$});var Eo=S((ape,lS)=>{var E$=mo(),S$=Zy(),T$=eE(),O$=rE(),A$=iE(),L$=aS();function es(t){var e=this.__data__=new E$(t);this.size=e.size}es.prototype.clear=S$;es.prototype.delete=T$;es.prototype.get=O$;es.prototype.has=A$;es.prototype.set=L$;lS.exports=es});var fc=S((lpe,cS)=>{function b$(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}cS.exports=b$});var Af=S((cpe,uS)=>{var k$=an(),N$=(function(){try{var t=k$(Object,"defineProperty");return t({},"",{}),t}catch{}})();uS.exports=N$});var So=S((upe,fS)=>{var hS=Af();function C$(t,e,r){e=="__proto__"&&hS?hS(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}fS.exports=C$});var To=S((hpe,dS)=>{var v$=So(),w$=_n(),I$=Object.prototype,R$=I$.hasOwnProperty;function M$(t,e,r){var n=t[e];(!(R$.call(t,e)&&w$(n,r))||r===void 0&&!(e in t))&&v$(t,e,r)}dS.exports=M$});var ts=S((fpe,pS)=>{var _$=To(),U$=So();function P$(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(r[a],t[a],a,r,t):void 0;c===void 0&&(c=t[a]),i?U$(r,a,c):_$(r,a,c)}return r}pS.exports=P$});var gS=S((dpe,mS)=>{function q$(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}mS.exports=q$});var Vt=S((ppe,xS)=>{function D$(t){return t!=null&&typeof t=="object"}xS.exports=D$});var ES=S((mpe,yS)=>{var $$=on(),B$=Vt(),F$="[object Arguments]";function K$(t){return B$(t)&&$$(t)==F$}yS.exports=K$});var rs=S((gpe,OS)=>{var SS=ES(),G$=Vt(),TS=Object.prototype,j$=TS.hasOwnProperty,W$=TS.propertyIsEnumerable,H$=SS((function(){return arguments})())?SS:function(t){return G$(t)&&j$.call(t,"callee")&&!W$.call(t,"callee")};OS.exports=H$});var Pe=S((xpe,AS)=>{var z$=Array.isArray;AS.exports=z$});var bS=S((ype,LS)=>{function V$(){return!1}LS.exports=V$});var Pn=S((Oo,ns)=>{var Y$=$t(),Q$=bS(),CS=typeof Oo=="object"&&Oo&&!Oo.nodeType&&Oo,kS=CS&&typeof ns=="object"&&ns&&!ns.nodeType&&ns,X$=kS&&kS.exports===CS,NS=X$?Y$.Buffer:void 0,Z$=NS?NS.isBuffer:void 0,J$=Z$||Q$;ns.exports=J$});var Ao=S((Epe,vS)=>{var eB=9007199254740991,tB=/^(?:0|[1-9]\d*)$/;function rB(t,e){var r=typeof t;return e=e??eB,!!e&&(r=="number"||r!="symbol"&&tB.test(t))&&t>-1&&t%1==0&&t<e}vS.exports=rB});var dc=S((Spe,wS)=>{var nB=9007199254740991;function iB(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=nB}wS.exports=iB});var RS=S((Tpe,IS)=>{var sB=on(),oB=dc(),aB=Vt(),lB="[object Arguments]",cB="[object Array]",uB="[object Boolean]",hB="[object Date]",fB="[object Error]",dB="[object Function]",pB="[object Map]",mB="[object Number]",gB="[object Object]",xB="[object RegExp]",yB="[object Set]",EB="[object String]",SB="[object WeakMap]",TB="[object ArrayBuffer]",OB="[object DataView]",AB="[object Float32Array]",LB="[object Float64Array]",bB="[object Int8Array]",kB="[object Int16Array]",NB="[object Int32Array]",CB="[object Uint8Array]",vB="[object Uint8ClampedArray]",wB="[object Uint16Array]",IB="[object Uint32Array]",ye={};ye[AB]=ye[LB]=ye[bB]=ye[kB]=ye[NB]=ye[CB]=ye[vB]=ye[wB]=ye[IB]=!0;ye[lB]=ye[cB]=ye[TB]=ye[uB]=ye[OB]=ye[hB]=ye[fB]=ye[dB]=ye[pB]=ye[mB]=ye[gB]=ye[xB]=ye[yB]=ye[EB]=ye[SB]=!1;function RB(t){return aB(t)&&oB(t.length)&&!!ye[sB(t)]}IS.exports=RB});var Lo=S((Ope,MS)=>{function MB(t){return function(e){return t(e)}}MS.exports=MB});var pc=S((bo,is)=>{var _B=Sf(),_S=typeof bo=="object"&&bo&&!bo.nodeType&&bo,ko=_S&&typeof is=="object"&&is&&!is.nodeType&&is,UB=ko&&ko.exports===_S,Lf=UB&&_B.process,PB=(function(){try{var t=ko&&ko.require&&ko.require("util").types;return t||Lf&&Lf.binding&&Lf.binding("util")}catch{}})();is.exports=PB});var ss=S((Ape,qS)=>{var qB=RS(),DB=Lo(),US=pc(),PS=US&&US.isTypedArray,$B=PS?DB(PS):qB;qS.exports=$B});var bf=S((Lpe,DS)=>{var BB=gS(),FB=rs(),KB=Pe(),GB=Pn(),jB=Ao(),WB=ss(),HB=Object.prototype,zB=HB.hasOwnProperty;function VB(t,e){var r=KB(t),n=!r&&FB(t),i=!r&&!n&&GB(t),s=!r&&!n&&!i&&WB(t),o=r||n||i||s,a=o?BB(t.length,String):[],c=a.length;for(var l in t)(e||zB.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||jB(l,c)))&&a.push(l);return a}DS.exports=VB});var No=S((bpe,$S)=>{var YB=Object.prototype;function QB(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||YB;return t===r}$S.exports=QB});var kf=S((kpe,BS)=>{function XB(t,e){return function(r){return t(e(r))}}BS.exports=XB});var KS=S((Npe,FS)=>{var ZB=kf(),JB=ZB(Object.keys,Object);FS.exports=JB});var mc=S((Cpe,GS)=>{var e2=No(),t2=KS(),r2=Object.prototype,n2=r2.hasOwnProperty;function i2(t){if(!e2(t))return t2(t);var e=[];for(var r in Object(t))n2.call(t,r)&&r!="constructor"&&e.push(r);return e}GS.exports=i2});var fr=S((vpe,jS)=>{var s2=Xi(),o2=dc();function a2(t){return t!=null&&o2(t.length)&&!s2(t)}jS.exports=a2});var wr=S((wpe,WS)=>{var l2=bf(),c2=mc(),u2=fr();function h2(t){return u2(t)?l2(t):c2(t)}WS.exports=h2});var zS=S((Ipe,HS)=>{var f2=ts(),d2=wr();function p2(t,e){return t&&f2(e,d2(e),t)}HS.exports=p2});var YS=S((Rpe,VS)=>{function m2(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}VS.exports=m2});var XS=S((Mpe,QS)=>{var g2=Ct(),x2=No(),y2=YS(),E2=Object.prototype,S2=E2.hasOwnProperty;function T2(t){if(!g2(t))return y2(t);var e=x2(t),r=[];for(var n in t)n=="constructor"&&(e||!S2.call(t,n))||r.push(n);return r}QS.exports=T2});var ln=S((_pe,ZS)=>{var O2=bf(),A2=XS(),L2=fr();function b2(t){return L2(t)?O2(t,!0):A2(t)}ZS.exports=b2});var eT=S((Upe,JS)=>{var k2=ts(),N2=ln();function C2(t,e){return t&&k2(e,N2(e),t)}JS.exports=C2});var Nf=S((Co,os)=>{var v2=$t(),iT=typeof Co=="object"&&Co&&!Co.nodeType&&Co,tT=iT&&typeof os=="object"&&os&&!os.nodeType&&os,w2=tT&&tT.exports===iT,rT=w2?v2.Buffer:void 0,nT=rT?rT.allocUnsafe:void 0;function I2(t,e){if(e)return t.slice();var r=t.length,n=nT?nT(r):new t.constructor(r);return t.copy(n),n}os.exports=I2});var Cf=S((Ppe,sT)=>{function R2(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}sT.exports=R2});var vf=S((qpe,oT)=>{function M2(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}oT.exports=M2});var wf=S((Dpe,aT)=>{function _2(){return[]}aT.exports=_2});var gc=S(($pe,cT)=>{var U2=vf(),P2=wf(),q2=Object.prototype,D2=q2.propertyIsEnumerable,lT=Object.getOwnPropertySymbols,$2=lT?function(t){return t==null?[]:(t=Object(t),U2(lT(t),function(e){return D2.call(t,e)}))}:P2;cT.exports=$2});var hT=S((Bpe,uT)=>{var B2=ts(),F2=gc();function K2(t,e){return B2(t,F2(t),e)}uT.exports=K2});var xc=S((Fpe,fT)=>{function G2(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}fT.exports=G2});var vo=S((Kpe,dT)=>{var j2=kf(),W2=j2(Object.getPrototypeOf,Object);dT.exports=W2});var If=S((Gpe,pT)=>{var H2=xc(),z2=vo(),V2=gc(),Y2=wf(),Q2=Object.getOwnPropertySymbols,X2=Q2?function(t){for(var e=[];t;)H2(e,V2(t)),t=z2(t);return e}:Y2;pT.exports=X2});var gT=S((jpe,mT)=>{var Z2=ts(),J2=If();function eF(t,e){return Z2(t,J2(t),e)}mT.exports=eF});var Rf=S((Wpe,xT)=>{var tF=xc(),rF=Pe();function nF(t,e,r){var n=e(t);return rF(t)?n:tF(n,r(t))}xT.exports=nF});var Mf=S((Hpe,yT)=>{var iF=Rf(),sF=gc(),oF=wr();function aF(t){return iF(t,oF,sF)}yT.exports=aF});var ST=S((zpe,ET)=>{var lF=Rf(),cF=If(),uF=ln();function hF(t){return lF(t,uF,cF)}ET.exports=hF});var OT=S((Vpe,TT)=>{var fF=an(),dF=$t(),pF=fF(dF,"DataView");TT.exports=pF});var LT=S((Ype,AT)=>{var mF=an(),gF=$t(),xF=mF(gF,"Promise");AT.exports=xF});var _f=S((Qpe,bT)=>{var yF=an(),EF=$t(),SF=yF(EF,"Set");bT.exports=SF});var NT=S((Xpe,kT)=>{var TF=an(),OF=$t(),AF=TF(OF,"WeakMap");kT.exports=AF});var Dn=S((Zpe,_T)=>{var Uf=OT(),Pf=uc(),qf=LT(),Df=_f(),$f=NT(),MT=on(),as=Of(),CT="[object Map]",LF="[object Object]",vT="[object Promise]",wT="[object Set]",IT="[object WeakMap]",RT="[object DataView]",bF=as(Uf),kF=as(Pf),NF=as(qf),CF=as(Df),vF=as($f),qn=MT;(Uf&&qn(new Uf(new ArrayBuffer(1)))!=RT||Pf&&qn(new Pf)!=CT||qf&&qn(qf.resolve())!=vT||Df&&qn(new Df)!=wT||$f&&qn(new $f)!=IT)&&(qn=function(t){var e=MT(t),r=e==LF?t.constructor:void 0,n=r?as(r):"";if(n)switch(n){case bF:return RT;case kF:return CT;case NF:return vT;case CF:return wT;case vF:return IT}return e});_T.exports=qn});var PT=S((Jpe,UT)=>{var wF=Object.prototype,IF=wF.hasOwnProperty;function RF(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&IF.call(t,"index")&&(r.index=t.index,r.input=t.input),r}UT.exports=RF});var Bf=S((eme,qT)=>{var MF=$t(),_F=MF.Uint8Array;qT.exports=_F});var yc=S((tme,$T)=>{var DT=Bf();function UF(t){var e=new t.constructor(t.byteLength);return new DT(e).set(new DT(t)),e}$T.exports=UF});var FT=S((rme,BT)=>{var PF=yc();function qF(t,e){var r=e?PF(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}BT.exports=qF});var GT=S((nme,KT)=>{var DF=/\w*$/;function $F(t){var e=new t.constructor(t.source,DF.exec(t));return e.lastIndex=t.lastIndex,e}KT.exports=$F});var VT=S((ime,zT)=>{var jT=Un(),WT=jT?jT.prototype:void 0,HT=WT?WT.valueOf:void 0;function BF(t){return HT?Object(HT.call(t)):{}}zT.exports=BF});var Ff=S((sme,YT)=>{var FF=yc();function KF(t,e){var r=e?FF(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}YT.exports=KF});var XT=S((ome,QT)=>{var GF=yc(),jF=FT(),WF=GT(),HF=VT(),zF=Ff(),VF="[object Boolean]",YF="[object Date]",QF="[object Map]",XF="[object Number]",ZF="[object RegExp]",JF="[object Set]",eK="[object String]",tK="[object Symbol]",rK="[object ArrayBuffer]",nK="[object DataView]",iK="[object Float32Array]",sK="[object Float64Array]",oK="[object Int8Array]",aK="[object Int16Array]",lK="[object Int32Array]",cK="[object Uint8Array]",uK="[object Uint8ClampedArray]",hK="[object Uint16Array]",fK="[object Uint32Array]";function dK(t,e,r){var n=t.constructor;switch(e){case rK:return GF(t);case VF:case YF:return new n(+t);case nK:return jF(t,r);case iK:case sK:case oK:case aK:case lK:case cK:case uK:case hK:case fK:return zF(t,r);case QF:return new n;case XF:case eK:return new n(t);case ZF:return WF(t);case JF:return new n;case tK:return HF(t)}}QT.exports=dK});var Kf=S((ame,JT)=>{var pK=Ct(),ZT=Object.create,mK=(function(){function t(){}return function(e){if(!pK(e))return{};if(ZT)return ZT(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})();JT.exports=mK});var Gf=S((lme,eO)=>{var gK=Kf(),xK=vo(),yK=No();function EK(t){return typeof t.constructor=="function"&&!yK(t)?gK(xK(t)):{}}eO.exports=EK});var rO=S((cme,tO)=>{var SK=Dn(),TK=Vt(),OK="[object Map]";function AK(t){return TK(t)&&SK(t)==OK}tO.exports=AK});var oO=S((ume,sO)=>{var LK=rO(),bK=Lo(),nO=pc(),iO=nO&&nO.isMap,kK=iO?bK(iO):LK;sO.exports=kK});var lO=S((hme,aO)=>{var NK=Dn(),CK=Vt(),vK="[object Set]";function wK(t){return CK(t)&&NK(t)==vK}aO.exports=wK});var fO=S((fme,hO)=>{var IK=lO(),RK=Lo(),cO=pc(),uO=cO&&cO.isSet,MK=uO?RK(uO):IK;hO.exports=MK});var jf=S((dme,gO)=>{var _K=Eo(),UK=fc(),PK=To(),qK=zS(),DK=eT(),$K=Nf(),BK=Cf(),FK=hT(),KK=gT(),GK=Mf(),jK=ST(),WK=Dn(),HK=PT(),zK=XT(),VK=Gf(),YK=Pe(),QK=Pn(),XK=oO(),ZK=Ct(),JK=fO(),eG=wr(),tG=ln(),rG=1,nG=2,iG=4,dO="[object Arguments]",sG="[object Array]",oG="[object Boolean]",aG="[object Date]",lG="[object Error]",pO="[object Function]",cG="[object GeneratorFunction]",uG="[object Map]",hG="[object Number]",mO="[object Object]",fG="[object RegExp]",dG="[object Set]",pG="[object String]",mG="[object Symbol]",gG="[object WeakMap]",xG="[object ArrayBuffer]",yG="[object DataView]",EG="[object Float32Array]",SG="[object Float64Array]",TG="[object Int8Array]",OG="[object Int16Array]",AG="[object Int32Array]",LG="[object Uint8Array]",bG="[object Uint8ClampedArray]",kG="[object Uint16Array]",NG="[object Uint32Array]",me={};me[dO]=me[sG]=me[xG]=me[yG]=me[oG]=me[aG]=me[EG]=me[SG]=me[TG]=me[OG]=me[AG]=me[uG]=me[hG]=me[mO]=me[fG]=me[dG]=me[pG]=me[mG]=me[LG]=me[bG]=me[kG]=me[NG]=!0;me[lG]=me[pO]=me[gG]=!1;function Ec(t,e,r,n,i,s){var o,a=e&rG,c=e&nG,l=e&iG;if(r&&(o=i?r(t,n,i,s):r(t)),o!==void 0)return o;if(!ZK(t))return t;var f=YK(t);if(f){if(o=HK(t),!a)return BK(t,o)}else{var u=WK(t),h=u==pO||u==cG;if(QK(t))return $K(t,a);if(u==mO||u==dO||h&&!i){if(o=c||h?{}:VK(t),!a)return c?KK(t,DK(o,t)):FK(t,qK(o,t))}else{if(!me[u])return i?t:{};o=zK(t,u,a)}}s||(s=new _K);var d=s.get(t);if(d)return d;s.set(t,o),JK(t)?t.forEach(function(g){o.add(Ec(g,e,r,g,t,s))}):XK(t)&&t.forEach(function(g,x){o.set(x,Ec(g,e,r,x,t,s))});var p=l?c?jK:GK:c?tG:eG,m=f?void 0:p(t);return UK(m||t,function(g,x){m&&(x=g,g=t[x]),PK(o,x,Ec(g,e,r,x,t,s))}),o}gO.exports=Ec});var yO=S((pme,xO)=>{var CG=jf(),vG=4;function wG(t){return CG(t,vG)}xO.exports=wG});var Sc=S((mme,EO)=>{function IG(t){return function(){return t}}EO.exports=IG});var TO=S((gme,SO)=>{function RG(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[t?a:++i];if(r(s[c],c,s)===!1)break}return e}}SO.exports=RG});var Tc=S((xme,OO)=>{var MG=TO(),_G=MG();OO.exports=_G});var Oc=S((yme,AO)=>{var UG=Tc(),PG=wr();function qG(t,e){return t&&UG(t,e,PG)}AO.exports=qG});var bO=S((Eme,LO)=>{var DG=fr();function $G(t,e){return function(r,n){if(r==null)return r;if(!DG(r))return t(r,n);for(var i=r.length,s=e?i:-1,o=Object(r);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return r}}LO.exports=$G});var wo=S((Sme,kO)=>{var BG=Oc(),FG=bO(),KG=FG(BG);kO.exports=KG});var cn=S((Tme,NO)=>{function GG(t){return t}NO.exports=GG});var Wf=S((Ome,CO)=>{var jG=cn();function WG(t){return typeof t=="function"?t:jG}CO.exports=WG});var Hf=S((Ame,vO)=>{var HG=fc(),zG=wo(),VG=Wf(),YG=Pe();function QG(t,e){var r=YG(t)?HG:zG;return r(t,VG(e))}vO.exports=QG});var zf=S((Lme,wO)=>{wO.exports=Hf()});var RO=S((bme,IO)=>{var XG=wo();function ZG(t,e){var r=[];return XG(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}IO.exports=ZG});var _O=S((kme,MO)=>{var JG="__lodash_hash_undefined__";function ej(t){return this.__data__.set(t,JG),this}MO.exports=ej});var PO=S((Nme,UO)=>{function tj(t){return this.__data__.has(t)}UO.exports=tj});var Vf=S((Cme,qO)=>{var rj=hc(),nj=_O(),ij=PO();function Ac(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new rj;++e<r;)this.add(t[e])}Ac.prototype.add=Ac.prototype.push=nj;Ac.prototype.has=ij;qO.exports=Ac});var $O=S((vme,DO)=>{function sj(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}DO.exports=sj});var Yf=S((wme,BO)=>{function oj(t,e){return t.has(e)}BO.exports=oj});var Qf=S((Ime,FO)=>{var aj=Vf(),lj=$O(),cj=Yf(),uj=1,hj=2;function fj(t,e,r,n,i,s){var o=r&uj,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),f=s.get(e);if(l&&f)return l==e&&f==t;var u=-1,h=!0,d=r&hj?new aj:void 0;for(s.set(t,e),s.set(e,t);++u<a;){var p=t[u],m=e[u];if(n)var g=o?n(m,p,u,e,t,s):n(p,m,u,t,e,s);if(g!==void 0){if(g)continue;h=!1;break}if(d){if(!lj(e,function(x,y){if(!cj(d,y)&&(p===x||i(p,x,r,n,s)))return d.push(y)})){h=!1;break}}else if(!(p===m||i(p,m,r,n,s))){h=!1;break}}return s.delete(t),s.delete(e),h}FO.exports=fj});var GO=S((Rme,KO)=>{function dj(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}KO.exports=dj});var Lc=S((Mme,jO)=>{function pj(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}jO.exports=pj});var YO=S((_me,VO)=>{var WO=Un(),HO=Bf(),mj=_n(),gj=Qf(),xj=GO(),yj=Lc(),Ej=1,Sj=2,Tj="[object Boolean]",Oj="[object Date]",Aj="[object Error]",Lj="[object Map]",bj="[object Number]",kj="[object RegExp]",Nj="[object Set]",Cj="[object String]",vj="[object Symbol]",wj="[object ArrayBuffer]",Ij="[object DataView]",zO=WO?WO.prototype:void 0,Xf=zO?zO.valueOf:void 0;function Rj(t,e,r,n,i,s,o){switch(r){case Ij:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case wj:return!(t.byteLength!=e.byteLength||!s(new HO(t),new HO(e)));case Tj:case Oj:case bj:return mj(+t,+e);case Aj:return t.name==e.name&&t.message==e.message;case kj:case Cj:return t==e+"";case Lj:var a=xj;case Nj:var c=n&Ej;if(a||(a=yj),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;n|=Sj,o.set(t,e);var f=gj(a(t),a(e),n,i,s,o);return o.delete(t),f;case vj:if(Xf)return Xf.call(t)==Xf.call(e)}return!1}VO.exports=Rj});var ZO=S((Ume,XO)=>{var QO=Mf(),Mj=1,_j=Object.prototype,Uj=_j.hasOwnProperty;function Pj(t,e,r,n,i,s){var o=r&Mj,a=QO(t),c=a.length,l=QO(e),f=l.length;if(c!=f&&!o)return!1;for(var u=c;u--;){var h=a[u];if(!(o?h in e:Uj.call(e,h)))return!1}var d=s.get(t),p=s.get(e);if(d&&p)return d==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var g=o;++u<c;){h=a[u];var x=t[h],y=e[h];if(n)var E=o?n(y,x,h,e,t,s):n(x,y,h,t,e,s);if(!(E===void 0?x===y||i(x,y,r,n,s):E)){m=!1;break}g||(g=h=="constructor")}if(m&&!g){var T=t.constructor,A=e.constructor;T!=A&&"constructor"in t&&"constructor"in e&&!(typeof T=="function"&&T instanceof T&&typeof A=="function"&&A instanceof A)&&(m=!1)}return s.delete(t),s.delete(e),m}XO.exports=Pj});var oA=S((Pme,sA)=>{var Zf=Eo(),qj=Qf(),Dj=YO(),$j=ZO(),JO=Dn(),eA=Pe(),tA=Pn(),Bj=ss(),Fj=1,rA="[object Arguments]",nA="[object Array]",bc="[object Object]",Kj=Object.prototype,iA=Kj.hasOwnProperty;function Gj(t,e,r,n,i,s){var o=eA(t),a=eA(e),c=o?nA:JO(t),l=a?nA:JO(e);c=c==rA?bc:c,l=l==rA?bc:l;var f=c==bc,u=l==bc,h=c==l;if(h&&tA(t)){if(!tA(e))return!1;o=!0,f=!1}if(h&&!f)return s||(s=new Zf),o||Bj(t)?qj(t,e,r,n,i,s):Dj(t,e,c,r,n,i,s);if(!(r&Fj)){var d=f&&iA.call(t,"__wrapped__"),p=u&&iA.call(e,"__wrapped__");if(d||p){var m=d?t.value():t,g=p?e.value():e;return s||(s=new Zf),i(m,g,r,n,s)}}return h?(s||(s=new Zf),$j(t,e,r,n,i,s)):!1}sA.exports=Gj});var Jf=S((qme,cA)=>{var jj=oA(),aA=Vt();function lA(t,e,r,n,i){return t===e?!0:t==null||e==null||!aA(t)&&!aA(e)?t!==t&&e!==e:jj(t,e,r,n,lA,i)}cA.exports=lA});var hA=S((Dme,uA)=>{var Wj=Eo(),Hj=Jf(),zj=1,Vj=2;function Yj(t,e,r,n){var i=r.length,s=i,o=!n;if(t==null)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=r[i];var c=a[0],l=t[c],f=a[1];if(o&&a[2]){if(l===void 0&&!(c in t))return!1}else{var u=new Wj;if(n)var h=n(l,f,c,t,e,u);if(!(h===void 0?Hj(f,l,zj|Vj,n,u):h))return!1}}return!0}uA.exports=Yj});var ed=S(($me,fA)=>{var Qj=Ct();function Xj(t){return t===t&&!Qj(t)}fA.exports=Xj});var pA=S((Bme,dA)=>{var Zj=ed(),Jj=wr();function eW(t){for(var e=Jj(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,Zj(i)]}return e}dA.exports=eW});var td=S((Fme,mA)=>{function tW(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}mA.exports=tW});var xA=S((Kme,gA)=>{var rW=hA(),nW=pA(),iW=td();function sW(t){var e=nW(t);return e.length==1&&e[0][2]?iW(e[0][0],e[0][1]):function(r){return r===t||rW(r,t,e)}}gA.exports=sW});var $n=S((Gme,yA)=>{var oW=on(),aW=Vt(),lW="[object Symbol]";function cW(t){return typeof t=="symbol"||aW(t)&&oW(t)==lW}yA.exports=cW});var kc=S((jme,EA)=>{var uW=Pe(),hW=$n(),fW=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dW=/^\w*$/;function pW(t,e){if(uW(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||hW(t)?!0:dW.test(t)||!fW.test(t)||e!=null&&t in Object(e)}EA.exports=pW});var OA=S((Wme,TA)=>{var SA=hc(),mW="Expected a function";function rd(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(mW);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(rd.Cache||SA),r}rd.Cache=SA;TA.exports=rd});var LA=S((Hme,AA)=>{var gW=OA(),xW=500;function yW(t){var e=gW(t,function(n){return r.size===xW&&r.clear(),n}),r=e.cache;return e}AA.exports=yW});var kA=S((zme,bA)=>{var EW=LA(),SW=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,TW=/\\(\\)?/g,OW=EW(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(SW,function(r,n,i,s){e.push(i?s.replace(TW,"$1"):n||r)}),e});bA.exports=OW});var Io=S((Vme,NA)=>{function AW(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}NA.exports=AW});var MA=S((Yme,RA)=>{var CA=Un(),LW=Io(),bW=Pe(),kW=$n(),NW=1/0,vA=CA?CA.prototype:void 0,wA=vA?vA.toString:void 0;function IA(t){if(typeof t=="string")return t;if(bW(t))return LW(t,IA)+"";if(kW(t))return wA?wA.call(t):"";var e=t+"";return e=="0"&&1/t==-NW?"-0":e}RA.exports=IA});var nd=S((Qme,_A)=>{var CW=MA();function vW(t){return t==null?"":CW(t)}_A.exports=vW});var Ro=S((Xme,UA)=>{var wW=Pe(),IW=kc(),RW=kA(),MW=nd();function _W(t,e){return wW(t)?t:IW(t,e)?[t]:RW(MW(t))}UA.exports=_W});var ls=S((Zme,PA)=>{var UW=$n(),PW=1/0;function qW(t){if(typeof t=="string"||UW(t))return t;var e=t+"";return e=="0"&&1/t==-PW?"-0":e}PA.exports=qW});var Mo=S((Jme,qA)=>{var DW=Ro(),$W=ls();function BW(t,e){e=DW(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[$W(e[r++])];return r&&r==n?t:void 0}qA.exports=BW});var $A=S((ege,DA)=>{var FW=Mo();function KW(t,e,r){var n=t==null?void 0:FW(t,e);return n===void 0?r:n}DA.exports=KW});var FA=S((tge,BA)=>{function GW(t,e){return t!=null&&e in Object(t)}BA.exports=GW});var id=S((rge,KA)=>{var jW=Ro(),WW=rs(),HW=Pe(),zW=Ao(),VW=dc(),YW=ls();function QW(t,e,r){e=jW(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=YW(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&VW(i)&&zW(o,i)&&(HW(t)||WW(t)))}KA.exports=QW});var sd=S((nge,GA)=>{var XW=FA(),ZW=id();function JW(t,e){return t!=null&&ZW(t,e,XW)}GA.exports=JW});var WA=S((ige,jA)=>{var eH=Jf(),tH=$A(),rH=sd(),nH=kc(),iH=ed(),sH=td(),oH=ls(),aH=1,lH=2;function cH(t,e){return nH(t)&&iH(e)?sH(oH(t),e):function(r){var n=tH(r,t);return n===void 0&&n===e?rH(r,t):eH(e,n,aH|lH)}}jA.exports=cH});var od=S((sge,HA)=>{function uH(t){return function(e){return e?.[t]}}HA.exports=uH});var VA=S((oge,zA)=>{var hH=Mo();function fH(t){return function(e){return hH(e,t)}}zA.exports=fH});var QA=S((age,YA)=>{var dH=od(),pH=VA(),mH=kc(),gH=ls();function xH(t){return mH(t)?dH(gH(t)):pH(t)}YA.exports=xH});var dr=S((lge,XA)=>{var yH=xA(),EH=WA(),SH=cn(),TH=Pe(),OH=QA();function AH(t){return typeof t=="function"?t:t==null?SH:typeof t=="object"?TH(t)?EH(t[0],t[1]):yH(t):OH(t)}XA.exports=AH});var ad=S((cge,ZA)=>{var LH=vf(),bH=RO(),kH=dr(),NH=Pe();function CH(t,e){var r=NH(t)?LH:bH;return r(t,kH(e,3))}ZA.exports=CH});var eL=S((uge,JA)=>{var vH=Object.prototype,wH=vH.hasOwnProperty;function IH(t,e){return t!=null&&wH.call(t,e)}JA.exports=IH});var ld=S((hge,tL)=>{var RH=eL(),MH=id();function _H(t,e){return t!=null&&MH(t,e,RH)}tL.exports=_H});var nL=S((fge,rL)=>{var UH=mc(),PH=Dn(),qH=rs(),DH=Pe(),$H=fr(),BH=Pn(),FH=No(),KH=ss(),GH="[object Map]",jH="[object Set]",WH=Object.prototype,HH=WH.hasOwnProperty;function zH(t){if(t==null)return!0;if($H(t)&&(DH(t)||typeof t=="string"||typeof t.splice=="function"||BH(t)||KH(t)||qH(t)))return!t.length;var e=PH(t);if(e==GH||e==jH)return!t.size;if(FH(t))return!UH(t).length;for(var r in t)if(HH.call(t,r))return!1;return!0}rL.exports=zH});var cd=S((dge,iL)=>{function VH(t){return t===void 0}iL.exports=VH});var ud=S((pge,sL)=>{var YH=wo(),QH=fr();function XH(t,e){var r=-1,n=QH(t)?Array(t.length):[];return YH(t,function(i,s,o){n[++r]=e(i,s,o)}),n}sL.exports=XH});var hd=S((mge,oL)=>{var ZH=Io(),JH=dr(),ez=ud(),tz=Pe();function rz(t,e){var r=tz(t)?ZH:ez;return r(t,JH(e,3))}oL.exports=rz});var lL=S((gge,aL)=>{function nz(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}aL.exports=nz});var uL=S((xge,cL)=>{function iz(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}cL.exports=iz});var fd=S((yge,hL)=>{var sz=lL(),oz=wo(),az=dr(),lz=uL(),cz=Pe();function uz(t,e,r){var n=cz(t)?sz:lz,i=arguments.length<3;return n(t,az(e,4),r,i,oz)}hL.exports=uz});var dL=S((Ege,fL)=>{var hz=on(),fz=Pe(),dz=Vt(),pz="[object String]";function mz(t){return typeof t=="string"||!fz(t)&&dz(t)&&hz(t)==pz}fL.exports=mz});var mL=S((Sge,pL)=>{var gz=od(),xz=gz("length");pL.exports=xz});var xL=S((Tge,gL)=>{var yz="\\ud800-\\udfff",Ez="\\u0300-\\u036f",Sz="\\ufe20-\\ufe2f",Tz="\\u20d0-\\u20ff",Oz=Ez+Sz+Tz,Az="\\ufe0e\\ufe0f",Lz="\\u200d",bz=RegExp("["+Lz+yz+Oz+Az+"]");function kz(t){return bz.test(t)}gL.exports=kz});var kL=S((Oge,bL)=>{var EL="\\ud800-\\udfff",Nz="\\u0300-\\u036f",Cz="\\ufe20-\\ufe2f",vz="\\u20d0-\\u20ff",wz=Nz+Cz+vz,Iz="\\ufe0e\\ufe0f",Rz="["+EL+"]",dd="["+wz+"]",pd="\\ud83c[\\udffb-\\udfff]",Mz="(?:"+dd+"|"+pd+")",SL="[^"+EL+"]",TL="(?:\\ud83c[\\udde6-\\uddff]){2}",OL="[\\ud800-\\udbff][\\udc00-\\udfff]",_z="\\u200d",AL=Mz+"?",LL="["+Iz+"]?",Uz="(?:"+_z+"(?:"+[SL,TL,OL].join("|")+")"+LL+AL+")*",Pz=LL+AL+Uz,qz="(?:"+[SL+dd+"?",dd,TL,OL,Rz].join("|")+")",yL=RegExp(pd+"(?="+pd+")|"+qz+Pz,"g");function Dz(t){for(var e=yL.lastIndex=0;yL.test(t);)++e;return e}bL.exports=Dz});var CL=S((Age,NL)=>{var $z=mL(),Bz=xL(),Fz=kL();function Kz(t){return Bz(t)?Fz(t):$z(t)}NL.exports=Kz});var wL=S((Lge,vL)=>{var Gz=mc(),jz=Dn(),Wz=fr(),Hz=dL(),zz=CL(),Vz="[object Map]",Yz="[object Set]";function Qz(t){if(t==null)return 0;if(Wz(t))return Hz(t)?zz(t):t.length;var e=jz(t);return e==Vz||e==Yz?t.size:Gz(t).length}vL.exports=Qz});var RL=S((bge,IL)=>{var Xz=fc(),Zz=Kf(),Jz=Oc(),e3=dr(),t3=vo(),r3=Pe(),n3=Pn(),i3=Xi(),s3=Ct(),o3=ss();function a3(t,e,r){var n=r3(t),i=n||n3(t)||o3(t);if(e=e3(e,4),r==null){var s=t&&t.constructor;i?r=n?new s:[]:s3(t)?r=i3(s)?Zz(t3(t)):{}:r={}}return(i?Xz:Jz)(t,function(o,a,c){return e(r,o,a,c)}),r}IL.exports=a3});var PL=S((kge,UL)=>{var ML=Un(),l3=rs(),c3=Pe(),_L=ML?ML.isConcatSpreadable:void 0;function u3(t){return c3(t)||l3(t)||!!(_L&&t&&t[_L])}UL.exports=u3});var Nc=S((Nge,DL)=>{var h3=xc(),f3=PL();function qL(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=f3),i||(i=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?qL(a,e-1,r,n,i):h3(i,a):n||(i[i.length]=a)}return i}DL.exports=qL});var BL=S((Cge,$L)=>{function d3(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}$L.exports=d3});var md=S((vge,KL)=>{var p3=BL(),FL=Math.max;function m3(t,e,r){return e=FL(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=FL(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),p3(t,this,a)}}KL.exports=m3});var WL=S((wge,jL)=>{var g3=Sc(),GL=Af(),x3=cn(),y3=GL?function(t,e){return GL(t,"toString",{configurable:!0,enumerable:!1,value:g3(e),writable:!0})}:x3;jL.exports=y3});var zL=S((Ige,HL)=>{var E3=800,S3=16,T3=Date.now;function O3(t){var e=0,r=0;return function(){var n=T3(),i=S3-(n-r);if(r=n,i>0){if(++e>=E3)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}HL.exports=O3});var gd=S((Rge,VL)=>{var A3=WL(),L3=zL(),b3=L3(A3);VL.exports=b3});var _o=S((Mge,YL)=>{var k3=cn(),N3=md(),C3=gd();function v3(t,e){return C3(N3(t,e,k3),t+"")}YL.exports=v3});var xd=S((_ge,QL)=>{function w3(t,e,r,n){for(var i=t.length,s=r+(n?1:-1);n?s--:++s<i;)if(e(t[s],s,t))return s;return-1}QL.exports=w3});var ZL=S((Uge,XL)=>{function I3(t){return t!==t}XL.exports=I3});var eb=S((Pge,JL)=>{function R3(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}JL.exports=R3});var rb=S((qge,tb)=>{var M3=xd(),_3=ZL(),U3=eb();function P3(t,e,r){return e===e?U3(t,e,r):M3(t,_3,r)}tb.exports=P3});var ib=S((Dge,nb)=>{var q3=rb();function D3(t,e){var r=t==null?0:t.length;return!!r&&q3(t,e,0)>-1}nb.exports=D3});var ob=S(($ge,sb)=>{function $3(t,e,r){for(var n=-1,i=t==null?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1}sb.exports=$3});var lb=S((Bge,ab)=>{function B3(){}ab.exports=B3});var ub=S((Fge,cb)=>{var yd=_f(),F3=lb(),K3=Lc(),G3=1/0,j3=yd&&1/K3(new yd([,-0]))[1]==G3?function(t){return new yd(t)}:F3;cb.exports=j3});var fb=S((Kge,hb)=>{var W3=Vf(),H3=ib(),z3=ob(),V3=Yf(),Y3=ub(),Q3=Lc(),X3=200;function Z3(t,e,r){var n=-1,i=H3,s=t.length,o=!0,a=[],c=a;if(r)o=!1,i=z3;else if(s>=X3){var l=e?null:Y3(t);if(l)return Q3(l);o=!1,i=V3,c=new W3}else c=e?[]:a;e:for(;++n<s;){var f=t[n],u=e?e(f):f;if(f=r||f!==0?f:0,o&&u===u){for(var h=c.length;h--;)if(c[h]===u)continue e;e&&c.push(u),a.push(f)}else i(c,u,r)||(c!==a&&c.push(u),a.push(f))}return a}hb.exports=Z3});var Ed=S((Gge,db)=>{var J3=fr(),eV=Vt();function tV(t){return eV(t)&&J3(t)}db.exports=tV});var mb=S((jge,pb)=>{var rV=Nc(),nV=_o(),iV=fb(),sV=Ed(),oV=nV(function(t){return iV(rV(t,1,sV,!0))});pb.exports=oV});var xb=S((Wge,gb)=>{var aV=Io();function lV(t,e){return aV(e,function(r){return t[r]})}gb.exports=lV});var Sd=S((Hge,yb)=>{var cV=xb(),uV=wr();function hV(t){return t==null?[]:cV(t,uV(t))}yb.exports=hV});var vt=S((zge,Eb)=>{var Cc;if(typeof Qn=="function")try{Cc={clone:yO(),constant:Sc(),each:zf(),filter:ad(),has:ld(),isArray:Pe(),isEmpty:nL(),isFunction:Xi(),isUndefined:cd(),keys:wr(),map:hd(),reduce:fd(),size:wL(),transform:RL(),union:mb(),values:Sd()}}catch{}Cc||(Cc=window._);Eb.exports=Cc});var vc=S((Yge,Ab)=>{"use strict";var j=vt();Ab.exports=Z;var fV="\0",Bn="\0",Sb="";function Z(t){this._isDirected=j.has(t,"directed")?t.directed:!0,this._isMultigraph=j.has(t,"multigraph")?t.multigraph:!1,this._isCompound=j.has(t,"compound")?t.compound:!1,this._label=void 0,this._defaultNodeLabelFn=j.constant(void 0),this._defaultEdgeLabelFn=j.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[Bn]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}Z.prototype._nodeCount=0;Z.prototype._edgeCount=0;Z.prototype.isDirected=function(){return this._isDirected};Z.prototype.isMultigraph=function(){return this._isMultigraph};Z.prototype.isCompound=function(){return this._isCompound};Z.prototype.setGraph=function(t){return this._label=t,this};Z.prototype.graph=function(){return this._label};Z.prototype.setDefaultNodeLabel=function(t){return j.isFunction(t)||(t=j.constant(t)),this._defaultNodeLabelFn=t,this};Z.prototype.nodeCount=function(){return this._nodeCount};Z.prototype.nodes=function(){return j.keys(this._nodes)};Z.prototype.sources=function(){var t=this;return j.filter(this.nodes(),function(e){return j.isEmpty(t._in[e])})};Z.prototype.sinks=function(){var t=this;return j.filter(this.nodes(),function(e){return j.isEmpty(t._out[e])})};Z.prototype.setNodes=function(t,e){var r=arguments,n=this;return j.each(t,function(i){r.length>1?n.setNode(i,e):n.setNode(i)}),this};Z.prototype.setNode=function(t,e){return j.has(this._nodes,t)?(arguments.length>1&&(this._nodes[t]=e),this):(this._nodes[t]=arguments.length>1?e:this._defaultNodeLabelFn(t),this._isCompound&&(this._parent[t]=Bn,this._children[t]={},this._children[Bn][t]=!0),this._in[t]={},this._preds[t]={},this._out[t]={},this._sucs[t]={},++this._nodeCount,this)};Z.prototype.node=function(t){return this._nodes[t]};Z.prototype.hasNode=function(t){return j.has(this._nodes,t)};Z.prototype.removeNode=function(t){var e=this;if(j.has(this._nodes,t)){var r=function(n){e.removeEdge(e._edgeObjs[n])};delete this._nodes[t],this._isCompound&&(this._removeFromParentsChildList(t),delete this._parent[t],j.each(this.children(t),function(n){e.setParent(n)}),delete this._children[t]),j.each(j.keys(this._in[t]),r),delete this._in[t],delete this._preds[t],j.each(j.keys(this._out[t]),r),delete this._out[t],delete this._sucs[t],--this._nodeCount}return this};Z.prototype.setParent=function(t,e){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(j.isUndefined(e))e=Bn;else{e+="";for(var r=e;!j.isUndefined(r);r=this.parent(r))if(r===t)throw new Error("Setting "+e+" as parent of "+t+" would create a cycle");this.setNode(e)}return this.setNode(t),this._removeFromParentsChildList(t),this._parent[t]=e,this._children[e][t]=!0,this};Z.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]};Z.prototype.parent=function(t){if(this._isCompound){var e=this._parent[t];if(e!==Bn)return e}};Z.prototype.children=function(t){if(j.isUndefined(t)&&(t=Bn),this._isCompound){var e=this._children[t];if(e)return j.keys(e)}else{if(t===Bn)return this.nodes();if(this.hasNode(t))return[]}};Z.prototype.predecessors=function(t){var e=this._preds[t];if(e)return j.keys(e)};Z.prototype.successors=function(t){var e=this._sucs[t];if(e)return j.keys(e)};Z.prototype.neighbors=function(t){var e=this.predecessors(t);if(e)return j.union(e,this.successors(t))};Z.prototype.isLeaf=function(t){var e;return this.isDirected()?e=this.successors(t):e=this.neighbors(t),e.length===0};Z.prototype.filterNodes=function(t){var e=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});e.setGraph(this.graph());var r=this;j.each(this._nodes,function(s,o){t(o)&&e.setNode(o,s)}),j.each(this._edgeObjs,function(s){e.hasNode(s.v)&&e.hasNode(s.w)&&e.setEdge(s,r.edge(s))});var n={};function i(s){var o=r.parent(s);return o===void 0||e.hasNode(o)?(n[s]=o,o):o in n?n[o]:i(o)}return this._isCompound&&j.each(e.nodes(),function(s){e.setParent(s,i(s))}),e};Z.prototype.setDefaultEdgeLabel=function(t){return j.isFunction(t)||(t=j.constant(t)),this._defaultEdgeLabelFn=t,this};Z.prototype.edgeCount=function(){return this._edgeCount};Z.prototype.edges=function(){return j.values(this._edgeObjs)};Z.prototype.setPath=function(t,e){var r=this,n=arguments;return j.reduce(t,function(i,s){return n.length>1?r.setEdge(i,s,e):r.setEdge(i,s),s}),this};Z.prototype.setEdge=function(){var t,e,r,n,i=!1,s=arguments[0];typeof s=="object"&&s!==null&&"v"in s?(t=s.v,e=s.w,r=s.name,arguments.length===2&&(n=arguments[1],i=!0)):(t=s,e=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],i=!0)),t=""+t,e=""+e,j.isUndefined(r)||(r=""+r);var o=Uo(this._isDirected,t,e,r);if(j.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=n),this;if(!j.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(t),this.setNode(e),this._edgeLabels[o]=i?n:this._defaultEdgeLabelFn(t,e,r);var a=dV(this._isDirected,t,e,r);return t=a.v,e=a.w,Object.freeze(a),this._edgeObjs[o]=a,Tb(this._preds[e],t),Tb(this._sucs[t],e),this._in[e][o]=a,this._out[t][o]=a,this._edgeCount++,this};Z.prototype.edge=function(t,e,r){var n=arguments.length===1?Td(this._isDirected,arguments[0]):Uo(this._isDirected,t,e,r);return this._edgeLabels[n]};Z.prototype.hasEdge=function(t,e,r){var n=arguments.length===1?Td(this._isDirected,arguments[0]):Uo(this._isDirected,t,e,r);return j.has(this._edgeLabels,n)};Z.prototype.removeEdge=function(t,e,r){var n=arguments.length===1?Td(this._isDirected,arguments[0]):Uo(this._isDirected,t,e,r),i=this._edgeObjs[n];return i&&(t=i.v,e=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],Ob(this._preds[e],t),Ob(this._sucs[t],e),delete this._in[e][n],delete this._out[t][n],this._edgeCount--),this};Z.prototype.inEdges=function(t,e){var r=this._in[t];if(r){var n=j.values(r);return e?j.filter(n,function(i){return i.v===e}):n}};Z.prototype.outEdges=function(t,e){var r=this._out[t];if(r){var n=j.values(r);return e?j.filter(n,function(i){return i.w===e}):n}};Z.prototype.nodeEdges=function(t,e){var r=this.inEdges(t,e);if(r)return r.concat(this.outEdges(t,e))};function Tb(t,e){t[e]?t[e]++:t[e]=1}function Ob(t,e){--t[e]||delete t[e]}function Uo(t,e,r,n){var i=""+e,s=""+r;if(!t&&i>s){var o=i;i=s,s=o}return i+Sb+s+Sb+(j.isUndefined(n)?fV:n)}function dV(t,e,r,n){var i=""+e,s=""+r;if(!t&&i>s){var o=i;i=s,s=o}var a={v:i,w:s};return n&&(a.name=n),a}function Td(t,e){return Uo(t,e.v,e.w,e.name)}});var bb=S((Qge,Lb)=>{Lb.exports="2.1.8"});var Nb=S((Xge,kb)=>{kb.exports={Graph:vc(),version:bb()}});var vb=S((Zge,Cb)=>{var pr=vt(),pV=vc();Cb.exports={write:mV,read:yV};function mV(t){var e={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:gV(t),edges:xV(t)};return pr.isUndefined(t.graph())||(e.value=pr.clone(t.graph())),e}function gV(t){return pr.map(t.nodes(),function(e){var r=t.node(e),n=t.parent(e),i={v:e};return pr.isUndefined(r)||(i.value=r),pr.isUndefined(n)||(i.parent=n),i})}function xV(t){return pr.map(t.edges(),function(e){var r=t.edge(e),n={v:e.v,w:e.w};return pr.isUndefined(e.name)||(n.name=e.name),pr.isUndefined(r)||(n.value=r),n})}function yV(t){var e=new pV(t.options).setGraph(t.value);return pr.each(t.nodes,function(r){e.setNode(r.v,r.value),r.parent&&e.setParent(r.v,r.parent)}),pr.each(t.edges,function(r){e.setEdge({v:r.v,w:r.w,name:r.name},r.value)}),e}});var Ib=S((Jge,wb)=>{var wc=vt();wb.exports=EV;function EV(t){var e={},r=[],n;function i(s){wc.has(e,s)||(e[s]=!0,n.push(s),wc.each(t.successors(s),i),wc.each(t.predecessors(s),i))}return wc.each(t.nodes(),function(s){n=[],i(s),n.length&&r.push(n)}),r}});var Od=S((exe,Mb)=>{var Rb=vt();Mb.exports=Bt;function Bt(){this._arr=[],this._keyIndices={}}Bt.prototype.size=function(){return this._arr.length};Bt.prototype.keys=function(){return this._arr.map(function(t){return t.key})};Bt.prototype.has=function(t){return Rb.has(this._keyIndices,t)};Bt.prototype.priority=function(t){var e=this._keyIndices[t];if(e!==void 0)return this._arr[e].priority};Bt.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key};Bt.prototype.add=function(t,e){var r=this._keyIndices;if(t=String(t),!Rb.has(r,t)){var n=this._arr,i=n.length;return r[t]=i,n.push({key:t,priority:e}),this._decrease(i),!0}return!1};Bt.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key};Bt.prototype.decrease=function(t,e){var r=this._keyIndices[t];if(e>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[r].priority+" New: "+e);this._arr[r].priority=e,this._decrease(r)};Bt.prototype._heapify=function(t){var e=this._arr,r=2*t,n=r+1,i=t;r<e.length&&(i=e[r].priority<e[i].priority?r:i,n<e.length&&(i=e[n].priority<e[i].priority?n:i),i!==t&&(this._swap(t,i),this._heapify(i)))};Bt.prototype._decrease=function(t){for(var e=this._arr,r=e[t].priority,n;t!==0&&(n=t>>1,!(e[n].priority<r));)this._swap(t,n),t=n};Bt.prototype._swap=function(t,e){var r=this._arr,n=this._keyIndices,i=r[t],s=r[e];r[t]=s,r[e]=i,n[s.key]=t,n[i.key]=e}});var Ad=S((txe,_b)=>{var SV=vt(),TV=Od();_b.exports=AV;var OV=SV.constant(1);function AV(t,e,r,n){return LV(t,String(e),r||OV,n||function(i){return t.outEdges(i)})}function LV(t,e,r,n){var i={},s=new TV,o,a,c=function(l){var f=l.v!==o?l.v:l.w,u=i[f],h=r(l),d=a.distance+h;if(h<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+l+" Weight: "+h);d<u.distance&&(u.distance=d,u.predecessor=o,s.decrease(f,d))};for(t.nodes().forEach(function(l){var f=l===e?0:Number.POSITIVE_INFINITY;i[l]={distance:f},s.add(l,f)});s.size()>0&&(o=s.removeMin(),a=i[o],a.distance!==Number.POSITIVE_INFINITY);)n(o).forEach(c);return i}});var Pb=S((rxe,Ub)=>{var bV=Ad(),kV=vt();Ub.exports=NV;function NV(t,e,r){return kV.transform(t.nodes(),function(n,i){n[i]=bV(t,i,e,r)},{})}});var Ld=S((nxe,Db)=>{var qb=vt();Db.exports=CV;function CV(t){var e=0,r=[],n={},i=[];function s(o){var a=n[o]={onStack:!0,lowlink:e,index:e++};if(r.push(o),t.successors(o).forEach(function(f){qb.has(n,f)?n[f].onStack&&(a.lowlink=Math.min(a.lowlink,n[f].index)):(s(f),a.lowlink=Math.min(a.lowlink,n[f].lowlink))}),a.lowlink===a.index){var c=[],l;do l=r.pop(),n[l].onStack=!1,c.push(l);while(o!==l);i.push(c)}}return t.nodes().forEach(function(o){qb.has(n,o)||s(o)}),i}});var Bb=S((ixe,$b)=>{var vV=vt(),wV=Ld();$b.exports=IV;function IV(t){return vV.filter(wV(t),function(e){return e.length>1||e.length===1&&t.hasEdge(e[0],e[0])})}});var Kb=S((sxe,Fb)=>{var RV=vt();Fb.exports=_V;var MV=RV.constant(1);function _V(t,e,r){return UV(t,e||MV,r||function(n){return t.outEdges(n)})}function UV(t,e,r){var n={},i=t.nodes();return i.forEach(function(s){n[s]={},n[s][s]={distance:0},i.forEach(function(o){s!==o&&(n[s][o]={distance:Number.POSITIVE_INFINITY})}),r(s).forEach(function(o){var a=o.v===s?o.w:o.v,c=e(o);n[s][a]={distance:c,predecessor:s}})}),i.forEach(function(s){var o=n[s];i.forEach(function(a){var c=n[a];i.forEach(function(l){var f=c[s],u=o[l],h=c[l],d=f.distance+u.distance;d<h.distance&&(h.distance=d,h.predecessor=u.predecessor)})})}),n}});var bd=S((oxe,jb)=>{var Po=vt();jb.exports=Gb;Gb.CycleException=Ic;function Gb(t){var e={},r={},n=[];function i(s){if(Po.has(r,s))throw new Ic;Po.has(e,s)||(r[s]=!0,e[s]=!0,Po.each(t.predecessors(s),i),delete r[s],n.push(s))}if(Po.each(t.sinks(),i),Po.size(e)!==t.nodeCount())throw new Ic;return n}function Ic(){}Ic.prototype=new Error});var zb=S((axe,Hb)=>{var Wb=bd();Hb.exports=PV;function PV(t){try{Wb(t)}catch(e){if(e instanceof Wb.CycleException)return!1;throw e}return!0}});var kd=S((lxe,Yb)=>{var Rc=vt();Yb.exports=qV;function qV(t,e,r){Rc.isArray(e)||(e=[e]);var n=(t.isDirected()?t.successors:t.neighbors).bind(t),i=[],s={};return Rc.each(e,function(o){if(!t.hasNode(o))throw new Error("Graph does not have node: "+o);Vb(t,o,r==="post",s,n,i)}),i}function Vb(t,e,r,n,i,s){Rc.has(n,e)||(n[e]=!0,r||s.push(e),Rc.each(i(e),function(o){Vb(t,o,r,n,i,s)}),r&&s.push(e))}});var Xb=S((cxe,Qb)=>{var DV=kd();Qb.exports=$V;function $V(t,e){return DV(t,e,"post")}});var Jb=S((uxe,Zb)=>{var BV=kd();Zb.exports=FV;function FV(t,e){return BV(t,e,"pre")}});var rk=S((hxe,tk)=>{var ek=vt(),KV=vc(),GV=Od();tk.exports=jV;function jV(t,e){var r=new KV,n={},i=new GV,s;function o(c){var l=c.v===s?c.w:c.v,f=i.priority(l);if(f!==void 0){var u=e(c);u<f&&(n[l]=s,i.decrease(l,u))}}if(t.nodeCount()===0)return r;ek.each(t.nodes(),function(c){i.add(c,Number.POSITIVE_INFINITY),r.setNode(c)}),i.decrease(t.nodes()[0],0);for(var a=!1;i.size()>0;){if(s=i.removeMin(),ek.has(n,s))r.setEdge(s,n[s]);else{if(a)throw new Error("Input graph is not connected: "+t);a=!0}t.nodeEdges(s).forEach(o)}return r}});var ik=S((fxe,nk)=>{nk.exports={components:Ib(),dijkstra:Ad(),dijkstraAll:Pb(),findCycles:Bb(),floydWarshall:Kb(),isAcyclic:zb(),postorder:Xb(),preorder:Jb(),prim:rk(),tarjan:Ld(),topsort:bd()}});var ak=S((dxe,ok)=>{var sk=Nb();ok.exports={Graph:sk.Graph,json:vb(),alg:ik(),version:sk.version}});var Ft=S((pxe,lk)=>{var Mc;if(typeof Qn=="function")try{Mc=ak()}catch{}Mc||(Mc=window.graphlib);lk.exports=Mc});var uk=S((gxe,ck)=>{var WV=jf(),HV=1,zV=4;function VV(t){return WV(t,HV|zV)}ck.exports=VV});var qo=S((xxe,hk)=>{var YV=_n(),QV=fr(),XV=Ao(),ZV=Ct();function JV(t,e,r){if(!ZV(r))return!1;var n=typeof e;return(n=="number"?QV(r)&&XV(e,r.length):n=="string"&&e in r)?YV(r[e],t):!1}hk.exports=JV});var pk=S((yxe,dk)=>{var eY=_o(),tY=_n(),rY=qo(),nY=ln(),fk=Object.prototype,iY=fk.hasOwnProperty,sY=eY(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&rY(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=nY(s),a=-1,c=o.length;++a<c;){var l=o[a],f=t[l];(f===void 0||tY(f,fk[l])&&!iY.call(t,l))&&(t[l]=s[l])}return t});dk.exports=sY});var gk=S((Exe,mk)=>{var oY=dr(),aY=fr(),lY=wr();function cY(t){return function(e,r,n){var i=Object(e);if(!aY(e)){var s=oY(r,3);e=lY(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}mk.exports=cY});var yk=S((Sxe,xk)=>{var uY=/\s/;function hY(t){for(var e=t.length;e--&&uY.test(t.charAt(e)););return e}xk.exports=hY});var Sk=S((Txe,Ek)=>{var fY=yk(),dY=/^\s+/;function pY(t){return t&&t.slice(0,fY(t)+1).replace(dY,"")}Ek.exports=pY});var Lk=S((Oxe,Ak)=>{var mY=Sk(),Tk=Ct(),gY=$n(),Ok=NaN,xY=/^[-+]0x[0-9a-f]+$/i,yY=/^0b[01]+$/i,EY=/^0o[0-7]+$/i,SY=parseInt;function TY(t){if(typeof t=="number")return t;if(gY(t))return Ok;if(Tk(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Tk(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=mY(t);var r=yY.test(t);return r||EY.test(t)?SY(t.slice(2),r?2:8):xY.test(t)?Ok:+t}Ak.exports=TY});var Nd=S((Axe,kk)=>{var OY=Lk(),bk=1/0,AY=17976931348623157e292;function LY(t){if(!t)return t===0?t:0;if(t=OY(t),t===bk||t===-bk){var e=t<0?-1:1;return e*AY}return t===t?t:0}kk.exports=LY});var Ck=S((Lxe,Nk)=>{var bY=Nd();function kY(t){var e=bY(t),r=e%1;return e===e?r?e-r:e:0}Nk.exports=kY});var wk=S((bxe,vk)=>{var NY=xd(),CY=dr(),vY=Ck(),wY=Math.max;function IY(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:vY(r);return i<0&&(i=wY(n+i,0)),NY(t,CY(e,3),i)}vk.exports=IY});var Rk=S((kxe,Ik)=>{var RY=gk(),MY=wk(),_Y=RY(MY);Ik.exports=_Y});var Cd=S((Nxe,Mk)=>{var UY=Nc();function PY(t){var e=t==null?0:t.length;return e?UY(t,1):[]}Mk.exports=PY});var Uk=S((Cxe,_k)=>{var qY=Tc(),DY=Wf(),$Y=ln();function BY(t,e){return t==null?t:qY(t,DY(e),$Y)}_k.exports=BY});var qk=S((vxe,Pk)=>{function FY(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}Pk.exports=FY});var $k=S((wxe,Dk)=>{var KY=So(),GY=Oc(),jY=dr();function WY(t,e){var r={};return e=jY(e,3),GY(t,function(n,i,s){KY(r,i,e(n,i,s))}),r}Dk.exports=WY});var _c=S((Ixe,Bk)=>{var HY=$n();function zY(t,e,r){for(var n=-1,i=t.length;++n<i;){var s=t[n],o=e(s);if(o!=null&&(a===void 0?o===o&&!HY(o):r(o,a)))var a=o,c=s}return c}Bk.exports=zY});var Kk=S((Rxe,Fk)=>{function VY(t,e){return t>e}Fk.exports=VY});var jk=S((Mxe,Gk)=>{var YY=_c(),QY=Kk(),XY=cn();function ZY(t){return t&&t.length?YY(t,XY,QY):void 0}Gk.exports=ZY});var vd=S((_xe,Wk)=>{var JY=So(),e4=_n();function t4(t,e,r){(r!==void 0&&!e4(t[e],r)||r===void 0&&!(e in t))&&JY(t,e,r)}Wk.exports=t4});var Vk=S((Uxe,zk)=>{var r4=on(),n4=vo(),i4=Vt(),s4="[object Object]",o4=Function.prototype,a4=Object.prototype,Hk=o4.toString,l4=a4.hasOwnProperty,c4=Hk.call(Object);function u4(t){if(!i4(t)||r4(t)!=s4)return!1;var e=n4(t);if(e===null)return!0;var r=l4.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Hk.call(r)==c4}zk.exports=u4});var wd=S((Pxe,Yk)=>{function h4(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}Yk.exports=h4});var Xk=S((qxe,Qk)=>{var f4=ts(),d4=ln();function p4(t){return f4(t,d4(t))}Qk.exports=p4});var nN=S((Dxe,rN)=>{var Zk=vd(),m4=Nf(),g4=Ff(),x4=Cf(),y4=Gf(),Jk=rs(),eN=Pe(),E4=Ed(),S4=Pn(),T4=Xi(),O4=Ct(),A4=Vk(),L4=ss(),tN=wd(),b4=Xk();function k4(t,e,r,n,i,s,o){var a=tN(t,r),c=tN(e,r),l=o.get(c);if(l){Zk(t,r,l);return}var f=s?s(a,c,r+"",t,e,o):void 0,u=f===void 0;if(u){var h=eN(c),d=!h&&S4(c),p=!h&&!d&&L4(c);f=c,h||d||p?eN(a)?f=a:E4(a)?f=x4(a):d?(u=!1,f=m4(c,!0)):p?(u=!1,f=g4(c,!0)):f=[]:A4(c)||Jk(c)?(f=a,Jk(a)?f=b4(a):(!O4(a)||T4(a))&&(f=y4(c))):u=!1}u&&(o.set(c,f),i(f,c,n,s,o),o.delete(c)),Zk(t,r,f)}rN.exports=k4});var oN=S(($xe,sN)=>{var N4=Eo(),C4=vd(),v4=Tc(),w4=nN(),I4=Ct(),R4=ln(),M4=wd();function iN(t,e,r,n,i){t!==e&&v4(e,function(s,o){if(i||(i=new N4),I4(s))w4(t,e,o,r,iN,n,i);else{var a=n?n(M4(t,o),s,o+"",t,e,i):void 0;a===void 0&&(a=s),C4(t,o,a)}},R4)}sN.exports=iN});var lN=S((Bxe,aN)=>{var _4=_o(),U4=qo();function P4(t){return _4(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&U4(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}aN.exports=P4});var uN=S((Fxe,cN)=>{var q4=oN(),D4=lN(),$4=D4(function(t,e,r){q4(t,e,r)});cN.exports=$4});var Id=S((Kxe,hN)=>{function B4(t,e){return t<e}hN.exports=B4});var dN=S((Gxe,fN)=>{var F4=_c(),K4=Id(),G4=cn();function j4(t){return t&&t.length?F4(t,G4,K4):void 0}fN.exports=j4});var mN=S((jxe,pN)=>{var W4=_c(),H4=dr(),z4=Id();function V4(t,e){return t&&t.length?W4(t,H4(e,2),z4):void 0}pN.exports=V4});var xN=S((Wxe,gN)=>{var Y4=$t(),Q4=function(){return Y4.Date.now()};gN.exports=Q4});var SN=S((Hxe,EN)=>{var X4=To(),Z4=Ro(),J4=Ao(),yN=Ct(),e5=ls();function t5(t,e,r,n){if(!yN(t))return t;e=Z4(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=e5(e[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var f=a[c];l=n?n(f,c,a):void 0,l===void 0&&(l=yN(f)?f:J4(e[i+1])?[]:{})}X4(a,c,l),a=a[c]}return t}EN.exports=t5});var ON=S((zxe,TN)=>{var r5=Mo(),n5=SN(),i5=Ro();function s5(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=r5(t,o);r(a,o)&&n5(s,i5(o,t),a)}return s}TN.exports=s5});var LN=S((Vxe,AN)=>{var o5=ON(),a5=sd();function l5(t,e){return o5(t,e,function(r,n){return a5(t,n)})}AN.exports=l5});var kN=S((Yxe,bN)=>{var c5=Cd(),u5=md(),h5=gd();function f5(t){return h5(u5(t,void 0,c5),t+"")}bN.exports=f5});var CN=S((Qxe,NN)=>{var d5=LN(),p5=kN(),m5=p5(function(t,e){return t==null?{}:d5(t,e)});NN.exports=m5});var wN=S((Xxe,vN)=>{var g5=Math.ceil,x5=Math.max;function y5(t,e,r,n){for(var i=-1,s=x5(g5((e-t)/(r||1)),0),o=Array(s);s--;)o[n?s:++i]=t,t+=r;return o}vN.exports=y5});var RN=S((Zxe,IN)=>{var E5=wN(),S5=qo(),Rd=Nd();function T5(t){return function(e,r,n){return n&&typeof n!="number"&&S5(e,r,n)&&(r=n=void 0),e=Rd(e),r===void 0?(r=e,e=0):r=Rd(r),n=n===void 0?e<r?1:-1:Rd(n),E5(e,r,n,t)}}IN.exports=T5});var _N=S((Jxe,MN)=>{var O5=RN(),A5=O5();MN.exports=A5});var PN=S((eye,UN)=>{function L5(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}UN.exports=L5});var $N=S((tye,DN)=>{var qN=$n();function b5(t,e){if(t!==e){var r=t!==void 0,n=t===null,i=t===t,s=qN(t),o=e!==void 0,a=e===null,c=e===e,l=qN(e);if(!a&&!l&&!s&&t>e||s&&o&&c&&!a&&!l||n&&o&&c||!r&&c||!i)return 1;if(!n&&!s&&!l&&t<e||l&&r&&i&&!n&&!s||a&&r&&i||!o&&i||!c)return-1}return 0}DN.exports=b5});var FN=S((rye,BN)=>{var k5=$N();function N5(t,e,r){for(var n=-1,i=t.criteria,s=e.criteria,o=i.length,a=r.length;++n<o;){var c=k5(i[n],s[n]);if(c){if(n>=a)return c;var l=r[n];return c*(l=="desc"?-1:1)}}return t.index-e.index}BN.exports=N5});var GN=S((nye,KN)=>{var Md=Io(),C5=Mo(),v5=dr(),w5=ud(),I5=PN(),R5=Lo(),M5=FN(),_5=cn(),U5=Pe();function P5(t,e,r){e.length?e=Md(e,function(s){return U5(s)?function(o){return C5(o,s.length===1?s[0]:s)}:s}):e=[_5];var n=-1;e=Md(e,R5(v5));var i=w5(t,function(s,o,a){var c=Md(e,function(l){return l(s)});return{criteria:c,index:++n,value:s}});return I5(i,function(s,o){return M5(s,o,r)})}KN.exports=P5});var HN=S((iye,WN)=>{var q5=Nc(),D5=GN(),$5=_o(),jN=qo(),B5=$5(function(t,e){if(t==null)return[];var r=e.length;return r>1&&jN(t,e[0],e[1])?e=[]:r>2&&jN(e[0],e[1],e[2])&&(e=[e[0]]),D5(t,q5(e,1),[])});WN.exports=B5});var VN=S((sye,zN)=>{var F5=nd(),K5=0;function G5(t){var e=++K5;return F5(t)+e}zN.exports=G5});var QN=S((oye,YN)=>{function j5(t,e,r){for(var n=-1,i=t.length,s=e.length,o={};++n<i;){var a=n<s?e[n]:void 0;r(o,t[n],a)}return o}YN.exports=j5});var ZN=S((aye,XN)=>{var W5=To(),H5=QN();function z5(t,e){return H5(t||[],e||[],W5)}XN.exports=z5});var Ee=S((lye,JN)=>{var Uc;if(typeof Qn=="function")try{Uc={cloneDeep:uk(),constant:Sc(),defaults:pk(),each:zf(),filter:ad(),find:Rk(),flatten:Cd(),forEach:Hf(),forIn:Uk(),has:ld(),isUndefined:cd(),last:qk(),map:hd(),mapValues:$k(),max:jk(),merge:uN(),min:dN(),minBy:mN(),now:xN(),pick:CN(),range:_N(),reduce:fd(),sortBy:HN(),uniqueId:VN(),values:Sd(),zipObject:ZN()}}catch{}Uc||(Uc=window._);JN.exports=Uc});var rC=S((uye,tC)=>{tC.exports=Pc;function Pc(){var t={};t._next=t._prev=t,this._sentinel=t}Pc.prototype.dequeue=function(){var t=this._sentinel,e=t._prev;if(e!==t)return eC(e),e};Pc.prototype.enqueue=function(t){var e=this._sentinel;t._prev&&t._next&&eC(t),t._next=e._next,e._next._prev=t,e._next=t,t._prev=e};Pc.prototype.toString=function(){for(var t=[],e=this._sentinel,r=e._prev;r!==e;)t.push(JSON.stringify(r,V5)),r=r._prev;return"["+t.join(", ")+"]"};function eC(t){t._prev._next=t._next,t._next._prev=t._prev,delete t._next,delete t._prev}function V5(t,e){if(t!=="_next"&&t!=="_prev")return e}});var iC=S((hye,nC)=>{var Ir=Ee(),Y5=Ft().Graph,Q5=rC();nC.exports=Z5;var X5=Ir.constant(1);function Z5(t,e){if(t.nodeCount()<=1)return[];var r=eQ(t,e||X5),n=J5(r.graph,r.buckets,r.zeroIdx);return Ir.flatten(Ir.map(n,function(i){return t.outEdges(i.v,i.w)}),!0)}function J5(t,e,r){for(var n=[],i=e[e.length-1],s=e[0],o;t.nodeCount();){for(;o=s.dequeue();)_d(t,e,r,o);for(;o=i.dequeue();)_d(t,e,r,o);if(t.nodeCount()){for(var a=e.length-2;a>0;--a)if(o=e[a].dequeue(),o){n=n.concat(_d(t,e,r,o,!0));break}}}return n}function _d(t,e,r,n,i){var s=i?[]:void 0;return Ir.forEach(t.inEdges(n.v),function(o){var a=t.edge(o),c=t.node(o.v);i&&s.push({v:o.v,w:o.w}),c.out-=a,Ud(e,r,c)}),Ir.forEach(t.outEdges(n.v),function(o){var a=t.edge(o),c=o.w,l=t.node(c);l.in-=a,Ud(e,r,l)}),t.removeNode(n.v),s}function eQ(t,e){var r=new Y5,n=0,i=0;Ir.forEach(t.nodes(),function(a){r.setNode(a,{v:a,in:0,out:0})}),Ir.forEach(t.edges(),function(a){var c=r.edge(a.v,a.w)||0,l=e(a),f=c+l;r.setEdge(a.v,a.w,f),i=Math.max(i,r.node(a.v).out+=l),n=Math.max(n,r.node(a.w).in+=l)});var s=Ir.range(i+n+3).map(function(){return new Q5}),o=n+1;return Ir.forEach(r.nodes(),function(a){Ud(s,o,r.node(a))}),{graph:r,buckets:s,zeroIdx:o}}function Ud(t,e,r){r.out?r.in?t[r.out-r.in+e].enqueue(r):t[t.length-1].enqueue(r):t[0].enqueue(r)}});var oC=S((fye,sC)=>{"use strict";var Fn=Ee(),tQ=iC();sC.exports={run:rQ,undo:iQ};function rQ(t){var e=t.graph().acyclicer==="greedy"?tQ(t,r(t)):nQ(t);Fn.forEach(e,function(n){var i=t.edge(n);t.removeEdge(n),i.forwardName=n.name,i.reversed=!0,t.setEdge(n.w,n.v,i,Fn.uniqueId("rev"))});function r(n){return function(i){return n.edge(i).weight}}}function nQ(t){var e=[],r={},n={};function i(s){Fn.has(n,s)||(n[s]=!0,r[s]=!0,Fn.forEach(t.outEdges(s),function(o){Fn.has(r,o.w)?e.push(o):i(o.w)}),delete r[s])}return Fn.forEach(t.nodes(),i),e}function iQ(t){Fn.forEach(t.edges(),function(e){var r=t.edge(e);if(r.reversed){t.removeEdge(e);var n=r.forwardName;delete r.reversed,delete r.forwardName,t.setEdge(e.w,e.v,r,n)}})}});var mt=S((dye,uC)=>{"use strict";var ne=Ee(),aC=Ft().Graph;uC.exports={addDummyNode:lC,simplify:sQ,asNonCompoundGraph:oQ,successorWeights:aQ,predecessorWeights:lQ,intersectRect:cQ,buildLayerMatrix:uQ,normalizeRanks:hQ,removeEmptyRanks:fQ,addBorderNode:dQ,maxRank:cC,partition:pQ,time:mQ,notime:gQ};function lC(t,e,r,n){var i;do i=ne.uniqueId(n);while(t.hasNode(i));return r.dummy=e,t.setNode(i,r),i}function sQ(t){var e=new aC().setGraph(t.graph());return ne.forEach(t.nodes(),function(r){e.setNode(r,t.node(r))}),ne.forEach(t.edges(),function(r){var n=e.edge(r.v,r.w)||{weight:0,minlen:1},i=t.edge(r);e.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})}),e}function oQ(t){var e=new aC({multigraph:t.isMultigraph()}).setGraph(t.graph());return ne.forEach(t.nodes(),function(r){t.children(r).length||e.setNode(r,t.node(r))}),ne.forEach(t.edges(),function(r){e.setEdge(r,t.edge(r))}),e}function aQ(t){var e=ne.map(t.nodes(),function(r){var n={};return ne.forEach(t.outEdges(r),function(i){n[i.w]=(n[i.w]||0)+t.edge(i).weight}),n});return ne.zipObject(t.nodes(),e)}function lQ(t){var e=ne.map(t.nodes(),function(r){var n={};return ne.forEach(t.inEdges(r),function(i){n[i.v]=(n[i.v]||0)+t.edge(i).weight}),n});return ne.zipObject(t.nodes(),e)}function cQ(t,e){var r=t.x,n=t.y,i=e.x-r,s=e.y-n,o=t.width/2,a=t.height/2;if(!i&&!s)throw new Error("Not possible to find intersection inside of the rectangle");var c,l;return Math.abs(s)*o>Math.abs(i)*a?(s<0&&(a=-a),c=a*i/s,l=a):(i<0&&(o=-o),c=o,l=o*s/i),{x:r+c,y:n+l}}function uQ(t){var e=ne.map(ne.range(cC(t)+1),function(){return[]});return ne.forEach(t.nodes(),function(r){var n=t.node(r),i=n.rank;ne.isUndefined(i)||(e[i][n.order]=r)}),e}function hQ(t){var e=ne.min(ne.map(t.nodes(),function(r){return t.node(r).rank}));ne.forEach(t.nodes(),function(r){var n=t.node(r);ne.has(n,"rank")&&(n.rank-=e)})}function fQ(t){var e=ne.min(ne.map(t.nodes(),function(s){return t.node(s).rank})),r=[];ne.forEach(t.nodes(),function(s){var o=t.node(s).rank-e;r[o]||(r[o]=[]),r[o].push(s)});var n=0,i=t.graph().nodeRankFactor;ne.forEach(r,function(s,o){ne.isUndefined(s)&&o%i!==0?--n:n&&ne.forEach(s,function(a){t.node(a).rank+=n})})}function dQ(t,e,r,n){var i={width:0,height:0};return arguments.length>=4&&(i.rank=r,i.order=n),lC(t,"border",i,e)}function cC(t){return ne.max(ne.map(t.nodes(),function(e){var r=t.node(e).rank;if(!ne.isUndefined(r))return r}))}function pQ(t,e){var r={lhs:[],rhs:[]};return ne.forEach(t,function(n){e(n)?r.lhs.push(n):r.rhs.push(n)}),r}function mQ(t,e){var r=ne.now();try{return e()}finally{console.log(t+" time: "+(ne.now()-r)+"ms")}}function gQ(t,e){return e()}});var dC=S((pye,fC)=>{"use strict";var hC=Ee(),xQ=mt();fC.exports={run:yQ,undo:SQ};function yQ(t){t.graph().dummyChains=[],hC.forEach(t.edges(),function(e){EQ(t,e)})}function EQ(t,e){var r=e.v,n=t.node(r).rank,i=e.w,s=t.node(i).rank,o=e.name,a=t.edge(e),c=a.labelRank;if(s!==n+1){t.removeEdge(e);var l,f,u;for(u=0,++n;n<s;++u,++n)a.points=[],f={width:0,height:0,edgeLabel:a,edgeObj:e,rank:n},l=xQ.addDummyNode(t,"edge",f,"_d"),n===c&&(f.width=a.width,f.height=a.height,f.dummy="edge-label",f.labelpos=a.labelpos),t.setEdge(r,l,{weight:a.weight},o),u===0&&t.graph().dummyChains.push(l),r=l;t.setEdge(r,i,{weight:a.weight},o)}}function SQ(t){hC.forEach(t.graph().dummyChains,function(e){var r=t.node(e),n=r.edgeLabel,i;for(t.setEdge(r.edgeObj,n);r.dummy;)i=t.successors(e)[0],t.removeNode(e),n.points.push({x:r.x,y:r.y}),r.dummy==="edge-label"&&(n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height),e=i,r=t.node(e)})}});var Do=S((mye,pC)=>{"use strict";var qc=Ee();pC.exports={longestPath:TQ,slack:OQ};function TQ(t){var e={};function r(n){var i=t.node(n);if(qc.has(e,n))return i.rank;e[n]=!0;var s=qc.min(qc.map(t.outEdges(n),function(o){return r(o.w)-t.edge(o).minlen}));return(s===Number.POSITIVE_INFINITY||s===void 0||s===null)&&(s=0),i.rank=s}qc.forEach(t.sources(),r)}function OQ(t,e){return t.node(e.w).rank-t.node(e.v).rank-t.edge(e).minlen}});var Pd=S((gye,mC)=>{"use strict";var Dc=Ee(),AQ=Ft().Graph,$c=Do().slack;mC.exports=LQ;function LQ(t){var e=new AQ({directed:!1}),r=t.nodes()[0],n=t.nodeCount();e.setNode(r,{});for(var i,s;bQ(e,t)<n;)i=kQ(e,t),s=e.hasNode(i.v)?$c(t,i):-$c(t,i),NQ(e,t,s);return e}function bQ(t,e){function r(n){Dc.forEach(e.nodeEdges(n),function(i){var s=i.v,o=n===s?i.w:s;!t.hasNode(o)&&!$c(e,i)&&(t.setNode(o,{}),t.setEdge(n,o,{}),r(o))})}return Dc.forEach(t.nodes(),r),t.nodeCount()}function kQ(t,e){return Dc.minBy(e.edges(),function(r){if(t.hasNode(r.v)!==t.hasNode(r.w))return $c(e,r)})}function NQ(t,e,r){Dc.forEach(t.nodes(),function(n){e.node(n).rank+=r})}});var AC=S((xye,OC)=>{"use strict";var Rr=Ee(),CQ=Pd(),vQ=Do().slack,wQ=Do().longestPath,IQ=Ft().alg.preorder,RQ=Ft().alg.postorder,MQ=mt().simplify;OC.exports=Kn;Kn.initLowLimValues=Dd;Kn.initCutValues=qd;Kn.calcCutValue=xC;Kn.leaveEdge=EC;Kn.enterEdge=SC;Kn.exchangeEdges=TC;function Kn(t){t=MQ(t),wQ(t);var e=CQ(t);Dd(e),qd(e,t);for(var r,n;r=EC(e);)n=SC(e,t,r),TC(e,t,r,n)}function qd(t,e){var r=RQ(t,t.nodes());r=r.slice(0,r.length-1),Rr.forEach(r,function(n){_Q(t,e,n)})}function _Q(t,e,r){var n=t.node(r),i=n.parent;t.edge(r,i).cutvalue=xC(t,e,r)}function xC(t,e,r){var n=t.node(r),i=n.parent,s=!0,o=e.edge(r,i),a=0;return o||(s=!1,o=e.edge(i,r)),a=o.weight,Rr.forEach(e.nodeEdges(r),function(c){var l=c.v===r,f=l?c.w:c.v;if(f!==i){var u=l===s,h=e.edge(c).weight;if(a+=u?h:-h,PQ(t,r,f)){var d=t.edge(r,f).cutvalue;a+=u?-d:d}}}),a}function Dd(t,e){arguments.length<2&&(e=t.nodes()[0]),yC(t,{},1,e)}function yC(t,e,r,n,i){var s=r,o=t.node(n);return e[n]=!0,Rr.forEach(t.neighbors(n),function(a){Rr.has(e,a)||(r=yC(t,e,r,a,n))}),o.low=s,o.lim=r++,i?o.parent=i:delete o.parent,r}function EC(t){return Rr.find(t.edges(),function(e){return t.edge(e).cutvalue<0})}function SC(t,e,r){var n=r.v,i=r.w;e.hasEdge(n,i)||(n=r.w,i=r.v);var s=t.node(n),o=t.node(i),a=s,c=!1;s.lim>o.lim&&(a=o,c=!0);var l=Rr.filter(e.edges(),function(f){return c===gC(t,t.node(f.v),a)&&c!==gC(t,t.node(f.w),a)});return Rr.minBy(l,function(f){return vQ(e,f)})}function TC(t,e,r,n){var i=r.v,s=r.w;t.removeEdge(i,s),t.setEdge(n.v,n.w,{}),Dd(t),qd(t,e),UQ(t,e)}function UQ(t,e){var r=Rr.find(t.nodes(),function(i){return!e.node(i).parent}),n=IQ(t,r);n=n.slice(1),Rr.forEach(n,function(i){var s=t.node(i).parent,o=e.edge(i,s),a=!1;o||(o=e.edge(s,i),a=!0),e.node(i).rank=e.node(s).rank+(a?o.minlen:-o.minlen)})}function PQ(t,e,r){return t.hasEdge(e,r)}function gC(t,e,r){return r.low<=e.lim&&e.lim<=r.lim}});var NC=S((yye,kC)=>{"use strict";var qQ=Do(),bC=qQ.longestPath,DQ=Pd(),$Q=AC();kC.exports=BQ;function BQ(t){switch(t.graph().ranker){case"network-simplex":LC(t);break;case"tight-tree":KQ(t);break;case"longest-path":FQ(t);break;default:LC(t)}}var FQ=bC;function KQ(t){bC(t),DQ(t)}function LC(t){$Q(t)}});var vC=S((Eye,CC)=>{var $d=Ee();CC.exports=GQ;function GQ(t){var e=WQ(t);$d.forEach(t.graph().dummyChains,function(r){for(var n=t.node(r),i=n.edgeObj,s=jQ(t,e,i.v,i.w),o=s.path,a=s.lca,c=0,l=o[c],f=!0;r!==i.w;){if(n=t.node(r),f){for(;(l=o[c])!==a&&t.node(l).maxRank<n.rank;)c++;l===a&&(f=!1)}if(!f){for(;c<o.length-1&&t.node(l=o[c+1]).minRank<=n.rank;)c++;l=o[c]}t.setParent(r,l),r=t.successors(r)[0]}})}function jQ(t,e,r,n){var i=[],s=[],o=Math.min(e[r].low,e[n].low),a=Math.max(e[r].lim,e[n].lim),c,l;c=r;do c=t.parent(c),i.push(c);while(c&&(e[c].low>o||a>e[c].lim));for(l=c,c=n;(c=t.parent(c))!==l;)s.push(c);return{path:i.concat(s.reverse()),lca:l}}function WQ(t){var e={},r=0;function n(i){var s=r;$d.forEach(t.children(i),n),e[i]={low:s,lim:r++}}return $d.forEach(t.children(),n),e}});var RC=S((Sye,IC)=>{var Mr=Ee(),Bd=mt();IC.exports={run:HQ,cleanup:YQ};function HQ(t){var e=Bd.addDummyNode(t,"root",{},"_root"),r=zQ(t),n=Mr.max(Mr.values(r))-1,i=2*n+1;t.graph().nestingRoot=e,Mr.forEach(t.edges(),function(o){t.edge(o).minlen*=i});var s=VQ(t)+1;Mr.forEach(t.children(),function(o){wC(t,e,i,s,n,r,o)}),t.graph().nodeRankFactor=i}function wC(t,e,r,n,i,s,o){var a=t.children(o);if(!a.length){o!==e&&t.setEdge(e,o,{weight:0,minlen:r});return}var c=Bd.addBorderNode(t,"_bt"),l=Bd.addBorderNode(t,"_bb"),f=t.node(o);t.setParent(c,o),f.borderTop=c,t.setParent(l,o),f.borderBottom=l,Mr.forEach(a,function(u){wC(t,e,r,n,i,s,u);var h=t.node(u),d=h.borderTop?h.borderTop:u,p=h.borderBottom?h.borderBottom:u,m=h.borderTop?n:2*n,g=d!==p?1:i-s[o]+1;t.setEdge(c,d,{weight:m,minlen:g,nestingEdge:!0}),t.setEdge(p,l,{weight:m,minlen:g,nestingEdge:!0})}),t.parent(o)||t.setEdge(e,c,{weight:0,minlen:i+s[o]})}function zQ(t){var e={};function r(n,i){var s=t.children(n);s&&s.length&&Mr.forEach(s,function(o){r(o,i+1)}),e[n]=i}return Mr.forEach(t.children(),function(n){r(n,1)}),e}function VQ(t){return Mr.reduce(t.edges(),function(e,r){return e+t.edge(r).weight},0)}function YQ(t){var e=t.graph();t.removeNode(e.nestingRoot),delete e.nestingRoot,Mr.forEach(t.edges(),function(r){var n=t.edge(r);n.nestingEdge&&t.removeEdge(r)})}});var UC=S((Tye,_C)=>{var Fd=Ee(),QQ=mt();_C.exports=XQ;function XQ(t){function e(r){var n=t.children(r),i=t.node(r);if(n.length&&Fd.forEach(n,e),Fd.has(i,"minRank")){i.borderLeft=[],i.borderRight=[];for(var s=i.minRank,o=i.maxRank+1;s<o;++s)MC(t,"borderLeft","_bl",r,i,s),MC(t,"borderRight","_br",r,i,s)}}Fd.forEach(t.children(),e)}function MC(t,e,r,n,i,s){var o={width:0,height:0,rank:s,borderType:e},a=i[e][s-1],c=QQ.addDummyNode(t,"border",o,r);i[e][s]=c,t.setParent(c,n),a&&t.setEdge(a,c,{weight:1})}});var $C=S((Oye,DC)=>{"use strict";var mr=Ee();DC.exports={adjust:ZQ,undo:JQ};function ZQ(t){var e=t.graph().rankdir.toLowerCase();(e==="lr"||e==="rl")&&qC(t)}function JQ(t){var e=t.graph().rankdir.toLowerCase();(e==="bt"||e==="rl")&&e6(t),(e==="lr"||e==="rl")&&(t6(t),qC(t))}function qC(t){mr.forEach(t.nodes(),function(e){PC(t.node(e))}),mr.forEach(t.edges(),function(e){PC(t.edge(e))})}function PC(t){var e=t.width;t.width=t.height,t.height=e}function e6(t){mr.forEach(t.nodes(),function(e){Kd(t.node(e))}),mr.forEach(t.edges(),function(e){var r=t.edge(e);mr.forEach(r.points,Kd),mr.has(r,"y")&&Kd(r)})}function Kd(t){t.y=-t.y}function t6(t){mr.forEach(t.nodes(),function(e){Gd(t.node(e))}),mr.forEach(t.edges(),function(e){var r=t.edge(e);mr.forEach(r.points,Gd),mr.has(r,"x")&&Gd(r)})}function Gd(t){var e=t.x;t.x=t.y,t.y=e}});var FC=S((Aye,BC)=>{"use strict";var _r=Ee();BC.exports=r6;function r6(t){var e={},r=_r.filter(t.nodes(),function(a){return!t.children(a).length}),n=_r.max(_r.map(r,function(a){return t.node(a).rank})),i=_r.map(_r.range(n+1),function(){return[]});function s(a){if(!_r.has(e,a)){e[a]=!0;var c=t.node(a);i[c.rank].push(a),_r.forEach(t.successors(a),s)}}var o=_r.sortBy(r,function(a){return t.node(a).rank});return _r.forEach(o,s),i}});var GC=S((Lye,KC)=>{"use strict";var un=Ee();KC.exports=n6;function n6(t,e){for(var r=0,n=1;n<e.length;++n)r+=i6(t,e[n-1],e[n]);return r}function i6(t,e,r){for(var n=un.zipObject(r,un.map(r,function(l,f){return f})),i=un.flatten(un.map(e,function(l){return un.sortBy(un.map(t.outEdges(l),function(f){return{pos:n[f.w],weight:t.edge(f).weight}}),"pos")}),!0),s=1;s<r.length;)s<<=1;var o=2*s-1;s-=1;var a=un.map(new Array(o),function(){return 0}),c=0;return un.forEach(i.forEach(function(l){var f=l.pos+s;a[f]+=l.weight;for(var u=0;f>0;)f%2&&(u+=a[f+1]),f=f-1>>1,a[f]+=l.weight;c+=l.weight*u})),c}});var HC=S((bye,WC)=>{var jC=Ee();WC.exports=s6;function s6(t,e){return jC.map(e,function(r){var n=t.inEdges(r);if(n.length){var i=jC.reduce(n,function(s,o){var a=t.edge(o),c=t.node(o.v);return{sum:s.sum+a.weight*c.order,weight:s.weight+a.weight}},{sum:0,weight:0});return{v:r,barycenter:i.sum/i.weight,weight:i.weight}}else return{v:r}})}});var VC=S((kye,zC)=>{"use strict";var wt=Ee();zC.exports=o6;function o6(t,e){var r={};wt.forEach(t,function(i,s){var o=r[i.v]={indegree:0,in:[],out:[],vs:[i.v],i:s};wt.isUndefined(i.barycenter)||(o.barycenter=i.barycenter,o.weight=i.weight)}),wt.forEach(e.edges(),function(i){var s=r[i.v],o=r[i.w];!wt.isUndefined(s)&&!wt.isUndefined(o)&&(o.indegree++,s.out.push(r[i.w]))});var n=wt.filter(r,function(i){return!i.indegree});return a6(n)}function a6(t){var e=[];function r(s){return function(o){o.merged||(wt.isUndefined(o.barycenter)||wt.isUndefined(s.barycenter)||o.barycenter>=s.barycenter)&&l6(s,o)}}function n(s){return function(o){o.in.push(s),--o.indegree===0&&t.push(o)}}for(;t.length;){var i=t.pop();e.push(i),wt.forEach(i.in.reverse(),r(i)),wt.forEach(i.out,n(i))}return wt.map(wt.filter(e,function(s){return!s.merged}),function(s){return wt.pick(s,["vs","i","barycenter","weight"])})}function l6(t,e){var r=0,n=0;t.weight&&(r+=t.barycenter*t.weight,n+=t.weight),e.weight&&(r+=e.barycenter*e.weight,n+=e.weight),t.vs=e.vs.concat(t.vs),t.barycenter=r/n,t.weight=n,t.i=Math.min(e.i,t.i),e.merged=!0}});var XC=S((Nye,QC)=>{var $o=Ee(),c6=mt();QC.exports=u6;function u6(t,e){var r=c6.partition(t,function(f){return $o.has(f,"barycenter")}),n=r.lhs,i=$o.sortBy(r.rhs,function(f){return-f.i}),s=[],o=0,a=0,c=0;n.sort(h6(!!e)),c=YC(s,i,c),$o.forEach(n,function(f){c+=f.vs.length,s.push(f.vs),o+=f.barycenter*f.weight,a+=f.weight,c=YC(s,i,c)});var l={vs:$o.flatten(s,!0)};return a&&(l.barycenter=o/a,l.weight=a),l}function YC(t,e,r){for(var n;e.length&&(n=$o.last(e)).i<=r;)e.pop(),t.push(n.vs),r++;return r}function h6(t){return function(e,r){return e.barycenter<r.barycenter?-1:e.barycenter>r.barycenter?1:t?r.i-e.i:e.i-r.i}}});var ev=S((Cye,JC)=>{var hn=Ee(),f6=HC(),d6=VC(),p6=XC();JC.exports=ZC;function ZC(t,e,r,n){var i=t.children(e),s=t.node(e),o=s?s.borderLeft:void 0,a=s?s.borderRight:void 0,c={};o&&(i=hn.filter(i,function(p){return p!==o&&p!==a}));var l=f6(t,i);hn.forEach(l,function(p){if(t.children(p.v).length){var m=ZC(t,p.v,r,n);c[p.v]=m,hn.has(m,"barycenter")&&g6(p,m)}});var f=d6(l,r);m6(f,c);var u=p6(f,n);if(o&&(u.vs=hn.flatten([o,u.vs,a],!0),t.predecessors(o).length)){var h=t.node(t.predecessors(o)[0]),d=t.node(t.predecessors(a)[0]);hn.has(u,"barycenter")||(u.barycenter=0,u.weight=0),u.barycenter=(u.barycenter*u.weight+h.order+d.order)/(u.weight+2),u.weight+=2}return u}function m6(t,e){hn.forEach(t,function(r){r.vs=hn.flatten(r.vs.map(function(n){return e[n]?e[n].vs:n}),!0)})}function g6(t,e){hn.isUndefined(t.barycenter)?(t.barycenter=e.barycenter,t.weight=e.weight):(t.barycenter=(t.barycenter*t.weight+e.barycenter*e.weight)/(t.weight+e.weight),t.weight+=e.weight)}});var rv=S((vye,tv)=>{var Bo=Ee(),x6=Ft().Graph;tv.exports=y6;function y6(t,e,r){var n=E6(t),i=new x6({compound:!0}).setGraph({root:n}).setDefaultNodeLabel(function(s){return t.node(s)});return Bo.forEach(t.nodes(),function(s){var o=t.node(s),a=t.parent(s);(o.rank===e||o.minRank<=e&&e<=o.maxRank)&&(i.setNode(s),i.setParent(s,a||n),Bo.forEach(t[r](s),function(c){var l=c.v===s?c.w:c.v,f=i.edge(l,s),u=Bo.isUndefined(f)?0:f.weight;i.setEdge(l,s,{weight:t.edge(c).weight+u})}),Bo.has(o,"minRank")&&i.setNode(s,{borderLeft:o.borderLeft[e],borderRight:o.borderRight[e]}))}),i}function E6(t){for(var e;t.hasNode(e=Bo.uniqueId("_root")););return e}});var iv=S((wye,nv)=>{var S6=Ee();nv.exports=T6;function T6(t,e,r){var n={},i;S6.forEach(r,function(s){for(var o=t.parent(s),a,c;o;){if(a=t.parent(o),a?(c=n[a],n[a]=o):(c=i,i=o),c&&c!==o){e.setEdge(c,o);return}o=a}})}});var cv=S((Iye,lv)=>{"use strict";var fn=Ee(),O6=FC(),A6=GC(),L6=ev(),b6=rv(),k6=iv(),N6=Ft().Graph,sv=mt();lv.exports=C6;function C6(t){var e=sv.maxRank(t),r=ov(t,fn.range(1,e+1),"inEdges"),n=ov(t,fn.range(e-1,-1,-1),"outEdges"),i=O6(t);av(t,i);for(var s=Number.POSITIVE_INFINITY,o,a=0,c=0;c<4;++a,++c){v6(a%2?r:n,a%4>=2),i=sv.buildLayerMatrix(t);var l=A6(t,i);l<s&&(c=0,o=fn.cloneDeep(i),s=l)}av(t,o)}function ov(t,e,r){return fn.map(e,function(n){return b6(t,n,r)})}function v6(t,e){var r=new N6;fn.forEach(t,function(n){var i=n.graph().root,s=L6(n,i,r,e);fn.forEach(s.vs,function(o,a){n.node(o).order=a}),k6(n,r,s.vs)})}function av(t,e){fn.forEach(e,function(r){fn.forEach(r,function(n,i){t.node(n).order=i})})}});var Ev=S((Rye,yv)=>{"use strict";var W=Ee(),w6=Ft().Graph,I6=mt();yv.exports={positionX:_6,findType1Conflicts:uv,findType2Conflicts:hv,addConflict:jd,hasConflict:fv,verticalAlignment:dv,horizontalCompaction:pv,alignCoordinates:gv,findSmallestWidthAlignment:mv,balance:xv};function uv(t,e){var r={};function n(i,s){var o=0,a=0,c=i.length,l=W.last(s);return W.forEach(s,function(f,u){var h=R6(t,f),d=h?t.node(h).order:c;(h||f===l)&&(W.forEach(s.slice(a,u+1),function(p){W.forEach(t.predecessors(p),function(m){var g=t.node(m),x=g.order;(x<o||d<x)&&!(g.dummy&&t.node(p).dummy)&&jd(r,m,p)})}),a=u+1,o=d)}),s}return W.reduce(e,n),r}function hv(t,e){var r={};function n(s,o,a,c,l){var f;W.forEach(W.range(o,a),function(u){f=s[u],t.node(f).dummy&&W.forEach(t.predecessors(f),function(h){var d=t.node(h);d.dummy&&(d.order<c||d.order>l)&&jd(r,h,f)})})}function i(s,o){var a=-1,c,l=0;return W.forEach(o,function(f,u){if(t.node(f).dummy==="border"){var h=t.predecessors(f);h.length&&(c=t.node(h[0]).order,n(o,l,u,a,c),l=u,a=c)}n(o,l,o.length,c,s.length)}),o}return W.reduce(e,i),r}function R6(t,e){if(t.node(e).dummy)return W.find(t.predecessors(e),function(r){return t.node(r).dummy})}function jd(t,e,r){if(e>r){var n=e;e=r,r=n}var i=t[e];i||(t[e]=i={}),i[r]=!0}function fv(t,e,r){if(e>r){var n=e;e=r,r=n}return W.has(t[e],r)}function dv(t,e,r,n){var i={},s={},o={};return W.forEach(e,function(a){W.forEach(a,function(c,l){i[c]=c,s[c]=c,o[c]=l})}),W.forEach(e,function(a){var c=-1;W.forEach(a,function(l){var f=n(l);if(f.length){f=W.sortBy(f,function(m){return o[m]});for(var u=(f.length-1)/2,h=Math.floor(u),d=Math.ceil(u);h<=d;++h){var p=f[h];s[l]===l&&c<o[p]&&!fv(r,l,p)&&(s[p]=l,s[l]=i[l]=i[p],c=o[p])}}})}),{root:i,align:s}}function pv(t,e,r,n,i){var s={},o=M6(t,e,r,i),a=i?"borderLeft":"borderRight";function c(u,h){for(var d=o.nodes(),p=d.pop(),m={};p;)m[p]?u(p):(m[p]=!0,d.push(p),d=d.concat(h(p))),p=d.pop()}function l(u){s[u]=o.inEdges(u).reduce(function(h,d){return Math.max(h,s[d.v]+o.edge(d))},0)}function f(u){var h=o.outEdges(u).reduce(function(p,m){return Math.min(p,s[m.w]-o.edge(m))},Number.POSITIVE_INFINITY),d=t.node(u);h!==Number.POSITIVE_INFINITY&&d.borderType!==a&&(s[u]=Math.max(s[u],h))}return c(l,o.predecessors.bind(o)),c(f,o.successors.bind(o)),W.forEach(n,function(u){s[u]=s[r[u]]}),s}function M6(t,e,r,n){var i=new w6,s=t.graph(),o=U6(s.nodesep,s.edgesep,n);return W.forEach(e,function(a){var c;W.forEach(a,function(l){var f=r[l];if(i.setNode(f),c){var u=r[c],h=i.edge(u,f);i.setEdge(u,f,Math.max(o(t,l,c),h||0))}c=l})}),i}function mv(t,e){return W.minBy(W.values(e),function(r){var n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return W.forIn(r,function(s,o){var a=P6(t,o)/2;n=Math.max(s+a,n),i=Math.min(s-a,i)}),n-i})}function gv(t,e){var r=W.values(e),n=W.min(r),i=W.max(r);W.forEach(["u","d"],function(s){W.forEach(["l","r"],function(o){var a=s+o,c=t[a],l;if(c!==e){var f=W.values(c);l=o==="l"?n-W.min(f):i-W.max(f),l&&(t[a]=W.mapValues(c,function(u){return u+l}))}})})}function xv(t,e){return W.mapValues(t.ul,function(r,n){if(e)return t[e.toLowerCase()][n];var i=W.sortBy(W.map(t,n));return(i[1]+i[2])/2})}function _6(t){var e=I6.buildLayerMatrix(t),r=W.merge(uv(t,e),hv(t,e)),n={},i;W.forEach(["u","d"],function(o){i=o==="u"?e:W.values(e).reverse(),W.forEach(["l","r"],function(a){a==="r"&&(i=W.map(i,function(u){return W.values(u).reverse()}));var c=(o==="u"?t.predecessors:t.successors).bind(t),l=dv(t,i,r,c),f=pv(t,i,l.root,l.align,a==="r");a==="r"&&(f=W.mapValues(f,function(u){return-u})),n[o+a]=f})});var s=mv(t,n);return gv(n,s),xv(n,t.graph().align)}function U6(t,e,r){return function(n,i,s){var o=n.node(i),a=n.node(s),c=0,l;if(c+=o.width/2,W.has(o,"labelpos"))switch(o.labelpos.toLowerCase()){case"l":l=-o.width/2;break;case"r":l=o.width/2;break}if(l&&(c+=r?l:-l),l=0,c+=(o.dummy?e:t)/2,c+=(a.dummy?e:t)/2,c+=a.width/2,W.has(a,"labelpos"))switch(a.labelpos.toLowerCase()){case"l":l=a.width/2;break;case"r":l=-a.width/2;break}return l&&(c+=r?l:-l),l=0,c}}function P6(t,e){return t.node(e).width}});var Ov=S((Mye,Tv)=>{"use strict";var Fo=Ee(),Sv=mt(),q6=Ev().positionX;Tv.exports=D6;function D6(t){t=Sv.asNonCompoundGraph(t),$6(t),Fo.forEach(q6(t),function(e,r){t.node(r).x=e})}function $6(t){var e=Sv.buildLayerMatrix(t),r=t.graph().ranksep,n=0;Fo.forEach(e,function(i){var s=Fo.max(Fo.map(i,function(o){return t.node(o).height}));Fo.forEach(i,function(o){t.node(o).y=n+s/2}),n+=s+r})}});var Cv=S((_ye,Nv)=>{"use strict";var V=Ee(),Av=oC(),Lv=dC(),B6=NC(),F6=mt().normalizeRanks,K6=vC(),G6=mt().removeEmptyRanks,bv=RC(),j6=UC(),kv=$C(),W6=cv(),H6=Ov(),dn=mt(),z6=Ft().Graph;Nv.exports=V6;function V6(t,e){var r=e&&e.debugTiming?dn.time:dn.notime;r("layout",function(){var n=r("  buildLayoutGraph",function(){return sX(t)});r("  runLayout",function(){Y6(n,r)}),r("  updateInputGraph",function(){Q6(t,n)})})}function Y6(t,e){e("    makeSpaceForEdgeLabels",function(){oX(t)}),e("    removeSelfEdges",function(){mX(t)}),e("    acyclic",function(){Av.run(t)}),e("    nestingGraph.run",function(){bv.run(t)}),e("    rank",function(){B6(dn.asNonCompoundGraph(t))}),e("    injectEdgeLabelProxies",function(){aX(t)}),e("    removeEmptyRanks",function(){G6(t)}),e("    nestingGraph.cleanup",function(){bv.cleanup(t)}),e("    normalizeRanks",function(){F6(t)}),e("    assignRankMinMax",function(){lX(t)}),e("    removeEdgeLabelProxies",function(){cX(t)}),e("    normalize.run",function(){Lv.run(t)}),e("    parentDummyChains",function(){K6(t)}),e("    addBorderSegments",function(){j6(t)}),e("    order",function(){W6(t)}),e("    insertSelfEdges",function(){gX(t)}),e("    adjustCoordinateSystem",function(){kv.adjust(t)}),e("    position",function(){H6(t)}),e("    positionSelfEdges",function(){xX(t)}),e("    removeBorderNodes",function(){pX(t)}),e("    normalize.undo",function(){Lv.undo(t)}),e("    fixupEdgeLabelCoords",function(){fX(t)}),e("    undoCoordinateSystem",function(){kv.undo(t)}),e("    translateGraph",function(){uX(t)}),e("    assignNodeIntersects",function(){hX(t)}),e("    reversePoints",function(){dX(t)}),e("    acyclic.undo",function(){Av.undo(t)})}function Q6(t,e){V.forEach(t.nodes(),function(r){var n=t.node(r),i=e.node(r);n&&(n.x=i.x,n.y=i.y,e.children(r).length&&(n.width=i.width,n.height=i.height))}),V.forEach(t.edges(),function(r){var n=t.edge(r),i=e.edge(r);n.points=i.points,V.has(i,"x")&&(n.x=i.x,n.y=i.y)}),t.graph().width=e.graph().width,t.graph().height=e.graph().height}var X6=["nodesep","edgesep","ranksep","marginx","marginy"],Z6={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},J6=["acyclicer","ranker","rankdir","align"],eX=["width","height"],tX={width:0,height:0},rX=["minlen","weight","width","height","labeloffset"],nX={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},iX=["labelpos"];function sX(t){var e=new z6({multigraph:!0,compound:!0}),r=Hd(t.graph());return e.setGraph(V.merge({},Z6,Wd(r,X6),V.pick(r,J6))),V.forEach(t.nodes(),function(n){var i=Hd(t.node(n));e.setNode(n,V.defaults(Wd(i,eX),tX)),e.setParent(n,t.parent(n))}),V.forEach(t.edges(),function(n){var i=Hd(t.edge(n));e.setEdge(n,V.merge({},nX,Wd(i,rX),V.pick(i,iX)))}),e}function oX(t){var e=t.graph();e.ranksep/=2,V.forEach(t.edges(),function(r){var n=t.edge(r);n.minlen*=2,n.labelpos.toLowerCase()!=="c"&&(e.rankdir==="TB"||e.rankdir==="BT"?n.width+=n.labeloffset:n.height+=n.labeloffset)})}function aX(t){V.forEach(t.edges(),function(e){var r=t.edge(e);if(r.width&&r.height){var n=t.node(e.v),i=t.node(e.w),s={rank:(i.rank-n.rank)/2+n.rank,e};dn.addDummyNode(t,"edge-proxy",s,"_ep")}})}function lX(t){var e=0;V.forEach(t.nodes(),function(r){var n=t.node(r);n.borderTop&&(n.minRank=t.node(n.borderTop).rank,n.maxRank=t.node(n.borderBottom).rank,e=V.max(e,n.maxRank))}),t.graph().maxRank=e}function cX(t){V.forEach(t.nodes(),function(e){var r=t.node(e);r.dummy==="edge-proxy"&&(t.edge(r.e).labelRank=r.rank,t.removeNode(e))})}function uX(t){var e=Number.POSITIVE_INFINITY,r=0,n=Number.POSITIVE_INFINITY,i=0,s=t.graph(),o=s.marginx||0,a=s.marginy||0;function c(l){var f=l.x,u=l.y,h=l.width,d=l.height;e=Math.min(e,f-h/2),r=Math.max(r,f+h/2),n=Math.min(n,u-d/2),i=Math.max(i,u+d/2)}V.forEach(t.nodes(),function(l){c(t.node(l))}),V.forEach(t.edges(),function(l){var f=t.edge(l);V.has(f,"x")&&c(f)}),e-=o,n-=a,V.forEach(t.nodes(),function(l){var f=t.node(l);f.x-=e,f.y-=n}),V.forEach(t.edges(),function(l){var f=t.edge(l);V.forEach(f.points,function(u){u.x-=e,u.y-=n}),V.has(f,"x")&&(f.x-=e),V.has(f,"y")&&(f.y-=n)}),s.width=r-e+o,s.height=i-n+a}function hX(t){V.forEach(t.edges(),function(e){var r=t.edge(e),n=t.node(e.v),i=t.node(e.w),s,o;r.points?(s=r.points[0],o=r.points[r.points.length-1]):(r.points=[],s=i,o=n),r.points.unshift(dn.intersectRect(n,s)),r.points.push(dn.intersectRect(i,o))})}function fX(t){V.forEach(t.edges(),function(e){var r=t.edge(e);if(V.has(r,"x"))switch((r.labelpos==="l"||r.labelpos==="r")&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}})}function dX(t){V.forEach(t.edges(),function(e){var r=t.edge(e);r.reversed&&r.points.reverse()})}function pX(t){V.forEach(t.nodes(),function(e){if(t.children(e).length){var r=t.node(e),n=t.node(r.borderTop),i=t.node(r.borderBottom),s=t.node(V.last(r.borderLeft)),o=t.node(V.last(r.borderRight));r.width=Math.abs(o.x-s.x),r.height=Math.abs(i.y-n.y),r.x=s.x+r.width/2,r.y=n.y+r.height/2}}),V.forEach(t.nodes(),function(e){t.node(e).dummy==="border"&&t.removeNode(e)})}function mX(t){V.forEach(t.edges(),function(e){if(e.v===e.w){var r=t.node(e.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e,label:t.edge(e)}),t.removeEdge(e)}})}function gX(t){var e=dn.buildLayerMatrix(t);V.forEach(e,function(r){var n=0;V.forEach(r,function(i,s){var o=t.node(i);o.order=s+n,V.forEach(o.selfEdges,function(a){dn.addDummyNode(t,"selfedge",{width:a.label.width,height:a.label.height,rank:o.rank,order:s+ ++n,e:a.e,label:a.label},"_se")}),delete o.selfEdges})})}function xX(t){V.forEach(t.nodes(),function(e){var r=t.node(e);if(r.dummy==="selfedge"){var n=t.node(r.e.v),i=n.x+n.width/2,s=n.y,o=r.x-i,a=n.height/2;t.setEdge(r.e,r.label),t.removeNode(e),r.label.points=[{x:i+2*o/3,y:s-a},{x:i+5*o/6,y:s-a},{x:i+o,y:s},{x:i+5*o/6,y:s+a},{x:i+2*o/3,y:s+a}],r.label.x=r.x,r.label.y=r.y}})}function Wd(t,e){return V.mapValues(V.pick(t,e),Number)}function Hd(t){var e={};return V.forEach(t,function(r,n){e[n.toLowerCase()]=r}),e}});var wv=S((Uye,vv)=>{var Bc=Ee(),yX=mt(),EX=Ft().Graph;vv.exports={debugOrdering:SX};function SX(t){var e=yX.buildLayerMatrix(t),r=new EX({compound:!0,multigraph:!0}).setGraph({});return Bc.forEach(t.nodes(),function(n){r.setNode(n,{label:n}),r.setParent(n,"layer"+t.node(n).rank)}),Bc.forEach(t.edges(),function(n){r.setEdge(n.v,n.w,{},n.name)}),Bc.forEach(e,function(n,i){var s="layer"+i;r.setNode(s,{rank:"same"}),Bc.reduce(n,function(o,a){return r.setEdge(o,a,{style:"invis"}),a})}),r}});var Rv=S((Pye,Iv)=>{Iv.exports="0.8.5"});var _v=S((qye,Mv)=>{Mv.exports={graphlib:Ft(),layout:Cv(),debug:wv(),util:{time:mt().time,notime:mt().notime},version:Rv()}});var aw=typeof global=="object"&&global&&global.Object===Object&&global,Zo=aw;var lw=typeof self=="object"&&self&&self.Object===Object&&self,cw=Zo||lw||Function("return this")(),qe=cw;var uw=qe.Symbol,He=uw;var cp=Object.prototype,hw=cp.hasOwnProperty,fw=cp.toString,us=He?He.toStringTag:void 0;function dw(t){var e=hw.call(t,us),r=t[us];try{t[us]=void 0;var n=!0}catch{}var i=fw.call(t);return n&&(e?t[us]=r:delete t[us]),i}var up=dw;var pw=Object.prototype,mw=pw.toString;function gw(t){return mw.call(t)}var hp=gw;var xw="[object Null]",yw="[object Undefined]",fp=He?He.toStringTag:void 0;function Ew(t){return t==null?t===void 0?yw:xw:fp&&fp in Object(t)?up(t):hp(t)}var ct=Ew;function Sw(t){return t!=null&&typeof t=="object"}var Re=Sw;var Tw="[object Symbol]";function Ow(t){return typeof t=="symbol"||Re(t)&&ct(t)==Tw}var Pr=Ow;function Aw(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var Yt=Aw;var Lw=Array.isArray,D=Lw;var bw=1/0,dp=He?He.prototype:void 0,pp=dp?dp.toString:void 0;function mp(t){if(typeof t=="string")return t;if(D(t))return Yt(t,mp)+"";if(Pr(t))return pp?pp.call(t):"";var e=t+"";return e=="0"&&1/t==-bw?"-0":e}var gp=mp;var kw=/\s/;function Nw(t){for(var e=t.length;e--&&kw.test(t.charAt(e)););return e}var xp=Nw;var Cw=/^\s+/;function vw(t){return t&&t.slice(0,xp(t)+1).replace(Cw,"")}var yp=vw;function ww(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Le=ww;var Ep=NaN,Iw=/^[-+]0x[0-9a-f]+$/i,Rw=/^0b[01]+$/i,Mw=/^0o[0-7]+$/i,_w=parseInt;function Uw(t){if(typeof t=="number")return t;if(Pr(t))return Ep;if(Le(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Le(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=yp(t);var r=Rw.test(t);return r||Mw.test(t)?_w(t.slice(2),r?2:8):Iw.test(t)?Ep:+t}var Sp=Uw;var Tp=1/0,Pw=17976931348623157e292;function qw(t){if(!t)return t===0?t:0;if(t=Sp(t),t===Tp||t===-Tp){var e=t<0?-1:1;return e*Pw}return t===t?t:0}var Op=qw;function Dw(t){var e=Op(t),r=e%1;return e===e?r?e-r:e:0}var Qt=Dw;function $w(t){return t}var Mt=$w;var Bw="[object AsyncFunction]",Fw="[object Function]",Kw="[object GeneratorFunction]",Gw="[object Proxy]";function jw(t){if(!Le(t))return!1;var e=ct(t);return e==Fw||e==Kw||e==Bw||e==Gw}var ut=jw;var Ww=qe["__core-js_shared__"],Jo=Ww;var Ap=(function(){var t=/[^.]+$/.exec(Jo&&Jo.keys&&Jo.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function Hw(t){return!!Ap&&Ap in t}var Lp=Hw;var zw=Function.prototype,Vw=zw.toString;function Yw(t){if(t!=null){try{return Vw.call(t)}catch{}try{return t+""}catch{}}return""}var Or=Yw;var Qw=/[\\^$.*+?()[\]{}|]/g,Xw=/^\[object .+?Constructor\]$/,Zw=Function.prototype,Jw=Object.prototype,eI=Zw.toString,tI=Jw.hasOwnProperty,rI=RegExp("^"+eI.call(tI).replace(Qw,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nI(t){if(!Le(t)||Lp(t))return!1;var e=ut(t)?rI:Xw;return e.test(Or(t))}var bp=nI;function iI(t,e){return t?.[e]}var kp=iI;function sI(t,e){var r=kp(t,e);return bp(r)?r:void 0}var yt=sI;var oI=yt(qe,"WeakMap"),ea=oI;var Np=Object.create,aI=(function(){function t(){}return function(e){if(!Le(e))return{};if(Np)return Np(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})(),Cp=aI;function lI(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var vp=lI;function cI(){}var be=cI;function uI(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var wp=uI;var hI=800,fI=16,dI=Date.now;function pI(t){var e=0,r=0;return function(){var n=dI(),i=fI-(n-r);if(r=n,i>0){if(++e>=hI)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Ip=pI;function mI(t){return function(){return t}}var Rp=mI;var gI=(function(){try{var t=yt(Object,"defineProperty");return t({},"",{}),t}catch{}})(),Xn=gI;var xI=Xn?function(t,e){return Xn(t,"toString",{configurable:!0,enumerable:!1,value:Rp(e),writable:!0})}:Mt,Mp=xI;var yI=Ip(Mp),_p=yI;function EI(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}var ta=EI;function SI(t,e,r,n){for(var i=t.length,s=r+(n?1:-1);n?s--:++s<i;)if(e(t[s],s,t))return s;return-1}var ra=SI;function TI(t){return t!==t}var Up=TI;function OI(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}var Pp=OI;function AI(t,e,r){return e===e?Pp(t,e,r):ra(t,Up,r)}var Zn=AI;function LI(t,e){var r=t==null?0:t.length;return!!r&&Zn(t,e,0)>-1}var na=LI;var bI=9007199254740991,kI=/^(?:0|[1-9]\d*)$/;function NI(t,e){var r=typeof t;return e=e??bI,!!e&&(r=="number"||r!="symbol"&&kI.test(t))&&t>-1&&t%1==0&&t<e}var qr=NI;function CI(t,e,r){e=="__proto__"&&Xn?Xn(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Jn=CI;function vI(t,e){return t===e||t!==t&&e!==e}var Xt=vI;var wI=Object.prototype,II=wI.hasOwnProperty;function RI(t,e,r){var n=t[e];(!(II.call(t,e)&&Xt(n,r))||r===void 0&&!(e in t))&&Jn(t,e,r)}var Dr=RI;function MI(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(r[a],t[a],a,r,t):void 0;c===void 0&&(c=t[a]),i?Jn(r,a,c):Dr(r,a,c)}return r}var Zt=MI;var qp=Math.max;function _I(t,e,r){return e=qp(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=qp(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),vp(t,this,a)}}var Dp=_I;function UI(t,e){return _p(Dp(t,e,Mt),t+"")}var ei=UI;var PI=9007199254740991;function qI(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=PI}var ti=qI;function DI(t){return t!=null&&ti(t.length)&&!ut(t)}var De=DI;function $I(t,e,r){if(!Le(r))return!1;var n=typeof e;return(n=="number"?De(r)&&qr(e,r.length):n=="string"&&e in r)?Xt(r[e],t):!1}var $r=$I;function BI(t){return ei(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&$r(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}var $p=BI;var FI=Object.prototype;function KI(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||FI;return t===r}var Jt=KI;function GI(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Bp=GI;var jI="[object Arguments]";function WI(t){return Re(t)&&ct(t)==jI}var Zc=WI;var Fp=Object.prototype,HI=Fp.hasOwnProperty,zI=Fp.propertyIsEnumerable,VI=Zc((function(){return arguments})())?Zc:function(t){return Re(t)&&HI.call(t,"callee")&&!zI.call(t,"callee")},Br=VI;function YI(){return!1}var Kp=YI;var Wp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Gp=Wp&&typeof module=="object"&&module&&!module.nodeType&&module,QI=Gp&&Gp.exports===Wp,jp=QI?qe.Buffer:void 0,XI=jp?jp.isBuffer:void 0,ZI=XI||Kp,Ar=ZI;var JI="[object Arguments]",eR="[object Array]",tR="[object Boolean]",rR="[object Date]",nR="[object Error]",iR="[object Function]",sR="[object Map]",oR="[object Number]",aR="[object Object]",lR="[object RegExp]",cR="[object Set]",uR="[object String]",hR="[object WeakMap]",fR="[object ArrayBuffer]",dR="[object DataView]",pR="[object Float32Array]",mR="[object Float64Array]",gR="[object Int8Array]",xR="[object Int16Array]",yR="[object Int32Array]",ER="[object Uint8Array]",SR="[object Uint8ClampedArray]",TR="[object Uint16Array]",OR="[object Uint32Array]",ge={};ge[pR]=ge[mR]=ge[gR]=ge[xR]=ge[yR]=ge[ER]=ge[SR]=ge[TR]=ge[OR]=!0;ge[JI]=ge[eR]=ge[fR]=ge[tR]=ge[dR]=ge[rR]=ge[nR]=ge[iR]=ge[sR]=ge[oR]=ge[aR]=ge[lR]=ge[cR]=ge[uR]=ge[hR]=!1;function AR(t){return Re(t)&&ti(t.length)&&!!ge[ct(t)]}var Hp=AR;function LR(t){return function(e){return t(e)}}var er=LR;var zp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,hs=zp&&typeof module=="object"&&module&&!module.nodeType&&module,bR=hs&&hs.exports===zp,Jc=bR&&Zo.process,kR=(function(){try{var t=hs&&hs.require&&hs.require("util").types;return t||Jc&&Jc.binding&&Jc.binding("util")}catch{}})(),_t=kR;var Vp=_t&&_t.isTypedArray,NR=Vp?er(Vp):Hp,ri=NR;var CR=Object.prototype,vR=CR.hasOwnProperty;function wR(t,e){var r=D(t),n=!r&&Br(t),i=!r&&!n&&Ar(t),s=!r&&!n&&!i&&ri(t),o=r||n||i||s,a=o?Bp(t.length,String):[],c=a.length;for(var l in t)(e||vR.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||qr(l,c)))&&a.push(l);return a}var ia=wR;function IR(t,e){return function(r){return t(e(r))}}var sa=IR;var RR=sa(Object.keys,Object),Yp=RR;var MR=Object.prototype,_R=MR.hasOwnProperty;function UR(t){if(!Jt(t))return Yp(t);var e=[];for(var r in Object(t))_R.call(t,r)&&r!="constructor"&&e.push(r);return e}var oa=UR;function PR(t){return De(t)?ia(t):oa(t)}var ce=PR;var qR=Object.prototype,DR=qR.hasOwnProperty,$R=$p(function(t,e){if(Jt(e)||De(e)){Zt(e,ce(e),t);return}for(var r in e)DR.call(e,r)&&Dr(t,r,e[r])}),Ye=$R;function BR(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Qp=BR;var FR=Object.prototype,KR=FR.hasOwnProperty;function GR(t){if(!Le(t))return Qp(t);var e=Jt(t),r=[];for(var n in t)n=="constructor"&&(e||!KR.call(t,n))||r.push(n);return r}var Xp=GR;function jR(t){return De(t)?ia(t,!0):Xp(t)}var Fr=jR;var WR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,HR=/^\w*$/;function zR(t,e){if(D(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Pr(t)?!0:HR.test(t)||!WR.test(t)||e!=null&&t in Object(e)}var ni=zR;var VR=yt(Object,"create"),Lr=VR;function YR(){this.__data__=Lr?Lr(null):{},this.size=0}var Zp=YR;function QR(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Jp=QR;var XR="__lodash_hash_undefined__",ZR=Object.prototype,JR=ZR.hasOwnProperty;function eM(t){var e=this.__data__;if(Lr){var r=e[t];return r===XR?void 0:r}return JR.call(e,t)?e[t]:void 0}var em=eM;var tM=Object.prototype,rM=tM.hasOwnProperty;function nM(t){var e=this.__data__;return Lr?e[t]!==void 0:rM.call(e,t)}var tm=nM;var iM="__lodash_hash_undefined__";function sM(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Lr&&e===void 0?iM:e,this}var rm=sM;function ii(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ii.prototype.clear=Zp;ii.prototype.delete=Jp;ii.prototype.get=em;ii.prototype.has=tm;ii.prototype.set=rm;var eu=ii;function oM(){this.__data__=[],this.size=0}var nm=oM;function aM(t,e){for(var r=t.length;r--;)if(Xt(t[r][0],e))return r;return-1}var Kr=aM;var lM=Array.prototype,cM=lM.splice;function uM(t){var e=this.__data__,r=Kr(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():cM.call(e,r,1),--this.size,!0}var im=uM;function hM(t){var e=this.__data__,r=Kr(e,t);return r<0?void 0:e[r][1]}var sm=hM;function fM(t){return Kr(this.__data__,t)>-1}var om=fM;function dM(t,e){var r=this.__data__,n=Kr(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var am=dM;function si(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}si.prototype.clear=nm;si.prototype.delete=im;si.prototype.get=sm;si.prototype.has=om;si.prototype.set=am;var Gr=si;var pM=yt(qe,"Map"),jr=pM;function mM(){this.size=0,this.__data__={hash:new eu,map:new(jr||Gr),string:new eu}}var lm=mM;function gM(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var cm=gM;function xM(t,e){var r=t.__data__;return cm(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Wr=xM;function yM(t){var e=Wr(this,t).delete(t);return this.size-=e?1:0,e}var um=yM;function EM(t){return Wr(this,t).get(t)}var hm=EM;function SM(t){return Wr(this,t).has(t)}var fm=SM;function TM(t,e){var r=Wr(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var dm=TM;function oi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}oi.prototype.clear=lm;oi.prototype.delete=um;oi.prototype.get=hm;oi.prototype.has=fm;oi.prototype.set=dm;var yn=oi;var OM="Expected a function";function tu(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(OM);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(tu.Cache||yn),r}tu.Cache=yn;var pm=tu;var AM=500;function LM(t){var e=pm(t,function(n){return r.size===AM&&r.clear(),n}),r=e.cache;return e}var mm=LM;var bM=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kM=/\\(\\)?/g,NM=mm(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(bM,function(r,n,i,s){e.push(i?s.replace(kM,"$1"):n||r)}),e}),gm=NM;function CM(t){return t==null?"":gp(t)}var xm=CM;function vM(t,e){return D(t)?t:ni(t,e)?[t]:gm(xm(t))}var Hr=vM;var wM=1/0;function IM(t){if(typeof t=="string"||Pr(t))return t;var e=t+"";return e=="0"&&1/t==-wM?"-0":e}var tr=IM;function RM(t,e){e=Hr(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[tr(e[r++])];return r&&r==n?t:void 0}var ai=RM;function MM(t,e,r){var n=t==null?void 0:ai(t,e);return n===void 0?r:n}var ym=MM;function _M(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var li=_M;var Em=He?He.isConcatSpreadable:void 0;function UM(t){return D(t)||Br(t)||!!(Em&&t&&t[Em])}var Sm=UM;function Tm(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=Sm),i||(i=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?Tm(a,e-1,r,n,i):li(i,a):n||(i[i.length]=a)}return i}var ci=Tm;function PM(t){var e=t==null?0:t.length;return e?ci(t,1):[]}var Ge=PM;var qM=sa(Object.getPrototypeOf,Object),aa=qM;function DM(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}var la=DM;function $M(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}var Om=$M;function BM(){this.__data__=new Gr,this.size=0}var Am=BM;function FM(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var Lm=FM;function KM(t){return this.__data__.get(t)}var bm=KM;function GM(t){return this.__data__.has(t)}var km=GM;var jM=200;function WM(t,e){var r=this.__data__;if(r instanceof Gr){var n=r.__data__;if(!jr||n.length<jM-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new yn(n)}return r.set(t,e),this.size=r.size,this}var Nm=WM;function ui(t){var e=this.__data__=new Gr(t);this.size=e.size}ui.prototype.clear=Am;ui.prototype.delete=Lm;ui.prototype.get=bm;ui.prototype.has=km;ui.prototype.set=Nm;var zr=ui;function HM(t,e){return t&&Zt(e,ce(e),t)}var Cm=HM;function zM(t,e){return t&&Zt(e,Fr(e),t)}var vm=zM;var Mm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wm=Mm&&typeof module=="object"&&module&&!module.nodeType&&module,VM=wm&&wm.exports===Mm,Im=VM?qe.Buffer:void 0,Rm=Im?Im.allocUnsafe:void 0;function YM(t,e){if(e)return t.slice();var r=t.length,n=Rm?Rm(r):new t.constructor(r);return t.copy(n),n}var _m=YM;function QM(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}var hi=QM;function XM(){return[]}var ca=XM;var ZM=Object.prototype,JM=ZM.propertyIsEnumerable,Um=Object.getOwnPropertySymbols,e_=Um?function(t){return t==null?[]:(t=Object(t),hi(Um(t),function(e){return JM.call(t,e)}))}:ca,fi=e_;function t_(t,e){return Zt(t,fi(t),e)}var Pm=t_;var r_=Object.getOwnPropertySymbols,n_=r_?function(t){for(var e=[];t;)li(e,fi(t)),t=aa(t);return e}:ca,ua=n_;function i_(t,e){return Zt(t,ua(t),e)}var qm=i_;function s_(t,e,r){var n=e(t);return D(t)?n:li(n,r(t))}var ha=s_;function o_(t){return ha(t,ce,fi)}var fs=o_;function a_(t){return ha(t,Fr,ua)}var fa=a_;var l_=yt(qe,"DataView"),da=l_;var c_=yt(qe,"Promise"),pa=c_;var u_=yt(qe,"Set"),Vr=u_;var Dm="[object Map]",h_="[object Object]",$m="[object Promise]",Bm="[object Set]",Fm="[object WeakMap]",Km="[object DataView]",f_=Or(da),d_=Or(jr),p_=Or(pa),m_=Or(Vr),g_=Or(ea),En=ct;(da&&En(new da(new ArrayBuffer(1)))!=Km||jr&&En(new jr)!=Dm||pa&&En(pa.resolve())!=$m||Vr&&En(new Vr)!=Bm||ea&&En(new ea)!=Fm)&&(En=function(t){var e=ct(t),r=e==h_?t.constructor:void 0,n=r?Or(r):"";if(n)switch(n){case f_:return Km;case d_:return Dm;case p_:return $m;case m_:return Bm;case g_:return Fm}return e});var jt=En;var x_=Object.prototype,y_=x_.hasOwnProperty;function E_(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&y_.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Gm=E_;var S_=qe.Uint8Array,di=S_;function T_(t){var e=new t.constructor(t.byteLength);return new di(e).set(new di(t)),e}var pi=T_;function O_(t,e){var r=e?pi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var jm=O_;var A_=/\w*$/;function L_(t){var e=new t.constructor(t.source,A_.exec(t));return e.lastIndex=t.lastIndex,e}var Wm=L_;var Hm=He?He.prototype:void 0,zm=Hm?Hm.valueOf:void 0;function b_(t){return zm?Object(zm.call(t)):{}}var Vm=b_;function k_(t,e){var r=e?pi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Ym=k_;var N_="[object Boolean]",C_="[object Date]",v_="[object Map]",w_="[object Number]",I_="[object RegExp]",R_="[object Set]",M_="[object String]",__="[object Symbol]",U_="[object ArrayBuffer]",P_="[object DataView]",q_="[object Float32Array]",D_="[object Float64Array]",$_="[object Int8Array]",B_="[object Int16Array]",F_="[object Int32Array]",K_="[object Uint8Array]",G_="[object Uint8ClampedArray]",j_="[object Uint16Array]",W_="[object Uint32Array]";function H_(t,e,r){var n=t.constructor;switch(e){case U_:return pi(t);case N_:case C_:return new n(+t);case P_:return jm(t,r);case q_:case D_:case $_:case B_:case F_:case K_:case G_:case j_:case W_:return Ym(t,r);case v_:return new n;case w_:case M_:return new n(t);case I_:return Wm(t);case R_:return new n;case __:return Vm(t)}}var Qm=H_;function z_(t){return typeof t.constructor=="function"&&!Jt(t)?Cp(aa(t)):{}}var Xm=z_;var V_="[object Map]";function Y_(t){return Re(t)&&jt(t)==V_}var Zm=Y_;var Jm=_t&&_t.isMap,Q_=Jm?er(Jm):Zm,eg=Q_;var X_="[object Set]";function Z_(t){return Re(t)&&jt(t)==X_}var tg=Z_;var rg=_t&&_t.isSet,J_=rg?er(rg):tg,ng=J_;var eU=1,tU=2,rU=4,ig="[object Arguments]",nU="[object Array]",iU="[object Boolean]",sU="[object Date]",oU="[object Error]",sg="[object Function]",aU="[object GeneratorFunction]",lU="[object Map]",cU="[object Number]",og="[object Object]",uU="[object RegExp]",hU="[object Set]",fU="[object String]",dU="[object Symbol]",pU="[object WeakMap]",mU="[object ArrayBuffer]",gU="[object DataView]",xU="[object Float32Array]",yU="[object Float64Array]",EU="[object Int8Array]",SU="[object Int16Array]",TU="[object Int32Array]",OU="[object Uint8Array]",AU="[object Uint8ClampedArray]",LU="[object Uint16Array]",bU="[object Uint32Array]",ue={};ue[ig]=ue[nU]=ue[mU]=ue[gU]=ue[iU]=ue[sU]=ue[xU]=ue[yU]=ue[EU]=ue[SU]=ue[TU]=ue[lU]=ue[cU]=ue[og]=ue[uU]=ue[hU]=ue[fU]=ue[dU]=ue[OU]=ue[AU]=ue[LU]=ue[bU]=!0;ue[oU]=ue[sg]=ue[pU]=!1;function ma(t,e,r,n,i,s){var o,a=e&eU,c=e&tU,l=e&rU;if(r&&(o=i?r(t,n,i,s):r(t)),o!==void 0)return o;if(!Le(t))return t;var f=D(t);if(f){if(o=Gm(t),!a)return wp(t,o)}else{var u=jt(t),h=u==sg||u==aU;if(Ar(t))return _m(t,a);if(u==og||u==ig||h&&!i){if(o=c||h?{}:Xm(t),!a)return c?qm(t,vm(o,t)):Pm(t,Cm(o,t))}else{if(!ue[u])return i?t:{};o=Qm(t,u,a)}}s||(s=new zr);var d=s.get(t);if(d)return d;s.set(t,o),ng(t)?t.forEach(function(g){o.add(ma(g,e,r,g,t,s))}):eg(t)&&t.forEach(function(g,x){o.set(x,ma(g,e,r,x,t,s))});var p=l?c?fa:fs:c?Fr:ce,m=f?void 0:p(t);return ta(m||t,function(g,x){m&&(x=g,g=t[x]),Dr(o,x,ma(g,e,r,x,t,s))}),o}var ag=ma;var kU=4;function NU(t){return ag(t,kU)}var he=NU;function CU(t){for(var e=-1,r=t==null?0:t.length,n=0,i=[];++e<r;){var s=t[e];s&&(i[n++]=s)}return i}var rr=CU;var vU="__lodash_hash_undefined__";function wU(t){return this.__data__.set(t,vU),this}var lg=wU;function IU(t){return this.__data__.has(t)}var cg=IU;function ga(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new yn;++e<r;)this.add(t[e])}ga.prototype.add=ga.prototype.push=lg;ga.prototype.has=cg;var mi=ga;function RU(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var xa=RU;function MU(t,e){return t.has(e)}var gi=MU;var _U=1,UU=2;function PU(t,e,r,n,i,s){var o=r&_U,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),f=s.get(e);if(l&&f)return l==e&&f==t;var u=-1,h=!0,d=r&UU?new mi:void 0;for(s.set(t,e),s.set(e,t);++u<a;){var p=t[u],m=e[u];if(n)var g=o?n(m,p,u,e,t,s):n(p,m,u,t,e,s);if(g!==void 0){if(g)continue;h=!1;break}if(d){if(!xa(e,function(x,y){if(!gi(d,y)&&(p===x||i(p,x,r,n,s)))return d.push(y)})){h=!1;break}}else if(!(p===m||i(p,m,r,n,s))){h=!1;break}}return s.delete(t),s.delete(e),h}var ya=PU;function qU(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var ug=qU;function DU(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var xi=DU;var $U=1,BU=2,FU="[object Boolean]",KU="[object Date]",GU="[object Error]",jU="[object Map]",WU="[object Number]",HU="[object RegExp]",zU="[object Set]",VU="[object String]",YU="[object Symbol]",QU="[object ArrayBuffer]",XU="[object DataView]",hg=He?He.prototype:void 0,ru=hg?hg.valueOf:void 0;function ZU(t,e,r,n,i,s,o){switch(r){case XU:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case QU:return!(t.byteLength!=e.byteLength||!s(new di(t),new di(e)));case FU:case KU:case WU:return Xt(+t,+e);case GU:return t.name==e.name&&t.message==e.message;case HU:case VU:return t==e+"";case jU:var a=ug;case zU:var c=n&$U;if(a||(a=xi),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;n|=BU,o.set(t,e);var f=ya(a(t),a(e),n,i,s,o);return o.delete(t),f;case YU:if(ru)return ru.call(t)==ru.call(e)}return!1}var fg=ZU;var JU=1,e0=Object.prototype,t0=e0.hasOwnProperty;function r0(t,e,r,n,i,s){var o=r&JU,a=fs(t),c=a.length,l=fs(e),f=l.length;if(c!=f&&!o)return!1;for(var u=c;u--;){var h=a[u];if(!(o?h in e:t0.call(e,h)))return!1}var d=s.get(t),p=s.get(e);if(d&&p)return d==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var g=o;++u<c;){h=a[u];var x=t[h],y=e[h];if(n)var E=o?n(y,x,h,e,t,s):n(x,y,h,t,e,s);if(!(E===void 0?x===y||i(x,y,r,n,s):E)){m=!1;break}g||(g=h=="constructor")}if(m&&!g){var T=t.constructor,A=e.constructor;T!=A&&"constructor"in t&&"constructor"in e&&!(typeof T=="function"&&T instanceof T&&typeof A=="function"&&A instanceof A)&&(m=!1)}return s.delete(t),s.delete(e),m}var dg=r0;var n0=1,pg="[object Arguments]",mg="[object Array]",Ea="[object Object]",i0=Object.prototype,gg=i0.hasOwnProperty;function s0(t,e,r,n,i,s){var o=D(t),a=D(e),c=o?mg:jt(t),l=a?mg:jt(e);c=c==pg?Ea:c,l=l==pg?Ea:l;var f=c==Ea,u=l==Ea,h=c==l;if(h&&Ar(t)){if(!Ar(e))return!1;o=!0,f=!1}if(h&&!f)return s||(s=new zr),o||ri(t)?ya(t,e,r,n,i,s):fg(t,e,c,r,n,i,s);if(!(r&n0)){var d=f&&gg.call(t,"__wrapped__"),p=u&&gg.call(e,"__wrapped__");if(d||p){var m=d?t.value():t,g=p?e.value():e;return s||(s=new zr),i(m,g,r,n,s)}}return h?(s||(s=new zr),dg(t,e,r,n,i,s)):!1}var xg=s0;function yg(t,e,r,n,i){return t===e?!0:t==null||e==null||!Re(t)&&!Re(e)?t!==t&&e!==e:xg(t,e,r,n,yg,i)}var Sa=yg;var o0=1,a0=2;function l0(t,e,r,n){var i=r.length,s=i,o=!n;if(t==null)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=r[i];var c=a[0],l=t[c],f=a[1];if(o&&a[2]){if(l===void 0&&!(c in t))return!1}else{var u=new zr;if(n)var h=n(l,f,c,t,e,u);if(!(h===void 0?Sa(f,l,o0|a0,n,u):h))return!1}}return!0}var Eg=l0;function c0(t){return t===t&&!Le(t)}var Ta=c0;function u0(t){for(var e=ce(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,Ta(i)]}return e}var Sg=u0;function h0(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var Oa=h0;function f0(t){var e=Sg(t);return e.length==1&&e[0][2]?Oa(e[0][0],e[0][1]):function(r){return r===t||Eg(r,t,e)}}var Tg=f0;function d0(t,e){return t!=null&&e in Object(t)}var Og=d0;function p0(t,e,r){e=Hr(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=tr(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&ti(i)&&qr(o,i)&&(D(t)||Br(t)))}var Aa=p0;function m0(t,e){return t!=null&&Aa(t,e,Og)}var Ag=m0;var g0=1,x0=2;function y0(t,e){return ni(t)&&Ta(e)?Oa(tr(t),e):function(r){var n=ym(r,t);return n===void 0&&n===e?Ag(r,t):Sa(e,n,g0|x0)}}var Lg=y0;function E0(t){return function(e){return e?.[t]}}var bg=E0;function S0(t){return function(e){return ai(e,t)}}var kg=S0;function T0(t){return ni(t)?bg(tr(t)):kg(t)}var Ng=T0;function O0(t){return typeof t=="function"?t:t==null?Mt:typeof t=="object"?D(t)?Lg(t[0],t[1]):Tg(t):Ng(t)}var $e=O0;function A0(t,e,r,n){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(n,o,r(o),t)}return n}var Cg=A0;function L0(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[t?a:++i];if(r(s[c],c,s)===!1)break}return e}}var vg=L0;var b0=vg(),wg=b0;function k0(t,e){return t&&wg(t,e,ce)}var Ig=k0;function N0(t,e){return function(r,n){if(r==null)return r;if(!De(r))return t(r,n);for(var i=r.length,s=e?i:-1,o=Object(r);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return r}}var Rg=N0;var C0=Rg(Ig),Et=C0;function v0(t,e,r,n){return Et(t,function(i,s,o){e(n,i,r(i),o)}),n}var Mg=v0;function w0(t,e){return function(r,n){var i=D(r)?Cg:Mg,s=e?e():{};return i(r,t,$e(n,2),s)}}var _g=w0;var Ug=Object.prototype,I0=Ug.hasOwnProperty,R0=ei(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&$r(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=Fr(s),a=-1,c=o.length;++a<c;){var l=o[a],f=t[l];(f===void 0||Xt(f,Ug[l])&&!I0.call(t,l))&&(t[l]=s[l])}return t}),yi=R0;function M0(t){return Re(t)&&De(t)}var nu=M0;function _0(t,e,r){for(var n=-1,i=t==null?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1}var La=_0;var U0=200;function P0(t,e,r,n){var i=-1,s=na,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;r&&(e=Yt(e,er(r))),n?(s=La,o=!1):e.length>=U0&&(s=gi,o=!1,e=new mi(e));e:for(;++i<a;){var f=t[i],u=r==null?f:r(f);if(f=n||f!==0?f:0,o&&u===u){for(var h=l;h--;)if(e[h]===u)continue e;c.push(f)}else s(e,u,n)||c.push(f)}return c}var Pg=P0;var q0=ei(function(t,e){return nu(t)?Pg(t,ci(e,1,nu,!0)):[]}),Yr=q0;function D0(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var nr=D0;function $0(t,e,r){var n=t==null?0:t.length;return n?(e=r||e===void 0?1:Qt(e),la(t,e<0?0:e,n)):[]}var Me=$0;function B0(t,e,r){var n=t==null?0:t.length;return n?(e=r||e===void 0?1:Qt(e),e=n-e,la(t,0,e<0?0:e)):[]}var br=B0;function F0(t){return typeof t=="function"?t:Mt}var qg=F0;function K0(t,e){var r=D(t)?ta:Et;return r(t,qg(e))}var _=K0;function G0(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}var Dg=G0;function j0(t,e){var r=!0;return Et(t,function(n,i,s){return r=!!e(n,i,s),r}),r}var $g=j0;function W0(t,e,r){var n=D(t)?Dg:$g;return r&&$r(t,e,r)&&(e=void 0),n(t,$e(e,3))}var tt=W0;function H0(t,e){var r=[];return Et(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}var ba=H0;function z0(t,e){var r=D(t)?hi:ba;return r(t,$e(e,3))}var rt=z0;function V0(t){return function(e,r,n){var i=Object(e);if(!De(e)){var s=$e(r,3);e=ce(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}var Bg=V0;var Y0=Math.max;function Q0(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:Qt(r);return i<0&&(i=Y0(n+i,0)),ra(t,$e(e,3),i)}var Fg=Q0;var X0=Bg(Fg),ir=X0;function Z0(t){return t&&t.length?t[0]:void 0}var ze=Z0;function J0(t,e){var r=-1,n=De(t)?Array(t.length):[];return Et(t,function(i,s,o){n[++r]=e(i,s,o)}),n}var Kg=J0;function e1(t,e){var r=D(t)?Yt:Kg;return r(t,$e(e,3))}var M=e1;function t1(t,e){return ci(M(t,e),1)}var ht=t1;var r1=Object.prototype,n1=r1.hasOwnProperty,i1=_g(function(t,e,r){n1.call(t,r)?t[r].push(e):Jn(t,r,[e])}),iu=i1;var s1=Object.prototype,o1=s1.hasOwnProperty;function a1(t,e){return t!=null&&o1.call(t,e)}var Gg=a1;function l1(t,e){return t!=null&&Aa(t,e,Gg)}var U=l1;var c1="[object String]";function u1(t){return typeof t=="string"||!D(t)&&Re(t)&&ct(t)==c1}var je=u1;function h1(t,e){return Yt(e,function(r){return t[r]})}var jg=h1;function f1(t){return t==null?[]:jg(t,ce(t))}var le=f1;var d1=Math.max;function p1(t,e,r,n){t=De(t)?t:le(t),r=r&&!n?Qt(r):0;var i=t.length;return r<0&&(r=d1(i+r,0)),je(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&Zn(t,e,r)>-1}var Se=p1;var m1=Math.max;function g1(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:Qt(r);return i<0&&(i=m1(n+i,0)),Zn(t,e,i)}var ka=g1;var x1="[object Map]",y1="[object Set]",E1=Object.prototype,S1=E1.hasOwnProperty;function T1(t){if(t==null)return!0;if(De(t)&&(D(t)||typeof t=="string"||typeof t.splice=="function"||Ar(t)||ri(t)||Br(t)))return!t.length;var e=jt(t);if(e==x1||e==y1)return!t.size;if(Jt(t))return!oa(t).length;for(var r in t)if(S1.call(t,r))return!1;return!0}var Y=T1;var O1="[object RegExp]";function A1(t){return Re(t)&&ct(t)==O1}var Wg=A1;var Hg=_t&&_t.isRegExp,L1=Hg?er(Hg):Wg,Ut=L1;function b1(t){return t===void 0}var nt=b1;var k1="Expected a function";function N1(t){if(typeof t!="function")throw new TypeError(k1);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}var zg=N1;function C1(t,e,r,n){if(!Le(t))return t;e=Hr(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=tr(e[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var f=a[c];l=n?n(f,c,a):void 0,l===void 0&&(l=Le(f)?f:qr(e[i+1])?[]:{})}Dr(a,c,l),a=a[c]}return t}var Vg=C1;function v1(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=ai(t,o);r(a,o)&&Vg(s,Hr(o,t),a)}return s}var Yg=v1;function w1(t,e){if(t==null)return{};var r=Yt(fa(t),function(n){return[n]});return e=$e(e),Yg(t,r,function(n,i){return e(n,i[0])})}var St=w1;function I1(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}var Qg=I1;function R1(t,e,r){var n=D(t)?Om:Qg,i=arguments.length<3;return n(t,$e(e,4),r,i,Et)}var Be=R1;function M1(t,e){var r=D(t)?hi:ba;return r(t,zg($e(e,3)))}var Qr=M1;function _1(t,e){var r;return Et(t,function(n,i,s){return r=e(n,i,s),!r}),!!r}var Xg=_1;function U1(t,e,r){var n=D(t)?xa:Xg;return r&&$r(t,e,r)&&(e=void 0),n(t,$e(e,3))}var ds=U1;var P1=1/0,q1=Vr&&1/xi(new Vr([,-0]))[1]==P1?function(t){return new Vr(t)}:be,Zg=q1;var D1=200;function $1(t,e,r){var n=-1,i=na,s=t.length,o=!0,a=[],c=a;if(r)o=!1,i=La;else if(s>=D1){var l=e?null:Zg(t);if(l)return xi(l);o=!1,i=gi,c=new mi}else c=e?[]:a;e:for(;++n<s;){var f=t[n],u=e?e(f):f;if(f=r||f!==0?f:0,o&&u===u){for(var h=c.length;h--;)if(c[h]===u)continue e;e&&c.push(u),a.push(f)}else i(c,u,r)||(c!==a&&c.push(u),a.push(f))}return a}var Jg=$1;function B1(t){return t&&t.length?Jg(t):[]}var Ei=B1;function Si(t){console&&console.error&&console.error(`Error: ${t}`)}function ps(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function ms(t){let e=new Date().getTime(),r=t();return{time:new Date().getTime()-e,value:r}}function gs(t){function e(){}e.prototype=t;let r=new e;function n(){return typeof r.bar}return n(),n(),t;(0,eval)(t)}function F1(t){return K1(t)?t.LABEL:t.name}function K1(t){return je(t.LABEL)&&t.LABEL!==""}var bt=class{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),_(this.definition,r=>{r.accept(e)})}},fe=class extends bt{constructor(e){super([]),this.idx=1,Ye(this,St(e,r=>r!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}},ft=class extends bt{constructor(e){super(e.definition),this.orgText="",Ye(this,St(e,r=>r!==void 0))}},de=class extends bt{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Ye(this,St(e,r=>r!==void 0))}},xe=class extends bt{constructor(e){super(e.definition),this.idx=1,Ye(this,St(e,r=>r!==void 0))}},_e=class extends bt{constructor(e){super(e.definition),this.idx=1,Ye(this,St(e,r=>r!==void 0))}},Ue=class extends bt{constructor(e){super(e.definition),this.idx=1,Ye(this,St(e,r=>r!==void 0))}},se=class extends bt{constructor(e){super(e.definition),this.idx=1,Ye(this,St(e,r=>r!==void 0))}},Ce=class extends bt{constructor(e){super(e.definition),this.idx=1,Ye(this,St(e,r=>r!==void 0))}},ve=class extends bt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ye(this,St(e,r=>r!==void 0))}},te=class{constructor(e){this.idx=1,Ye(this,St(e,r=>r!==void 0))}accept(e){e.visit(this)}};function Na(t){return M(t,Ti)}function Ti(t){function e(r){return M(r,Ti)}if(t instanceof fe){let r={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return je(t.label)&&(r.label=t.label),r}else{if(t instanceof de)return{type:"Alternative",definition:e(t.definition)};if(t instanceof xe)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof _e)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Ue)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Ti(new te({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ce)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Ti(new te({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof se)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof ve)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof te){let r={type:"Terminal",name:t.terminalType.name,label:F1(t.terminalType),idx:t.idx};je(t.label)&&(r.terminalLabel=t.label);let n=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(r.pattern=Ut(n)?n.source:n),r}else{if(t instanceof ft)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}var dt=class{visit(e){let r=e;switch(r.constructor){case fe:return this.visitNonTerminal(r);case de:return this.visitAlternative(r);case xe:return this.visitOption(r);case _e:return this.visitRepetitionMandatory(r);case Ue:return this.visitRepetitionMandatoryWithSeparator(r);case Ce:return this.visitRepetitionWithSeparator(r);case se:return this.visitRepetition(r);case ve:return this.visitAlternation(r);case te:return this.visitTerminal(r);case ft:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}};function su(t){return t instanceof de||t instanceof xe||t instanceof se||t instanceof _e||t instanceof Ue||t instanceof Ce||t instanceof te||t instanceof ft}function Sn(t,e=[]){return t instanceof xe||t instanceof se||t instanceof Ce?!0:t instanceof ve?ds(t.definition,n=>Sn(n,e)):t instanceof fe&&Se(e,t)?!1:t instanceof bt?(t instanceof fe&&e.push(t),tt(t.definition,n=>Sn(n,e))):!1}function ou(t){return t instanceof ve}function Tt(t){if(t instanceof fe)return"SUBRULE";if(t instanceof xe)return"OPTION";if(t instanceof ve)return"OR";if(t instanceof _e)return"AT_LEAST_ONE";if(t instanceof Ue)return"AT_LEAST_ONE_SEP";if(t instanceof Ce)return"MANY_SEP";if(t instanceof se)return"MANY";if(t instanceof te)return"CONSUME";throw Error("non exhaustive match")}var kr=class{walk(e,r=[]){_(e.definition,(n,i)=>{let s=Me(e.definition,i+1);if(n instanceof fe)this.walkProdRef(n,s,r);else if(n instanceof te)this.walkTerminal(n,s,r);else if(n instanceof de)this.walkFlat(n,s,r);else if(n instanceof xe)this.walkOption(n,s,r);else if(n instanceof _e)this.walkAtLeastOne(n,s,r);else if(n instanceof Ue)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Ce)this.walkManySep(n,s,r);else if(n instanceof se)this.walkMany(n,s,r);else if(n instanceof ve)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(e,r,n){}walkProdRef(e,r,n){}walkFlat(e,r,n){let i=r.concat(n);this.walk(e,i)}walkOption(e,r,n){let i=r.concat(n);this.walk(e,i)}walkAtLeastOne(e,r,n){let i=[new xe({definition:e.definition})].concat(r,n);this.walk(e,i)}walkAtLeastOneSep(e,r,n){let i=ex(e,r,n);this.walk(e,i)}walkMany(e,r,n){let i=[new xe({definition:e.definition})].concat(r,n);this.walk(e,i)}walkManySep(e,r,n){let i=ex(e,r,n);this.walk(e,i)}walkOr(e,r,n){let i=r.concat(n);_(e.definition,s=>{let o=new de({definition:[s]});this.walk(o,i)})}};function ex(t,e,r){return[new xe({definition:[new te({terminalType:t.separator})].concat(t.definition)})].concat(e,r)}function Tn(t){if(t instanceof fe)return Tn(t.referencedRule);if(t instanceof te)return W1(t);if(su(t))return G1(t);if(ou(t))return j1(t);throw Error("non exhaustive match")}function G1(t){let e=[],r=t.definition,n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=Sn(s),e=e.concat(Tn(s)),n=n+1,i=r.length>n;return Ei(e)}function j1(t){let e=M(t.definition,r=>Tn(r));return Ei(Ge(e))}function W1(t){return[t.terminalType]}var Ca="_~IN~_";var au=class extends kr{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,r,n){}walkProdRef(e,r,n){let i=H1(e.referencedRule,e.idx)+this.topProd.name,s=r.concat(n),o=new de({definition:s}),a=Tn(o);this.follows[i]=a}};function tx(t){let e={};return _(t,r=>{let n=new au(r).startWalking();Ye(e,n)}),e}function H1(t,e){return t.name+e+Ca}function B(t){return t.charCodeAt(0)}function va(t,e){Array.isArray(t)?t.forEach(function(r){e.push(r)}):e.push(t)}function Oi(t,e){if(t[e]===!0)throw"duplicate flag "+e;let r=t[e];t[e]=!0}function On(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function xs(){throw Error("Internal Error - Should never get here!")}function lu(t){return t.type==="Character"}var ys=[];for(let t=B("0");t<=B("9");t++)ys.push(t);var Es=[B("_")].concat(ys);for(let t=B("a");t<=B("z");t++)Es.push(t);for(let t=B("A");t<=B("Z");t++)Es.push(t);var cu=[B(" "),B("\f"),B(`
`),B("\r"),B("	"),B("\v"),B("	"),B("\xA0"),B("\u1680"),B("\u2000"),B("\u2001"),B("\u2002"),B("\u2003"),B("\u2004"),B("\u2005"),B("\u2006"),B("\u2007"),B("\u2008"),B("\u2009"),B("\u200A"),B("\u2028"),B("\u2029"),B("\u202F"),B("\u205F"),B("\u3000"),B("\uFEFF")];var z1=/[0-9a-fA-F]/,wa=/[0-9]/,V1=/[1-9]/,Ss=class{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");let r=this.disjunction();this.consumeChar("/");let n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Oi(n,"global");break;case"i":Oi(n,"ignoreCase");break;case"m":Oi(n,"multiLine");break;case"u":Oi(n,"unicode");break;case"y":Oi(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){let e=[],r=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(r)}}alternative(){let e=[],r=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){let e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}On(r);let n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(e)}}return xs()}quantifier(e=!1){let r,n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":let i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&r===void 0)return;On(r);break}if(!(e===!0&&r===void 0)&&On(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let e,r=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}return e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),On(e)?(e.loc=this.loc(r),this.isQuantifier()&&(e.quantifier=this.quantifier()),e):xs()}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[B(`
`),B("\r"),B("\u2028"),B("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,r=!1;switch(this.popChar()){case"d":e=ys;break;case"D":e=ys,r=!0;break;case"s":e=cu;break;case"S":e=cu,r=!0;break;case"w":e=Es;break;case"W":e=Es,r=!0;break}return On(e)?{type:"Set",value:e,complement:r}:xs()}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=B("\f");break;case"n":e=B(`
`);break;case"r":e=B("\r");break;case"t":e=B("	");break;case"v":e=B("\v");break}return On(e)?{type:"Character",value:e}:xs()}controlLetterEscapeAtom(){this.consumeChar("c");let e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:B("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){let e=this.popChar();return{type:"Character",value:B(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:let e=this.popChar();return{type:"Character",value:B(e)}}}characterClass(){let e=[],r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){let n=this.classAtom(),i=n.type==="Character";if(lu(n)&&this.isRangeDash()){this.consumeChar("-");let s=this.classAtom(),o=s.type==="Character";if(lu(s)){if(s.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:s.value})}else va(n.value,e),e.push(B("-")),va(s.value,e)}else va(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:r,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:B("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}let r=this.disjunction();this.consumeChar(")");let n={type:"Group",capturing:e,value:r};return e&&(n.idx=this.groupIdx),n}positiveInteger(){let e=this.popChar();if(V1.test(e)===!1)throw Error("Expecting a positive integer");for(;wa.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(wa.test(e)===!1)throw Error("Expecting an integer");for(;wa.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){let e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:B(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return wa.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){let e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let r="";for(let i=0;i<e;i++){let s=this.popChar();if(z1.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){let e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}};var Xr=class{visitChildren(e){for(let r in e){let n=e[r];e.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}};var Ia={},Y1=new Ss;function Ai(t){let e=t.toString();if(Ia.hasOwnProperty(e))return Ia[e];{let r=Y1.pattern(e);return Ia[e]=r,r}}function rx(){Ia={}}var ix="Complement Sets are not supported for first char optimization",Ts=`Unable to use "first char" lexer optimizations:
`;function sx(t,e=!1){try{let r=Ai(t);return uu(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===ix)e&&ps(`${Ts}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Si(`${Ts}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function uu(t,e,r){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)uu(t.value[i],e,r);break;case"Alternative":let n=t.value;for(let i=0;i<n.length;i++){let s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}let o=s;switch(o.type){case"Character":Ra(o.value,e,r);break;case"Set":if(o.complement===!0)throw Error(ix);_(o.value,c=>{if(typeof c=="number")Ra(c,e,r);else{let l=c;if(r===!0)for(let f=l.from;f<=l.to;f++)Ra(f,e,r);else{for(let f=l.from;f<=l.to&&f<Li;f++)Ra(f,e,r);if(l.to>=Li){let f=l.from>=Li?l.from:Li,u=l.to,h=sr(f),d=sr(u);for(let p=h;p<=d;p++)e[p]=p}}}});break;case"Group":uu(o.value,e,r);break;default:throw Error("Non Exhaustive Match")}let a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&hu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return le(e)}function Ra(t,e,r){let n=sr(t);e[n]=n,r===!0&&Q1(t,e)}function Q1(t,e){let r=String.fromCharCode(t),n=r.toUpperCase();if(n!==r){let i=sr(n.charCodeAt(0));e[i]=i}else{let i=r.toLowerCase();if(i!==r){let s=sr(i.charCodeAt(0));e[s]=s}}}function nx(t,e){return ir(t.value,r=>{if(typeof r=="number")return Se(e,r);{let n=r;return ir(e,i=>n.from<=i&&i<=n.to)!==void 0}})}function hu(t){let e=t.quantifier;return e&&e.atLeast===0?!0:t.value?D(t.value)?tt(t.value,hu):hu(t.value):!1}var fu=class extends Xr{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Se(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?nx(e,this.targetCharCodes)===void 0&&(this.found=!0):nx(e,this.targetCharCodes)!==void 0&&(this.found=!0)}};function Ma(t,e){if(e instanceof RegExp){let r=Ai(e),n=new fu(t);return n.visit(r),n.found}else return ir(e,r=>Se(t,r.charCodeAt(0)))!==void 0}var An="PATTERN",bi="defaultMode",_a="modes",pu=typeof new RegExp("(?:)").sticky=="boolean";function lx(t,e){e=yi(e,{useSticky:pu,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(y,E)=>E()});let r=e.tracer;r("initCharCodeToOptimizedIndexMap",()=>{pP()});let n;r("Reject Lexer.NA",()=>{n=Qr(t,y=>y[An]===Q.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=M(n,y=>{let E=y[An];if(Ut(E)){let T=E.source;return T.length===1&&T!=="^"&&T!=="$"&&T!=="."&&!E.ignoreCase?T:T.length===2&&T[0]==="\\"&&!Se(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?T[1]:e.useSticky?ax(E):ox(E)}else{if(ut(E))return i=!0,{exec:E};if(typeof E=="object")return i=!0,E;if(typeof E=="string"){if(E.length===1)return E;{let T=E.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),A=new RegExp(T);return e.useSticky?ax(A):ox(A)}}else throw Error("non exhaustive match")}})});let o,a,c,l,f;r("misc mapping",()=>{o=M(n,y=>y.tokenTypeIdx),a=M(n,y=>{let E=y.GROUP;if(E!==Q.SKIPPED){if(je(E))return E;if(nt(E))return!1;throw Error("non exhaustive match")}}),c=M(n,y=>{let E=y.LONGER_ALT;if(E)return D(E)?M(E,A=>ka(n,A)):[ka(n,E)]}),l=M(n,y=>y.PUSH_MODE),f=M(n,y=>U(y,"POP_MODE"))});let u;r("Line Terminator Handling",()=>{let y=gx(e.lineTerminatorCharacters);u=M(n,E=>!1),e.positionTracking!=="onlyOffset"&&(u=M(n,E=>U(E,"LINE_BREAKS")?!!E.LINE_BREAKS:mx(E,y)===!1&&Ma(y,E.PATTERN)))});let h,d,p,m;r("Misc Mapping #2",()=>{h=M(n,dx),d=M(s,fP),p=Be(n,(y,E)=>{let T=E.GROUP;return je(T)&&T!==Q.SKIPPED&&(y[T]=[]),y},{}),m=M(s,(y,E)=>({pattern:s[E],longerAlt:c[E],canLineTerminator:u[E],isCustom:h[E],short:d[E],group:a[E],push:l[E],pop:f[E],tokenTypeIdx:o[E],tokenType:n[E]}))});let g=!0,x=[];return e.safeMode||r("First Char Optimization",()=>{x=Be(n,(y,E,T)=>{if(typeof E.PATTERN=="string"){let A=E.PATTERN.charCodeAt(0),L=sr(A);du(y,L,m[T])}else if(D(E.START_CHARS_HINT)){let A;_(E.START_CHARS_HINT,L=>{let k=typeof L=="string"?L.charCodeAt(0):L,N=sr(k);A!==N&&(A=N,du(y,N,m[T]))})}else if(Ut(E.PATTERN))if(E.PATTERN.unicode)g=!1,e.ensureOptimizations&&Si(`${Ts}	Unable to analyze < ${E.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{let A=sx(E.PATTERN,e.ensureOptimizations);Y(A)&&(g=!1),_(A,L=>{du(y,L,m[T])})}else e.ensureOptimizations&&Si(`${Ts}	TokenType: <${E.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return y},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:x,hasCustom:i,canBeOptimized:g}}function cx(t,e){let r=[],n=Z1(t);r=r.concat(n.errors);let i=J1(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(X1(s)),r=r.concat(aP(s)),r=r.concat(lP(s,e)),r=r.concat(cP(s)),r}function X1(t){let e=[],r=rt(t,n=>Ut(n[An]));return e=e.concat(tP(r)),e=e.concat(iP(r)),e=e.concat(sP(r)),e=e.concat(oP(r)),e=e.concat(rP(r)),e}function Z1(t){let e=rt(t,i=>!U(i,An)),r=M(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Te.MISSING_PATTERN,tokenTypes:[i]})),n=Yr(t,e);return{errors:r,valid:n}}function J1(t){let e=rt(t,i=>{let s=i[An];return!Ut(s)&&!ut(s)&&!U(s,"exec")&&!je(s)}),r=M(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Te.INVALID_PATTERN,tokenTypes:[i]})),n=Yr(t,e);return{errors:r,valid:n}}var eP=/[^\\][$]/;function tP(t){class e extends Xr{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}let r=rt(t,i=>{let s=i.PATTERN;try{let o=Ai(s),a=new e;return a.visit(o),a.found}catch{return eP.test(s.source)}});return M(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Te.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function rP(t){let e=rt(t,n=>n.PATTERN.test(""));return M(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:Te.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}var nP=/[^\\[][\^]|^\^/;function iP(t){class e extends Xr{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}let r=rt(t,i=>{let s=i.PATTERN;try{let o=Ai(s),a=new e;return a.visit(o),a.found}catch{return nP.test(s.source)}});return M(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Te.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function sP(t){let e=rt(t,n=>{let i=n[An];return i instanceof RegExp&&(i.multiline||i.global)});return M(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Te.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function oP(t){let e=[],r=M(t,s=>Be(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Se(e,a)&&a.PATTERN!==Q.NA&&(e.push(a),o.push(a)),o),[]));r=rr(r);let n=rt(r,s=>s.length>1);return M(n,s=>{let o=M(s,c=>c.name);return{message:`The same RegExp pattern ->${ze(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Te.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function aP(t){let e=rt(t,n=>{if(!U(n,"GROUP"))return!1;let i=n.GROUP;return i!==Q.SKIPPED&&i!==Q.NA&&!je(i)});return M(e,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Te.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function lP(t,e){let r=rt(t,i=>i.PUSH_MODE!==void 0&&!Se(e,i.PUSH_MODE));return M(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Te.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function cP(t){let e=[],r=Be(t,(n,i,s)=>{let o=i.PATTERN;return o===Q.NA||(je(o)?n.push({str:o,idx:s,tokenType:i}):Ut(o)&&hP(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return _(t,(n,i)=>{_(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&uP(s,n.PATTERN)){let c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Te.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),e}function uP(t,e){if(Ut(e)){let r=e.exec(t);return r!==null&&r.index===0}else{if(ut(e))return e(t,0,[],{});if(U(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function hP(t){return ir([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>t.source.indexOf(r)!==-1)===void 0}function ox(t){let e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function ax(t){let e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function ux(t,e,r){let n=[];return U(t,bi)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+bi+`> property in its definition
`,type:Te.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),U(t,_a)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+_a+`> property in its definition
`,type:Te.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),U(t,_a)&&U(t,bi)&&!U(t.modes,t.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${bi}: <${t.defaultMode}>which does not exist
`,type:Te.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),U(t,_a)&&_(t.modes,(i,s)=>{_(i,(o,a)=>{if(nt(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Te.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(U(o,"LONGER_ALT")){let c=D(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];_(c,l=>{!nt(l)&&!Se(i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Te.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function hx(t,e,r){let n=[],i=!1,s=rr(Ge(le(t.modes))),o=Qr(s,c=>c[An]===Q.NA),a=gx(r);return e&&_(o,c=>{let l=mx(c,a);if(l!==!1){let u={message:dP(c,l),type:l.issue,tokenType:c};n.push(u)}else U(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Ma(a,c.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Te.NO_LINE_BREAKS_FLAGS}),n}function fx(t){let e={},r=ce(t);return _(r,n=>{let i=t[n];if(D(i))e[n]=[];else throw Error("non exhaustive match")}),e}function dx(t){let e=t.PATTERN;if(Ut(e))return!1;if(ut(e))return!0;if(U(e,"exec"))return!0;if(je(e))return!1;throw Error("non exhaustive match")}function fP(t){return je(t)&&t.length===1?t.charCodeAt(0):!1}var px={test:function(t){let e=t.length;for(let r=this.lastIndex;r<e;r++){let n=t.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return t.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function mx(t,e){if(U(t,"LINE_BREAKS"))return!1;if(Ut(t.PATTERN)){try{Ma(e,t.PATTERN)}catch(r){return{issue:Te.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(je(t.PATTERN))return!1;if(dx(t))return{issue:Te.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function dP(t,e){if(e.issue===Te.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Te.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function gx(t){return M(t,r=>je(r)?r.charCodeAt(0):r)}function du(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}var Li=256,Ua=[];function sr(t){return t<Li?t:Ua[t]}function pP(){if(Y(Ua)){Ua=new Array(65536);for(let t=0;t<65536;t++)Ua[t]=t>255?255+~~(t/255):t}}function Nr(t,e){let r=t.tokenTypeIdx;return r===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[r]===!0}function ki(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}var xx=1,Ex={};function Cr(t){let e=mP(t);gP(e),yP(e),xP(e),_(e,r=>{r.isParent=r.categoryMatches.length>0})}function mP(t){let e=he(t),r=t,n=!0;for(;n;){r=rr(Ge(M(r,s=>s.CATEGORIES)));let i=Yr(r,e);e=e.concat(i),Y(i)?n=!1:r=i}return e}function gP(t){_(t,e=>{mu(e)||(Ex[xx]=e,e.tokenTypeIdx=xx++),yx(e)&&!D(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),yx(e)||(e.CATEGORIES=[]),EP(e)||(e.categoryMatches=[]),SP(e)||(e.categoryMatchesMap={})})}function xP(t){_(t,e=>{e.categoryMatches=[],_(e.categoryMatchesMap,(r,n)=>{e.categoryMatches.push(Ex[n].tokenTypeIdx)})})}function yP(t){_(t,e=>{Sx([],e)})}function Sx(t,e){_(t,r=>{e.categoryMatchesMap[r.tokenTypeIdx]=!0}),_(e.CATEGORIES,r=>{let n=t.concat(e);Se(n,r)||Sx(n,r)})}function mu(t){return U(t,"tokenTypeIdx")}function yx(t){return U(t,"CATEGORIES")}function EP(t){return U(t,"categoryMatches")}function SP(t){return U(t,"categoryMatchesMap")}function Tx(t){return U(t,"tokenTypeIdx")}var gu={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,r,n,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${r} characters.`}};var Te;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Te||(Te={}));var Os={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:gu,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Os);var Q=class{constructor(e,r=Os){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;let o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);let{time:a,value:c}=ms(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ye({},Os,r);let n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Os.lineTerminatorsPattern)this.config.lineTerminatorsPattern=px;else if(this.config.lineTerminatorCharacters===Os.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),D(e)?i={modes:{defaultMode:he(e)},defaultMode:bi}:(s=!1,i=he(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(ux(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(hx(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},_(i.modes,(a,c)=>{i.modes[c]=Qr(a,l=>nt(l))});let o=ce(i.modes);if(_(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(cx(a,o))}),Y(this.lexerDefinitionErrors)){Cr(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=lx(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Ye({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Y(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){let c=M(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}_(this.lexerDefinitionWarning,a=>{ps(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(pu?(this.chopInput=Mt,this.match=this.matchWithTest):(this.updateLastIndex=be,this.match=this.matchWithExec),s&&(this.handleModes=be),this.trackStartLines===!1&&(this.computeNewColumn=Mt),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=be),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{let a=Be(this.canModeBeOptimized,(c,l,f)=>(l===!1&&c.push(f),c),[]);if(r.ensureOptimizations&&!Y(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{rx()}),this.TRACE_INIT("toFastProperties",()=>{gs(this)})})}tokenize(e,r=this.defaultMode){if(!Y(this.lexerDefinitionErrors)){let i=M(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,r)}tokenizeInternal(e,r){let n,i,s,o,a,c,l,f,u,h,d,p,m,g,x,y,E=e,T=E.length,A=0,L=0,k=this.hasCustom?0:Math.floor(e.length/10),N=new Array(k),v=[],R=this.trackStartLines?1:void 0,b=this.trackStartLines?1:void 0,w=fx(this.emptyGroups),C=this.trackStartLines,I=this.config.lineTerminatorsPattern,P=0,q=[],$=[],F=[],J=[];Object.freeze(J);let ee;function ae(){return q}function oe(Ie){let Je=sr(Ie),Er=$[Je];return Er===void 0?J:Er}let Ze=Ie=>{if(F.length===1&&Ie.tokenType.PUSH_MODE===void 0){let Je=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ie);v.push({offset:Ie.startOffset,line:Ie.startLine,column:Ie.startColumn,length:Ie.image.length,message:Je})}else{F.pop();let Je=nr(F);q=this.patternIdxToConfig[Je],$=this.charCodeToPatternIdxToConfig[Je],P=q.length;let Er=this.canModeBeOptimized[Je]&&this.config.safeMode===!1;$&&Er?ee=oe:ee=ae}};function at(Ie){F.push(Ie),$=this.charCodeToPatternIdxToConfig[Ie],q=this.patternIdxToConfig[Ie],P=q.length,P=q.length;let Je=this.canModeBeOptimized[Ie]&&this.config.safeMode===!1;$&&Je?ee=oe:ee=ae}at.call(this,r);let Ne,At=this.config.recoveryEnabled;for(;A<T;){c=null;let Ie=E.charCodeAt(A),Je=ee(Ie),Er=Je.length;for(n=0;n<Er;n++){Ne=Je[n];let et=Ne.pattern;l=null;let Lt=Ne.short;if(Lt!==!1?Ie===Lt&&(c=et):Ne.isCustom===!0?(y=et.exec(E,A,N,w),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(et,A),c=this.match(et,e,A)),c!==null){if(a=Ne.longerAlt,a!==void 0){let Gt=a.length;for(s=0;s<Gt;s++){let It=q[a[s]],K=It.pattern;if(f=null,It.isCustom===!0?(y=K.exec(E,A,N,w),y!==null?(o=y[0],y.payload!==void 0&&(f=y.payload)):o=null):(this.updateLastIndex(K,A),o=this.match(K,e,A)),o&&o.length>c.length){c=o,l=f,Ne=It;break}}}break}}if(c!==null){if(u=c.length,h=Ne.group,h!==void 0&&(d=Ne.tokenTypeIdx,p=this.createTokenInstance(c,A,d,Ne.tokenType,R,b,u),this.handlePayload(p,l),h===!1?L=this.addToken(N,L,p):w[h].push(p)),e=this.chopInput(e,u),A=A+u,b=this.computeNewColumn(b,u),C===!0&&Ne.canLineTerminator===!0){let et=0,Lt,Gt;I.lastIndex=0;do Lt=I.test(c),Lt===!0&&(Gt=I.lastIndex-1,et++);while(Lt===!0);et!==0&&(R=R+et,b=u-Gt,this.updateTokenEndLineColumnLocation(p,h,Gt,et,R,b,u))}this.handleModes(Ne,Ze,at,p)}else{let et=A,Lt=R,Gt=b,It=At===!1;for(;It===!1&&A<T;)for(e=this.chopInput(e,1),A++,i=0;i<P;i++){let K=q[i],ie=K.pattern,lt=K.short;if(lt!==!1?E.charCodeAt(A)===lt&&(It=!0):K.isCustom===!0?It=ie.exec(E,A,N,w)!==null:(this.updateLastIndex(ie,A),It=ie.exec(e)!==null),It===!0)break}if(m=A-et,b=this.computeNewColumn(b,m),x=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(E,et,m,Lt,Gt),v.push({offset:et,line:Lt,column:Gt,length:m,message:x}),At===!1)break}}return this.hasCustom||(N.length=L),{tokens:N,groups:w,errors:v}}handleModes(e,r,n,i){if(e.pop===!0){let s=e.push;r(i),s!==void 0&&n.call(this,s)}else e.push!==void 0&&n.call(this,e.push)}chopInput(e,r){return e.substring(r)}updateLastIndex(e,r){e.lastIndex=r}updateTokenEndLineColumnLocation(e,r,n,i,s,o,a){let c,l;r!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,r){return e+r}createOffsetOnlyToken(e,r,n,i){return{image:e,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(e,r,n,i,s,o){return{image:e,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(e,r,n){return e.push(n),r}addTokenUsingMemberAccess(e,r,n){return e[r]=n,r++,r}handlePayloadNoCustom(e,r){}handlePayloadWithCustom(e,r){r!==null&&(e.payload=r)}matchWithTest(e,r,n){return e.test(r)===!0?r.substring(n,e.lastIndex):null}matchWithExec(e,r){let n=e.exec(r);return n!==null?n[0]:null}};Q.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Q.NA=/NOT_APPLICABLE/;function Ln(t){return xu(t)?t.LABEL:t.name}function xu(t){return je(t.LABEL)&&t.LABEL!==""}var TP="parent",Ox="categories",Ax="label",Lx="group",bx="push_mode",kx="pop_mode",Nx="longer_alt",Cx="line_breaks",vx="start_chars_hint";function O(t){return OP(t)}function OP(t){let e=t.pattern,r={};if(r.name=t.name,nt(e)||(r.PATTERN=e),U(t,TP))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return U(t,Ox)&&(r.CATEGORIES=t[Ox]),Cr([r]),U(t,Ax)&&(r.LABEL=t[Ax]),U(t,Lx)&&(r.GROUP=t[Lx]),U(t,kx)&&(r.POP_MODE=t[kx]),U(t,bx)&&(r.PUSH_MODE=t[bx]),U(t,Nx)&&(r.LONGER_ALT=t[Nx]),U(t,Cx)&&(r.LINE_BREAKS=t[Cx]),U(t,vx)&&(r.START_CHARS_HINT=t[vx]),r}var re=O({name:"EOF",pattern:Q.NA});Cr([re]);function bn(t,e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function yu(t,e){return Nr(t,e)}var Pa={buildMismatchTokenMessage({expected:t,actual:e,previous:r,ruleName:n}){return`Expecting ${xu(t)?`--> ${Ln(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:r,customUserDescription:n,ruleName:i}){let s="Expecting: ",a=`
but found: '`+ze(e).image+"'";if(n)return s+n+a;{let c=Be(t,(h,d)=>h.concat(d),[]),l=M(c,h=>`[${M(h,d=>Ln(d)).join(", ")}]`),u=`one of these possible Token sequences:
${M(l,(h,d)=>`  ${d+1}. ${h}`).join(`
`)}`;return s+u+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:r,ruleName:n}){let i="Expecting: ",o=`
but found: '`+ze(e).image+"'";if(r)return i+r+o;{let c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${M(t,l=>`[${M(l,f=>Ln(f)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Pa);var wx={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Wt={buildDuplicateFoundError(t,e){function r(f){return f instanceof te?f.terminalType.name:f instanceof fe?f.nonTerminalName:""}let n=t.name,i=ze(e),s=i.idx,o=Tt(i),a=r(i),c=s>0,l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){let e=M(t.prefixPath,i=>Ln(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){let e=M(t.prefixPath,i=>Ln(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx,n=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(t){let e=Tt(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){let e=t.topLevelRule.name,r=M(t.leftRecursionPath,s=>s.name),n=`${e} --> ${r.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof ft?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function Ix(t,e){let r=new Eu(t,e);return r.resolveRefs(),r.errors}var Eu=class extends dt{constructor(e,r){super(),this.nameToTopRule=e,this.errMsgProvider=r,this.errors=[]}resolveRefs(){_(le(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){let r=this.nameToTopRule[e.nonTerminalName];if(r)e.referencedRule=r;else{let n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:We.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}};var Su=class extends kr{constructor(e,r){super(),this.topProd=e,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=he(this.path.ruleStack).reverse(),this.occurrenceStack=he(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,r=[]){this.found||super.walk(e,r)}walkProdRef(e,r,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){let i=r.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Y(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}},qa=class extends Su{constructor(e,r){super(e,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,r,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){let i=r.concat(n),s=new de({definition:i});this.possibleTokTypes=Tn(s),this.found=!0}}},Ni=class extends kr{constructor(e,r){super(),this.topRule=e,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}},Da=class extends Ni{walkMany(e,r,n){if(e.idx===this.occurrence){let i=ze(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,r,n)}},As=class extends Ni{walkManySep(e,r,n){if(e.idx===this.occurrence){let i=ze(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,r,n)}},$a=class extends Ni{walkAtLeastOne(e,r,n){if(e.idx===this.occurrence){let i=ze(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,r,n)}},Ls=class extends Ni{walkAtLeastOneSep(e,r,n){if(e.idx===this.occurrence){let i=ze(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof te&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,r,n)}};function Ba(t,e,r=[]){r=he(r);let n=[],i=0;function s(a){return a.concat(Me(t,i+1))}function o(a){let c=Ba(s(a),e,r);return n.concat(c)}for(;r.length<e&&i<t.length;){let a=t[i];if(a instanceof de)return o(a.definition);if(a instanceof fe)return o(a.definition);if(a instanceof xe)n=o(a.definition);else if(a instanceof _e){let c=a.definition.concat([new se({definition:a.definition})]);return o(c)}else if(a instanceof Ue){let c=[new de({definition:a.definition}),new se({definition:[new te({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ce){let c=a.definition.concat([new se({definition:[new te({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof se){let c=a.definition.concat([new se({definition:a.definition})]);n=o(c)}else{if(a instanceof ve)return _(a.definition,c=>{Y(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof te)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:Me(t,i)}),n}function Fa(t,e,r,n){let i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE",a=!1,c=e.length,l=c-n-1,f=[],u=[];for(u.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Y(u);){let h=u.pop();if(h===o){a&&nr(u).idx<=l&&u.pop();continue}let d=h.def,p=h.idx,m=h.ruleStack,g=h.occurrenceStack;if(Y(d))continue;let x=d[0];if(x===i){let y={idx:p,def:Me(d),ruleStack:br(m),occurrenceStack:br(g)};u.push(y)}else if(x instanceof te)if(p<c-1){let y=p+1,E=e[y];if(r(E,x.terminalType)){let T={idx:y,def:Me(d),ruleStack:m,occurrenceStack:g};u.push(T)}}else if(p===c-1)f.push({nextTokenType:x.terminalType,nextTokenOccurrence:x.idx,ruleStack:m,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(x instanceof fe){let y=he(m);y.push(x.nonTerminalName);let E=he(g);E.push(x.idx);let T={idx:p,def:x.definition.concat(s,Me(d)),ruleStack:y,occurrenceStack:E};u.push(T)}else if(x instanceof xe){let y={idx:p,def:Me(d),ruleStack:m,occurrenceStack:g};u.push(y),u.push(o);let E={idx:p,def:x.definition.concat(Me(d)),ruleStack:m,occurrenceStack:g};u.push(E)}else if(x instanceof _e){let y=new se({definition:x.definition,idx:x.idx}),E=x.definition.concat([y],Me(d)),T={idx:p,def:E,ruleStack:m,occurrenceStack:g};u.push(T)}else if(x instanceof Ue){let y=new te({terminalType:x.separator}),E=new se({definition:[y].concat(x.definition),idx:x.idx}),T=x.definition.concat([E],Me(d)),A={idx:p,def:T,ruleStack:m,occurrenceStack:g};u.push(A)}else if(x instanceof Ce){let y={idx:p,def:Me(d),ruleStack:m,occurrenceStack:g};u.push(y),u.push(o);let E=new te({terminalType:x.separator}),T=new se({definition:[E].concat(x.definition),idx:x.idx}),A=x.definition.concat([T],Me(d)),L={idx:p,def:A,ruleStack:m,occurrenceStack:g};u.push(L)}else if(x instanceof se){let y={idx:p,def:Me(d),ruleStack:m,occurrenceStack:g};u.push(y),u.push(o);let E=new se({definition:x.definition,idx:x.idx}),T=x.definition.concat([E],Me(d)),A={idx:p,def:T,ruleStack:m,occurrenceStack:g};u.push(A)}else if(x instanceof ve)for(let y=x.definition.length-1;y>=0;y--){let E=x.definition[y],T={idx:p,def:E.definition.concat(Me(d)),ruleStack:m,occurrenceStack:g};u.push(T),u.push(o)}else if(x instanceof de)u.push({idx:p,def:x.definition.concat(Me(d)),ruleStack:m,occurrenceStack:g});else if(x instanceof ft)u.push(AP(x,p,m,g));else throw Error("non exhaustive match")}return f}function AP(t,e,r,n){let i=he(r);i.push(t.name);let s=he(n);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ke;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ke||(ke={}));function Ga(t){if(t instanceof xe||t==="Option")return ke.OPTION;if(t instanceof se||t==="Repetition")return ke.REPETITION;if(t instanceof _e||t==="RepetitionMandatory")return ke.REPETITION_MANDATORY;if(t instanceof Ue||t==="RepetitionMandatoryWithSeparator")return ke.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Ce||t==="RepetitionWithSeparator")return ke.REPETITION_WITH_SEPARATOR;if(t instanceof ve||t==="Alternation")return ke.ALTERNATION;throw Error("non exhaustive match")}function Mx(t,e,r,n,i,s){let o=bs(t,e,r),a=$x(o)?ki:Nr;return s(o,n,a,i)}function _x(t,e,r,n,i,s){let o=ks(t,e,i,r),a=$x(o)?ki:Nr;return s(o[0],a,n)}function Ux(t,e,r,n){let i=t.length,s=tt(t,o=>tt(o,a=>a.length===1));if(e)return function(o){let a=M(o,c=>c.GATE);for(let c=0;c<i;c++){let l=t[c],f=l.length,u=a[c];if(!(u!==void 0&&u.call(this)===!1))e:for(let h=0;h<f;h++){let d=l[h],p=d.length;for(let m=0;m<p;m++){let g=this.LA(m+1);if(r(g,d[m])===!1)continue e}return c}}};if(s&&!n){let o=M(t,c=>Ge(c)),a=Be(o,(c,l,f)=>(_(l,u=>{U(c,u.tokenTypeIdx)||(c[u.tokenTypeIdx]=f),_(u.categoryMatches,h=>{U(c,h)||(c[h]=f)})}),c),{});return function(){let c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){let a=t[o],c=a.length;e:for(let l=0;l<c;l++){let f=a[l],u=f.length;for(let h=0;h<u;h++){let d=this.LA(h+1);if(r(d,f[h])===!1)continue e}return o}}}}function Px(t,e,r){let n=tt(t,s=>s.length===1),i=t.length;if(n&&!r){let s=Ge(t);if(s.length===1&&Y(s[0].categoryMatches)){let a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{let o=Be(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,_(c.categoryMatches,f=>{a[f]=!0}),a),[]);return function(){let a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){let o=t[s],a=o.length;for(let c=0;c<a;c++){let l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}var Ou=class extends kr{constructor(e,r,n){super(),this.topProd=e,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,r,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(e,r,n){this.checkIsTarget(e,ke.OPTION,r,n)||super.walkOption(e,r,n)}walkAtLeastOne(e,r,n){this.checkIsTarget(e,ke.REPETITION_MANDATORY,r,n)||super.walkOption(e,r,n)}walkAtLeastOneSep(e,r,n){this.checkIsTarget(e,ke.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}walkMany(e,r,n){this.checkIsTarget(e,ke.REPETITION,r,n)||super.walkOption(e,r,n)}walkManySep(e,r,n){this.checkIsTarget(e,ke.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}},Ka=class extends dt{constructor(e,r,n){super(),this.targetOccurrence=e,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(e,r){e.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ke.OPTION)}visitRepetition(e){this.checkIsTarget(e,ke.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ke.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ke.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ke.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ke.ALTERNATION)}};function Rx(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=[];return e}function Tu(t){let e=[""];for(let r=0;r<t.length;r++){let n=t[r],i=[];for(let s=0;s<e.length;s++){let o=e[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){let c="_"+n.categoryMatches[a];i.push(o+c)}}e=i}return e}function LP(t,e,r){for(let n=0;n<t.length;n++){if(n===r)continue;let i=t[n];for(let s=0;s<e.length;s++){let o=e[s];if(i[o]===!0)return!1}}return!0}function qx(t,e){let r=M(t,o=>Ba([o],1)),n=Rx(r.length),i=M(r,o=>{let a={};return _(o,c=>{let l=Tu(c.partialPath);_(l,f=>{a[f]=!0})}),a}),s=r;for(let o=1;o<=e;o++){let a=s;s=Rx(a.length);for(let c=0;c<a.length;c++){let l=a[c];for(let f=0;f<l.length;f++){let u=l[f].partialPath,h=l[f].suffixDef,d=Tu(u);if(LP(i,d,c)||Y(h)||u.length===e){let m=n[c];if(ja(m,u)===!1){m.push(u);for(let g=0;g<d.length;g++){let x=d[g];i[c][x]=!0}}}else{let m=Ba(h,o+1,u);s[c]=s[c].concat(m),_(m,g=>{let x=Tu(g.partialPath);_(x,y=>{i[c][y]=!0})})}}}}return n}function bs(t,e,r,n){let i=new Ka(t,ke.ALTERNATION,n);return e.accept(i),qx(i.result,r)}function ks(t,e,r,n){let i=new Ka(t,r);e.accept(i);let s=i.result,a=new Ou(e,t,r).startWalking(),c=new de({definition:s}),l=new de({definition:a});return qx([c,l],n)}function ja(t,e){e:for(let r=0;r<t.length;r++){let n=t[r];if(n.length===e.length){for(let i=0;i<n.length;i++){let s=e[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function Dx(t,e){return t.length<e.length&&tt(t,(r,n)=>{let i=e[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function $x(t){return tt(t,e=>tt(e,r=>tt(r,n=>Y(n.categoryMatches))))}function Bx(t){let e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return M(e,r=>Object.assign({type:We.CUSTOM_LOOKAHEAD_VALIDATION},r))}function Fx(t,e,r,n){let i=ht(t,c=>bP(c,r)),s=IP(t,e,r),o=ht(t,c=>CP(c,r)),a=ht(t,c=>NP(c,t,n,r));return i.concat(s,o,a)}function bP(t,e){let r=new Au;t.accept(r);let n=r.allProductions,i=iu(n,kP),s=St(i,a=>a.length>1);return M(le(s),a=>{let c=ze(a),l=e.buildDuplicateFoundError(t,a),f=Tt(c),u={message:l,type:We.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:f,occurrence:c.idx},h=Kx(c);return h&&(u.parameter=h),u})}function kP(t){return`${Tt(t)}_#_${t.idx}_#_${Kx(t)}`}function Kx(t){return t instanceof te?t.terminalType.name:t instanceof fe?t.nonTerminalName:""}var Au=class extends dt{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}};function NP(t,e,r,n){let i=[];if(Be(e,(o,a)=>a.name===t.name?o+1:o,0)>1){let o=n.buildDuplicateRuleNameError({topLevelRule:t,grammarName:r});i.push({message:o,type:We.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function Gx(t,e,r){let n=[],i;return Se(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:We.INVALID_RULE_OVERRIDE,ruleName:t})),n}function bu(t,e,r,n=[]){let i=[],s=Wa(e.definition);if(Y(s))return[];{let o=t.name;Se(s,t)&&i.push({message:r.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:n}),type:We.LEFT_RECURSION,ruleName:o});let c=Yr(s,n.concat([t])),l=ht(c,f=>{let u=he(n);return u.push(f),bu(t,f,r,u)});return i.concat(l)}}function Wa(t){let e=[];if(Y(t))return e;let r=ze(t);if(r instanceof fe)e.push(r.referencedRule);else if(r instanceof de||r instanceof xe||r instanceof _e||r instanceof Ue||r instanceof Ce||r instanceof se)e=e.concat(Wa(r.definition));else if(r instanceof ve)e=Ge(M(r.definition,s=>Wa(s.definition)));else if(!(r instanceof te))throw Error("non exhaustive match");let n=Sn(r),i=t.length>1;if(n&&i){let s=Me(t);return e.concat(Wa(s))}else return e}var Ns=class extends dt{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}};function jx(t,e){let r=new Ns;t.accept(r);let n=r.alternations;return ht(n,s=>{let o=br(s.definition);return ht(o,(a,c)=>{let l=Fa([a],[],Nr,1);return Y(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:We.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function Wx(t,e,r){let n=new Ns;t.accept(n);let i=n.alternations;return i=Qr(i,o=>o.ignoreAmbiguities===!0),ht(i,o=>{let a=o.idx,c=o.maxLookahead||e,l=bs(a,t,c,o),f=vP(l,o,t,r),u=wP(l,o,t,r);return f.concat(u)})}var Lu=class extends dt{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}};function CP(t,e){let r=new Ns;t.accept(r);let n=r.alternations;return ht(n,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:We.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function Hx(t,e,r){let n=[];return _(t,i=>{let s=new Lu;i.accept(s);let o=s.allProductions;_(o,a=>{let c=Ga(a),l=a.maxLookahead||e,f=a.idx,h=ks(f,i,c,l)[0];if(Y(Ge(h))){let d=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:d,type:We.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function vP(t,e,r,n){let i=[],s=Be(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||_(c,f=>{let u=[l];_(t,(h,d)=>{l!==d&&ja(h,f)&&e.definition[d].ignoreAmbiguities!==!0&&u.push(d)}),u.length>1&&!ja(i,f)&&(i.push(f),a.push({alts:u,path:f}))}),a),[]);return M(s,a=>{let c=M(a.alts,f=>f+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:We.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:e.idx,alternatives:a.alts}})}function wP(t,e,r,n){let i=Be(t,(o,a,c)=>{let l=M(a,f=>({idx:c,path:f}));return o.concat(l)},[]);return rr(ht(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];let c=o.idx,l=o.path,f=rt(i,h=>e.definition[h.idx].ignoreAmbiguities!==!0&&h.idx<c&&Dx(h.path,l));return M(f,h=>{let d=[h.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:d,prefixPath:h.path}),type:We.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:p,alternatives:d}})}))}function IP(t,e,r){let n=[],i=M(e,s=>s.name);return _(t,s=>{let o=s.name;if(Se(i,o)){let a=r.buildNamespaceConflictError(s);n.push({message:a,type:We.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function zx(t){let e=yi(t,{errMsgProvider:wx}),r={};return _(t.rules,n=>{r[n.name]=n}),Ix(r,e.errMsgProvider)}function Vx(t){return t=yi(t,{errMsgProvider:Wt}),Fx(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}var Yx="MismatchedTokenException",Qx="NoViableAltException",Xx="EarlyExitException",Zx="NotAllInputParsedException",Jx=[Yx,Qx,Xx,Zx];Object.freeze(Jx);function Zr(t){return Se(Jx,t.name)}var Ci=class extends Error{constructor(e,r){super(e),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},kn=class extends Ci{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Yx}},Cs=class extends Ci{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Qx}},vs=class extends Ci{constructor(e,r){super(e,r),this.name=Zx}},ws=class extends Ci{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Xx}};var ku={},Cu="InRuleRecoveryException",Nu=class extends Error{constructor(e){super(e),this.name=Cu}},Ha=class{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=U(e,"recoveryEnabled")?e.recoveryEnabled:pt.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=RP)}getTokenToInsert(e){let r=bn(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,r,n,i){let s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[],c=!1,l=this.LA(1),f=this.LA(1),u=()=>{let h=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:h,ruleName:this.getCurrRuleFullName()}),p=new kn(d,l,this.LA(0));p.resyncedTokens=br(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(f,i)){u();return}else if(n.call(this)){u(),e.apply(this,r);return}else this.tokenMatcher(f,s)?c=!0:(f=this.SKIP_TOKEN(),this.addToResyncTokens(f,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,r)))}getFollowsForInRuleRecovery(e,r){let n=this.getCurrentGrammarPath(e,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,r){if(this.canRecoverWithSingleTokenInsertion(e,r))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){let n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new Nu("sad sad panda")}canPerformInRuleRecovery(e,r){return this.canRecoverWithSingleTokenInsertion(e,r)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,r){if(!this.canTokenTypeBeInsertedInRecovery(e)||Y(r))return!1;let n=this.LA(1);return ir(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){let r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Se(n,e)}findReSyncTokenType(){let e=this.flattenFollowSet(),r=this.LA(1),n=2;for(;;){let i=ir(e,s=>yu(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return ku;let e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){let e=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return M(e,(n,i)=>i===0?ku:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){let e=M(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return Ge(e)}getFollowSetFromFollowKey(e){if(e===ku)return[re];let r=e.ruleName+e.idxInCallingRule+Ca+e.inRule;return this.resyncFollows[r]}addToResyncTokens(e,r){return this.tokenMatcher(e,re)||r.push(e),r}reSyncTo(e){let r=[],n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return br(r)}attemptInRepetitionRecovery(e,r,n,i,s,o,a){}getCurrentGrammarPath(e,r){let n=this.getHumanReadableRuleStack(),i=he(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:e,lastTokOccurrence:r}}getHumanReadableRuleStack(){return M(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}};function RP(t,e,r,n,i,s,o){let a=this.getKeyForAutomaticLookahead(n,i),c=this.firstAfterRepMap[a];if(c===void 0){let h=this.getCurrRuleFullName(),d=this.getGAstProductions()[h];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,f=c.occurrence,u=c.isEndOfRule;this.RULE_STACK.length===1&&u&&l===void 0&&(l=re,f=1),!(l===void 0||f===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,f,o)&&this.tryInRepetitionRecovery(t,e,r,l)}function za(t,e,r){return r|e|t}var Is=class{constructor(e){var r;this.maxLookahead=(r=e?.maxLookahead)!==null&&r!==void 0?r:pt.maxLookahead}validate(e){let r=this.validateNoLeftRecursion(e.rules);if(Y(r)){let n=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(e){return ht(e,r=>bu(r,r,Wt))}validateEmptyOrAlternatives(e){return ht(e,r=>jx(r,Wt))}validateAmbiguousAlternationAlternatives(e,r){return ht(e,n=>Wx(n,r,Wt))}validateSomeNonEmptyLookaheadPath(e,r){return Hx(e,r,Wt)}buildLookaheadForAlternation(e){return Mx(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,Ux)}buildLookaheadForOptional(e){return _x(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Ga(e.prodType),Px)}};var Ya=class{initLooksAhead(e){this.dynamicTokensEnabled=U(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:pt.dynamicTokensEnabled,this.maxLookahead=U(e,"maxLookahead")?e.maxLookahead:pt.maxLookahead,this.lookaheadStrategy=U(e,"lookaheadStrategy")?e.lookaheadStrategy:new Is({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){_(e,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{let{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=MP(r);_(n,l=>{let f=l.idx===0?"":l.idx;this.TRACE_INIT(`${Tt(l)}${f}`,()=>{let u=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:r,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),h=za(this.fullRuleNameToShort[r.name],256,l.idx);this.setLaFuncCache(h,u)})}),_(i,l=>{this.computeLookaheadFunc(r,l.idx,768,"Repetition",l.maxLookahead,Tt(l))}),_(s,l=>{this.computeLookaheadFunc(r,l.idx,512,"Option",l.maxLookahead,Tt(l))}),_(o,l=>{this.computeLookaheadFunc(r,l.idx,1024,"RepetitionMandatory",l.maxLookahead,Tt(l))}),_(a,l=>{this.computeLookaheadFunc(r,l.idx,1536,"RepetitionMandatoryWithSeparator",l.maxLookahead,Tt(l))}),_(c,l=>{this.computeLookaheadFunc(r,l.idx,1280,"RepetitionWithSeparator",l.maxLookahead,Tt(l))})})})}computeLookaheadFunc(e,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{let a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=za(this.fullRuleNameToShort[e.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,r){let n=this.getLastExplicitRuleShortName();return za(n,e,r)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,r){this.lookAheadFuncsCache.set(e,r)}},vu=class extends dt{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}},Va=new vu;function MP(t){Va.reset(),t.accept(Va);let e=Va.dslMethods;return Va.reset(),e}function Ru(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function Mu(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function ey(t,e,r){t.children[r]===void 0?t.children[r]=[e]:t.children[r].push(e)}function ty(t,e,r){t.children[e]===void 0?t.children[e]=[r]:t.children[e].push(r)}var _P="name";function _u(t,e){Object.defineProperty(t,_P,{enumerable:!1,configurable:!0,writable:!1,value:e})}function UP(t,e){let r=ce(t),n=r.length;for(let i=0;i<n;i++){let s=r[i],o=t[s],a=o.length;for(let c=0;c<a;c++){let l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function ry(t,e){let r=function(){};_u(r,t+"BaseSemantics");let n={visit:function(i,s){if(D(i)&&(i=i[0]),!nt(i))return this[i.name](i.children,s)},validateVisitor:function(){let i=PP(this,e);if(!Y(i)){let s=M(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=e,r}function ny(t,e,r){let n=function(){};_u(n,t+"BaseSemanticsWithDefaults");let i=Object.create(r.prototype);return _(e,s=>{i[s]=UP}),n.prototype=i,n.prototype.constructor=n,n}var Uu;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Uu||(Uu={}));function PP(t,e){return qP(t,e)}function qP(t,e){let r=rt(e,i=>ut(t[i])===!1),n=M(r,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Uu.MISSING_METHOD,methodName:i}));return rr(n)}var Ja=class{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=U(e,"nodeLocationTracking")?e.nodeLocationTracking:pt.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=be,this.cstFinallyStateUpdate=be,this.cstPostTerminal=be,this.cstPostNonTerminal=be,this.cstPostRule=be;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Mu,this.setNodeLocationFromNode=Mu,this.cstPostRule=be,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=be,this.setNodeLocationFromNode=be,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ru,this.setNodeLocationFromNode=Ru,this.cstPostRule=be,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=be,this.setNodeLocationFromNode=be,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=be,this.setNodeLocationFromNode=be,this.cstPostRule=be,this.setInitialNodeLocation=be;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){let r=this.LA(1);e.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){let r={name:e,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){let r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){let r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(e,r){let n=this.CST_STACK[this.CST_STACK.length-1];ey(n,r,e),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(e,r){let n=this.CST_STACK[this.CST_STACK.length-1];ty(n,r,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(nt(this.baseCstVisitorConstructor)){let e=ry(this.className,ce(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(nt(this.baseCstVisitorWithDefaultsConstructor)){let e=ny(this.className,ce(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){let e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}};var el=class{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):vi}LA(e){let r=this.currIdx+e;return r<0||this.tokVectorLength<=r?vi:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}};var tl=class{ACTION(e){return e.call(this)}consume(e,r,n){return this.consumeInternal(r,e,n)}subrule(e,r,n){return this.subruleInternal(r,e,n)}option(e,r){return this.optionInternal(r,e)}or(e,r){return this.orInternal(r,e)}many(e,r){return this.manyInternal(e,r)}atLeastOne(e,r){return this.atLeastOneInternal(e,r)}CONSUME(e,r){return this.consumeInternal(e,0,r)}CONSUME1(e,r){return this.consumeInternal(e,1,r)}CONSUME2(e,r){return this.consumeInternal(e,2,r)}CONSUME3(e,r){return this.consumeInternal(e,3,r)}CONSUME4(e,r){return this.consumeInternal(e,4,r)}CONSUME5(e,r){return this.consumeInternal(e,5,r)}CONSUME6(e,r){return this.consumeInternal(e,6,r)}CONSUME7(e,r){return this.consumeInternal(e,7,r)}CONSUME8(e,r){return this.consumeInternal(e,8,r)}CONSUME9(e,r){return this.consumeInternal(e,9,r)}SUBRULE(e,r){return this.subruleInternal(e,0,r)}SUBRULE1(e,r){return this.subruleInternal(e,1,r)}SUBRULE2(e,r){return this.subruleInternal(e,2,r)}SUBRULE3(e,r){return this.subruleInternal(e,3,r)}SUBRULE4(e,r){return this.subruleInternal(e,4,r)}SUBRULE5(e,r){return this.subruleInternal(e,5,r)}SUBRULE6(e,r){return this.subruleInternal(e,6,r)}SUBRULE7(e,r){return this.subruleInternal(e,7,r)}SUBRULE8(e,r){return this.subruleInternal(e,8,r)}SUBRULE9(e,r){return this.subruleInternal(e,9,r)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,r,n=wi){if(Se(this.definedRulesNames,e)){let o={message:Wt.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:We.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);let i=this.defineRule(e,r,n);return this[e]=i,i}OVERRIDE_RULE(e,r,n=wi){let i=Gx(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);let s=this.defineRule(e,r,n);return this[e]=s,s}BACKTRACK(e,r){return function(){this.isBackTrackingStack.push(1);let n=this.saveRecogState();try{return e.apply(this,r),!0}catch(i){if(Zr(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return Na(le(this.gastProductionsCache))}};var rl=class{initRecognizerEngine(e,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ki,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},U(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(D(e)){if(Y(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(D(e))this.tokensMap=Be(e,(s,o)=>(s[o.name]=o,s),{});else if(U(e,"modes")&&tt(Ge(le(e.modes)),Tx)){let s=Ge(le(e.modes)),o=Ei(s);this.tokensMap=Be(o,(a,c)=>(a[c.name]=c,a),{})}else if(Le(e))this.tokensMap=he(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=re;let n=U(e,"modes")?Ge(le(e.modes)):le(e),i=tt(n,s=>Y(s.categoryMatches));this.tokenMatcher=i?ki:Nr,Cr(le(this.tokensMap))}defineRule(e,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);let i=U(n,"resyncEnabled")?n.resyncEnabled:wi.resyncEnabled,s=U(n,"recoveryValueFunc")?n.recoveryValueFunc:wi.recoveryValueFunc,o=this.ruleShortNameIdx<<12;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...f){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,f);let u=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(u),u}catch(u){return this.invokeRuleCatch(u,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...f){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,f)}catch(u){return this.invokeRuleCatch(u,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:r})}invokeRuleCatch(e,r,n){let i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(Zr(e)){let o=e;if(s){let a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){let c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(e);else{if(this.outputCst){let c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(e);throw o}}else throw e}optionInternal(e,r){let n=this.getKeyForAutomaticLookahead(512,r);return this.optionInternalLogic(e,r,n)}optionInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof e!="function"){s=e.DEF;let o=e.GATE;if(o!==void 0){let a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,r){let n=this.getKeyForAutomaticLookahead(1024,e);return this.atLeastOneInternalLogic(e,r,n)}atLeastOneInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;let o=r.GATE;if(o!==void 0){let a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ke.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,r],i,1024,e,$a)}atLeastOneSepFirstInternal(e,r){let n=this.getKeyForAutomaticLookahead(1536,e);this.atLeastOneSepFirstInternalLogic(e,r,n)}atLeastOneSepFirstInternalLogic(e,r,n){let i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);let a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Ls],a,1536,e,Ls)}else throw this.raiseEarlyExitException(e,ke.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(e,r){let n=this.getKeyForAutomaticLookahead(768,e);return this.manyInternalLogic(e,r,n)}manyInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;let a=r.GATE;if(a!==void 0){let c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,r],i,768,e,Da,o)}manySepFirstInternal(e,r){let n=this.getKeyForAutomaticLookahead(1280,e);this.manySepFirstInternalLogic(e,r,n)}manySepFirstInternalLogic(e,r,n){let i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);let a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,As],a,1280,e,As)}}repetitionSepSecondInternal(e,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,r,n,i,s],n,1536,e,s)}doSingleRepetition(e){let r=this.getLexerPosition();return e.call(this),this.getLexerPosition()>r}orInternal(e,r){let n=this.getKeyForAutomaticLookahead(256,r),i=D(e)?e:e.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){let e=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new vs(r,e))}}subruleInternal(e,r,n){let i;try{let s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=e.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,n,e.ruleName)}}subruleInternalError(e,r,n){throw Zr(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,r,n){let i;try{let s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,n)}catch(s){i=this.consumeInternalRecovery(e,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,i),i}consumeInternalError(e,r,n){let i,s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new kn(i,r,s))}consumeInternalRecovery(e,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){let i=this.getFollowsForInRuleRecovery(e,r);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Cu?n:s}}else throw n}saveRecogState(){let e=this.errors,r=he(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){let e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),re)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}};var nl=class{initErrorHandler(e){this._errors=[],this.errorMessageProvider=U(e,"errorMessageProvider")?e.errorMessageProvider:pt.errorMessageProvider}SAVE_ERROR(e){if(Zr(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:he(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return he(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,r,n){let i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=ks(e,s,r,this.maxLookahead)[0],c=[];for(let f=1;f<=this.maxLookahead;f++)c.push(this.LA(f));let l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new ws(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,r){let n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=bs(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));let a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Cs(c,this.LA(1),a))}};var il=class{initContentAssist(){}computeContentAssist(e,r){let n=this.gastProductionsCache[e];if(nt(n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Fa([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){let r=ze(e.ruleStack),i=this.getGAstProductions()[r];return new qa(i,e).startWalking()}};var al={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(al);var iy=!0,sy=Math.pow(2,8)-1,ay=O({name:"RECORDING_PHASE_TOKEN",pattern:Q.NA});Cr([ay]);var ly=bn(ay,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(ly);var $P={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}},sl=class{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){let r=e>0?e:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,e,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,e,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${r}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,r,n){return this.consumeInternalRecord(r,e,n)},this.subrule=function(e,r,n){return this.subruleInternalRecord(r,e,n)},this.option=function(e,r){return this.optionInternalRecord(r,e)},this.or=function(e,r){return this.orInternalRecord(r,e)},this.many=function(e,r){this.manyInternalRecord(e,r)},this.atLeastOne=function(e,r){this.atLeastOneInternalRecord(e,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{let e=this;for(let r=0;r<10;r++){let n=r>0?r:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,r){return()=>!0}LA_RECORD(e){return vi}topLevelRuleRecord(e,r){try{let n=new ft({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(e,r){return Ms.call(this,xe,e,r)}atLeastOneInternalRecord(e,r){Ms.call(this,_e,r,e)}atLeastOneSepFirstInternalRecord(e,r){Ms.call(this,Ue,r,e,iy)}manyInternalRecord(e,r){Ms.call(this,se,r,e)}manySepFirstInternalRecord(e,r){Ms.call(this,Ce,r,e,iy)}orInternalRecord(e,r){return BP.call(this,e,r)}subruleInternalRecord(e,r,n){if(ol(r),!e||U(e,"ruleName")===!1){let a=new Error(`<SUBRULE${oy(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}let i=nr(this.recordingProdStack),s=e.ruleName,o=new fe({idx:r,nonTerminalName:s,label:n?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?$P:al}consumeInternalRecord(e,r,n){if(ol(r),!mu(e)){let o=new Error(`<CONSUME${oy(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}let i=nr(this.recordingProdStack),s=new te({idx:r,terminalType:e,label:n?.LABEL});return i.definition.push(s),ly}};function Ms(t,e,r,n=!1){ol(r);let i=nr(this.recordingProdStack),s=ut(e)?e:e.DEF,o=new t({definition:[],idx:r});return n&&(o.separator=e.SEP),U(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),al}function BP(t,e){ol(e);let r=nr(this.recordingProdStack),n=D(t)===!1,i=n===!1?t:t.DEF,s=new ve({definition:[],idx:e,ignoreAmbiguities:n&&t.IGNORE_AMBIGUITIES===!0});U(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);let o=ds(i,a=>ut(a.GATE));return s.hasPredicates=o,r.definition.push(s),_(i,a=>{let c=new de({definition:[]});s.definition.push(c),U(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:U(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),al}function oy(t){return t===0?"":`${t}`}function ol(t){if(t<0||t>sy){let e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${sy+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}var ll=class{initPerformanceTracer(e){if(U(e,"traceInitPerf")){let r=e.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=pt.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,r){if(this.traceInitPerf===!0){this.traceInitIndent++;let n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);let{time:i,value:s}=ms(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}};function cy(t,e){e.forEach(r=>{let n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;let s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=r.prototype[i]})})}var vi=bn(re,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(vi);var pt=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Pa,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),wi=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0}),We;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(We||(We={}));var _s=class t{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;let r=this.className;this.TRACE_INIT("toFastProps",()=>{gs(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),_(this.definedRulesNames,i=>{let o=this[i].originalGrammarAction,a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=zx({rules:le(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Y(n)&&this.skipValidations===!1){let i=Vx({rules:le(this.gastProductionsCache),tokenTypes:le(this.tokensMap),errMsgProvider:Wt,grammarName:r}),s=Bx({lookaheadStrategy:this.lookaheadStrategy,rules:le(this.gastProductionsCache),tokenTypes:le(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Y(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{let i=tx(le(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:le(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(le(this.gastProductionsCache))})),!t.DEFER_DEFINITION_ERRORS_HANDLING&&!Y(this.definitionErrors))throw e=M(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,r){this.definitionErrors=[],this.selfAnalysisDone=!1;let n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(e,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),U(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=U(r,"skipValidations")?r.skipValidations:pt.skipValidations}};_s.DEFER_DEFINITION_ERRORS_HANDLING=!1;cy(_s,[Ha,Ya,Ja,el,rl,tl,nl,il,sl,ll]);var kt=class extends _s{constructor(e,r=pt){let n=he(r);n.outputCst=!0,super(e,n)}};var G=O({name:"Identifier",pattern:/[a-zA-Z_][a-zA-Z0-9_]*(?:-[a-zA-Z0-9_]+)*/}),Qe=O({name:"NumberLiteral",pattern:/[0-9]+/}),cl=O({name:"FlowchartKeyword",pattern:/flowchart/,longer_alt:G}),ul=O({name:"GraphKeyword",pattern:/graph/,longer_alt:G}),Us=O({name:"Direction",pattern:/TD|TB|BT|RL|LR/,longer_alt:G}),hl=O({name:"SubgraphKeyword",pattern:/subgraph/,longer_alt:G}),fl=O({name:"EndKeyword",pattern:/end/,longer_alt:G}),dl=O({name:"ClassKeyword",pattern:/class/,longer_alt:G}),pl=O({name:"StyleKeyword",pattern:/style/,longer_alt:G}),ml=O({name:"ClassDefKeyword",pattern:/classDef/,longer_alt:G}),gl=O({name:"ClickKeyword",pattern:/click/,longer_alt:G}),xl=O({name:"LinkStyleKeyword",pattern:/linkStyle/,longer_alt:G}),yl=O({name:"Ampersand",pattern:/&/}),or=O({name:"Comma",pattern:/,/}),El=O({name:"Semicolon",pattern:/;/}),Nn=O({name:"Colon",pattern:/:/}),Sl=O({name:"TripleColon",pattern:/:::/}),qu=O({name:"BiDirectionalArrow",pattern:/<-->/}),Du=O({name:"CircleEndLine",pattern:/o--o|o---o|o----o/}),$u=O({name:"CrossEndLine",pattern:/x--x|x---x|x----x/}),Tl=O({name:"DottedArrowRight",pattern:/-\.->|-\.\.->|-\.\.\.->/}),Bu=O({name:"DottedArrowLeft",pattern:/<-\.-|<-\.\.-|<-\.\.\.-/}),Ol=O({name:"ThickArrowRight",pattern:/==>|===>|====>/}),Fu=O({name:"ThickArrowLeft",pattern:/<==|<===|<====/}),Al=O({name:"ArrowRight",pattern:/-->|--->|---->/}),Ku=O({name:"ArrowLeft",pattern:/<--|<---|<----/}),Ps=O({name:"DottedLine",pattern:/-\.-|-\.\.-|-\.\.\.-/}),qs=O({name:"ThickLine",pattern:/===|====|=====/}),Ll=O({name:"Line",pattern:/---|----/}),bl=O({name:"TwoDashes",pattern:/--/}),Ds=O({name:"InvalidArrow",pattern:/->(?!>)/}),Gu=O({name:"DoubleSquareOpen",pattern:/\[\[/}),ju=O({name:"DoubleSquareClose",pattern:/\]\]/}),Wu=O({name:"DoubleRoundOpen",pattern:/\(\(/}),Hu=O({name:"DoubleRoundClose",pattern:/\)\)/}),zu=O({name:"HexagonOpen",pattern:/\{\{/}),Vu=O({name:"HexagonClose",pattern:/\}\}/}),Yu=O({name:"StadiumOpen",pattern:/\(\[/}),Qu=O({name:"StadiumClose",pattern:/\]\)/}),Xu=O({name:"CylinderOpen",pattern:/\[\(/}),Zu=O({name:"CylinderClose",pattern:/\)\]/}),$s=O({name:"SquareOpen",pattern:/\[/}),Bs=O({name:"SquareClose",pattern:/\]/}),Fs=O({name:"RoundOpen",pattern:/\(/}),Ks=O({name:"RoundClose",pattern:/\)/}),kl=O({name:"DiamondOpen",pattern:/\{/}),Nl=O({name:"DiamondClose",pattern:/\}/}),Cl=O({name:"AngleOpen",pattern:/>/}),Ju=O({name:"AngleLess",pattern:/</}),vl=O({name:"AtSign",pattern:/@/}),Gs=O({name:"Pipe",pattern:/\|/}),eh=O({name:"ForwardSlash",pattern:/\//}),th=O({name:"Backslash",pattern:/\\/}),Pt=O({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),rh=O({name:"MultilineText",pattern:/"""[\s\S]*?"""/,line_breaks:!0}),KP=O({name:"Comment",pattern:/%%[^\n\r]*/,group:Q.SKIPPED}),js=O({name:"ColorValue",pattern:/#[0-9a-fA-F]{3,6}/}),qt=O({name:"Text",pattern:/[^[\](){}|<>\n\r\t &,;:]+/}),GP=O({name:"WhiteSpace",pattern:/[ \t]+/,group:Q.SKIPPED}),Xe=O({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),nh=[KP,rh,Pt,cl,ul,hl,fl,ml,dl,pl,gl,xl,Us,Gu,ju,Wu,Hu,zu,Vu,Yu,Qu,Xu,Zu,qu,Du,$u,Tl,Bu,Ol,Fu,Al,Ku,Ps,qs,Ll,bl,Ds,$s,Bs,Fs,Ks,kl,Nl,Cl,Ju,vl,eh,th,Gs,Sl,yl,or,El,Nn,js,Qe,G,qt,GP,Xe],jP=new Q(nh);function wl(t){return jP.tokenize(t)}var ih=class extends kt{constructor(){super(nh),this.diagram=this.RULE("diagram",()=>{this.OR([{ALT:()=>this.CONSUME(cl)},{ALT:()=>this.CONSUME(ul)}]),this.CONSUME(Us),this.OPTION(()=>{this.CONSUME(Xe)}),this.MANY(()=>{this.SUBRULE(this.statement)})}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.nodeStatement)},{ALT:()=>this.SUBRULE(this.subgraph)},{ALT:()=>this.SUBRULE(this.directionStatement)},{ALT:()=>this.SUBRULE(this.classStatement)},{ALT:()=>this.SUBRULE(this.styleStatement)},{ALT:()=>this.SUBRULE(this.classDefStatement)},{ALT:()=>this.SUBRULE(this.clickStatement)},{ALT:()=>this.SUBRULE(this.linkStyleStatement)},{ALT:()=>this.CONSUME(Xe)}])}),this.nodeStatement=this.RULE("nodeStatement",()=>{this.SUBRULE(this.nodeOrParallelGroup),this.OPTION(()=>{this.SUBRULE(this.link),this.SUBRULE2(this.nodeOrParallelGroup),this.MANY(()=>{this.SUBRULE2(this.link),this.SUBRULE3(this.nodeOrParallelGroup)})}),this.OPTION2(()=>this.CONSUME(El)),this.OR2([{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(re)}])}),this.nodeOrParallelGroup=this.RULE("nodeOrParallelGroup",()=>{this.SUBRULE(this.node),this.MANY(()=>{this.CONSUME(yl),this.SUBRULE2(this.node)})}),this.node=this.RULE("node",()=>{this.OR([{ALT:()=>{this.CONSUME(G,{LABEL:"nodeId"}),this.OPTION(()=>{this.CONSUME(Qe,{LABEL:"nodeIdSuffix"})}),this.OPTION1(()=>this.SUBRULE(this.attrObject))}},{ALT:()=>{this.CONSUME2(Qe,{LABEL:"nodeIdNum"})}}]),this.OPTION2(()=>{this.SUBRULE(this.nodeShape)}),this.OPTION3(()=>{this.CONSUME(Sl),this.CONSUME3(G,{LABEL:"nodeClass"})})}),this.attrObject=this.RULE("attrObject",()=>{this.CONSUME(vl),this.CONSUME(kl,{LABEL:"attrLCurly"}),this.OPTION(()=>{this.SUBRULE(this.attrPair),this.MANY(()=>{this.CONSUME(or),this.SUBRULE2(this.attrPair)})}),this.CONSUME(Nl,{LABEL:"attrRCurly"})}),this.attrPair=this.RULE("attrPair",()=>{this.CONSUME(G,{LABEL:"attrKey"}),this.CONSUME(Nn),this.OR([{GATE:()=>{let e=this.LA(-1),r=this.LA(-2);return r&&/^(shape)$/i.test(String(r.image||""))},ALT:()=>this.SUBRULE(this.attrShapeValue)},{ALT:()=>this.CONSUME(Pt)},{ALT:()=>this.CONSUME2(G)},{ALT:()=>this.CONSUME(Qe)},{ALT:()=>this.CONSUME(qt)}])}),this.attrShapeValue=this.RULE("attrShapeValue",()=>{let e=()=>{let n=this.LA(1);if(!n||n.tokenType!==G)return!1;let i=String(n.image||"").toLowerCase();return i==="rect"||i==="round"||i==="rounded"||i==="stadium"||i==="subroutine"||i==="circle"||i==="cylinder"||i==="diamond"||i==="trapezoid"||i==="trapezoidalt"||i==="parallelogram"||i==="hexagon"||i==="lean-l"||i==="lean-r"||i==="icon"||i==="image"},r=()=>{let n=this.LA(1);if(!n||n.tokenType!==Pt)return!1;let i=String(n.image||""),o=(i.length>=2&&(i.startsWith('"')||i.startsWith("'"))?i.slice(1,-1):i).toLowerCase();return o==="rect"||o==="round"||o==="rounded"||o==="stadium"||o==="subroutine"||o==="circle"||o==="cylinder"||o==="diamond"||o==="trapezoid"||o==="trapezoidalt"||o==="parallelogram"||o==="hexagon"||o==="lean-l"||o==="lean-r"||o==="icon"||o==="image"};this.OR([{GATE:e,ALT:()=>this.CONSUME(G,{LABEL:"shapeId"})},{GATE:r,ALT:()=>this.CONSUME(Pt,{LABEL:"shapeQuoted"})},{ALT:()=>this.CONSUME2(G)},{ALT:()=>this.CONSUME2(Pt)},{ALT:()=>this.CONSUME(Qe)},{ALT:()=>this.CONSUME(qt)}])}),this.clickStatement=this.RULE("clickStatement",()=>{this.CONSUME(gl),this.CONSUME(G,{LABEL:"clickTarget"}),this.OR([{GATE:()=>this.LA(1).tokenType===G&&/^(href)$/i.test(this.LA(1).image||""),ALT:()=>this.SUBRULE(this.clickHref)},{GATE:()=>this.LA(1).tokenType===G&&/^(call|callback)$/i.test(this.LA(1).image||""),ALT:()=>this.SUBRULE(this.clickCall)}]),this.OPTION(()=>this.CONSUME(Xe))}),this.clickHref=this.RULE("clickHref",()=>{this.CONSUME(G,{LABEL:"mode"}),this.CONSUME(Pt,{LABEL:"url"}),this.OPTION(()=>this.CONSUME2(Pt,{LABEL:"tooltip"})),this.OPTION2(()=>this.CONSUME2(G,{LABEL:"target"}))}),this.clickCall=this.RULE("clickCall",()=>{this.CONSUME1(G,{LABEL:"mode"}),this.OPTION1(()=>{this.CONSUME2(G,{LABEL:"fn"}),this.OPTION2(()=>{this.CONSUME3(Fs),this.OPTION3(()=>{this.OR([{ALT:()=>this.CONSUME4(G)},{ALT:()=>this.CONSUME5(Qe)},{ALT:()=>this.CONSUME6(qt)}])}),this.CONSUME7(Ks)})}),this.OPTION4(()=>this.CONSUME8(Pt,{LABEL:"tooltip"}))}),this.linkStyleStatement=this.RULE("linkStyleStatement",()=>{this.CONSUME(xl),this.SUBRULE(this.linkStyleIndexList),this.OPTION1(()=>this.CONSUME1(Xe)),this.SUBRULE(this.linkStylePairs),this.OPTION2(()=>this.CONSUME2(Xe))}),this.linkStyleIndexList=this.RULE("linkStyleIndexList",()=>{this.CONSUME(Qe,{LABEL:"index"}),this.MANY(()=>{this.CONSUME(or),this.CONSUME2(Qe,{LABEL:"index"})})}),this.linkStylePairs=this.RULE("linkStylePairs",()=>{this.SUBRULE(this.linkStylePair),this.MANY(()=>{this.CONSUME(or),this.OPTION(()=>this.CONSUME(Xe)),this.SUBRULE2(this.linkStylePair)})}),this.linkStylePair=this.RULE("linkStylePair",()=>{this.CONSUME1(G,{LABEL:"key"}),this.CONSUME(Nn),this.SUBRULE(this.linkStyleValueChunk)}),this.linkStyleValueChunk=this.RULE("linkStyleValueChunk",()=>{this.AT_LEAST_ONE({GATE:()=>{let e=this.LA(1);return e&&e.tokenType!==or&&e.tokenType!==Xe},DEF:()=>{this.OR([{ALT:()=>this.CONSUME(js)},{ALT:()=>this.CONSUME(Pt)},{ALT:()=>this.CONSUME(Qe)},{ALT:()=>this.CONSUME(G)},{ALT:()=>this.CONSUME(qt)}])}})}),this.nodeShape=this.RULE("nodeShape",()=>{this.OR([{ALT:()=>{this.CONSUME($s),this.OPTION(()=>this.SUBRULE(this.nodeContent)),this.CONSUME(Bs)}},{ALT:()=>{this.CONSUME(Gu),this.OPTION2(()=>this.SUBRULE2(this.nodeContent)),this.CONSUME(ju)}},{ALT:()=>{this.CONSUME(Fs),this.OPTION3(()=>this.SUBRULE3(this.nodeContent)),this.CONSUME(Ks)}},{ALT:()=>{this.CONSUME(Wu),this.OPTION4(()=>this.SUBRULE4(this.nodeContent)),this.CONSUME(Hu)}},{ALT:()=>{this.CONSUME(kl),this.OPTION5(()=>this.SUBRULE5(this.nodeContent)),this.CONSUME(Nl)}},{ALT:()=>{this.CONSUME(zu),this.OPTION6(()=>this.SUBRULE6(this.nodeContent)),this.CONSUME(Vu)}},{ALT:()=>{this.CONSUME(Yu),this.OPTION7(()=>this.SUBRULE7(this.nodeContent)),this.CONSUME(Qu)}},{ALT:()=>{this.CONSUME(Xu),this.OPTION8(()=>this.SUBRULE8(this.nodeContent)),this.CONSUME(Zu)}}])}),this.nodeContent=this.RULE("nodeContent",()=>{this.OR([{ALT:()=>this.CONSUME(Pt)},{ALT:()=>this.CONSUME(rh)},{ALT:()=>{this.AT_LEAST_ONE(()=>{this.OR2([{ALT:()=>this.CONSUME(G)},{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME(Qe)},{ALT:()=>this.CONSUME(Fs)},{ALT:()=>this.CONSUME(Ks)},{ALT:()=>this.CONSUME(Ju)},{ALT:()=>this.CONSUME(Cl)},{ALT:()=>this.CONSUME(eh)},{ALT:()=>this.CONSUME(th)},{ALT:()=>this.CONSUME(or)},{ALT:()=>this.CONSUME(Nn)},{ALT:()=>this.CONSUME(yl)},{ALT:()=>this.CONSUME(El)},{ALT:()=>this.CONSUME(bl)},{ALT:()=>this.CONSUME(Ll)},{ALT:()=>this.CONSUME(qs)},{ALT:()=>this.CONSUME(Ps)},{ALT:()=>this.CONSUME(cl)},{ALT:()=>this.CONSUME(ul)},{ALT:()=>this.CONSUME(hl)},{ALT:()=>this.CONSUME(fl)},{ALT:()=>this.CONSUME(Us)},{ALT:()=>this.CONSUME(dl)},{ALT:()=>this.CONSUME(pl)},{ALT:()=>this.CONSUME(ml)},{ALT:()=>this.CONSUME(gl)},{ALT:()=>this.CONSUME(xl)}])})}}])}),this.link=this.RULE("link",()=>{this.OPTION1(()=>{this.CONSUME(G,{LABEL:"edgeId"}),this.CONSUME(vl)}),this.OR([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Ps)},{ALT:()=>this.CONSUME(qs)},{ALT:()=>this.CONSUME(bl)}]),this.SUBRULE(this.linkTextInline),this.OR3([{ALT:()=>this.CONSUME(Al)},{ALT:()=>this.CONSUME(Tl)},{ALT:()=>this.CONSUME(Ol)}])}},{ALT:()=>{this.CONSUME(qt,{LABEL:"inlineCarrier"}),this.CONSUME(Cl)}},{ALT:()=>this.CONSUME2(qu)},{ALT:()=>this.CONSUME2(Du)},{ALT:()=>this.CONSUME2($u)},{ALT:()=>this.CONSUME2(Al)},{ALT:()=>this.CONSUME2(Ku)},{ALT:()=>this.CONSUME2(Tl)},{ALT:()=>this.CONSUME2(Bu)},{ALT:()=>this.CONSUME2(Ol)},{ALT:()=>this.CONSUME2(Fu)},{ALT:()=>this.CONSUME2(Ll)},{ALT:()=>this.CONSUME2(Ps)},{ALT:()=>this.CONSUME2(qs)},{ALT:()=>this.CONSUME(Ds)}]),this.OPTION2(()=>{this.CONSUME(Gs),this.SUBRULE(this.linkText),this.CONSUME2(Gs)})}),this.linkText=this.RULE("linkText",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(G)},{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME(Qe)}])})}),this.linkTextInline=this.RULE("linkTextInline",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(G)},{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME(Qe)},{ALT:()=>this.CONSUME(Gs)}])})}),this.subgraph=this.RULE("subgraph",()=>{this.CONSUME(hl),this.OR([{ALT:()=>{this.CONSUME(G,{LABEL:"subgraphId"}),this.OPTION(()=>{this.CONSUME1($s),this.SUBRULE(this.nodeContent),this.CONSUME1(Bs)})}},{ALT:()=>{this.CONSUME(Pt,{LABEL:"subgraphTitleQ"})}},{ALT:()=>{this.CONSUME2($s),this.SUBRULE2(this.nodeContent),this.CONSUME2(Bs)}}]),this.CONSUME(Xe),this.MANY(()=>{this.SUBRULE(this.subgraphStatement)}),this.CONSUME(fl),this.OPTION3(()=>{this.CONSUME2(Xe)})}),this.subgraphStatement=this.RULE("subgraphStatement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStatement)},{ALT:()=>this.SUBRULE(this.nodeStatement)},{ALT:()=>this.SUBRULE(this.subgraph)},{ALT:()=>this.SUBRULE(this.classStatement)},{ALT:()=>this.SUBRULE(this.styleStatement)},{ALT:()=>this.SUBRULE(this.classDefStatement)},{ALT:()=>this.CONSUME(Xe)}])}),this.directionStatement=this.RULE("directionStatement",()=>{this.CONSUME(G,{LABEL:"dirKw"}),this.CONSUME(Us),this.OPTION(()=>this.CONSUME(Xe))}),this.classStatement=this.RULE("classStatement",()=>{this.CONSUME(dl),this.CONSUME(G),this.MANY(()=>{this.CONSUME(or),this.CONSUME2(G)}),this.CONSUME3(G,{LABEL:"className"}),this.OPTION(()=>{this.CONSUME(Xe)})}),this.styleStatement=this.RULE("styleStatement",()=>{this.CONSUME(pl),this.CONSUME(G),this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME2(G)},{ALT:()=>this.CONSUME(js)},{ALT:()=>this.CONSUME(Nn)},{ALT:()=>this.CONSUME(or)},{ALT:()=>this.CONSUME(Qe)}])}),this.OPTION(()=>{this.CONSUME(Xe)})}),this.classDefStatement=this.RULE("classDefStatement",()=>{this.CONSUME(ml),this.CONSUME(G),this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(qt)},{ALT:()=>this.CONSUME2(G)},{ALT:()=>this.CONSUME(js)},{ALT:()=>this.CONSUME(Nn)},{ALT:()=>this.CONSUME(or)},{ALT:()=>this.CONSUME(Qe)}])}),this.OPTION(()=>{this.CONSUME(Xe)})}),this.performSelfAnalysis()}_augmentNodeRule(){let e=this.node;this.node=this.RULE("node",()=>{this.OR([{ALT:()=>{this.CONSUME(G,{LABEL:"nodeId"}),this.OPTION(()=>{this.CONSUME(Qe,{LABEL:"nodeIdSuffix"})})}},{ALT:()=>{this.CONSUME2(Qe,{LABEL:"nodeIdNum"})}}]),this.OPTION2(()=>{this.SUBRULE(this.nodeShape)}),this.OPTION3(()=>{this.CONSUME(Sl),this.CONSUME3(G,{LABEL:"nodeClass"})})})}},Dt=new ih;function uy(t){return Dt.input=t,{cst:Dt.diagram(),errors:Dt.errors}}var hy=Dt.getBaseCstVisitorConstructorWithDefaults(),sh=class extends hy{constructor(e,r,n){super(),this.edgeCount=0,this.validateVisitor(),this.ctx=e,this.knownIds=r,this.knownEdgeIds=n}diagram(e){e.statement&&e.statement.forEach(r=>this.visit(r))}classStatement(e){let r=e.Identifier||[],n=e.className&&e.className[0];for(let i of r){if(n&&i.startOffset===n.startOffset)continue;let s=String(i.image);this.knownIds.has(s)||this.knownEdgeIds.has(s)||this.ctx.errors.push({line:i.startLine??1,column:i.startColumn??1,severity:"warning",code:"FL-CLASS-TARGET-UNKNOWN",message:`Unknown id '${s}' in class statement.`,hint:"Define the node/link before applying classes, or move the class line after it."})}}styleStatement(e){let r=e.Identifier&&e.Identifier[0];if(r){let n=String(r.image);this.knownIds.has(n)||this.ctx.errors.push({line:r.startLine??1,column:r.startColumn??1,severity:"warning",code:"FL-STYLE-TARGET-UNKNOWN",message:`Unknown node id '${n}' in style statement.`,hint:"Define the node before styling it, or move the style line after the node definition."})}}statement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}clickStatement(e){let r=e.clickHref?.[0],n=r?void 0:e.clickCall?.[0];if(r){let l=r.children||{},f=l.mode?.[0],u=l.url?.[0],h=l.tooltip?.[0],d=l.target?.[0];if(String(f?.image||"").toLowerCase()!=="href"){this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-MODE-INVALID",message:`Unknown click mode '${f?.image}'. Use 'href' or 'call'.`,hint:'Examples: href "\u2026" | call fn()'});return}u||this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-HREF-URL-MISSING",message:"'click \u2026 href' requires a quoted URL.",hint:'Example: click A href "https://example.com" "Open" _blank'}),d&&!/^_(blank|self|parent|top)$/i.test(String(d.image||""))&&this.ctx.errors.push({line:d.startLine??1,column:d.startColumn??1,severity:"warning",code:"FL-CLICK-TARGET-UNKNOWN",message:`Unknown target '${d.image}'. Use _blank/_self/_parent/_top.`,hint:"Example: \u2026 _blank"});return}if(n){let l=n.children||{},f=l.mode?.[0],u=String(f?.image||"").toLowerCase();if(!(u==="call"||u==="callback")){this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-MODE-INVALID",message:`Unknown click mode '${f?.image}'. Use 'href' or 'call'.`,hint:'Examples: href "\u2026" | call fn()'});return}l.fn?.[0]||this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-CLICK-CALL-NAME-MISSING",message:"'click \u2026 call' requires a function name.",hint:'Example: click A call doThing() "Tooltip"'});let d=l.tooltip?.[0];d&&this.ctx.errors.push({line:d.startLine??1,column:d.startColumn??1,severity:"error",code:"FL-CLICK-CALL-EXTRA-TEXT",message:"Tooltip/text after 'call()' is not supported by Mermaid CLI.",hint:"Use: click A call doThing()"});return}let i=e.Identifier||[],s=e.QuotedString||[],o=i[0],a=i[1],c=(a?.image||"").toLowerCase();if(!c){this.ctx.errors.push({line:o?.startLine??1,column:o?.startColumn??1,severity:"error",code:"FL-CLICK-MODE-MISSING",message:"After 'click <id>' specify 'href' or 'call'.",hint:'Examples: click A href "https://\u2026" "Tip" _blank | click A call doThing() "Tip"'});return}if(c==="href"){s.length<1&&this.ctx.errors.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"FL-CLICK-HREF-URL-MISSING",message:"'click \u2026 href' requires a quoted URL.",hint:'Example: click A href "https://example.com" "Open" _blank'});let l=i[2];l&&!/^_(blank|self|parent|top)$/i.test(l.image||"")&&this.ctx.errors.push({line:l.startLine??1,column:l.startColumn??1,severity:"warning",code:"FL-CLICK-TARGET-UNKNOWN",message:`Unknown target '${l.image}'. Use _blank/_self/_parent/_top.`,hint:"Example: \u2026 _blank"});return}if(c==="call"||c==="callback"){i[2]||this.ctx.errors.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"FL-CLICK-CALL-NAME-MISSING",message:"'click \u2026 call' requires a function name.",hint:'Example: click A call doThing() "Tooltip"'});return}this.ctx.errors.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"FL-CLICK-MODE-INVALID",message:`Unknown click mode '${a.image}'. Use 'href' or 'call'.`,hint:'Examples: href "\u2026" | call fn()'})}linkStyleStatement(e){let r=e.linkStyleIndexList?.[0],n=e.linkStylePairs?.[0],s=((f,u)=>f?(f.children||{})[u]||[]:[])(r,"index"),o=s.map(f=>parseInt(f.image,10)).filter(f=>Number.isFinite(f));if(o.length===0){let f=e.LinkStyleKeyword?.[0]||s[0];this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-LINKSTYLE-NO-INDICES",message:"'linkStyle' requires one or more link indices (comma separated).",hint:"Example: linkStyle 0,1 stroke:#f66,stroke-width:2px"});return}if(!((n?.children||{}).linkStylePair||[]).length){let f=s[0];this.ctx.errors.push({line:f?.startLine??1,column:f?.startColumn??1,severity:"error",code:"FL-LINKSTYLE-MISSING-STYLE",message:"Missing style declarations after indices.",hint:"Example: linkStyle 0 stroke:#f00,stroke-width:2px"})}let l=new Set;for(let f of o){if(l.has(f)){let u=s.find(h=>parseInt(h.image,10)===f);this.ctx.errors.push({line:u?.startLine??1,column:u?.startColumn??1,severity:"warning",code:"FL-LINKSTYLE-DUPLICATE-INDEX",message:`Duplicate linkStyle index ${f}.`,hint:"Remove duplicates."})}l.add(f)}for(let f of o)if(!(f>=0&&f<this.edgeCount)){let u=s.find(h=>parseInt(h.image,10)===f);this.ctx.errors.push({line:u?.startLine??1,column:u?.startColumn??1,severity:"error",code:"FL-LINKSTYLE-INDEX-OUT-OF-RANGE",message:`linkStyle index ${f} is out of range (0..${Math.max(0,this.edgeCount-1)}).`,hint:`Use an index between 0 and ${Math.max(0,this.edgeCount-1)} or add more links first.`})}}subgraph(e){e.subgraphStatement&&e.subgraphStatement.forEach(r=>this.visit(r))}subgraphStatement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}directionStatement(e){let r=e.dirKw?.[0];r&&r.image!=="direction"&&this.ctx.errors.push({line:r.startLine??1,column:r.startColumn??1,severity:"error",code:"FL-DIR-KW-INVALID",message:`Unknown keyword '${r.image}' before direction. Use 'direction TB' / 'LR' / etc.`,hint:"Example inside subgraph: 'direction TB'",length:r.image?.length??0})}nodeStatement(e){e.nodeOrParallelGroup&&e.nodeOrParallelGroup.forEach(n=>this.visit(n));let r=Array.isArray(e.link)?e.link.length:0;r>0&&(this.edgeCount+=r)}nodeOrParallelGroup(e){e.node&&e.node.forEach(r=>this.visit(r))}node(e){let r=Array.isArray(e.attrObject)&&e.attrObject.length>0,n=Array.isArray(e.nodeShape)&&e.nodeShape.length>0;if(r&&n){let s=(e.attrObject?.[0]?.children?.attrLCurly||[])[0];this.ctx.errors.push({line:s?.startLine??1,column:s?.startColumn??1,severity:"warning",code:"FL-TYPED-SHAPE-CONFLICT",message:"Both bracket shape and '@{ shape: \u2026 }' provided. Bracket shape will be used.",hint:'Pick one style: either A[Label] or A@{ shape: rect, label: "Label" }'})}if(e.nodeShape&&e.nodeShape.forEach(i=>this.visit(i)),r){let s=e.attrObject?.[0]?.children?.attrPair||[],o=new Set(["shape","label","padding","cornerRadius","icon","image"]),a=new Set(["rect","round","rounded","stadium","subroutine","circle","cylinder","diamond","trapezoid","trapezoidAlt","parallelogram","hexagon","lean-l","lean-r","icon","image"]);for(let c of s){let l=c.children?.attrKey?.[0],f=c.children?.QuotedString?.[0]||c.children?.Identifier?.[0]||c.children?.NumberLiteral?.[0]||c.children?.Text?.[0];if(!l)continue;let u=l.image;if(!o.has(u)){this.ctx.errors.push({line:l.startLine??1,column:l.startColumn??1,severity:"warning",code:"FL-TYPED-KEY-UNKNOWN",message:`Unknown typed-shape key '${u}'.`,hint:"Allowed keys: shape, label, padding, cornerRadius, icon, image"});continue}if(u==="shape"&&f){let h=String(f.image).replace(/^"|"$/g,"");a.has(h)?new Set(["rect","round","rounded","diamond","circle","cylinder","stadium","subroutine","lean-l","lean-r"]).has(h)||this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"error",code:"FL-TYPED-SHAPE-UNSUPPORTED",message:`Typed shape '${h}' is not supported by current Mermaid CLI.`,hint:'Use one of: rect, rounded, diamond, circle, cylinder, stadium, subroutine, "lean-l", "lean-r"'}):this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"error",code:"FL-TYPED-SHAPE-UNKNOWN",message:`Unknown shape '${h}' in '@{ shape: \u2026 }'.`,hint:"Use one of: rect, round, stadium, subroutine, circle, cylinder, diamond, trapezoid, parallelogram, hexagon, lean-l, lean-r, icon, image"})}if(u==="label"&&f&&f.tokenType?.name!=="QuotedString"&&this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"warning",code:"FL-TYPED-LABEL-NOT-STRING",message:"Typed-shape 'label' should be a quoted string.",hint:'Example: A@{ shape: rect, label: "Start" }'}),(u==="padding"||u==="cornerRadius")&&f){let h=String(f.image).replace(/^"|"$/g,"");/^\d+(px)?$/.test(h)||this.ctx.errors.push({line:f.startLine??1,column:f.startColumn??1,severity:"warning",code:"FL-TYPED-NUMERIC-EXPECTED",message:`'${u}' expects a number (optionally with px).`,hint:`Use: ${u}: 8 or ${u}: "8px"`})}}}}checkEmptyContent(e,r){if(!r||r.length===0){this.ctx.errors.push({line:e.startLine??1,column:e.startColumn??1,severity:"error",message:"Empty label inside a shape.",code:"FL-NODE-EMPTY",hint:'Write non-empty text inside the brackets, e.g., A["Start"] or A[Start]. If you want no label, omit the brackets and just use A.'});return}for(let n of r){let i=n.children||{},s=[].concat(i.QuotedString||[]).concat(i.MultilineText||[]);for(let o of s){let a=o.image;if(!a)continue;(a.startsWith('"')||a.startsWith("'")?a.slice(1,-1):a).trim().length===0&&this.ctx.errors.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",message:"Empty label inside a shape (only empty quotes/whitespace).",code:"FL-NODE-EMPTY",hint:'Provide non-empty text, e.g., A["Start"] or A[Start]. If you want no label, omit the brackets and just use A.'})}}}checkEscapedQuotes(e){if(e)for(let r of e){let n=r.children||{},i=[].concat(n.QuotedString||[]).concat(n.Text||[]).concat(n.Identifier||[]).concat(n.NumberLiteral||[]);for(let s of i)s.image&&s.image.includes('\\"')&&this.ctx.errors.push({line:s.startLine??1,column:s.startColumn??1,severity:"error",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',code:"FL-LABEL-ESCAPED-QUOTE",hint:'Prefer "He said &quot;Hi&quot;".'})}}checkDoubleInSingleQuoted(e){if(e)for(let r of e){let i=(r.children||{}).QuotedString||[];for(let s of i){let o=s.image||"";if(o.startsWith("'")&&o.endsWith("'")&&o.includes('"')){let a=o.indexOf('"'),c=(s.startColumn??1)+Math.max(0,a);this.ctx.errors.push({line:s.startLine??1,column:c,severity:"error",message:'Double quotes inside a single-quoted label are not supported by Mermaid. Replace inner " with &quot; or use a double-quoted label with &quot;.',code:"FL-LABEL-DOUBLE-IN-SINGLE",hint:'Change to "She said &quot;Hello&quot;" or replace inner " with &quot;.',length:1})}}}}checkDoubleInDoubleQuoted(e){if(e)for(let r of e){let i=(r.children||{}).QuotedString||[];if(i.length>=2){let s=i[1];this.ctx.errors.push({line:s.startLine??1,column:s.startColumn??1,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1})}}}warnParensInUnquoted(e){if(e)for(let r of e){let n=r.children||{};if(Array.isArray(n.QuotedString)&&n.QuotedString.length>0)continue;let s=[];for(let l of Object.keys(n))Array.isArray(n[l])&&s.push(...n[l]);if(s.sort((l,f)=>(l.startOffset??0)-(f.startOffset??0)),s.length>=2){let l=s[0],f=s[s.length-1],u=h=>h.image==="/"||h.image==="\\";if(u(l)&&u(f))continue}let o=n.RoundOpen||[],a=n.RoundClose||[],c=[...o,...a];if(c.length>0){let l=c[0];this.ctx.errors.push({line:l.startLine??1,column:l.startColumn??1,severity:"error",code:"FL-LABEL-PARENS-UNQUOTED",message:"Parentheses inside an unquoted label are not supported by Mermaid. Wrap the label in quotes.",hint:'Example: A["Calls func(arg)"]'})}}}nodeShape(e){let r=e.SquareOpen&&e.SquareOpen[0]||e.DoubleSquareOpen&&e.DoubleSquareOpen[0]||e.RoundOpen&&e.RoundOpen[0]||e.DoubleRoundOpen&&e.DoubleRoundOpen[0]||e.DiamondOpen&&e.DiamondOpen[0]||e.HexagonOpen&&e.HexagonOpen[0]||e.StadiumOpen&&e.StadiumOpen[0]||e.CylinderOpen&&e.CylinderOpen[0],n=[];for(let i of Object.keys(e))if(i.startsWith("nodeContent")){let s=e[i];Array.isArray(s)&&n.push(...s)}if(r&&(this.checkEmptyContent(r,n.length?n:void 0),this.checkDoubleInSingleQuoted(n),this.checkBackticksInContent(n),this.warnParensInUnquoted(n),this.ctx.strict)){let i=!1,s;for(let o of n){let a=o.children||{};if(a.QuotedString&&a.QuotedString.length||a.MultilineText&&a.MultilineText.length){i=!0;break}let c=[].concat(a.Identifier||[]).concat(a.Text||[]).concat(a.NumberLiteral||[]).concat(a.RoundOpen||[]).concat(a.RoundClose||[]).concat(a.Comma||[]).concat(a.Colon||[]).concat(a.Pipe||[]);!s&&c.length&&(s=c[0])}if(n.length>0&&!i){let o=s??r;this.ctx.errors.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",code:"FL-STRICT-LABEL-QUOTES-REQUIRED",message:"Strict mode: Node label must be quoted (use double quotes and &quot; inside).",hint:'Example: A["Label with &quot;quotes&quot; and (parens)"]'})}}}checkBackticksInContent(e){if(e)for(let r of e){let n=r.children||{},i=a=>{if(!a)return!1;let l=String(a.image||"").indexOf("`");if(l>=0){let f=(a.startColumn??1)+l;return this.ctx.errors.push({line:a.startLine??1,column:f,severity:"warning",code:"FL-LABEL-BACKTICK",message:"Backticks (`\u2026`) inside node labels are not supported by Mermaid.",hint:'Remove the backticks or use quotes instead, e.g., "GITHUB_ACTIONS" and "--cli".',length:1}),!0}return!1},s=n.Text||[];for(let a of s)if(i(a))return;let o=n.QuotedString||[];for(let a of o)if(i(a))return}}},oh=class extends hy{constructor(){super(),this.ids=new Set,this.edgeIds=new Set,this.validateVisitor()}node(e){let r=e.nodeId&&e.nodeId[0],n=e.nodeIdNum&&e.nodeIdNum[0];r?this.ids.add(String(r.image)):n&&this.ids.add(String(n.image))}link(e){let r=e.edgeId?.[0];r&&this.edgeIds.add(String(r.image))}nodeOrParallelGroup(e){e.node&&e.node.forEach(r=>this.visit(r))}nodeStatement(e){e.nodeOrParallelGroup&&e.nodeOrParallelGroup.forEach(r=>this.visit(r)),e.link&&e.link.forEach(r=>this.visit(r))}edgeAttrStatement(e){let r=e.edgeId?.[0];r&&this.edgeIds.add(String(r.image))}statement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}diagram(e){e.statement&&e.statement.forEach(r=>this.visit(r))}};function fy(t,e,r){let n={errors:[],strict:r?.strict},i=new oh;return i.visit(t),new sh(n,i.ids,i.edgeIds).visit(t),n.errors}function Ws(t,e){let r=[],n=e.code,i=e.message||'Escaped quotes (\\") are not supported by Mermaid. Use &quot; instead.',s=e.hint||'Use &quot; for inner quotes, e.g., "He said &quot;Hi&quot;".',o=new Set;for(let a of t)if(typeof a.image=="string"){let c=a.image.indexOf('\\"');if(c!==-1){let l=a.startLine??1;if(o.has(l))continue;o.add(l);let f=(a.startColumn??1)+c,{line:u,column:h}=ar(l,f,1,1);r.push({line:u,column:h,severity:"error",code:n,message:i,hint:s,length:2})}}return r}function Ii(t,e){let r=[],n=new Map;for(let o of t){let a=o.startLine??1;n.has(a)||n.set(a,[]),n.get(a).push(o)}let i=new Set(e.scopeEndTokenNames||[]),s=new Set(e.scopeStartTokenNames||[]);for(let[o,a]of n)for(let c=0;c<a.length;c++){let l=a[c];if(l.tokenType?.name==="QuotedString"){if(s.size>0){let f=-1;for(let d=c-1;d>=0;d--){let p=a[d];if(s.has(p.tokenType?.name||"")){f=d;break}}if(f===-1)continue;let u=a[f],h=a[f-1];if(u.tokenType?.name==="DiamondOpen"&&h?.tokenType?.name==="AtSign")continue}for(let f=c+1;f<a.length;f++){let u=a[f];if(i.size>0&&i.has(u.tokenType?.name||""))break;if(u.tokenType?.name==="QuotedString"){if((l.image||"").startsWith('"')){let{line:p,column:m}=ar(u.startLine??null,u.startColumn??null,o,1);r.push({line:p,column:m,severity:"error",code:e.code,message:e.message,hint:e.hint,length:1})}f=a.length;break}if(u.tokenType?.name==="Text"&&typeof u.image=="string"&&u.image.includes('"')){let h=u.image.indexOf('"'),d=(u.startColumn??1)+(h>=0?h:0),{line:p,column:m}=ar(u.startLine??null,d,o,1);r.push({line:p,column:m,severity:"error",code:e.code,message:e.message,hint:e.hint,length:1}),f=a.length;break}}if(r.length>0&&r[r.length-1].line===o)break}}return r}function Jr(t,e){let r=[],n=t.split(/\r?\n/),i=e.message||"Unclosed quote in label or name.",s=e.hint||'Close the quote, e.g., "Text"',o=e.limitPerFile??1;for(let a=0;a<n.length;a++){let c=n[a]??"";if(!c)continue;let l=c.split("&quot;").join("").split('\\"').join(""),f=[],u=[];for(let p=0;p<l.length;p++){let m=l[p];m==='"'?f.push(p):m==="'"&&u.push(p)}let h=f.length%2===1,d=u.length%2===1;if(h||d){let p=h?f[0]??0:u[0]??0;if(r.push({line:a+1,column:p+1,severity:"error",code:e.code,message:i,hint:s,length:1}),r.length>=o)break}}return r}function ar(t,e,r=1,n=1){let i=Number.isFinite(t)&&t>0?t:r,s=Number.isFinite(e)&&e>0?e:n;return{line:i,column:s}}function Hs(t){let e=t.split(/\r?\n/),r=e.length,n=e[e.length-1]??"",i=Math.max(1,n.length+1);return{line:r,column:i}}function dy(t){let{line:e,column:r}=ar(t.line,t.column);return{line:e,column:r,severity:"error",message:t.message}}function ah(t){let e=t?.image??"";return e===`
`?"\\n":e}function it(t,e){let r=t?.context?.ruleStack;return Array.isArray(r)&&r.includes(e)}function Fe(t,e){return(t.message||"").includes(`--> ${e} <--`)}function lh(t){let e=t?.context?.ruleStack;return Array.isArray(e)&&e.length===1&&e[0]==="diagram"}function py(t,e){let r=t.token,n=Hs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=ah(r),a=r?.tokenType?.name,c=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,l=e.split(/\r?\n/),f=l[Math.max(0,i-1)]??"",u=h=>{let d=Math.max(0,s-1),m=f.slice(0,d).lastIndexOf(h);if(m===-1)return null;let g=f.slice(m+1),x=g.indexOf('\\"');if(x!==-1)return{kind:"escaped",column:m+1+x+1};let y=[];for(let E=0;E<g.length;E++)g[E]==='"'&&y.push(E);if(y.length>=3){let E=y[2];return{kind:"double-in-double",column:m+1+E+1}}return null};if(lh(t)&&Fe(t,"Direction"))return a==="EOF"||a==="Newline"?{line:i,column:s,severity:"error",code:"FL-DIR-MISSING",message:"Missing direction after diagram header. Use TD, TB, BT, RL, or LR.",hint:"Example: 'flowchart TD' for top-down layout.",length:1}:{line:i,column:s,severity:"error",code:"FL-DIR-INVALID",message:`Invalid direction '${o}'. Use one of: TD, TB, BT, RL, LR.`,hint:"Try 'TD' (top-down) or 'LR' (left-to-right).",length:c};if(t.name==="MismatchedTokenException"){let h=t.message||"";if(a==="Identifier"&&["right","left","over","of"].includes(o)){let d=l[Math.max(0,i-1)]?.slice(0,Math.max(0,s-1))?.trim()?.split(/\s+/)||[];if(d[d.length-1]==="note"||d.length>=2&&d[d.length-2]==="note")return{line:i,column:Math.max(1,l[Math.max(0,i-1)]?.lastIndexOf("note")+1||s),severity:"error",code:"FL-NOTE-NOT-SUPPORTED",message:"'note' syntax is not supported in flowchart/graph diagrams.",hint:"Notes are only available in sequence diagrams. Use node labels or HTML comments (%%comment%%) instead.",length:4}}if(h.includes("AtSign")&&o==="of"){let d=l[Math.max(0,i-1)]||"";if(d.includes("note")){let p=d.indexOf("note");return{line:i,column:p+1,severity:"error",code:"FL-NOTE-NOT-SUPPORTED",message:"'note' syntax is not supported in flowchart/graph diagrams.",hint:"Notes are only available in sequence diagrams. Use node labels or HTML comments (%%comment%%) instead.",length:4}}}}if(a==="QuotedString"){let h=t?.context,d=h?.ruleStack?.includes("linkTextInline")||h?.ruleStack?.includes("link")||!1,g=(l[Math.max(0,i-1)]||"").slice(0,Math.max(0,s-1)).match(/--\s*$|==\s*$|-\.\s*$|-\.-\s*$|\[\s*$/);if(d||g){let x=o.startsWith('"')?o.slice(1,-1):o;return{line:i,column:s,severity:"error",code:"FL-EDGE-LABEL-QUOTED",message:"Edge labels must use pipe syntax, not quotes.",hint:`Change -- "${x}" --> to --|${x}|--> or use -- |${x}| -->`,length:c}}}if(t.name==="NoViableAltException"||t.name==="MismatchedTokenException"){let h=t.message||"";if(a==="Identifier"&&h.includes("Newline")&&h.includes("EOF"))return{line:i,column:s,severity:"error",code:"FL-LINK-MISSING",message:`Two nodes on one line must be connected with an arrow before '${o}'.`,hint:"Insert --> between nodes, e.g., A --> B.",length:c}}if(it(t,"nodeShape")&&t.name==="MismatchedTokenException"&&a==="SquareClose"&&Fe(t,"RoundClose"))return{line:i,column:s,severity:"error",code:"FL-NODE-MIXED-BRACKETS",message:"Mismatched brackets: opened '(' but closed with ']'.",hint:"Close with ')' or change the opening bracket to '['.",length:c};if(it(t,"nodeShape")&&t.name==="MismatchedTokenException"){if(Fe(t,"SquareClose")){if(a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &quot; for quotes or wrap the entire label in quotes.",hint:'Example: I[Log &quot;processing N items&quot;] or I["Log \\"processing N items\\""]',length:c};let h=u("[");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '['. Add a matching ']' before the arrow or newline.",hint:"Example: A[Label] --> B",length:1}}if(Fe(t,"RoundClose")){if(a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &quot; for quotes or wrap the entire label in quotes.",hint:'Example: E(Log &quot;message&quot;) or E["Log \\"message\\""]',length:c};let h=u("(");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '('. Add a matching ')'.",hint:"Example: B(Label)",length:1}}if(Fe(t,"DiamondClose")){if(a==="QuotedString")return{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Quotes are not allowed inside unquoted node labels. Use &apos; for single quotes or &quot; for double quotes.",hint:"Example: B{Does &apos;B&apos; depend on a forEach check &apos;A&apos;?}",length:c};let h=u("{");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Example: D{"Is &quot;Driver&quot; AND &quot;AuthCheck.Path&quot; configured?"}',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported by Mermaid. Use &quot; for inner quotes.",hint:'Example: D{"Is &quot;Driver&quot; and &quot;AuthCheck.Path&quot; configured?"}',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '{'. Add a matching '}'.",hint:"Example: C{Decision}",length:1}}if(Fe(t,"DoubleRoundClose")){let h=u("(");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '(( '. Add a matching '))'.",hint:"Example: A((Circle))",length:2}}if(Fe(t,"DoubleSquareClose")){let h=u("[");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '[[ '. Add a matching ']]'.",hint:"Example: [[Subroutine]]",length:2}}if(Fe(t,"StadiumClose")){let h=u("(")||u("[");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '([ '. Add a matching '])'.",hint:"Example: A([Stadium])",length:c}}if(Fe(t,"CylinderClose")){let h=u("(")||u("[");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '[( '. Add a matching ')]'.",hint:"Example: A[(Cylinder)]",length:c}}if(Fe(t,"HexagonClose")){let h=u("{");return h?.kind==="escaped"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are not supported by Mermaid. Use &quot; instead.',hint:'Prefer "He said &quot;Hi&quot;".',length:2}:h?.kind==="double-in-double"?{line:i,column:h.column,severity:"error",code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',length:1}:{line:i,column:s,severity:"error",code:"FL-NODE-UNCLOSED-BRACKET",message:"Unclosed '{{ '. Add a matching '}}'.",hint:"Example: A{{Hexagon}}",length:c}}}return it(t,"nodeContent")&&t.name==="MismatchedTokenException"&&a==="QuotedString"?{line:i,column:s,severity:"error",code:"FL-LABEL-QUOTE-IN-UNQUOTED",message:"Double quotes inside an unquoted label are not allowed. Wrap the entire label in quotes or use &quot;.",hint:'Example: A["Calls logger.debug(&quot;message&quot;, data)"]',length:c}:it(t,"classStatement")?{line:i,column:s,severity:"error",code:"FL-CLASS-MALFORMED",message:"Invalid class statement. Provide node id(s) then a class name.",hint:"Example: class A,B important",length:c}:it(t,"subgraph")&&t.name==="NoViableAltException"?{line:i,column:s,severity:"error",code:"FL-SUBGRAPH-MISSING-HEADER",message:"Subgraph header is missing. Add an ID or a [Title] after the keyword.",hint:"Example: subgraph API [API Layer]",length:c}:t.name==="NotAllInputParsedException"&&a==="EndKeyword"?{line:i,column:s,severity:"error",code:"FL-END-WITHOUT-SUBGRAPH",message:"'end' without a matching 'subgraph'.",hint:"Remove this end or add a subgraph above.",length:c}:{line:i,column:s,severity:"error",message:t.message||"Parser error",length:c}}function my(t,e){let r=t.token,n=Hs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=ah(r),a=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,l=e.split(/\r?\n/)[Math.max(0,i-1)]||"";if(t.name==="NotAllInputParsedException"&&r?.tokenType?.name==="Colon")return{line:i,column:s,severity:"error",code:"PI-LABEL-REQUIRES-QUOTES",message:"Slice labels must be quoted (single or double quotes).",hint:'Example: "Dogs" : 10',length:a};if(t.name==="NotAllInputParsedException"){let f=l.indexOf(":");if(f>0){let u=l.slice(0,f);if(!(u.trimStart().startsWith('"')||u.trimStart().startsWith("'")))return{line:i,column:Math.max(1,f),severity:"error",code:"PI-LABEL-REQUIRES-QUOTES",message:"Slice labels must be quoted (single or double quotes).",hint:'Example: "Dogs" : 10',length:1}}}if(t.name==="NotAllInputParsedException"&&typeof r?.image=="string"){let f=r.image;if(f.startsWith('"')&&!f.slice(1).includes('"')||f.startsWith("'")&&!f.slice(1).includes("'"))return{line:i,column:s,severity:"error",code:"PI-QUOTE-UNCLOSED",message:"Unclosed quote in slice label.",hint:'Close the quote: "Dogs" : 10',length:a}}if(Fe(t,"Colon")){let f=(l.match(/\"/g)||[]).length;if((l.match(/"/g)||[]).length-f>=3){let h=[];for(let p=0;p<l.length;p++)l[p]==='"'&&h.push(p);let d=(h[2]??s-1)+1;return{line:i,column:d,severity:"error",code:"PI-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted slice label are not supported. Use &quot; for inner quotes.",hint:'Example: "He said &quot;Hi&quot;" : 1',length:1}}return{line:i,column:s,severity:"error",code:"PI-MISSING-COLON",message:"Missing colon between slice label and value.",hint:'Use: "Label" : 10',length:a}}return Fe(t,"NumberLiteral")?{line:i,column:s,severity:"error",code:"PI-MISSING-NUMBER",message:"Missing numeric value after colon.",hint:"Use a number like 10 or 42.5",length:a}:Fe(t,"QuotedString")?{line:i,column:s,severity:"error",code:"PI-LABEL-REQUIRES-QUOTES",message:"Slice labels must be quoted (single or double quotes).",hint:'Example: "Dogs" : 10',length:a}:{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}}function gy(t,e){let r=t.token,n=Hs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=ah(r),a=r?.tokenType?.name,c=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,f=e.split(/\r?\n/)[Math.max(0,i-1)]||"",u=L=>it(t,L),h=u("actorRef")||u("participantDecl"),d=L=>Fe(t,L),p=t?.context?.ruleStack?.[0]==="diagram"&&t?.context?.ruleStack?.length===1,m=[{tok:"ElseKeyword",key:"else",allowedRule:"altBlock",allowedLabel:"alt",example:`alt Condition
  \u2026
else
  \u2026
end`},{tok:"AndKeyword",key:"and",allowedRule:"parBlock",allowedLabel:"par",example:`par
  \u2026
and
  \u2026
end`},{tok:"OptionKeyword",key:"option",allowedRule:"criticalBlock",allowedLabel:"critical",example:`critical
  \u2026
option Label
  \u2026
end`}],x=(t?.context?.ruleStack||[]).slice().reverse().find(L=>/Block$/.test(L)),y=m.find(L=>L.tok===a);if(y){if(!x)return y.key==="else"?{line:i,column:s,severity:"error",code:"SE-ELSE-OUTSIDE-ALT",message:"'else' is only allowed inside 'alt' blocks.",hint:"Use: alt Condition \u2026 else \u2026 end",length:c}:y.key==="and"?{line:i,column:s,severity:"error",code:"SE-AND-OUTSIDE-PAR",message:"'and' is only allowed inside 'par' blocks.",hint:"Example: par \u2026 and \u2026 end (parallel branches).",length:c}:{line:i,column:s,severity:"error",code:"SE-BRANCH-OUTSIDE-BLOCK",message:`'${y.key}' is only allowed inside a '${y.allowedLabel}' block.`,hint:`Start a ${y.allowedLabel} section:
${y.example}`,length:c};if(x!==y.allowedRule){if(y.key==="else"&&x==="criticalBlock")return{line:i,column:s,severity:"error",code:"SE-ELSE-IN-CRITICAL",message:"'else' is not allowed inside a 'critical' block. Use 'option' or close the block with 'end'.",hint:`Replace with: option <label>
Example:
option Retry`,length:c};let L=(x||"").replace(/Block$/,"")||"block";return{line:i,column:s,severity:"error",code:"SE-BRANCH-IN-WRONG-BLOCK",message:`'${y.key}' is only valid in '${y.allowedLabel}' blocks (not inside '${L}').`,hint:`Use the proper branch for '${L}' or close it with 'end'.
For '${y.allowedLabel}', use:
${y.example}`,length:c}}}if(p&&d("SequenceKeyword"))return{line:i,column:s,severity:"error",code:"SE-HEADER-MISSING",message:"Missing 'sequenceDiagram' header.",hint:"Start with: sequenceDiagram",length:c};if(u("messageStmt")&&t.name==="MismatchedTokenException"&&d("Colon"))return{line:i,column:s,severity:"error",code:"SE-MSG-COLON-MISSING",message:"Missing colon after target actor in message.",hint:"Use: A->>B: Message text",length:c};if(h&&(t.name==="NoViableAltException"||t.name==="MismatchedTokenException"||t.name==="EarlyExitException")){let k=Jr(e,{code:"SE-QUOTE-UNCLOSED",message:"Unclosed quote in participant/actor name.",hint:'Close the quote: participant "Bob"  or  participant Alice as "Alias"',limitPerFile:Number.MAX_SAFE_INTEGER}).find(b=>b.line===i);if(k)return{...k,severity:"warning"};let N=(f.match(/\"/g)||[]).length,v=(f.match(/"/g)||[]).length-N,R=(f.match(/'/g)||[]).length;if(v>=3){let b=[];for(let C=0;C<f.length;C++)f[C]==='"'&&b.push(C);let w=(b[2]??s-1)+1;return{line:i,column:w,severity:"warning",code:"SE-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label are not supported. Use &quot; for inner quotes.",hint:'Example: participant "Logger &quot;debug&quot;" as L',length:1}}}if(u("arrow")&&t.name==="NoViableAltException")return{line:i,column:s,severity:"error",code:"SE-ARROW-INVALID",message:`Invalid sequence arrow near '${o}'.`,hint:"Use ->, -->, ->>, -->>, -x, --x, -), --), <<->>, or <<-->>",length:c};if(u("noteStmt")){if(t.name==="MismatchedTokenException"&&d("Colon"))return{line:i,column:s,severity:"error",code:"SE-NOTE-MALFORMED",message:"Malformed note: missing colon before the note text.",hint:"Example: Note right of Alice: Hello",length:c};if(t.name==="NoViableAltException")return{line:i,column:s,severity:"error",code:"SE-NOTE-MALFORMED",message:"Malformed note statement. Use left|right of X or over X[,Y]: text",hint:"Examples: Note over A,B: hi",length:c}}if(a==="ElseKeyword"&&it(t,"criticalBlock"))return{line:i,column:s,severity:"error",code:"SE-ELSE-IN-CRITICAL",message:"'else' is not allowed inside a 'critical' block. Use 'option' or close the block with 'end'.",hint:`Replace with: option <label>
Example:
option Retry`,length:c};if(u("boxBlock")&&(t.name==="NoViableAltException"||t.name==="MismatchedTokenException")){let L=/->|-->>|-->/.test(f),k=/note\s+(left|right|over)/i.test(f),N=/activate\s+/i.test(f),v=/deactivate\s+/i.test(f);if(L||k||N||v||a==="NoteKeyword"||a==="ActivateKeyword"||a==="DeactivateKeyword"){let R=e.split(/\r?\n/),b=Math.max(0,i-1),w=!1,C=-1;for(let I=b;I>=0;I--)if(/^\s*box\b/.test(R[I]||"")){C=I;break}if(C!==-1)for(let I=b;I<R.length;I++){if(/^\s*end\s*$/.test(R[I]||"")){w=!0;break}if(I>b&&/^\s*(sequenceDiagram|box|alt|opt|loop|par|rect|critical|break)\b/.test(R[I]||""))break}if(w){let I=!1;for(let P=C+1;P<R.length;P++){let q=R[P]||"";if(/^\s*end\s*$/.test(q))break;if(/^\s*(participant|actor)\b/i.test(q)){I=!0;break}}return I?{line:i,column:s,severity:"error",code:"SE-BOX-INVALID-CONTENT",message:"Box blocks can only contain participant/actor declarations.",hint:`Move messages, notes, and other statements outside the box block.
Example:
box "Group"
  participant A
  participant B
end
A->>B: Message`,length:c}:{line:C+1,column:1,severity:"error",code:"SE-BOX-EMPTY",message:"Box block has no participant/actor declarations. Use 'rect' to group messages visually.",hint:`Replace 'box' with 'rect' if you want to group messages:
rect rgb(240, 240, 255)
  A->>B: Message
  Note over A: Info
end`,length:3}}}}let E=[{rule:"altBlock",label:"alt"},{rule:"optBlock",label:"opt"},{rule:"loopBlock",label:"loop"},{rule:"parBlock",label:"par"},{rule:"rectBlock",label:"rect"},{rule:"criticalBlock",label:"critical"},{rule:"breakBlock",label:"break"},{rule:"boxBlock",label:"box"}];if(t.name==="MismatchedTokenException"&&d("EndKeyword")){let L=E.find(k=>it(t,k.rule));if(L){let k=e.split(/\r?\n/),N=/^(\s*)(alt\b|opt\b|loop\b|par\b|rect\b|critical\b|break\b|box\b)/,v=-1,R="";for(let w=Math.max(0,i-1);w>=0;w--){let C=N.exec(k[w]||"");if(C){v=w,R=C[1]||"";break}}let b=i;if(v!==-1){b=k.length;for(let w=v+1;w<k.length;w++){let C=k[w]||"";if(C.trim()==="")continue;if((C.match(/^(\s*)/)?.[1]||"").length<=R.length){b=w+1;break}}b>k.length&&(b=k.length+1)}return{line:b,column:1,severity:"error",code:"SE-BLOCK-MISSING-END",message:`Missing 'end' to close a '${L.label}' block.`,hint:"Add 'end' on its own line aligned with the block's start.",length:1}}}if((t.name==="NoViableAltException"||t.name==="NotAllInputParsedException")&&a==="ElseKeyword")return{line:i,column:s,severity:"error",code:"SE-ELSE-OUTSIDE-ALT",message:"'else' is only allowed inside 'alt' blocks.",hint:"Use: alt Condition \u2026 else \u2026 end",length:c};if((t.name==="NoViableAltException"||t.name==="NotAllInputParsedException")&&a==="AndKeyword")return{line:i,column:s,severity:"error",code:"SE-AND-OUTSIDE-PAR",message:"'and' is only allowed inside 'par' blocks.",hint:"Example: par \u2026 and \u2026 end (parallel branches).",length:c};if((t.name==="NoViableAltException"||t.name==="NotAllInputParsedException")&&a==="EndKeyword")return{line:i,column:s,severity:"error",code:"SE-END-WITHOUT-BLOCK",message:"'end' without an open block (alt/opt/loop/par/rect/critical/break/box).",hint:"Add a block above (e.g., par \u2026 end | alt \u2026 end) or remove this end.",length:c};if(u("autonumberStmt")){if(a==="Identifier")return{line:i,column:s,severity:"error",code:"SE-AUTONUMBER-NON-NUMERIC",message:`Autonumber values must be numbers. Found '${o}'.`,hint:"Use numbers: autonumber 10 or autonumber 10 10 (start and step).",length:c};if(a==="ParticipantKeyword"||a==="ActorKeyword")return{line:i,column:s,severity:"error",code:"SE-AUTONUMBER-EXTRANEOUS",message:"Unexpected token after 'autonumber'. Put 'autonumber' on its own line.",hint:`Example:
autonumber 10 10
participant A`,length:c};if(t.name==="NoViableAltException"||t.name==="MismatchedTokenException"||t.name==="NotAllInputParsedException")return{line:i,column:s,severity:"error",code:"SE-AUTONUMBER-MALFORMED",message:"Malformed autonumber statement.",hint:"Use: autonumber | autonumber off | autonumber 10 10",length:c}}if(u("createStmt")&&(a==="Newline"||a==="EOF"))return{line:i,column:s,severity:"error",code:"SE-CREATE-MISSING-NAME",message:"Missing name after 'create'.",hint:"Use: create participant A  or  create actor B",length:c};if(u("createStmt")&&(t.name==="MismatchedTokenException"||t.name==="NoViableAltException"))return{line:i,column:s,severity:"error",code:"SE-CREATE-MALFORMED",message:"After 'create', specify 'participant' or 'actor' before the name.",hint:`Examples:
create participant B
create actor D as Donald`,length:c};if(u("destroyStmt")&&t.name==="MismatchedTokenException")return{line:i,column:s,severity:"error",code:"SE-DESTROY-MALFORMED",message:"After 'destroy', specify 'participant' or 'actor' and a name.",hint:`Examples:
destroy participant A
destroy actor B`,length:c};if(u("destroyStmt")&&(a==="Newline"||a==="EOF"))return{line:i,column:s,severity:"error",code:"SE-DESTROY-MISSING-NAME",message:"Missing name after 'destroy'.",hint:"Use: destroy participant A  or  destroy actor B",length:c};let T=(f.match(/\"/g)||[]).length;if((f.match(/"/g)||[]).length-T>=3){let L=[];for(let N=0;N<f.length;N++)f[N]==='"'&&L.push(N);let k=(L[2]??s-1)+1;return{line:i,column:k,severity:"error",code:"SE-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label are not supported. Use &quot; for inner quotes.",hint:'Example: participant "Logger &quot;debug&quot;" as L',length:1}}return{line:i,column:s,severity:"error",message:t.message||"Parser error",length:c}}function xy(t,e){let r=t.token,n=Hs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=r?.tokenType?.name,a=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,l=e.split(/\r?\n/)[Math.max(0,i-1)]||"";return lh(t)&&!Fe(t,"ClassDiagramKeyword")?{line:i,column:s,severity:"error",code:"CL-HEADER-MISSING",message:"Missing 'classDiagram' header.",hint:"Start with: classDiagram",length:a}:it(t,"relationOp")?/^\s*class\b/.test(l)?{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}:{line:i,column:s,severity:"error",code:"CL-REL-INVALID",message:"Invalid relationship operator. Use <|--, *--, o--, --, ..> or ..|>.",hint:"Example: Foo <|-- Bar",length:a}:(it(t,"classBlock")||it(t,"classLine"))&&t.name==="MismatchedTokenException"&&Fe(t,"RCurly")?{line:i,column:s,severity:"error",code:"CL-BLOCK-MISSING-RBRACE",message:"Missing '}' to close class block.",hint:"Close the block: class Foo { ... }",length:a}:it(t,"memberLine")&&(t.name==="MismatchedTokenException"||t.name==="NoViableAltException")?{line:i,column:s,severity:"error",code:"CL-MEMBER-MALFORMED",message:"Malformed class member. Use visibility + name [()][: type].",hint:"Examples: +foo() : void  |  -bar: int",length:a}:it(t,"relationStmt")&&t.name==="MismatchedTokenException"?{line:i,column:s,severity:"error",code:"CL-REL-MALFORMED",message:"Malformed relationship. Use: A <op> B [: label]",hint:"Example: Foo <|-- Bar : extends",length:a}:{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}}function yy(t,e){let r=t.token,n=Hs(e),{line:i,column:s}=ar(r?.startLine??null,r?.startColumn??null,n.line,n.column),o=r?.tokenType?.name,a=typeof r?.image=="string"&&r.image.length>0?r.image.length:1,l=e.split(/\r?\n/)[Math.max(0,i-1)]||"";if(lh(t)&&!(Fe(t,"StateDiagram")||Fe(t,"StateDiagramV2")))return{line:i,column:s,severity:"error",code:"ST-HEADER-MISSING",message:"Missing 'stateDiagram' header.",hint:"Start with: stateDiagram-v2",length:a};if(it(t,"noteStmt")&&t.name==="MismatchedTokenException"&&Fe(t,"Colon"))return{line:i,column:s,severity:"error",code:"ST-NOTE-MALFORMED",message:"Malformed note: missing colon before note text.",hint:"Example: Note right of A: message",length:a};if(it(t,"stateBlock")&&t.name==="MismatchedTokenException"&&Fe(t,"RCurly"))return{line:i,column:s,severity:"error",code:"ST-BLOCK-MISSING-RBRACE",message:"Missing '}' to close a state block.",hint:"Close the block: state Foo { ... }",length:a};if((t.name==="NoViableAltException"||t.name==="MismatchedTokenException")&&o==="Dashes"&&!it(t,"innerStatement"))return{line:i,column:s,severity:"error",code:"ST-CONCURRENCY-OUTSIDE-BLOCK",message:"'---' is only allowed inside 'state { \u2026 }' blocks.",hint:"Move '---' inside a composite state block: state A { \u2026 --- \u2026 }",length:a};let f=(l.match(/\\\"/g)||[]).length;if((l.match(/\"/g)||[]).length-f>=3){let h=[];for(let p=0;p<l.length;p++)l[p]==='"'&&h.push(p);let d=(h[2]??s-1)+1;return{line:i,column:d,severity:"warning",code:"ST-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label may be invalid. Use &quot; for inner quotes.",hint:'Example: state "Logger &quot;core&quot;" as L',length:1}}return{line:i,column:s,severity:"error",message:t.message||"Parser error",length:a}}function lr(t,e){let r=[],n=e.tokenize(t);if(n.errors.length>0&&r.push(...n.errors.map(dy)),e.postLex)try{r.push(...e.postLex(t,n.tokens)||[])}catch{}let i=null;if(n.errors.length===0){let s=e.parse(n.tokens);i=s.cst,s.errors.length>0&&r.push(...s.errors.map(o=>e.mapParserError(o,t)))}if(i)try{r.push(...e.analyze(i,n.tokens)||[])}catch(s){r.push({line:1,column:1,severity:"error",message:`Internal semantic analysis error: ${s.message}`})}if(e.postParse)try{r.push(...e.postParse(t,n.tokens,i,r)||[])}catch{}return r}function Ey(t,e={}){return lr(t,{tokenize:wl,parse:uy,analyze:(r,n)=>fy(r,n,{strict:!!e.strict}),mapParserError:(r,n)=>py(r,n),postLex:(r,n)=>{let i=[];for(let s of n)s.tokenType===Ds&&i.push({line:s.startLine??1,column:s.startColumn??1,message:"Invalid arrow syntax: -> (use --> instead)",severity:"error",code:"FL-ARROW-INVALID",hint:"Replace -> with -->, or use -- text --> for inline labels.",length:s.image?.length??2});return i},postParse:(r,n,i,s)=>{let o=Ws(n,{code:"FL-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in node labels are accepted by Mermaid, but using &quot; is preferred for portability.',hint:'Prefer &quot; inside quoted labels, e.g., A["He said &quot;Hi&quot;"]'}).map(m=>({...m,severity:"warning"})),a=new Set(s.filter(m=>m.code==="FL-LABEL-DOUBLE-IN-DOUBLE").map(m=>m.line)),c=new Set(Ws(n,{code:"x"}).map(m=>m.line)),l=Ii(n,{code:"FL-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted label are not supported. Use &quot; for inner quotes.",hint:'Example: A["He said &quot;Hi&quot;"]',scopeEndTokenNames:["SquareClose","RoundClose","DiamondClose","DoubleSquareClose","DoubleRoundClose","StadiumClose","CylinderClose","HexagonClose"],scopeStartTokenNames:["SquareOpen","RoundOpen","DiamondOpen","DoubleSquareOpen","DoubleRoundOpen","StadiumOpen","CylinderOpen","HexagonOpen"]}).filter(m=>!a.has(m.line)&&!c.has(m.line)),f=o.concat(l),u=(s||[]).filter(m=>m.severity==="error"&&!("code"in m)&&typeof m.message=="string");for(let m of u){let g=String(m.message||"");g.includes("Newline")&&g.includes("EOF")&&f.push({line:m.line??1,column:m.column??1,severity:"error",code:"FL-LINK-MISSING",message:"Two nodes on one line must be connected with an arrow.",hint:"Insert --> between nodes, e.g., A --> B."})}{let m=r.split(/\r?\n/),g=String.raw`[A-Za-z0-9_]+(?:\[[^\]]*\]|\([^\)]*\)|\{[^}]*\}|\[\[[^\]]*\]\]|\(\([^\)]*\)\))?`,x=new RegExp(String.raw`^\s*(${g})\s+(${g})\s*;?\s*$`),y=/^(?:\s*)(style|classDef|class|click|linkStyle|subgraph|end|graph|flowchart|direction)\b/;for(let E=0;E<m.length;E++){let T=m[E]||"",A=E+1;if(!T.trim()||y.test(T))continue;let L=x.exec(T);if(L){let k=T.indexOf(L[2]),N=k>=0?k+1:1;f.push({line:A,column:N,severity:"error",code:"FL-LINK-MISSING",message:"Two nodes on one line must be connected with an arrow.",hint:"Insert --> between nodes, e.g., A --> B."})}}}let h=(r.match(/\\\"/g)||[]).length,d=(r.match(/\"/g)||[]).length-h,p=(r.match(/'/g)||[]).length;return(d%2===1||p%2===1)&&f.push(...Jr(r,{code:"FL-QUOTE-UNCLOSED",message:"Unclosed quote in node label.",hint:'Close the quote: A["Label"]',limitPerFile:1})),f}})}var ch=O({name:"PieKeyword",pattern:/pie/}),uh=O({name:"TitleKeyword",pattern:/title/}),hh=O({name:"ShowDataKeyword",pattern:/showData/}),fh=O({name:"Colon",pattern:/:/}),Il=O({name:"NumberLiteral",pattern:/-?[0-9]+(\.[0-9]+)?/}),Rl=O({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),dh=O({name:"Text",pattern:/[^:\n\r]+/}),HP=O({name:"Comment",pattern:/%%[^\n\r]*/,group:Q.SKIPPED}),zP=O({name:"WhiteSpace",pattern:/[ \t]+/,group:Q.SKIPPED}),Ri=O({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),ph=[HP,Rl,ch,uh,hh,zP,fh,Il,dh,Ri],VP=new Q(ph);function Ml(t){return VP.tokenize(t)}var mh=class extends kt{constructor(){super(ph),this.diagram=this.RULE("diagram",()=>{this.CONSUME(ch),this.OPTION(()=>this.CONSUME(hh)),this.OPTION2(()=>this.CONSUME(Ri)),this.MANY(()=>this.SUBRULE(this.statement))}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.titleStmt)},{ALT:()=>this.SUBRULE(this.sliceStmt)},{ALT:()=>this.CONSUME(Ri)}])}),this.titleStmt=this.RULE("titleStmt",()=>{this.CONSUME(uh),this.AT_LEAST_ONE(()=>this.OR([{ALT:()=>this.CONSUME(Rl)},{ALT:()=>this.CONSUME(dh)},{ALT:()=>this.CONSUME(Il)}])),this.OPTION2(()=>this.CONSUME(Ri))}),this.sliceStmt=this.RULE("sliceStmt",()=>{this.SUBRULE(this.sliceLabel),this.CONSUME(fh),this.CONSUME(Il),this.OPTION3(()=>this.CONSUME(Ri))}),this.sliceLabel=this.RULE("sliceLabel",()=>{this.CONSUME(Rl)}),this.performSelfAnalysis()}},cr=new mh;function Sy(t){return cr.input=t,{cst:cr.diagram(),errors:cr.errors}}var QP=cr.getBaseCstVisitorConstructorWithDefaults(),gh=class extends QP{constructor(e){super(),this.validateVisitor(),this.ctx=e}diagram(e){e.statement&&e.statement.forEach(r=>this.visit(r))}statement(e){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)&&n.forEach(i=>{i&&typeof i.name=="string"&&this.visit(i)})}}};function Ty(t,e){let r={errors:[]};return new gh(r).visit(t),r.errors}function Oy(t,e={}){return lr(t,{tokenize:Ml,parse:Sy,analyze:(r,n)=>Ty(r,n),mapParserError:(r,n)=>my(r,n),postLex:(r,n)=>{let i=[];i.push(...Jr(r,{code:"PI-QUOTE-UNCLOSED",message:"Unclosed quote in slice label.",hint:'Close the quote: "Dogs" : 10',limitPerFile:1}));let s=n,o=new Set;for(let c of s)typeof c.image=="string"&&c.image.includes('\\"')&&o.add(c.startLine??1);let a=Ii(s,{code:"PI-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted slice label are not supported. Use &quot; for inner quotes.",hint:'Example: "He said &quot;Hi&quot;" : 1',scopeEndTokenNames:["Colon"]}).filter(c=>!o.has(c.line));return i.push(...a),i}})}var H=O({name:"Identifier",pattern:/[A-Za-z_][A-Za-z0-9_]*/}),en=O({name:"NumberLiteral",pattern:/[0-9]+/}),xh=O({name:"SequenceKeyword",pattern:/sequenceDiagram/,longer_alt:H}),tn=O({name:"ParticipantKeyword",pattern:/participant/i,longer_alt:H}),rn=O({name:"ActorKeyword",pattern:/actor/i,longer_alt:H}),_l=O({name:"AsKeyword",pattern:/as/i,longer_alt:H}),Ul=O({name:"AutonumberKeyword",pattern:/autonumber/i,longer_alt:H}),Pl=O({name:"OffKeyword",pattern:/off/i,longer_alt:H}),ql=O({name:"NoteKeyword",pattern:/note/i,longer_alt:H}),Dl=O({name:"LeftKeyword",pattern:/left/i,longer_alt:H}),$l=O({name:"RightKeyword",pattern:/right/i,longer_alt:H}),Mi=O({name:"OverKeyword",pattern:/over/i,longer_alt:H}),Bl=O({name:"OfKeyword",pattern:/of/i,longer_alt:H}),_i=O({name:"TitleKeyword",pattern:/title/i,longer_alt:H}),Ui=O({name:"AccTitleKeyword",pattern:/acc_title|accTitle/i,longer_alt:H}),Pi=O({name:"AccDescrKeyword",pattern:/acc_descr|accDescr/i,longer_alt:H}),Cn=O({name:"ActivateKeyword",pattern:/activate/i,longer_alt:H}),vn=O({name:"DeactivateKeyword",pattern:/deactivate/i,longer_alt:H}),wn=O({name:"CreateKeyword",pattern:/create/i,longer_alt:H}),Fl=O({name:"DestroyKeyword",pattern:/destroy/i,longer_alt:H}),zs=O({name:"AltKeyword",pattern:/alt/i,longer_alt:H}),In=O({name:"ElseKeyword",pattern:/else/i,longer_alt:H}),Kl=O({name:"OptionKeyword",pattern:/option/i,longer_alt:H}),Gl=O({name:"OptKeyword",pattern:/opt/i,longer_alt:H}),jl=O({name:"LoopKeyword",pattern:/loop/i,longer_alt:H}),qi=O({name:"ParKeyword",pattern:/par/i,longer_alt:H}),Rn=O({name:"AndKeyword",pattern:/and/i,longer_alt:H}),Wl=O({name:"RectKeyword",pattern:/rect/i,longer_alt:H}),Hl=O({name:"CriticalKeyword",pattern:/critical/i,longer_alt:H}),zl=O({name:"BoxKeyword",pattern:/box/i,longer_alt:H}),Ht=O({name:"EndKeyword",pattern:/end/i,longer_alt:H}),Vl=O({name:"LinksKeyword",pattern:/links/i,longer_alt:H}),Yl=O({name:"LinkKeyword",pattern:/link/i,longer_alt:H}),Vs=O({name:"PropertiesKeyword",pattern:/properties/i,longer_alt:H}),Ys=O({name:"DetailsKeyword",pattern:/details/i,longer_alt:H}),Ql=O({name:"BreakKeyword",pattern:/break/i,longer_alt:H}),Di=O({name:"BidirAsyncDotted",pattern:/<<-->>/}),$i=O({name:"BidirAsync",pattern:/<<->>/}),Bi=O({name:"DottedAsync",pattern:/-->>/}),Fi=O({name:"Async",pattern:/->>/}),Ki=O({name:"Dotted",pattern:/-->/}),Gi=O({name:"Solid",pattern:/->/}),Qs=O({name:"DottedCross",pattern:/--x/}),Xs=O({name:"Cross",pattern:/-x/}),Zs=O({name:"DottedOpen",pattern:/--\)/}),Js=O({name:"Open",pattern:/-\)/}),ji=O({name:"Plus",pattern:/\+/}),Wi=O({name:"Minus",pattern:/-/}),eo=O({name:"Comma",pattern:/,/}),ur=O({name:"Colon",pattern:/:/}),yh=O({name:"LParen",pattern:/\(/}),Eh=O({name:"RParen",pattern:/\)/}),Hi=O({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),XP=O({name:"Comment",pattern:/%%[^\n\r]*/,group:Q.SKIPPED}),ZP=O({name:"WhiteSpace",pattern:/[ \t]+/,group:Q.SKIPPED}),X=O({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),zi=O({name:"Text",pattern:/[^\n\r]+/}),Sh=[XP,Hi,ZP,X,xh,_i,Ui,Pi,tn,rn,_l,Ul,Pl,ql,Dl,$l,Mi,Bl,Cn,vn,wn,Fl,zs,In,Kl,Gl,jl,qi,Rn,Wl,Hl,Ql,zl,Ht,Vl,Yl,Vs,Ys,Di,$i,Bi,Fi,Ki,Gi,Qs,Xs,Zs,Js,eo,ur,yh,Eh,ji,Wi,en,H,zi],JP=new Q(Sh);function Xl(t){return JP.tokenize(t)}var Oh=class extends kt{constructor(){super(Sh),this.diagram=this.RULE("diagram",()=>{this.CONSUME(xh),this.MANY(()=>this.CONSUME(X)),this.MANY2(()=>{this.SUBRULE(this.line)}),this.OPTION(()=>this.CONSUME(re))}),this.line=this.RULE("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.metaStmt)},{ALT:()=>this.SUBRULE(this.participantDecl)},{ALT:()=>this.SUBRULE(this.autonumberStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.activateStmt)},{ALT:()=>this.SUBRULE(this.deactivateStmt)},{ALT:()=>this.SUBRULE(this.createStmt)},{ALT:()=>this.SUBRULE(this.destroyStmt)},{ALT:()=>this.SUBRULE(this.linkStmt)},{ALT:()=>this.SUBRULE(this.propertiesStmt)},{ALT:()=>this.SUBRULE(this.detailsStmt)},{ALT:()=>this.SUBRULE(this.altBlock)},{ALT:()=>this.SUBRULE(this.optBlock)},{ALT:()=>this.SUBRULE(this.loopBlock)},{ALT:()=>this.SUBRULE(this.parBlock)},{ALT:()=>this.SUBRULE(this.criticalBlock)},{ALT:()=>this.SUBRULE(this.breakBlock)},{ALT:()=>this.SUBRULE(this.rectBlock)},{ALT:()=>this.SUBRULE(this.boxBlock)},{ALT:()=>this.SUBRULE(this.messageStmt)},{ALT:()=>this.SUBRULE(this.blankLine)}])}),this.metaStmt=this.RULE("metaStmt",()=>{this.OR([{ALT:()=>this.CONSUME(_i)},{ALT:()=>this.CONSUME(Ui)},{ALT:()=>this.CONSUME(Pi)}]),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.blankLine=this.RULE("blankLine",()=>{this.AT_LEAST_ONE(()=>this.CONSUME(X))}),this.actorRef=this.RULE("actorRef",()=>{this.AT_LEAST_ONE(()=>this.OR([{ALT:()=>this.CONSUME(H)},{ALT:()=>this.CONSUME(Hi)},{ALT:()=>this.CONSUME(en)},{ALT:()=>this.CONSUME(zi)}]))}),this.participantDecl=this.RULE("participantDecl",()=>{this.OR([{ALT:()=>this.CONSUME(tn)},{ALT:()=>this.CONSUME(rn)}]),this.SUBRULE(this.actorRef),this.OPTION(()=>{this.CONSUME(_l),this.SUBRULE2(this.actorRef)}),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.autonumberStmt=this.RULE("autonumberStmt",()=>{this.CONSUME(Ul),this.OPTION(()=>{this.OR([{ALT:()=>this.CONSUME(Pl)},{ALT:()=>{this.CONSUME(en),this.OPTION2(()=>this.CONSUME2(en))}}])}),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.noteStmt=this.RULE("noteStmt",()=>{this.CONSUME(ql),this.OR([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Dl)},{ALT:()=>this.CONSUME($l)}]),this.CONSUME(Bl),this.SUBRULE(this.actorRef)}},{ALT:()=>{this.CONSUME(Mi),this.SUBRULE2(this.actorRef),this.OPTION(()=>{this.CONSUME(eo),this.SUBRULE3(this.actorRef)})}}]),this.CONSUME(ur),this.OPTION2(()=>this.SUBRULE(this.lineRemainder)),this.OR3([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.activateStmt=this.RULE("activateStmt",()=>{this.CONSUME(Cn),this.SUBRULE(this.actorRef),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.deactivateStmt=this.RULE("deactivateStmt",()=>{this.CONSUME(vn),this.SUBRULE(this.actorRef),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.createStmt=this.RULE("createStmt",()=>{this.CONSUME(wn),this.OR([{ALT:()=>this.CONSUME(tn)},{ALT:()=>this.CONSUME(rn)}]),this.SUBRULE(this.actorRef),this.OPTION(()=>{this.CONSUME(_l),this.OPTION2(()=>this.SUBRULE(this.lineRemainder))}),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.destroyStmt=this.RULE("destroyStmt",()=>{this.CONSUME(Fl),this.OPTION(()=>{this.OR([{ALT:()=>this.CONSUME(tn)},{ALT:()=>this.CONSUME(rn)}])}),this.SUBRULE(this.actorRef),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.linkStmt=this.RULE("linkStmt",()=>{this.OR([{ALT:()=>this.CONSUME(Yl)},{ALT:()=>this.CONSUME(Vl)}]),this.SUBRULE(this.actorRef),this.CONSUME(ur),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.propertiesStmt=this.RULE("propertiesStmt",()=>{this.CONSUME(Vs),this.OPTION(()=>this.CONSUME(ur)),this.OPTION1(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.detailsStmt=this.RULE("detailsStmt",()=>{this.CONSUME(Ys),this.OPTION(()=>this.CONSUME(ur)),this.OPTION1(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.messageStmt=this.RULE("messageStmt",()=>{this.SUBRULE(this.actorRef),this.SUBRULE(this.arrow),this.OPTION(()=>this.OR([{ALT:()=>this.CONSUME(ji)},{ALT:()=>this.CONSUME(Wi)}])),this.SUBRULE2(this.actorRef),this.CONSUME(ur),this.OPTION2(()=>this.SUBRULE(this.lineRemainder)),this.OR2([{ALT:()=>this.AT_LEAST_ONE(()=>this.CONSUME(X))},{ALT:()=>this.CONSUME(re)}])}),this.arrow=this.RULE("arrow",()=>{this.OR([{ALT:()=>this.CONSUME(Di)},{ALT:()=>this.CONSUME($i)},{ALT:()=>this.CONSUME(Bi)},{ALT:()=>this.CONSUME(Fi)},{ALT:()=>this.CONSUME(Ki)},{ALT:()=>this.CONSUME(Gi)},{ALT:()=>this.CONSUME(Qs)},{ALT:()=>this.CONSUME(Xs)},{ALT:()=>this.CONSUME(Zs)},{ALT:()=>this.CONSUME(Js)}])}),this.altBlock=this.RULE("altBlock",()=>{this.CONSUME(zs),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2(()=>{this.CONSUME(In),this.OPTION2(()=>this.SUBRULE2(this.lineRemainder)),this.AT_LEAST_ONE2(()=>this.CONSUME2(X)),this.MANY3(()=>this.SUBRULE2(this.line))}),this.CONSUME(Ht),this.OR3([{ALT:()=>this.AT_LEAST_ONE3(()=>this.CONSUME3(X))},{ALT:()=>this.CONSUME3(re)}])}),this.optBlock=this.RULE("optBlock",()=>{this.CONSUME(Gl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ht),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.loopBlock=this.RULE("loopBlock",()=>{this.CONSUME(jl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ht),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.parBlock=this.RULE("parBlock",()=>{this.CONSUME(qi),this.OPTION(()=>this.SUBRULE(this.parHeader)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2(()=>{this.CONSUME(Rn),this.OPTION2(()=>this.SUBRULE2(this.lineRemainder)),this.AT_LEAST_ONE2(()=>this.CONSUME2(X)),this.MANY3(()=>this.SUBRULE2(this.line))}),this.CONSUME(Ht),this.OR3([{ALT:()=>this.AT_LEAST_ONE3(()=>this.CONSUME3(X))},{ALT:()=>this.CONSUME3(re)}])}),this.parHeader=this.RULE("parHeader",()=>{this.OR([{GATE:()=>this.LA(1).tokenType===Mi,ALT:()=>{this.CONSUME(Mi),this.SUBRULE(this.actorRef),this.OPTION(()=>{this.CONSUME(eo),this.SUBRULE2(this.actorRef)}),this.OPTION1(()=>this.SUBRULE(this.lineRemainder))}},{ALT:()=>this.SUBRULE2(this.lineRemainder)}])}),this.criticalBlock=this.RULE("criticalBlock",()=>{this.CONSUME(Hl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2(()=>{this.CONSUME(Kl),this.OPTION2(()=>this.SUBRULE2(this.lineRemainder)),this.AT_LEAST_ONE2(()=>this.CONSUME2(X)),this.MANY3(()=>this.SUBRULE2(this.line))}),this.CONSUME(Ht),this.AT_LEAST_ONE3(()=>this.CONSUME3(X))}),this.breakBlock=this.RULE("breakBlock",()=>{this.CONSUME(Ql),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ht),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.rectBlock=this.RULE("rectBlock",()=>{this.CONSUME(Wl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ht),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.boxBlock=this.RULE("boxBlock",()=>{this.CONSUME(zl),this.OPTION(()=>this.SUBRULE(this.lineRemainder)),this.AT_LEAST_ONE(()=>this.CONSUME(X)),this.MANY(()=>this.OR([{ALT:()=>this.SUBRULE(this.participantDecl)},{ALT:()=>this.SUBRULE(this.blankLine)}])),this.CONSUME(Ht),this.OR2([{ALT:()=>this.AT_LEAST_ONE2(()=>this.CONSUME2(X))},{ALT:()=>this.CONSUME2(re)}])}),this.lineRemainder=this.RULE("lineRemainder",()=>{this.AT_LEAST_ONE(()=>this.OR([{ALT:()=>this.CONSUME(H)},{ALT:()=>this.CONSUME(en)},{ALT:()=>this.CONSUME(Hi)},{ALT:()=>this.CONSUME(zi)},{ALT:()=>this.CONSUME(ji)},{ALT:()=>this.CONSUME(Wi)},{ALT:()=>this.CONSUME(eo)},{ALT:()=>this.CONSUME(ur)},{ALT:()=>this.CONSUME(yh)},{ALT:()=>this.CONSUME(Eh)},{ALT:()=>this.CONSUME(Rn)},{ALT:()=>this.CONSUME(In)},{ALT:()=>this.CONSUME(Gl)},{ALT:()=>this.CONSUME(Kl)},{ALT:()=>this.CONSUME(jl)},{ALT:()=>this.CONSUME(qi)},{ALT:()=>this.CONSUME(Wl)},{ALT:()=>this.CONSUME(Hl)},{ALT:()=>this.CONSUME(Ql)},{ALT:()=>this.CONSUME(zl)},{ALT:()=>this.CONSUME(Ht)},{ALT:()=>this.CONSUME(_i)},{ALT:()=>this.CONSUME(Ui)},{ALT:()=>this.CONSUME(Pi)},{ALT:()=>this.CONSUME(ql)},{ALT:()=>this.CONSUME(Dl)},{ALT:()=>this.CONSUME($l)},{ALT:()=>this.CONSUME(Mi)},{ALT:()=>this.CONSUME(Bl)},{ALT:()=>this.CONSUME(Ul)},{ALT:()=>this.CONSUME(Pl)},{ALT:()=>this.CONSUME(Yl)},{ALT:()=>this.CONSUME(Vl)},{ALT:()=>this.CONSUME(wn)},{ALT:()=>this.CONSUME(Fl)},{ALT:()=>this.CONSUME(tn)},{ALT:()=>this.CONSUME(rn)},{ALT:()=>this.CONSUME(Cn)},{ALT:()=>this.CONSUME(vn)}]))}),this.performSelfAnalysis()}},nn=new Oh;function Ay(t){return nn.input=t,{cst:nn.diagram(),errors:nn.errors}}var eq=nn.getBaseCstVisitorConstructorWithDefaults(),Ah=class extends eq{constructor(e){super(),this.ctx=e,this.validateVisitor()}};function Ly(t,e){let r={tokens:e},n=new Ah(r),i=[],s=new Map;for(let u of e){let h=u.startLine??1,d=u.startColumn??1,p=s.get(h);(!p||(p.startColumn??1/0)>d)&&s.set(h,u)}for(let u of e)(u.tokenType===_i||u.tokenType===Ui||u.tokenType===Pi)&&s.get(u.startLine??1)===u&&i.push({line:u.startLine??1,column:u.startColumn??1,severity:"error",code:"SE-META-UNSUPPORTED",message:"Title/accTitle/accDescr are not accepted by current Mermaid CLI for sequence diagrams.",hint:"Remove this line (e.g., 'title \u2026') to match mermaid-cli.",length:u.image?.length??5}),u.tokenType===Vs&&s.get(u.startLine??1)===u&&i.push({line:u.startLine??1,column:u.startColumn??1,severity:"error",code:"SE-PROPERTIES-UNSUPPORTED",message:"'properties' is not accepted by current Mermaid CLI for sequence diagrams.",hint:"Remove the 'properties:' line to match mermaid-cli.",length:u.image?.length??10}),u.tokenType===Ys&&s.get(u.startLine??1)===u&&i.push({line:u.startLine??1,column:u.startColumn??1,severity:"error",code:"SE-DETAILS-UNSUPPORTED",message:"'details' is not accepted by current Mermaid CLI for sequence diagrams.",hint:"Remove the 'details:' line to match mermaid-cli.",length:u.image?.length??7});let o=new Map;for(let u of e){if(u.tokenType===X)continue;let h=u.startLine??1;(o.get(h)||o.set(h,[]).get(h)).push(u)}let a=[],c=Array.from(o.entries()).sort((u,h)=>u[0]-h[0]),l=(u,h)=>{let d=[];for(let m=h;m<u.length;m++){let g=u[m];if(g.tokenType===ur||g.tokenType===X||((g.tokenType===H||g.tokenType===Hi||g.tokenType===en||g.tokenType===zi)&&d.push(g.image),g.tokenType===Fi||g.tokenType===Gi||g.tokenType===Ki||g.tokenType===Bi||g.tokenType===$i||g.tokenType===Di))break}return d.join(" ").trim().replace(/^"|"$/g,"")};for(let[u,h]of c){if(h.some(p=>p.tokenType===Cn)){let p=h.findIndex(g=>g.tokenType===Cn),m=l(h,p+1);m&&a.push({kind:"activate",line:u,actor:m});continue}if(h.some(p=>p.tokenType===vn)){let p=h.findIndex(g=>g.tokenType===vn),m=l(h,p+1);m&&a.push({kind:"deactivate",line:u,actor:m});continue}if(h.some(p=>p.tokenType===wn)){let p=h.findIndex(y=>y.tokenType===wn),m=h.slice(p+1),g=m.findIndex(y=>y.tokenType===tn||y.tokenType===rn),x=g>=0?l(m,g+1):l(h,p+1);x&&a.push({kind:"create",line:u,actor:x});continue}let d=h.findIndex(p=>[Fi,Bi,Gi,Ki,Xs,Qs,Zs,Js,$i,Di].includes(p.tokenType));if(d>0){let p=l(h,0),m=l(h,d+1);if(p||m){let g=h.find(y=>y.tokenType===ji),x=h.find(y=>y.tokenType===Wi);a.push({kind:"message",line:u,from:p,to:m,plus:!!g,minus:!!x,plusTok:g,minusTok:x})}}}let f=new Map;for(let u of a)if(u.kind==="activate"&&u.actor){let h=f.get(u.actor)||[];h.push({line:u.line}),f.set(u.actor,h)}else if(u.kind==="deactivate"&&u.actor){let h=f.get(u.actor)||[];h.pop(),f.set(u.actor,h)}else if(u.kind==="message"&&u.to){let h=u.to,d=!!u.plus,p=!!u.minus,m=u.plusTok,g=u.minusTok;if(d){let x=f.get(h)||[];if(x.length>0){let y=m?.startColumn??1;i.push({line:u.line,column:y,severity:"warning",code:"SE-ACTIVATION-ALREADY-ACTIVE",message:`Message indicates '+ (activate)' but '${h}' is already active.`,hint:`Remove '+' or deactivate first: deactivate ${h}`,length:1})}else x.push({line:u.line}),f.set(h,x)}if(p){let x=f.get(h)||[];if(x.length===0){let y=g?.startColumn??1;i.push({line:u.line,column:y,severity:"warning",code:"SE-DEACTIVATE-NO-ACTIVE",message:`Message indicates '- (deactivate)' but '${h}' is not active.`,hint:`Remove '-' or ensure 'activate ${h}' occurred before.`,length:1})}else x.pop(),f.set(h,x)}}for(let[u,h]of f.entries())if(h.length){let d=h[h.length-1];i.push({line:d.line,column:1,severity:"warning",code:"SE-ACTIVATION-UNBALANCED",message:`Unbalanced activation: '${u}' was activated but not deactivated.`,hint:`Add 'deactivate ${u}' after the active section.`,length:u.length})}for(let u=0;u<a.length;u++){let h=a[u];if(h.kind==="create"&&h.actor){let d=a[u+1];d&&d.kind==="message"&&(d.from===h.actor||d.to===h.actor)||i.push({line:h.line,column:1,severity:"warning",code:"SE-CREATE-NO-CREATING-MESSAGE",message:`Actor '${h.actor}' is created but the next line is not a message involving it.`,hint:`Add a creating message to or from '${h.actor}' immediately after the create line.`,length:h.actor.length})}}return i}function by(t,e={}){return lr(t,{tokenize:Xl,parse:Ay,analyze:(r,n)=>Ly(r,n),mapParserError:(r,n)=>gy(r,n),postLex:(r,n)=>{let i=n,o=Ws(i,{code:"SE-LABEL-ESCAPED-QUOTE",message:'Escaped quotes (\\") in names or labels are not supported by Mermaid. Use &quot; instead.',hint:'Example: participant "Logger &quot;debug&quot;" as L'}).map(f=>({...f,severity:e.strict?"error":"warning"})),a=new Map;for(let f of i){let u=f.startLine??1;a.has(u)||a.set(u,[]),a.get(u).push(f)}let c=new Set(o.map(f=>f.line)),l=Ii(i,{code:"SE-LABEL-DOUBLE-IN-DOUBLE",message:"Double quotes inside a double-quoted name/label are not supported. Use &quot; for inner quotes.",hint:'Example: participant "Logger &quot;debug&quot;" as L',scopeEndTokenNames:["Newline"]}).filter(f=>!c.has(f.line)).map(f=>({...f,severity:e.strict?"error":"warning"}));return o.push(...l),o},postParse:(r,n,i,s)=>{let o=[],a=n,c=a.some(d=>d.tokenType===qi),l=a.some(d=>d.tokenType===Rn),f=a.some(d=>d.tokenType===zs),u=a.some(d=>d.tokenType===In);if(s.some(d=>d.severity==="error")){if(!s.some(m=>m.code==="SE-QUOTE-UNCLOSED")){let m=Jr(r,{code:"SE-QUOTE-UNCLOSED",message:"Unclosed quote in participant/actor name.",hint:'Close the quote: participant "Bob"  or  participant Alice as "Alias"',limitPerFile:1});m.length&&o.push(...m.map(g=>({...g,severity:e.strict?"error":"warning"})))}let d=s.some(m=>m.code==="SE-AND-OUTSIDE-PAR"),p=s.some(m=>m.code==="SE-ELSE-OUTSIDE-ALT");if(l&&!c&&!d){let m=a.find(g=>g.tokenType===Rn);o.push({line:m.startLine??1,column:m.startColumn??1,severity:"warning",code:"SE-HINT-PAR-BLOCK-SUGGEST",message:"Found 'and' but no 'par' block in the file.",hint:"Start a parallel section with: par \u2026 and \u2026 end",length:m.image?.length??3})}if(u&&!f&&!p){let m=a.find(g=>g.tokenType===In);o.push({line:m.startLine??1,column:m.startColumn??1,severity:"warning",code:"SE-HINT-ALT-BLOCK-SUGGEST",message:"Found 'else' but no 'alt' block in the file.",hint:"Use: alt Condition \u2026 else \u2026 end",length:m.image?.length??4})}}return o}})}var Ke=O({name:"Identifier",pattern:/[A-Za-z_][A-Za-z0-9_$]*/}),to=O({name:"NumberLiteral",pattern:/[0-9]+/}),Lh=O({name:"ClassDiagramKeyword",pattern:/classDiagram/,longer_alt:Ke}),bh=O({name:"DirectionKw",pattern:/direction/,longer_alt:Ke}),kh=O({name:"Direction",pattern:/LR|RL|TB|BT|TD/,longer_alt:Ke}),ro=O({name:"ClassKw",pattern:/class/,longer_alt:Ke}),Nh=O({name:"AsKw",pattern:/as/,longer_alt:Ke}),Ch=O({name:"NoteKw",pattern:/note/,longer_alt:Ke}),vh=O({name:"ForKw",pattern:/for/,longer_alt:Ke}),wh=O({name:"RelCompToAgg",pattern:/\*--o/}),Ih=O({name:"RelAggToComp",pattern:/o--\*/}),Rh=O({name:"RelCompBoth",pattern:/\*--\*/}),Mh=O({name:"RelAggBoth",pattern:/o--o/}),_h=O({name:"LollipopLeft",pattern:/\(\)--/}),Uh=O({name:"LollipopRight",pattern:/--\(\)/}),no=O({name:"RelExtends",pattern:/<\|--/}),io=O({name:"RelComposition",pattern:/\*--/}),so=O({name:"RelAggregation",pattern:/o--/}),oo=O({name:"RelDependency",pattern:/\.\.>/}),ao=O({name:"RelRealization",pattern:/\.\.\|>/}),lo=O({name:"RelAssociation",pattern:/--/}),Ph=O({name:"RelDependencyLeft",pattern:/<\.\./}),qh=O({name:"RelRealizationLeft",pattern:/<\|\.\./}),Dh=O({name:"RelExtendsRight",pattern:/--\|>/}),$h=O({name:"InvalidRelArrow",pattern:/->(?!>)/}),Bh=O({name:"LCurly",pattern:/\{/}),Fh=O({name:"RCurly",pattern:/\}/}),Zl=O({name:"LParen",pattern:/\(/}),Kh=O({name:"RParen",pattern:/\)/}),vr=O({name:"Colon",pattern:/:/}),Jl=O({name:"Comma",pattern:/,/}),Gh=O({name:"Visibility",pattern:/[+\-#~]/}),co=O({name:"LTlt",pattern:/<</}),ec=O({name:"GTgt",pattern:/>>/}),tc=O({name:"GenericAngle",pattern:/<[^\n\r>]+>/}),Nt=O({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),jh=O({name:"BacktickName",pattern:/`(?:\\.|[^`\\])*`/}),Wh=O({name:"SquareOpen",pattern:/\[/}),Hh=O({name:"SquareClose",pattern:/\]/}),tq=O({name:"Comment",pattern:/%%[^\n\r]*/,group:Q.SKIPPED}),rq=O({name:"WhiteSpace",pattern:/[ \t]+/,group:Q.SKIPPED}),zt=O({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),zh=[tq,Nt,Lh,bh,ro,Nh,Ch,vh,kh,wh,Ih,Rh,Mh,_h,Uh,ao,oo,no,Ph,qh,Dh,io,so,lo,$h,co,ec,tc,Bh,Fh,Zl,Kh,Wh,Hh,vr,Jl,Gh,to,jh,Ke,rq,zt],nq=new Q(zh);function rc(t){return nq.tokenize(t)}var Vh=class extends kt{constructor(){super(zh),this.diagram=this.RULE("diagram",()=>{this.CONSUME(Lh),this.OPTION(()=>this.CONSUME(zt)),this.MANY(()=>this.SUBRULE(this.statement))}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStmt)},{ALT:()=>this.SUBRULE(this.classLine)},{ALT:()=>this.SUBRULE(this.relationStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.memberAssignStmt)},{ALT:()=>this.CONSUME(zt)}])}),this.directionStmt=this.RULE("directionStmt",()=>{this.CONSUME(bh),this.CONSUME(kh),this.OPTION(()=>this.CONSUME(zt))}),this.classLine=this.RULE("classLine",()=>{this.CONSUME(ro),this.SUBRULE(this.classRef),this.OR([{ALT:()=>{this.CONSUME(Bh),this.MANY(()=>{this.OR2([{ALT:()=>this.CONSUME3(zt)},{ALT:()=>this.SUBRULE(this.memberLineStmt)}])}),this.CONSUME(Fh),this.OPTION(()=>this.CONSUME(zt))}},{ALT:()=>{this.OPTION1(()=>{this.CONSUME(Wh),this.CONSUME(Nt),this.CONSUME(Hh)}),this.OPTION2(()=>{this.CONSUME(co),this.CONSUME2(Ke),this.CONSUME(ec)}),this.OPTION3(()=>{this.CONSUME(Nh),this.CONSUME3(Ke)}),this.OPTION4(()=>this.CONSUME2(zt))}}])}),this.memberAssignStmt=this.RULE("memberAssignStmt",()=>{this.SUBRULE(this.classRef),this.CONSUME(vr),this.SUBRULE(this.memberLine),this.OPTION(()=>this.CONSUME(zt))}),this.memberLineStmt=this.RULE("memberLineStmt",()=>{this.SUBRULE(this.memberLine)}),this.memberLine=this.RULE("memberLine",()=>{this.OR([{GATE:()=>this.LA(1).tokenType===co,ALT:()=>{this.CONSUME(co),this.CONSUME(Ke),this.CONSUME(ec)}},{ALT:()=>{this.OPTION(()=>this.CONSUME(Gh)),this.OPTION1({GATE:()=>this.LA(1).tokenType!==Zl,DEF:()=>this.SUBRULE(this.memberName)}),this.OPTION2(()=>{this.CONSUME(Zl),this.OPTION3(()=>this.SUBRULE(this.argList)),this.CONSUME(Kh)}),this.OPTION4(()=>{this.CONSUME(vr),this.SUBRULE(this.typeRef)})}}])}),this.memberName=this.RULE("memberName",()=>{this.OR([{ALT:()=>this.CONSUME(Ke)},{ALT:()=>this.CONSUME(Nt)}])}),this.param=this.RULE("param",()=>{this.OPTION(()=>{this.CONSUME(Ke),this.CONSUME(vr)}),this.SUBRULE(this.typeRef)}),this.argList=this.RULE("argList",()=>{this.SUBRULE(this.param),this.MANY(()=>{this.CONSUME(Jl),this.SUBRULE2(this.param)})}),this.typeRef=this.RULE("typeRef",()=>{this.OR([{ALT:()=>this.CONSUME(Ke)},{ALT:()=>this.CONSUME(to)},{ALT:()=>this.CONSUME(Nt)}])}),this.noteStmt=this.RULE("noteStmt",()=>{this.CONSUME(Ch),this.OPTION(()=>this.CONSUME(vh)),this.SUBRULE(this.classRef),this.OPTION1(()=>this.CONSUME(vr)),this.OR([{ALT:()=>this.CONSUME(Nt)},{ALT:()=>this.CONSUME(Ke)},{ALT:()=>this.CONSUME(to)}]),this.OPTION2(()=>this.CONSUME(zt))}),this.relationOp=this.RULE("relationOp",()=>{this.OR([{ALT:()=>this.CONSUME(wh)},{ALT:()=>this.CONSUME(Ih)},{ALT:()=>this.CONSUME(Rh)},{ALT:()=>this.CONSUME(Mh)},{ALT:()=>this.CONSUME(_h)},{ALT:()=>this.CONSUME(Uh)},{ALT:()=>this.CONSUME(no)},{ALT:()=>this.CONSUME(Dh)},{ALT:()=>this.CONSUME(io)},{ALT:()=>this.CONSUME(so)},{ALT:()=>this.CONSUME(ao)},{ALT:()=>this.CONSUME(oo)},{ALT:()=>this.CONSUME(qh)},{ALT:()=>this.CONSUME(Ph)},{ALT:()=>this.CONSUME(lo)}])}),this.classRef=this.RULE("classRef",()=>{this.OR([{ALT:()=>{this.CONSUME(Ke),this.OPTION(()=>this.CONSUME(tc))}},{ALT:()=>this.CONSUME(Nt)},{ALT:()=>this.CONSUME(jh)}])}),this.labelText=this.RULE("labelText",()=>{this.OR([{ALT:()=>this.CONSUME(Nt)},{ALT:()=>this.CONSUME(Ke)},{ALT:()=>this.CONSUME(to)},{ALT:()=>this.CONSUME(tc)}])}),this.relationStmt=this.RULE("relationStmt",()=>{this.SUBRULE(this.classRef),this.OPTION1(()=>this.CONSUME(Nt,{LABEL:"leftCard"})),this.SUBRULE(this.relationOp),this.OPTION2(()=>this.CONSUME2(Nt,{LABEL:"rightCard"})),this.SUBRULE2(this.classRef),this.OPTION3(()=>{this.CONSUME(vr),this.AT_LEAST_ONE_SEP({SEP:Jl,DEF:()=>this.SUBRULE(this.labelText)})}),this.OPTION4(()=>this.CONSUME(zt))}),this.performSelfAnalysis()}},Vi=new Vh;function Ny(t){return Vi.input=t,{cst:Vi.diagram(),errors:Vi.errors}}function Cy(t,e){return[]}function vy(t,e={}){return lr(t,{tokenize:rc,parse:Ny,analyze:Cy,mapParserError:xy,postLex:(r,n)=>{let i=[],s=n;for(let o=0;o<s.length-1;o++){let a=s[o],c=s[o+1];a.tokenType===ro&&c.tokenType===Nt&&i.push({line:c.startLine??1,column:c.startColumn??1,severity:"error",code:"CL-NAME-DOUBLE-QUOTED",message:"Double-quoted class name is not supported. Use backticks for names with spaces/punctuation, or use a label.",hint:'Example: class `Logger "core"` as L  or  class L["Logger "core""]',length:c.image?.length??1})}for(let o of s)o.tokenType===$h&&i.push({line:o.startLine??1,column:o.startColumn??1,severity:"error",code:"CL-REL-INVALID",message:"Invalid relationship operator '->'. Use <|--, *--, o--, --, ..> or ..|>.",hint:"Example: Foo <|-- Bar",length:o.image?.length??2});for(let o=0;o<s.length;o++){let a=s[o];if(!(a.tokenType===no||a.tokenType===io||a.tokenType===so||a.tokenType===oo||a.tokenType===ao||a.tokenType===lo))continue;let l=a.startLine??-1,f=o+1,u=null,h=!1;for(;f<s.length;){let d=s[f];if((d.startLine??-1)!==l)break;if(d.tokenType===Ke||d.tokenType===Nt){h=!0;break}if(d.tokenType===vr){u=d;break}f++}u&&!h&&i.push({line:l,column:u.startColumn??1,severity:"error",code:"CL-REL-MALFORMED",message:"Malformed relationship. Provide a target class before the label.",hint:"Use: A <|-- B : label",length:u.image?.length??1})}return i},postParse:(r,n,i,s)=>{let o=[],a=(f,u)=>(s||[]).some(h=>h.code===f&&h.line===u&&h.severity==="error"),c=r.split(/\r?\n/),l=[];for(let f=0;f<c.length;f++){let u=c[f]||"";/^\s*class\b.*\{\s*$/.test(u)&&l.push(f+1)}if(l.length>0&&!c.some(u=>/\}/.test(u))&&!a("CL-BLOCK-MISSING-RBRACE",Math.max(1,c.length))){let u=l[l.length-1];o.push({line:Math.max(1,c.length),column:1,severity:"error",code:"CL-BLOCK-MISSING-RBRACE",message:"Missing '}' to close class block.",hint:"Close the block: class Foo { ... }"})}return o}})}var Oe=O({name:"Identifier",pattern:/[A-Za-z_][A-Za-z0-9_]*/}),uo=O({name:"NumberLiteral",pattern:/[0-9]+/}),Yh=O({name:"StateDiagramV2",pattern:/stateDiagram-v2/}),Qh=O({name:"StateDiagram",pattern:/stateDiagram/,longer_alt:Oe}),nc=O({name:"StateKw",pattern:/state/,longer_alt:Oe}),Xh=O({name:"AsKw",pattern:/as/,longer_alt:Oe}),Zh=O({name:"DirectionKw",pattern:/direction/,longer_alt:Oe}),Jh=O({name:"Direction",pattern:/LR|RL|TB|BT|TD/,longer_alt:Oe}),ho=O({name:"NoteKw",pattern:/note/i,longer_alt:Oe}),ef=O({name:"LeftKw",pattern:/left/,longer_alt:Oe}),tf=O({name:"RightKw",pattern:/right/,longer_alt:Oe}),ic=O({name:"OfKw",pattern:/of/,longer_alt:Oe}),rf=O({name:"OverKw",pattern:/over/,longer_alt:Oe}),sc=O({name:"AngleAngleOpen",pattern:/<</}),oc=O({name:"AngleAngleClose",pattern:/>>/}),nf=O({name:"Dashes",pattern:/---+/}),sf=O({name:"StyleClassDefKw",pattern:/classDef/,longer_alt:Oe}),of=O({name:"StyleClassKw",pattern:/class(?!Diagram)/,longer_alt:Oe}),af=O({name:"Start",pattern:/\[\*\]/}),lf=O({name:"HistoryShallow",pattern:/\[H\]/}),cf=O({name:"HistoryDeep",pattern:/\[H\*\]/}),uf=O({name:"Arrow",pattern:/-->/}),hf=O({name:"InvalidArrow",pattern:/->(?!>)/}),ff=O({name:"Hyphen",pattern:/-/}),df=O({name:"LCurly",pattern:/\{/}),pf=O({name:"RCurly",pattern:/\}/}),fo=O({name:"Colon",pattern:/:/}),mf=O({name:"Comma",pattern:/,/}),hr=O({name:"QuotedString",pattern:/"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/}),iq=O({name:"Comment",pattern:/%%[^\n\r]*/,group:Q.SKIPPED}),sq=O({name:"WhiteSpace",pattern:/[ \t]+/,group:Q.SKIPPED}),Ot=O({name:"Newline",pattern:/[\n\r]+/,line_breaks:!0}),Mn=O({name:"LabelChunk",pattern:/[^\n\r<\-][^\n\r]*/}),gf=[iq,hr,Yh,Qh,nc,Xh,Zh,Jh,ho,ef,tf,ic,rf,sc,oc,af,cf,lf,uf,hf,nf,ff,sf,of,df,pf,fo,mf,uo,Oe,sq,Mn,Ot],oq=new Q(gf);function ac(t){return oq.tokenize(t)}var xf=class extends kt{constructor(){super(gf),this.diagram=this.RULE("diagram",()=>{this.OR([{ALT:()=>this.CONSUME(Yh)},{ALT:()=>this.CONSUME(Qh)}]),this.OPTION(()=>this.CONSUME(Ot)),this.MANY(()=>this.SUBRULE(this.statement))}),this.statement=this.RULE("statement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStmt)},{ALT:()=>this.SUBRULE(this.transitionStmt)},{ALT:()=>this.SUBRULE(this.stateBlock)},{ALT:()=>this.SUBRULE(this.stateDecl)},{ALT:()=>this.SUBRULE(this.stateDescriptionStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.styleStmt)},{ALT:()=>this.CONSUME(Ot)}])}),this.styleStmt=this.RULE("styleStmt",()=>{this.OR([{ALT:()=>{this.CONSUME(sf),this.OPTION1(()=>this.CONSUME1(Mn))}},{ALT:()=>{this.CONSUME(of),this.OPTION2(()=>this.CONSUME2(Mn))}}]),this.OPTION3(()=>this.CONSUME(Ot))}),this.directionStmt=this.RULE("directionStmt",()=>{this.CONSUME(Zh),this.CONSUME(Jh),this.OPTION(()=>this.CONSUME(Ot))}),this.actorRef=this.RULE("actorRef",()=>{this.OR([{ALT:()=>this.CONSUME(af)},{ALT:()=>this.CONSUME(cf)},{ALT:()=>this.CONSUME(lf)},{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Oe)},{ALT:()=>this.CONSUME(hr)}]),this.OPTION(()=>{this.CONSUME(sc),this.CONSUME2(Oe),this.CONSUME(oc)})}}])}),this.labelText=this.RULE("labelText",()=>{this.OR([{ALT:()=>this.CONSUME(hr)},{ALT:()=>this.CONSUME(Oe)},{ALT:()=>this.CONSUME(uo)},{ALT:()=>this.CONSUME(ff)},{ALT:()=>this.CONSUME(Mn)}])}),this.transitionStmt=this.RULE("transitionStmt",()=>{this.SUBRULE(this.actorRef),this.CONSUME(uf),this.SUBRULE2(this.actorRef),this.OPTION(()=>{this.CONSUME(fo),this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(hr)},{ALT:()=>this.CONSUME(Oe)},{ALT:()=>this.CONSUME(uo)},{ALT:()=>this.CONSUME(Mn)}])})}),this.OPTION2(()=>this.CONSUME(Ot))}),this.stateDecl=this.RULE("stateDecl",()=>{this.CONSUME(nc),this.OR([{GATE:()=>this.LA(1).tokenType===hr,ALT:()=>{this.CONSUME(hr),this.CONSUME(Xh),this.CONSUME(Oe)}},{ALT:()=>{this.CONSUME2(Oe),this.OPTION1(()=>{this.CONSUME(sc),this.CONSUME3(Oe),this.CONSUME(oc)})}}]),this.OPTION2(()=>this.CONSUME(Ot))}),this.stateBlock=this.RULE("stateBlock",()=>{this.CONSUME(nc),this.OR([{ALT:()=>this.CONSUME(Oe)},{ALT:()=>this.CONSUME(hr)}]),this.CONSUME(df),this.MANY(()=>this.SUBRULE(this.innerStatement)),this.CONSUME(pf),this.OPTION(()=>this.CONSUME(Ot))}),this.innerStatement=this.RULE("innerStatement",()=>{this.OR([{ALT:()=>this.SUBRULE(this.directionStmt)},{ALT:()=>this.SUBRULE(this.transitionStmt)},{ALT:()=>this.SUBRULE(this.stateBlock)},{ALT:()=>this.SUBRULE(this.stateDecl)},{ALT:()=>this.CONSUME(nf)},{ALT:()=>this.SUBRULE(this.stateDescriptionStmt)},{ALT:()=>this.SUBRULE(this.noteStmt)},{ALT:()=>this.SUBRULE(this.styleStmt)},{ALT:()=>this.CONSUME(Ot)}])}),this.noteStmt=this.RULE("noteStmt",()=>{this.CONSUME(ho),this.OR([{ALT:()=>{this.CONSUME(ef),this.CONSUME(ic),this.SUBRULE(this.actorRef)}},{ALT:()=>{this.CONSUME(tf),this.CONSUME2(ic),this.SUBRULE2(this.actorRef)}},{ALT:()=>{this.CONSUME(rf),this.SUBRULE3(this.actorRef),this.OPTION1(()=>{this.CONSUME(mf),this.SUBRULE4(this.actorRef)})}}]),this.CONSUME(fo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.labelText)),this.OPTION2(()=>this.CONSUME(Ot))}),this.stateDescriptionStmt=this.RULE("stateDescriptionStmt",()=>{this.OR1([{ALT:()=>this.CONSUME1(Oe)},{ALT:()=>this.CONSUME1(hr)}]),this.CONSUME(fo),this.AT_LEAST_ONE(()=>{this.OR2([{ALT:()=>this.CONSUME2(hr)},{ALT:()=>this.CONSUME2(Oe)},{ALT:()=>this.CONSUME1(uo)},{ALT:()=>this.CONSUME1(Mn)}])}),this.OPTION(()=>this.CONSUME(Ot))}),this.performSelfAnalysis()}},Yi=new xf;function Iy(t){return Yi.input=t,{cst:Yi.diagram(),errors:Yi.errors}}function Ry(t,e){return[]}function My(t,e={}){return lr(t,{tokenize:ac,parse:Iy,analyze:Ry,mapParserError:yy,postLex:(r,n)=>{let i=[],s=n;for(let o=0;o<s.length;o++){let a=s[o];a.tokenType===hf&&i.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"ST-ARROW-INVALID",message:"Invalid arrow '->'. Use '-->' in state transitions.",hint:"Example: A --> B : event",length:a.image?.length??2})}for(let o=0;o<s.length;o++){let a=s[o];if(a.tokenType===ho){let c=s[o-1];c&&c.tokenType!==Ot&&c.startLine===a.startLine&&i.push({line:a.startLine??1,column:a.startColumn??1,severity:"error",code:"ST-NOTE-GLUED",message:"'Note' must start on a new line (not glued to the previous statement).",hint:"Put 'Note \u2026' on its own line: Note right of Auth: \u2026",length:a.image?.length??4})}}return i},postParse:(r,n,i,s)=>{let o=[],a=(d,p)=>(s||[]).some(m=>m.code===d&&m.line===p&&m.severity==="error")||o.some(m=>m.code===d&&m.line===p),c=r.split(/\r?\n/),l=[];for(let d=0;d<c.length;d++){let p=c[d]||"",m=d+1;if(/^\s*state\b.*\{\s*$/.test(p)&&l.push(m),/^\s*Note\b/i.test(p)&&!/:/.test(p)){let g=p.length-p.trimStart().length;if(p.replace(/^\s*Note\s+(left|right)\s+of\s+[^:]+/i,"").replace(/^\s*Note\s+over\s+[^:]+/i,"")!==p){if(p.indexOf(":")===-1){let E=/(Note\s+(left|right)\s+of\s+[^:]+|Note\s+over\s+[^:]+)/i.exec(p),T=E?E.index+(E[0]?.length||0)+1:1;a("ST-NOTE-MALFORMED",m)||o.push({line:m,column:T,severity:"error",code:"ST-NOTE-MALFORMED",message:"Malformed note: missing colon before note text.",hint:"Example: Note right of A: message"})}}}}l.length>0&&!c.some(p=>/\}/.test(p))&&!a("ST-BLOCK-MISSING-RBRACE",Math.max(1,c.length))&&o.push({line:Math.max(1,c.length),column:1,severity:"error",code:"ST-BLOCK-MISSING-RBRACE",message:"Missing '}' to close a state block.",hint:"Close the block: state Foo { ... }"});let f=[],u=d=>f.push({start:d,content:[],seps:[]}),h=()=>f[f.length-1];for(let d=0;d<c.length;d++){let p=c[d]||"",m=d+1;if(/^\s*state\b.*\{\s*$/.test(p)){u(m);continue}if(/^\s*\}\s*$/.test(p)){let g=f.pop();if(g){let x=[...g.content.map(E=>({ln:E,kind:"content"})),...g.seps.map(E=>({ln:E,kind:"sep"}))].sort((E,T)=>E.ln-T.ln),y=x.map((E,T)=>({i:T,x:E})).filter(E=>E.x.kind==="sep").map(E=>E.i);for(let E of y){let T=x[E].ln,A=!1;for(let k=E-1;k>=0&&x[k].kind!=="sep";k--)if(x[k].kind==="content"){A=!0;break}let L=!1;for(let k=E+1;k<x.length&&x[k].kind!=="sep";k++)if(x[k].kind==="content"){L=!0;break}(!A||!L)&&o.push({line:T,column:1,severity:"error",code:"ST-CONCURRENCY-MISPLACED",message:"Concurrency separator '---' must be between regions, not at the start or end of a block.",hint:"Place '---' between two sets of state lines inside the same block."})}}continue}f.length>0&&(/^\s*---\s*$/.test(p)?(h().seps.push(m),a("ST-CONCURRENCY-UNSUPPORTED",m)||o.push({line:m,column:1,severity:"error",code:"ST-CONCURRENCY-UNSUPPORTED",message:"Concurrency separator '---' is not supported by Mermaid CLI in state diagrams.",hint:"Remove '---' or split logic into separate composite states."})):p.trim()!==""&&h().content.push(m))}return o}})}function _y(t){let e=t.split(/\r?\n/);for(let r of e){let n=r.trim();if(n&&!n.startsWith("%%"))return n}}function Uy(t){let e=_y(t);return e?/^(flowchart|graph)\b/i.test(e)?"flowchart":/^pie\b/i.test(e)?"pie":/^sequenceDiagram\b/i.test(e)?"sequence":/^classDiagram\b/.test(e)?"class":/^stateDiagram(?:-v2)?\b/.test(e)?"state":"unknown":"unknown"}function aq(t){if(!t)return!1;let r=/^(\w[\w-]*)/.exec(t)?.[1]||"";return new Set(["classDiagram","stateDiagram","stateDiagram-v2","erDiagram","journey","userJourney","gantt","gitGraph","mindmap","timeline","quadrantChart","xychart","xychart-beta","xyChart","sankey","sankey-beta","requirementDiagram","C4Context","C4Container","C4Component","C4Deployment","C4Dynamic","block","block-beta","blockDiagram","treemap","treemap-beta"]).has(r)}function lc(t,e={}){let r=Uy(t);switch(r){case"flowchart":return{type:r,errors:Ey(t,e)};case"pie":return{type:r,errors:Oy(t,e)};case"sequence":return{type:r,errors:by(t,e)};case"class":return{type:r,errors:vy(t,e)};case"state":return{type:r,errors:My(t,e)};default:let n=_y(t);return aq(n)?{type:r,errors:[]}:{type:r,errors:[{line:1,column:1,message:'Diagram must start with "graph", "flowchart", "pie", "sequenceDiagram", "classDiagram" or "stateDiagram[-v2]"',severity:"error",code:"GEN-HEADER-INVALID",hint:"Start with: flowchart TD | pie | sequenceDiagram | classDiagram | stateDiagram-v2."}]}}}function qy(t){return t.split(/\r?\n/)}function Py(t,e){let r=qy(t),n=Math.max(0,Math.min(r.length-1,e.line-1)),i=r[n]??"",s=Math.max(1,e.column),o=0;for(let a=0;a<n;a++)o+=(r[a]?.length??0)+1;return o+=Math.min(i.length,s-1),o}function yf(t,e){if(!e||e.length===0)return t;let r=e.map(i=>{let s=Py(t,i.start),o=i.end?Py(t,i.end):s;return{startOff:s,endOff:o,newText:i.newText}}).sort((i,s)=>s.startOff-i.startOff),n=t;for(let i of r)n=n.slice(0,i.startOff)+i.newText+n.slice(i.endOff);return n}function Ve(t,e,r,n){return{start:e,end:{line:e.line,column:e.column+Math.max(0,r)},newText:n}}function Ae(t,e,r){return{start:e,newText:r}}function pe(t,e){let r=qy(t);return r[Math.max(0,Math.min(r.length-1,e-1))]??""}function sn(t){let e=/^(\s*)/.exec(t);return e&&e[1]||""}function st(t){return{line:t.line,column:t.column}}function z(t,e){return e.code===t}function Ef(t,e,r="safe"){let n=[],i=new Set,s=new Set,o=new Set;for(let l of e){let f=`${l.code}@${l.line}:${l.column}:${l.length??1}`;if(!s.has(f)){if(s.add(f),z("FL-ARROW-INVALID",l)){n.push(Ve(t,st(l),l.length??2,"-->"));continue}if(z("FL-EDGE-LABEL-QUOTED",l)){let u=pe(t,l.line),h=Math.max(0,l.column-1),d=u.indexOf('"',h);if(d!==-1){let p=u.indexOf('"',d+1);if(p!==-1){let m=u.slice(d+1,p),g=u.slice(0,d).trim(),x=u.slice(p+1).trim(),y="--",E="-->";g.endsWith("==")?(y="==",E="==>"):g.endsWith("-.-")?(y="-.-",E=".->"):g.endsWith("-.")&&(y="-.",E=".->");let A=u.slice(0,d).lastIndexOf(y);if(A===-1)continue;let L=u.slice(0,A),k=x;k.startsWith("-->")||k.startsWith("==>")||k.startsWith(".->")?k=k.slice(3).trim():k.startsWith("->")&&(k=k.slice(2).trim()),k&&!k.startsWith(" ")&&(k=" "+k);let N=`${L}${y}|${m}|${E}${k}`;n.push({start:{line:l.line,column:1},end:{line:l.line,column:u.length+1},newText:N})}}continue}if(z("CL-NAME-DOUBLE-QUOTED",l)){let u=pe(t,l.line),h=u.indexOf("class"),d=h>=0?h+5:0,p=u.indexOf('"',d);if(p!==-1){let m=u.indexOf(" as ",p+1),g=m!==-1?u.lastIndexOf('"',m-1):u.lastIndexOf('"');if(g>p)if(m!==-1){let y='"'+u.slice(p+1,g).replace(/\"/g,'"').replace(/"/g,"&quot;")+'"',E=u.slice(m+4).trim(),A=`${u.slice(0,d).trimEnd()} ${E}[${y}]`;n.push({start:{line:l.line,column:1},end:{line:l.line,column:u.length+1},newText:A})}else n.push(Ve(t,{line:l.line,column:p+1},1,"`")),n.push(Ve(t,{line:l.line,column:g+1},1,"`"))}continue}if(z("FL-LABEL-ESCAPED-QUOTE",l)){let u=pe(t,l.line),h=Math.max(0,l.column-1),p=[{tok:"[[",idx:u.lastIndexOf("[[",h),delta:2},{tok:"{",idx:u.lastIndexOf("{",h),delta:1},{tok:"[",idx:u.lastIndexOf("[",h),delta:1},{tok:"((",idx:u.lastIndexOf("((",h),delta:2}].filter(m=>m.idx!==-1).sort((m,g)=>m.idx-g.idx).pop();if(p){let m=[u.indexOf("]]",h),u.indexOf("}",h),u.indexOf("]",h),u.indexOf("))",h)].filter(x=>x!==-1).sort((x,y)=>x-y),g=m.length?m[0]:-1;if(g!==-1){let x=u.indexOf('"',p.idx+p.delta),y=u.lastIndexOf('"',g-1);if(x!==-1&&y!==-1&&y>x){let E=u.slice(x+1,y);if(E.includes('\\"')){let T=E.split('\\"').join("&quot;");n.push({start:{line:l.line,column:x+2},end:{line:l.line,column:y+1},newText:T});continue}}}}n.push(Ve(t,st(l),l.length??2,"&quot;"));continue}if(z("FL-LABEL-BACKTICK",l)){n.push(Ve(t,st(l),l.length??1,""));continue}if(z("FL-LABEL-DOUBLE-IN-DOUBLE",l)){let u=pe(t,l.line),h=Math.max(0,l.column-1),p=[{tok:"[[",idx:u.lastIndexOf("[[",h)},{tok:"((",idx:u.lastIndexOf("((",h)},{tok:"{",idx:u.lastIndexOf("{",h)},{tok:"(",idx:u.lastIndexOf("(",h)},{tok:"[",idx:u.lastIndexOf("[",h)}].sort((g,x)=>(g.idx||-1)-(x.idx||-1)).pop(),m=p&&p.idx>=0?p.idx:-1;if(m>=0){let x=[{tok:"]]",idx:u.indexOf("]]",h)},{tok:"))",idx:u.indexOf("))",h)},{tok:"}",idx:u.indexOf("}",h)},{tok:")",idx:u.indexOf(")",h)},{tok:"]",idx:u.indexOf("]",h)}].filter(A=>A.idx!==-1).sort((A,L)=>A.idx-L.idx)[0],y=x?x.idx:u.length,E=u.indexOf('"',m+1),T=u.lastIndexOf('"',y-1);if(E!==-1&&T!==-1&&T>E){let A=u.slice(E+1,T),L=A.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");if(L!==A){let k={line:l.line,column:E+2},N={line:l.line,column:T+1};n.push({start:k,end:N,newText:L});continue}}}n.push(Ve(t,st(l),l.length??1,"&quot;"));continue}if(z("FL-LABEL-DOUBLE-IN-SINGLE",l)){let u=pe(t,l.line),h=Math.max(0,l.column-1),d=u.lastIndexOf("'",h),p=u.indexOf("'",Math.max(h+1,d+1));if(d!==-1&&p!==-1&&p>d){let m=u.slice(d+1,p),g=m.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");if(g!==m){let x={line:l.line,column:d+2},y={line:l.line,column:p+1};n.push({start:x,end:y,newText:g}),i.add(l.line);continue}}if(i.has(l.line))continue;n.push(Ve(t,st(l),l.length??1,"&quot;"));continue}if(z("FL-NODE-MIXED-BRACKETS",l)){let u=l.message||"",h=pe(t,l.line),d=Math.max(0,l.column-1);if(u.includes("opened '('")&&u.includes("closed with ']'")){let m=h.lastIndexOf("(",d);if(m!==-1){n.push({start:{line:l.line,column:m+1},end:{line:l.line,column:m+2},newText:"["});continue}}let p=")";u.includes("opened '['")?p="]":u.includes("opened '('")?p=")":u.includes("opened '{'")?p="}":u.includes("opened '[[ '")?p="]]":u.includes("opened '(( '")&&(p="))"),n.push(Ve(t,st(l),l.length??1,p));continue}if(z("FL-NODE-EMPTY",l)){let u=pe(t,l.line),h=Math.max(0,l.column-1),d=u[h]==="["?h:u.lastIndexOf("[",h);if(d>=0){let p=u.indexOf("]",Math.max(d+1,h));if(p!==-1){let m={line:l.line,column:d+1},g=p-d+1;n.push(Ve(t,m,g,""))}}continue}if(z("FL-DIR-KW-INVALID",l)){n.push(Ve(t,st(l),l.length??0,"direction"));continue}if(z("FL-DIR-MISSING",l)){(r==="safe"||r==="all")&&n.push(Ae(t,st(l)," TD"));continue}if(z("FL-LINK-MISSING",l)){if(r==="all"){let u=l.line,h=pe(t,u);if(!/-->/.test(h)){let d="(?:\\[[^\\]]*\\]|\\([^\\)]*\\)|\\{[^}]*\\}|\\[\\[[^\\]]*\\]\\]|\\(\\([^\\)]*\\)\\))?",p="[A-Za-z0-9_]+",g=new RegExp(`^\\s*(${p}${d})\\s+(${p})`).exec(h);if(g){let E=g[0].length-g[2].length+1;n.push(Ae(t,{line:u,column:E}," --> "))}else n.push(Ae(t,st(l)," --> "))}}continue}if(z("FL-NODE-UNCLOSED-BRACKET",l)){if(r==="safe"||r==="all"){let u=pe(t,l.line),h=Math.max(0,l.column-1),p=(l.message||"").match(/Unclosed '(.+?)'/),m=p?p[1]:null,x=m?{"[":"]","{":"}","(":")","[[":"]]","{{":"}}","((":"))","([":"])","[(":")]"}[m]:null,y=null;if(m&&x){let L=u.lastIndexOf(m,h);L!==-1&&(y={open:m,close:x,idx:L,len:m.length})}if(!y&&(y=[{open:"{{",close:"}}",idx:u.lastIndexOf("{{",h),len:2},{open:"[[",close:"]]",idx:u.lastIndexOf("[[",h),len:2},{open:"([",close:"])",idx:u.lastIndexOf("([",h),len:2},{open:"[(",close:")]",idx:u.lastIndexOf("[(",h),len:2},{open:"{",close:"}",idx:u.lastIndexOf("{",h),len:1},{open:"(",close:")",idx:u.lastIndexOf("(",h),len:1},{open:"[",close:"]",idx:u.lastIndexOf("[",h),len:1}].filter(k=>k.idx!==-1).sort((k,N)=>k.idx-N.idx).pop()||null,y)){if(y.open==="{"){let k=u.lastIndexOf("{{",h);k!==-1&&k+1===y.idx&&(y={open:"{{",close:"}}",idx:k,len:2})}else if(y.open==="["){let k=u.lastIndexOf("[[",h),N=u.lastIndexOf("[(",h);k!==-1&&k===y.idx?y={open:"[[",close:"]]",idx:k,len:2}:N!==-1&&N===y.idx&&(y={open:"[(",close:")]",idx:N,len:2})}else if(y.open==="("){let k=u.lastIndexOf("((",h),N=u.lastIndexOf("([",h),v=u.lastIndexOf("[(",h);k!==-1&&k===y.idx?y={open:"((",close:"))",idx:k,len:2}:N!==-1&&N===y.idx-1?y={open:"([",close:"])",idx:N,len:2}:v!==-1&&v===y.idx-1&&(y={open:"[(",close:")]",idx:v,len:2})}}if(y){let L=u.indexOf(y.close,h);if(L!==-1){let k=u.slice(y.idx+y.len,L);if(process.env.DEBUG_FIXES&&(console.log("DEBUG FL-NODE-UNCLOSED-BRACKET:"),console.log("  opened.idx:",y.idx,"opened.len:",y.len,"opened.open:",y.open,"opened.close:",y.close),console.log("  closerIdx:",L),console.log("  innerSeg:",k),console.log("  caret0:",h,"lineText[caret0]:",u[h])),k.includes('"')||k.includes("'")){let N=k.match(/^\s*/)?.[0]??"",v=k.match(/\s*$/)?.[0]??"",R=k.slice(N.length,k.length-v.length),b=R.slice(0,1),w=R.slice(-1),C=(P,q)=>P==="/"&&q==="/"||P==="\\"&&q==="\\"||P==="/"&&q==="\\"||P==="\\"&&q==="/",I;if(R.length>=2&&C(b,w)){let q=R.slice(1,-1).split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");I=N+b+q+w+v}else I='"'+k.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;")+'"';n.push({start:{line:l.line,column:y.idx+y.len+1},end:{line:l.line,column:L+1},newText:I}),i.add(l.line);continue}}}if(i.has(l.line))continue;let E="]";y&&(E=y.close);let T=u.slice(h),A=Math.min(E.length,Math.max(1,T.length));n.push({start:{line:l.line,column:h+1},end:{line:l.line,column:h+1+A},newText:E})}continue}if(z("FL-QUOTE-UNCLOSED",l)){if(r==="all"){let u=pe(t,l.line),h=Math.max(0,l.column-1);if((u.replace(/\\\"/g,"").match(/\"/g)||[]).length%2===1){let m=[],g=x=>{x>=0&&m.push({idx:x})};if(g(u.indexOf("]]",h)),g(u.indexOf("))",h)),g(u.indexOf("}",h)),g(u.indexOf("]",h)),g(u.indexOf(")",h)),m.length){let x=m.reduce((E,T)=>E.idx!==-1&&E.idx<=T.idx?E:T),y=(x.idx>=0?x.idx:u.length)+1;n.push(Ae(t,{line:l.line,column:y},'"'))}}}continue}if(z("FL-LABEL-QUOTE-IN-UNQUOTED",l)){if(r==="safe"||r==="all"){let u=pe(t,l.line),h=Math.max(0,l.column-1),p=[{open:"[[",close:"]]",idx:u.lastIndexOf("[[",h),delta:2},{open:"((",close:"))",idx:u.lastIndexOf("((",h),delta:2},{open:"{",close:"}",idx:u.lastIndexOf("{",h),delta:1},{open:"[",close:"]",idx:u.lastIndexOf("[",h),delta:1}].filter(m=>m.idx!==-1).sort((m,g)=>m.idx-g.idx).pop();if(p){let m=p.idx+p.delta,g=u.indexOf(p.close,Math.max(h,m));if(g!==-1){let x=u.slice(m,g),y=x.match(/^\s*/)?.[0]??"",E=x.match(/\s*$/)?.[0]??"",T=x.slice(y.length,x.length-E.length),A=T.slice(0,1),L=T.slice(-1),k=(v,R)=>v==="/"&&R==="/"||v==="\\"&&R==="\\"||v==="/"&&R==="\\"||v==="\\"&&R==="/",N;if(T.length>=2&&k(A,L)){let R=T.slice(1,-1).split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");N=y+A+R+L+E}else N='"'+x.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;")+'"';n.push({start:{line:l.line,column:m+1},end:{line:l.line,column:g+1},newText:N}),i.add(l.line)}}}continue}if(z("FL-LABEL-PARENS-UNQUOTED",l)){if(r==="safe"||r==="all"){if(i.has(l.line))continue;let u=pe(t,l.line),h=Math.max(0,l.column-1),d=[{open:"{{",close:"}}"},{open:"[[",close:"]]"},{open:"((",close:"))"},{open:"([",close:"])"},{open:"[(",close:")]"},{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"}];for(let p of d){let m=0;for(;;){let g=u.indexOf(p.open,m);if(g===-1)break;let x=g+p.open.length,y=u.indexOf(p.close,x);if(y===-1)break;if(g<=h&&h<y){let E=u.slice(x,y),T=E.trim();if(T.startsWith('"')&&T.endsWith('"')||p.open==="("&&(h===g||h===y-1))break;let A=E.match(/^\s*/)?.[0]??"",L=E.match(/\s*$/)?.[0]??"",k=E.slice(A.length,E.length-L.length),N=k.slice(0,1),v=k.slice(-1),R=(w,C)=>w==="/"&&C==="/"||w==="\\"&&C==="\\"||w==="/"&&C==="\\"||w==="\\"&&C==="/";if(k.length>=2&&R(N,v))break;let b='"'+E+'"';n.push({start:{line:l.line,column:x+1},end:{line:l.line,column:y+1},newText:b}),i.add(l.line);break}m=g+1}if(i.has(l.line))break}}continue}if(z("PI-LABEL-ESCAPED-QUOTE",l)){n.push(Ve(t,st(l),l.length??1,"&quot;"));continue}if(z("PI-MISSING-COLON",l)){n.push(Ae(t,st(l)," : "));continue}if(z("PI-LABEL-DOUBLE-IN-DOUBLE",l)){let u=pe(t,l.line),h=u.indexOf('"'),d=u.indexOf(":"),p=d!==-1?u.lastIndexOf('"',d-1):u.lastIndexOf('"');if(h!==-1&&p!==-1&&p>h){let m=u.slice(h+1,p),g=m.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");g!==m&&n.push({start:{line:l.line,column:h+2},end:{line:l.line,column:p+1},newText:g})}continue}if(z("PI-LABEL-REQUIRES-QUOTES",l)){let u=pe(t,l.line),h=u.indexOf(":");if(h>0){let d=u.slice(0,h),p=d.search(/\S/),m=d.replace(/\s+$/,"").length;p>=0&&m>p&&(n.push(Ae(t,{line:l.line,column:p+1},'"')),n.push(Ae(t,{line:l.line,column:m+1},'"')))}continue}if(z("PI-QUOTE-UNCLOSED",l)){if(r==="all"){if(o.has(l.line))continue;let u=pe(t,l.line),h=u.indexOf(":"),d=h>0?h+1:u.length+1;n.push(Ae(t,{line:l.line,column:d},'"')),o.add(l.line)}continue}if(z("SE-MSG-COLON-MISSING",l)){let u=pe(t,l.line),h=["<<-->>","<<->>","-->>","->>","-->","->","--x","-x","--)","-)"],d=-1,p=0;for(let m of h){let g=u.indexOf(m);g!==-1&&(d===-1||g<d)&&(d=g,p=m.length)}if(d!==-1){let m=d+p;for((u[m]==="+"||u[m]==="-")&&m++;m<u.length&&/\s/.test(u[m]);)m++;let g=m;if(u[m]==='"'||u[m]==="'"){let E=u[m];for(g=m+1;g<u.length;){if(u[g]==="\\"){g+=2;continue}if(u[g]===E){g++;break}g++}}else for(;g<u.length&&!/\s/.test(u[g])&&u[g]!==":";)g++;let x=g+1;(u[g]||"")===" "?n.push(Ve(t,{line:l.line,column:x},1," : ")):n.push(Ae(t,{line:l.line,column:x}," : "))}else n.push(Ae(t,st(l),": "));continue}if(z("SE-NOTE-MALFORMED",l)){let u=pe(t,l.line),h=/^(\s*)Note\s+(left|right)\s+of\s+(.+?)\s+(.+)$/.exec(u),d=/^(\s*)Note\s+over\s+(.+?)\s+(.+)$/.exec(u),p=l.column;h?p=`${h[1]||""}Note ${h[2]} of ${h[3]}`.length+1:d&&(p=`${d[1]||""}Note over ${d[2]}`.length+1);let m=Math.max(0,p-1);(u[m]||"")===" "?n.push(Ve(t,{line:l.line,column:p},1," : ")):n.push(Ae(t,{line:l.line,column:p}," : "));continue}if(z("SE-ELSE-IN-CRITICAL",l)){n.push(Ve(t,st(l),l.length??4,"option"));continue}if(z("SE-BOX-EMPTY",l)){let u=t.split(/\r?\n/),h=Math.max(0,l.line-1),d=u[h]||"";if(/^\s*box\s+(.+)$/.exec(d)){let g=`${d.match(/^\s*/)?.[0]||""}rect rgb(240, 240, 255)`;n.push({start:{line:l.line,column:1},end:{line:l.line,column:d.length+1},newText:g})}continue}if(z("SE-BOX-INVALID-CONTENT",l)){let u=t.split(/\r?\n/),h=Math.max(0,l.line-1),d=/^(\s*)box\b/,p=-1,m="";for(let g=h;g>=0;g--){let x=d.exec(u[g]||"");if(x){p=g,m=x[1]||"";break}}if(p!==-1){let g=-1;for(let x=p+1;x<u.length;x++)if((u[x]||"").trim()==="end"){g=x;break}if(g!==-1){let x=[];for(let y=p+1;y<g;y++){let E=u[y]||"";E.trim()!==""&&(/^\s*(participant|actor)\b/i.test(E)||x.push(y))}if(x.length>0){let y=m,E=x.map(T=>{let L=(u[T]||"").trimStart();return y+L}).join(`
`)+`
`;for(let T=x.length-1;T>=0;T--){let A=x[T];n.push({start:{line:A+1,column:1},end:{line:A+2,column:1},newText:""})}n.push(Ae(t,{line:g+2,column:1},E))}}}continue}if(z("SE-BLOCK-MISSING-END",l)){let u=t.split(/\r?\n/),h=Math.max(0,l.line-1),d=/^(\s*)(alt\b|opt\b|loop\b|par\b|rect\b|critical\b|break\b|box\b)/,p=-1,m="";for(let y=h;y>=0;y--){let E=d.exec(u[y]||"");if(E){p=y,m=E[1]||"";break}}if(p===-1){let y=sn(u[h]||"");n.push(Ae(t,{line:h+1,column:1},`${y}end
`));continue}let g=u.length;for(let y=p+1;y<u.length;y++){let E=u[y]||"";if(E.trim()==="")continue;if(sn(E).length<=m.length){g=y;break}}let x=g;n.push(Ae(t,{line:x+1,column:1},`${m}end
`));continue}if(z("SE-AUTONUMBER-EXTRANEOUS",l)){let u=pe(t,l.line),h=u.length,d=sn(u),p=l.column,x=u.slice(0,Math.max(0,p-1)).replace(/\s+$/,"").length+1,y=u.slice(Math.max(0,p-1)).replace(/^\s+/,"");n.push({start:{line:l.line,column:x},end:{line:l.line,column:h+1},newText:`
${d}${y}`});continue}if(z("SE-AUTONUMBER-MALFORMED",l)||z("SE-AUTONUMBER-NON-NUMERIC",l)){if(r==="all"){let u=pe(t,l.line),h=u.indexOf("autonumber");h>=0&&n.push({start:{line:l.line,column:h+1},end:{line:l.line,column:u.length+1},newText:"autonumber"})}continue}if(z("SE-LABEL-ESCAPED-QUOTE",l)){n.push(Ve(t,st(l),l.length??1,"&quot;"));continue}if(z("SE-LABEL-DOUBLE-IN-DOUBLE",l)){let u=pe(t,l.line),h=u.trimStart();if(/^(participant|actor)\b/.test(h)){let d=u.indexOf("participant"),p=d===-1?u.indexOf("actor"):d,m=p>=0?p:0,g=u.indexOf('"',m);if(g!==-1){let x=u.indexOf(" as ",g+1),y=x!==-1?u.lastIndexOf('"',x-1):u.lastIndexOf('"');if(y>g){let E=u.slice(g+1,y),T=E.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");if(T!==E){let A={line:l.line,column:g+2},L={line:l.line,column:y+1};n.push({start:A,end:L,newText:T})}}}}continue}if(z("SE-QUOTE-UNCLOSED",l)){if(r==="all"){let h=pe(t,l.line).length+1;n.push(Ae(t,{line:l.line,column:h},'"'))}continue}if(z("ST-ARROW-INVALID",l)){n.push(Ve(t,st(l),l.length??2,"-->"));continue}if(z("ST-NOTE-MALFORMED",l)){let u=t.split(/\r?\n/),h=pe(t,l.line),d=/^(\s*)Note\s+(left|right)\s+of\s+([^:]+?)\s+(.+)$/.exec(h),p=/^(\s*)Note\s+over\s+([^:]+?)\s+(.+)$/.exec(h),m="",g="right",x="",y="";if(d?(m=d[1]||"",g=(d[2]||"right").toLowerCase(),x=(d[3]||"").trim(),y=(d[4]||"").trim()):p&&(m=p[1]||"",g="right",x=(p[2]||"").split(",").map(T=>T.trim()).filter(Boolean)[0]||"",y=(p[3]||"").trim()),x){let E=`${m}Note ${g} of ${x} : ${y}`,T=u.slice(0,Math.max(0,l.line-1)).join(`
`);if(new RegExp(`(^|
|\b)${x}(\b)`).test(T))n.push({start:{line:l.line,column:1},end:{line:l.line,column:h.length+1},newText:E});else{let L=u.length+1;for(let k=l.line;k<u.length;k++){let N=u[k]||"";if(new RegExp(`(^|\\b)${x}(\\b)`).test(N)){L=k+2;break}}n.push({start:{line:l.line,column:1},end:{line:l.line+1,column:1},newText:""}),n.push(Ae(t,{line:L,column:1},E+`
`))}}else{let E=/^(\s*Note\s+(?:left|right)\s+of\s+[^:]+|\s*Note\s+over\s+[^:]+)/i.exec(h),T=E?(E[0]||"").length+1:l.column;n.push(Ae(t,{line:l.line,column:T}," : "))}continue}if(z("ST-BLOCK-MISSING-RBRACE",l)){let u=t.split(/\r?\n/),h=Math.max(0,l.line-1),d=/^(\s*)state\b/,p=-1,m="";for(let x=h;x>=0;x--){let y=d.exec(u[x]||"");if(y){p=x,m=y[1]||"";break}}if(p===-1){let x=sn(u[h]||"");n.push(Ae(t,{line:h+1,column:1},`${x}}
`));continue}let g=u.length;for(let x=p+1;x<u.length;x++){let y=u[x]||"";if(y.trim()==="")continue;if(sn(y).length<=m.length){g=x;break}}n.push(Ae(t,{line:g+1,column:1},`${m}}
`));continue}if(z("CL-REL-INVALID",l)){let h=pe(t,l.line).indexOf("->");h>=0&&n.push({start:{line:l.line,column:h+1},end:{line:l.line,column:h+3},newText:"--"});continue}if(z("CL-BLOCK-MISSING-RBRACE",l)){let u=t.split(/\r?\n/),h=Math.max(0,l.line-1),d=/^(\s*)class\b.*\{\s*$/,p=-1,m="";for(let x=h;x>=0;x--){let y=d.exec(u[x]||"");if(y){p=x,m=y[1]||"";break}}if(p===-1){let x=sn(u[h]||"");n.push(Ae(t,{line:h+1,column:1},`${x}}
`));continue}let g=u.length;for(let x=p+1;x<u.length;x++){let y=u[x]||"";if(y.trim()==="")continue;if(sn(y).length<=m.length){g=x;break}}n.push(Ae(t,{line:g+1,column:1},`${m}}
`));continue}if(z("CL-LABEL-DOUBLE-IN-DOUBLE",l)){let u=pe(t,l.line),h=u.indexOf('"');if(h!==-1){let d=u.indexOf(" as ",h+1),p=d!==-1?u.lastIndexOf('"',d-1):u.lastIndexOf('"');if(p>h){let m=u.slice(h+1,p),g=m.split("&quot;").join("\0").split('"').join("&quot;").split("\0").join("&quot;");g!==m&&n.push({start:{line:l.line,column:h+2},end:{line:l.line,column:p+1},newText:g})}}else n.push(Ve(t,st(l),l.length??1,"&quot;"));continue}if(z("FL-STRICT-LABEL-QUOTES-REQUIRED",l)){if(r==="all"){let u=pe(t,l.line),h=Math.max(0,l.column-1),d=u.slice(0,h),p=u.slice(h),m=Math.max(d.lastIndexOf("["),d.lastIndexOf("("),d.lastIndexOf("{"));if(m>=0){let g=d[m],x=g==="["?"]":g==="("?")":"}",y=u.indexOf(x,h);y>m&&(n.push(Ae(t,{line:l.line,column:m+2},'"')),n.push(Ae(t,{line:l.line,column:y+1},'"')))}}continue}}}let a=[],c=new Set;for(let l of n){let f=`${l.start.line}:${l.start.column}:${l.end?.line??0}:${l.end?.column??0}:${l.newText}`;c.has(f)||(c.add(f),a.push(l))}return a}var cc=class{constructor(){this.nodes=new Map,this.edges=[],this.nodeCounter=0,this.edgeCounter=0,this.subgraphs=[],this.currentSubgraphStack=[],this.pendingLinkStyles=[],this.classStyles=new Map,this.nodeStyles=new Map,this.nodeClasses=new Map,this.edgeClasses=new Map,this.edgeStyles=new Map,this.nodeLinks=new Map}build(e){if(this.reset(),!e||!e.children)return{nodes:[],edges:[],direction:"TD",subgraphs:[]};let r=this.extractDirection(e);this.processStatements(e);for(let[n,i]of this.nodeLinks.entries()){let s=this.nodes.get(n);s&&(s.link=i)}return{nodes:Array.from(this.nodes.values()),edges:this.edges,direction:r,subgraphs:this.subgraphs}}reset(){this.nodes.clear(),this.edges=[],this.nodeCounter=0,this.edgeCounter=0,this.subgraphs=[],this.currentSubgraphStack=[],this.classStyles.clear(),this.nodeStyles.clear(),this.nodeClasses.clear(),this.edgeClasses.clear(),this.edgeStyles.clear(),this.pendingLinkStyles=[],this.nodeLinks.clear()}extractDirection(e){switch(e.children?.Direction?.[0]?.image?.toUpperCase()){case"TB":case"TD":return"TD";case"BT":return"BT";case"LR":return"LR";case"RL":return"RL";default:return"TD"}}processStatements(e){let r=e.children?.statement;if(r){for(let n of r)n.children?.nodeStatement?this.processNodeStatement(n.children.nodeStatement[0]):n.children?.subgraph?this.processSubgraph(n.children.subgraph[0]):n.children?.classDefStatement?this.processClassDef(n.children.classDefStatement[0]):n.children?.classStatement?this.processClassAssign(n.children.classStatement[0]):n.children?.styleStatement?this.processStyle(n.children.styleStatement[0]):n.children?.linkStyleStatement?this.processLinkStyle(n.children.linkStyleStatement[0]):n.children?.clickStatement?this.processClick(n.children.clickStatement[0]):n.children?.edgeAttrStatement&&this.processEdgeAttr(n.children.edgeAttrStatement[0]);this.applyLinkStyles()}}unquote(e){return e&&(e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e)}processClick(e){let r=e.children||{},n=r.clickTarget?.[0];if(!n)return;let i=n.image,s={};if(r.clickHref&&r.clickHref[0]){let o=r.clickHref[0].children||{};o.url&&o.url[0]&&(s.href=this.unquote(o.url[0].image)),o.tooltip&&o.tooltip[0]&&(s.tooltip=this.unquote(o.tooltip[0].image)),o.target&&o.target[0]&&(s.target=o.target[0].image)}else if(r.clickCall&&r.clickCall[0]){let o=r.clickCall[0].children||{};o.fn&&o.fn[0]&&(s.call=o.fn[0].image),o.tooltip&&o.tooltip[0]&&(s.tooltip=this.unquote(o.tooltip[0].image))}else{let o=r.Identifier||[],a=r.Text||[],c=r.QuotedString||[],l=o.find(u=>/^(href|call|callback)$/i.test(u.image)),f=l?.image?.toLowerCase();if(f==="href"){let u=c[0],h=c[1],d=o.find(p=>/^_(blank|self|parent|top)$/i.test(p.image));u&&(s.href=this.unquote(u.image)),h&&(s.tooltip=this.unquote(h.image)),d&&(s.target=d.image)}else if(f==="call"||f==="callback"){let u=new Set(["href","call","callback","_blank","_self","_parent","_top"]),d=o.filter(g=>(g.startOffset??0)>(l?.startOffset??-1)).find(g=>!u.has(g.image.toLowerCase())),p=a.map(g=>g.image).join(" ").trim();s.call=d?d.image+(p?` ${p}`:""):p||void 0;let m=c[0];m&&(s.tooltip=this.unquote(m.image))}}Object.keys(s).length&&this.nodeLinks.set(i,{...this.nodeLinks.get(i)||{},...s})}processNodeStatement(e){let r=e.children?.nodeOrParallelGroup,n=e.children?.link;if(!r||r.length===0)return;if((!n||n.length===0)&&r.length===1){let o=r[0].children?.node||[];if(o.length===1){let a=o[0],c=!!(a.children.attrObject&&a.children.attrObject.length),l=!!a.children?.nodeShape;if(c&&!l){let f=a.children.nodeId?.[0]||a.children.Identifier?.[0]||void 0;if(f){let u=f.image;if(this.edges.some(d=>d.id===u)){let d={children:{edgeId:[{image:u}],attrObject:a.children.attrObject}};this.processEdgeAttr(d);return}}}}}let i=this.processNodeGroup(r[0]);if(r.length>1&&n&&n.length>0){let s=this.processNodeGroup(r[1]),o=this.extractLinkInfo(n[0]);for(let a of i)for(let c of s)this.edges.push({id:o.edgeId||`e${this.edgeCounter++}`,source:a,target:c,label:o.label,type:o.type,markerStart:o.markerStart,markerEnd:o.markerEnd});for(let a=2;a<r.length;a++){let c=this.processNodeGroup(r[a]),l=n[a-1]?this.extractLinkInfo(n[a-1]):o;for(let f of s)for(let u of c)this.edges.push({id:l.edgeId||`e${this.edgeCounter++}`,source:f,target:u,label:l.label,type:l.type,markerStart:l.markerStart,markerEnd:l.markerEnd});s.length=0,s.push(...c)}}}processNodeGroup(e){let r=e.children?.node;if(!r)return[];let n=[];for(let i of r){let s=this.extractNodeInfo(i);if(s){if(!this.subgraphs.some(a=>a.id===s.id)){if(!this.nodes.has(s.id))s.style=this.computeNodeStyle(s.id),this.nodes.set(s.id,s);else{let a=this.nodes.get(s.id);(s.shape!=="rectangle"||s.label!==s.id)&&(s.label!==s.id&&(a.label=s.label),s.shape!=="rectangle"&&(a.shape=s.shape));let c=this.computeNodeStyle(s.id);Object.keys(c).length&&(a.style={...a.style||{},...c})}if(this.currentSubgraphStack.length)for(let a of this.currentSubgraphStack){let c=this.subgraphs.find(l=>l.id===a);c&&!c.nodes.includes(s.id)&&c.nodes.push(s.id)}}n.push(s.id)}}return n}extractNodeInfo(e){let r=e.children;if(!r)return null;let n;if(r.nodeId)n=r.nodeId[0].image,r.nodeIdSuffix&&(n+=r.nodeIdSuffix[0].image);else if(r.nodeIdNum)n=r.nodeIdNum[0].image;else if(r.Identifier)n=r.Identifier[0].image;else return null;let i="rectangle",s=n,o=r.nodeShape?.[0];if(o?.children){let u=this.extractShapeAndLabel(o);i=u.shape,u.label&&(s=u.label)}let a=r.attrObject?.[0],c;if(a&&!o){if(c=this.parseTypedAttrObject(a),c.shape){let u=c.shape;u==="rect"?i="rectangle":u==="round"||u==="rounded"?i="round":u==="stadium"?i="stadium":u==="subroutine"?i="subroutine":u==="circle"?i="circle":u==="cylinder"?i="cylinder":u==="diamond"?i="diamond":u==="trapezoid"?i="trapezoid":u==="trapezoidAlt"?i="trapezoidAlt":u==="parallelogram"||u==="lean-l"||u==="lean-r"?(i="parallelogram",c.lean=u==="lean-l"?"l":u==="lean-r"?"r":void 0):u==="hexagon"?i="hexagon":(u==="icon"||u==="image")&&(i="rectangle")}typeof c.label=="string"&&c.label.length>0&&(s=c.label)}let l=r.nodeClass?.[0];if(l){let u=this.nodeClasses.get(n)||new Set;u.add(l.image),this.nodeClasses.set(n,u)}let f={id:n,label:s,shape:i};if(c){let u=c.padding,h=c.cornerRadius,d=c.lean,p=c.icon||c.image?{icon:c.icon,image:c.image}:void 0;f.typed={padding:u,cornerRadius:h,lean:d,media:p}}return f}parseTypedAttrObject(e){let n=(e.children||{}).attrPair||[],i={};for(let s of n){let o=s.children?.attrKey?.[0];if(!o)continue;let a=o.image,c=s.children?.QuotedString?.[0]||s.children?.Identifier?.[0]||s.children?.NumberLiteral?.[0]||s.children?.Text?.[0];if(!c)continue;let l=c.image;switch((l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),a){case"shape":i.shape=l;break;case"label":i.label=l;break;case"padding":{let f=parseFloat(l);Number.isFinite(f)&&(i.padding=f);break}case"cornerRadius":{let f=parseFloat(l);Number.isFinite(f)&&(i.cornerRadius=f);break}case"icon":i.icon=l;break;case"image":i.image=l;break}}return i}extractShapeAndLabel(e){let r=e.children,n="rectangle",i="",s=r?.nodeContent;if(s&&s.length>0&&(i=this.extractTextContent(s[0])),r?.SquareOpen){n="rectangle";let o=r.nodeContent?.[0];if(o){let a=o.children,c=["ForwardSlash","Backslash","Identifier","Text","NumberLiteral","RoundOpen","RoundClose","AngleLess","AngleOpen","Comma","Colon","Ampersand","Semicolon","TwoDashes","Line","ThickLine","DottedLine"],l=[];for(let f of c)a[f]?.forEach(h=>l.push({type:f,t:h,start:h.startOffset??0}));if(l.length>=2){l.sort((h,d)=>h.start-d.start);let f=l[0].type,u=l[l.length-1].type;f==="ForwardSlash"&&u==="ForwardSlash"||f==="Backslash"&&u==="Backslash"?n="parallelogram":f==="ForwardSlash"&&u==="Backslash"?n="trapezoid":f==="Backslash"&&u==="ForwardSlash"&&(n="trapezoidAlt")}}}else r?.RoundOpen?n="round":r?.DiamondOpen?n="diamond":r?.DoubleRoundOpen?n="circle":r?.StadiumOpen?n="stadium":r?.HexagonOpen?n="hexagon":r?.DoubleSquareOpen?n="subroutine":r?.CylinderOpen?n="cylinder":r?.TrapezoidOpen?n="trapezoid":r?.ParallelogramOpen&&(n="parallelogram");return{shape:n,label:i}}extractTextContent(e){let r=e.children;if(!r)return"";let n=["Text","Identifier","QuotedString","NumberLiteral","Ampersand","Comma","Colon","Semicolon","Dot","Underscore","Dash","ForwardSlash","Backslash","AngleLess","AngleOpen"],i=[];for(let o of n){let a=r[o];if(a)for(let c of a){let l=c.image;o==="QuotedString"&&l.startsWith('"')&&l.endsWith('"')&&(l=l.slice(1,-1)),!((o==="ForwardSlash"||o==="Backslash")&&i.length===0)&&i.push({text:l,startOffset:c.startOffset??0,type:o})}}if(i.sort((o,a)=>o.startOffset-a.startOffset),i.length){let o=i[0];(o.type==="ForwardSlash"||o.type==="Backslash")&&i.shift();let a=i[i.length-1];(a.type==="ForwardSlash"||a.type==="Backslash")&&i.pop()}let s=i.map(o=>o.text);return r.Space?s.join(""):s.join(" ").trim()}extractLinkInfo(e){let r=e.children,n="arrow",i,s="none",o="none",a=r.edgeId?.[0];r.BiDirectionalArrow?(n="arrow",s="arrow",o="arrow"):r.CircleEndLine?(n="open",s="circle",o="circle"):r.CrossEndLine?(n="open",s="cross",o="cross"):r?.ArrowRight?(n="arrow",o="arrow"):r?.ArrowLeft?(n="arrow",s="arrow"):r?.DottedArrowRight?(n="dotted",o="arrow"):r?.DottedArrowLeft?(n="dotted",s="arrow"):r?.ThickArrowRight?(n="thick",o="arrow"):r?.ThickArrowLeft?(n="thick",s="arrow"):r?.LinkRight||r?.LinkLeft||r?.Line||r?.TwoDashes||r?.DottedLine||r?.ThickLine?r?.DottedLine?n="dotted":r?.ThickLine?n="thick":n="open":r?.InvisibleLink&&(n="invisible"),o==="none"&&(r?.ArrowRight||r.ThickArrowRight||r.DottedArrowRight)&&(o="arrow"),s==="none"&&(r?.ArrowLeft||r.ThickArrowLeft||r.DottedArrowLeft)&&(s="arrow");let c=r?.linkText?.[0];if(c)i=this.extractTextContent(c);else if(r.linkTextInline?.[0])i=this.extractTextContent(r.linkTextInline[0]);else if(r.inlineCarrier?.[0]){let f=r.inlineCarrier[0].image.trim();f.startsWith("-.")&&f.endsWith(".-")?n="dotted":f.startsWith("==")&&f.endsWith("==")?n="thick":f.startsWith("--")&&f.endsWith("--"),(r.ArrowRight||r.DottedArrowRight||r.ThickArrowRight)&&(o="arrow"),(r.ArrowLeft||r.DottedArrowLeft||r.ThickArrowLeft)&&(s="arrow"),i=(h=>h.startsWith("-.")&&h.endsWith(".-")||h.startsWith("==")&&h.endsWith("==")||h.startsWith("--")&&h.endsWith("--")?h.slice(2,-2).trim():h)(f)}return{type:n,label:i,markerStart:s,markerEnd:o,edgeId:a?a.image:void 0}}processSubgraph(e){let r=e.children,n=`subgraph_${this.subgraphs.length}`,i,s=r?.subgraphId?.[0]||r?.Identifier?.[0];if(s&&(n=s.image),r?.SquareOpen&&r?.nodeContent)i=this.extractTextContent(r.nodeContent[0]);else if(r.subgraphTitleQ?.[0]){let f=r.subgraphTitleQ[0].image;i=f&&f.length>=2&&(f.startsWith('"')||f.startsWith("'"))?f.slice(1,-1):f}else r?.subgraphLabel&&(i=this.extractTextContent(r.subgraphLabel[0]));!i&&n!==`subgraph_${this.subgraphs.length}`&&(i=n);let o=this.currentSubgraphStack.length?this.currentSubgraphStack[this.currentSubgraphStack.length-1]:void 0,a={id:n,label:i,nodes:[],parent:o};this.subgraphs.push(a),this.currentSubgraphStack.push(n);let c=r?.subgraphStatement;if(c)for(let l of c)l.children?.nodeStatement?this.processNodeStatement(l.children.nodeStatement[0]):l.children?.subgraph&&this.processSubgraph(l.children.subgraph[0]);this.currentSubgraphStack.pop()}processClassDef(e){let r=e.children?.Identifier?.[0];if(!r)return;let n=r.image,i=this.collectStyleProps(e,{skipFirstIdentifier:!0});if(Object.keys(i).length){this.classStyles.set(n,i);for(let[s,o]of this.nodeClasses.entries())if(o.has(n)){let a=this.nodes.get(s);a&&(a.style={...a.style||{},...this.computeNodeStyle(s)})}}}processClassAssign(e){let r=e.children?.Identifier||[];if(!r.length)return;let n=e.children.className?.[0],i=n?.image||r[r.length-1].image,s=r.slice(0,-1);for(let o of s){let a=o.image,c=this.nodeClasses.get(a)||new Set;c.add(i),this.nodeClasses.set(a,c);let l=this.edgeClasses.get(a)||new Set;l.add(i),this.edgeClasses.set(a,l);let f=this.nodes.get(a);f&&(f.style={...f.style||{},...this.computeNodeStyle(a)})}}processStyle(e){let r=e.children?.Identifier?.[0];if(!r)return;let n=r.image,i=this.collectStyleProps(e,{skipFirstIdentifier:!0});if(Object.keys(i).length){this.nodeStyles.set(n,i);let s=this.nodes.get(n);s&&(s.style={...s.style||{},...this.computeNodeStyle(n)})}}collectStyleProps(e,r={}){let n=[],i=e.children||{},s=(c,l="t")=>c?.forEach(f=>n.push({text:f.image,startOffset:f.startOffset??0,type:l}));if(s(i.Text,"Text"),s(i.Identifier,"Identifier"),s(i.ColorValue,"Color"),s(i.Colon,"Colon"),s(i.Comma,"Comma"),s(i.NumberLiteral,"Number"),n.sort((c,l)=>c.startOffset-l.startOffset),r.skipFirstIdentifier){let c=n.findIndex(l=>l.type==="Identifier");c>=0&&n.splice(c,1)}let o=n.map(c=>c.text).join(""),a={};for(let c of o.split(",").map(l=>l.trim()).filter(Boolean)){let[l,f]=c.split(":");l&&f&&(a[l.trim()]=f.trim())}return a}processEdgeAttr(e){let r=e.children.edgeId?.[0];if(!r)return;let n=r.image,i=e.children.attrObject?.[0];if(!i)return;let o=(i.children||{}).attrPair||[],a={};for(let l of o){let f=l.children.attrKey?.[0],u=l.children.QuotedString?.[0]||l.children.Identifier?.[0]||l.children.NumberLiteral?.[0]||l.children.Text?.[0];if(!f||!u)continue;let h=u.image;(h.startsWith('"')&&h.endsWith('"')||h.startsWith("'")&&h.endsWith("'"))&&(h=h.slice(1,-1));let d=f.image;d==="animate"?/^(true|1|yes|on|fast|slow)$/i.test(h)&&(a.animation=/^slow$/i.test(h)?"dash 8s linear infinite":/^fast$/i.test(h)?"dash 2s linear infinite":"dash 4s linear infinite",a["stroke-dasharray"]||(a["stroke-dasharray"]="5 5")):a[d]=h}let c=this.edgeStyles.get(n)||{};this.edgeStyles.set(n,{...c,...a})}computeEdgeStyle(e){let r={},n=this.edgeClasses.get(e);if(n)for(let s of n){let o=this.classStyles.get(s);o&&Object.assign(r,this.normalizeStyle(o))}let i=this.edgeStyles.get(e);return i&&Object.assign(r,this.normalizeStyle(i)),r}processLinkStyle(e){let r=e.children||{};if(r.linkStyleIndexList&&r.linkStylePairs){let o=r.linkStyleIndexList[0],a=r.linkStylePairs[0],l=((o.children||{}).index||[]).map(h=>parseInt(h.image,10)).filter(h=>Number.isFinite(h)),f=(a.children||{}).linkStylePair||[],u={};for(let h of f){let d=h.children||{},p=d.key?.[0],m=d.valueColor?.[0]||d.valueQuoted?.[0]||d.valueNum?.[0]||d.valueId?.[0]||d.valueText?.[0];if(!p||!m)continue;let g=m.image;m.tokenType?.name==="QuotedString"&&(g.startsWith('"')||g.startsWith("'"))&&(g=g.slice(1,-1)),u[p.image]=g}this.pendingLinkStyles.push({indices:l,props:u});return}let i=(e.children?.NumberLiteral||[]).map(o=>parseInt(o.image,10)).filter(o=>Number.isFinite(o)),s=this.collectStyleProps(e);this.pendingLinkStyles.push({indices:i,props:s})}applyLinkStyles(){if(!this.pendingLinkStyles.length||!this.edges.length)return;let e=r=>{let n={};for(let[i,s]of Object.entries(r)){let o=i.trim().toLowerCase(),a=s.trim();if(o==="stroke")n.stroke=a;else if(o==="stroke-width"){let c=parseFloat(a);Number.isNaN(c)||(n.strokeWidth=c)}else if(o==="opacity"||o==="stroke-opacity"){let c=parseFloat(a);Number.isNaN(c)||(n.strokeOpacity=c)}else o==="stroke-dasharray"&&(n.dasharray=a)}return n};for(let r of this.pendingLinkStyles){let n=e(r.props);for(let i of r.indices)if(i>=0&&i<this.edges.length){let s=this.edges[i];s.style={...s.style||{},stroke:n.stroke??s.style?.stroke,strokeWidth:n.strokeWidth??s.style?.strokeWidth,strokeOpacity:n.strokeOpacity??s.style?.strokeOpacity},n.dasharray&&(s.dasharray=n.dasharray),n.animation&&(s.animation=n.animation)}}}computeNodeStyle(e){let r={},n=this.nodeClasses.get(e);if(n)for(let s of n){let o=this.classStyles.get(s);o&&Object.assign(r,this.normalizeStyle(o))}let i=this.nodeStyles.get(e);return i&&Object.assign(r,this.normalizeStyle(i)),r}normalizeStyle(e){let r={};for(let[n,i]of Object.entries(e)){let s=n.trim().toLowerCase(),o=i.trim();if(s==="stroke-width"){let a=parseFloat(o);Number.isNaN(a)||(r.strokeWidth=a)}else s==="stroke"?r.stroke=o:s==="fill"&&(r.fill=o)}return r}};var zd=ow(_v(),1),Ur=class{constructor(){this.nodeWidth=120,this.nodeHeight=50,this.rankSep=50,this.nodeSep=50,this.edgeSep=10}layout(e){let r=new zd.default.graphlib.Graph,n=!!(e.subgraphs&&e.subgraphs.length>0),i=this.mapDirection(e.direction),s=this.rankSep,o=this.nodeSep;n&&(i==="LR"||i==="RL"?(s+=20,o+=70):(s+=70,o+=20));let a={rankdir:i,ranksep:s,nodesep:o,edgesep:this.edgeSep,marginx:20,marginy:20};if(n&&(i==="LR"||i==="RL")&&(a.ranker="network-simplex",a.acyclicer="greedy",o+=40,s=Math.max(30,s-20)),n&&(a.compound=!0),r.setGraph(a),r.setDefaultEdgeLabel(()=>({})),e.subgraphs&&e.subgraphs.length>0)for(let x of e.subgraphs)r.setNode(x.id,{label:x.label||x.id,clusterLabelPos:"top"});for(let x of e.nodes){let y=x.width,E=x.height,T=y&&E?{width:y,height:E}:this.calculateNodeDimensions(x.label,x.shape);r.setNode(x.id,{width:T.width,height:T.height,label:x.label,shape:x.shape})}if(e.subgraphs&&e.subgraphs.length>0)for(let x of e.subgraphs){for(let y of x.nodes)if(r.hasNode(y))try{r.setParent(y,x.id)}catch{}if(x.parent&&r.hasNode(x.parent))try{r.setParent(x.id,x.parent)}catch{}}for(let x of e.edges)r.setEdge(x.source,x.target,{label:x.label,width:x.label?x.label.length*8:0,height:x.label?20:0});zd.default.layout(r);let c=r.graph(),l=[],f=[];for(let x of e.nodes){let y=r.node(x.id);y&&l.push({...x,x:y.x-y.width/2,y:y.y-y.height/2,width:y.width,height:y.height})}let u=[];if(e.subgraphs&&e.subgraphs.length>0){for(let y of e.subgraphs){let E=l.filter(T=>y.nodes.includes(T.id));if(E.length){let T=Math.min(...E.map(v=>v.x)),A=Math.min(...E.map(v=>v.y)),L=Math.max(...E.map(v=>v.x+v.width)),k=Math.max(...E.map(v=>v.y+v.height)),N=30;u.push({id:y.id,label:y.label||y.id,x:T-N,y:A-N-18,width:L-T+N*2,height:k-A+N*2+18,parent:y.parent})}}let x=Object.fromEntries(u.map(y=>[y.id,y]));for(let y of u){if(!y.parent)continue;let E=x[y.parent];if(!E)continue;let T=Math.min(E.x,y.x),A=Math.min(E.y,y.y),L=Math.max(E.x+E.width,y.x+y.width),k=Math.max(E.y+E.height,y.y+y.height);E.x=T,E.y=A,E.width=L-T,E.height=k-A}}let h=Object.fromEntries(u.map(x=>[x.id,x]));for(let x of e.edges){let y=r.edge(x.source,x.target),E=y&&Array.isArray(y.points)?y.points.slice():[],T=E.some(N=>!Number.isFinite(N.x)||!Number.isFinite(N.y)),A=h[x.source],L=h[x.target],k=!1;if(!E.length||T||A||L){let N=this.mapDirection(e.direction),v=w=>{let C=r.node(w);if(C)return{id:w,label:C.label||w,shape:C.shape||"rectangle",x:C.x-C.width/2,y:C.y-C.height/2,width:C.width,height:C.height,style:{}}},R=A?this.clusterAnchor(A,N,"out"):this.nodeAnchor(v(x.source),N,"out"),b=L?this.clusterAnchor(L,N,"in"):this.nodeAnchor(v(x.target),N,"in");if(R&&b){let I=A&&L&&Math.abs(A.x-L.x)>Math.abs(A.y-L.y);if(N==="LR"||N==="RL"){let P=R.x+(N==="LR"?20:-20),q=b.x+(N==="LR"?-20:20),$={x:A?P:R.x,y:R.y},F={x:L?q:b.x,y:b.y},ee=$.x+(F.x-$.x)*.72,ae={x:ee,y:$.y},oe={x:ee,y:F.y};E=L?[R,$,ae,oe,F]:[R,$,ae,oe,F,b]}else if(I&&A&&L){let P=(A.y+A.height/2+L.y+L.height/2)/2;if(A.x<L.x){let q=A.x+A.width,$=L.x;E=[{x:q,y:P},{x:$,y:P}]}else{let q=A.x,$=L.x+L.width;E=[{x:q,y:P},{x:$,y:P}]}}else{let P=R.y+(N==="TD"?20:-20),q=b.y+(N==="TD"?-20:20),$={x:R.x,y:A?P:R.y},F={x:b.x,y:L?q:b.y},ee=$.y+(F.y-$.y)*.68,ae={x:$.x,y:ee},oe={x:F.x,y:ee};E=L?[R,$,ae,oe,F]:[R,$,ae,oe,F,b]}k=!0}}E.length&&f.push({...x,points:E,pathMode:k?"orthogonal":"smooth"})}let d=c.width,p=c.height,m=Number.isFinite(d)&&d>0?d:800,g=Number.isFinite(p)&&p>0?p:600;return{nodes:l,edges:f,width:m,height:g,subgraphs:u}}mapDirection(e){switch(e){case"TB":case"TD":return"TB";case"BT":return"BT";case"LR":return"LR";case"RL":return"RL";default:return"TB"}}calculateNodeDimensions(e,r){let l=e.split(/<\s*br\s*\/?\s*>/i),f=l.length>1,u,h;if(f){let p=Math.max(...l.map(m=>m.length));u=Math.min(Math.max(p*7+40,80),240),h=l.length}else{u=Math.min(Math.max(e.length*7+40,80),240);let p=Math.max(1,Math.floor((u-40)/7));h=Math.ceil(e.length/p)}let d=Math.max(h*18+20,40);switch(r){case"circle":let p=Math.max(u,d);u=p,d=p;break;case"diamond":{let m=Math.max(u,d)*1.2;u=m,d=m;break}case"hexagon":u*=1.3,d*=1.2;break;case"stadium":u*=1.2;break;case"cylinder":d*=1.5;break;case"subroutine":case"double":u+=10,d+=10;break;case"parallelogram":case"trapezoid":u*=1.3;break}return{width:Math.round(u),height:Math.round(d)}}clusterAnchor(e,r,n){switch(r){case"LR":return{x:n==="out"?e.x+e.width:e.x,y:e.y+e.height/2};case"RL":return{x:n==="out"?e.x:e.x+e.width,y:e.y+e.height/2};case"BT":return{x:e.x+e.width/2,y:n==="out"?e.y:e.y+e.height};case"TB":default:return{x:e.x+e.width/2,y:n==="out"?e.y+e.height:e.y}}}nodeAnchor(e,r,n){if(!e)return{x:0,y:0};switch(r){case"LR":return{x:n==="in"?e.x:e.x+e.width,y:e.y+e.height/2};case"RL":return{x:n==="in"?e.x+e.width:e.x,y:e.y+e.height/2};case"BT":return{x:e.x+e.width/2,y:n==="in"?e.y+e.height:e.y};case"TB":default:return{x:e.x+e.width/2,y:n==="in"?e.y:e.y+e.height}}}};function Ko(t,e,r="#333",n=8,i=6){let s=e.x-t.x,o=e.y-t.y,a=Math.hypot(s,o)||1,c=s/a,l=o/a,f=-l,u=c,h=e.x-c*n,d=e.y-l*n,p=h+f*(i/2),m=d+u*(i/2),g=h-f*(i/2),x=d-u*(i/2);return`<path d="M${e.x},${e.y} L${p},${m} L${g},${x} Z" fill="${r}" />`}function Go(t,e,r="#333",n=8,i=6){let s=e.x-t.x,o=e.y-t.y,a=Math.hypot(s,o)||1,c=s/a,l=o/a,f=-l,u=c,h=t.x-c*n,d=t.y-l*n,p=t.x+f*(i/2),m=t.y+u*(i/2),g=t.x-f*(i/2),x=t.y-u*(i/2);return`<path d="M${h},${d} L${p},${m} L${g},${x} Z" fill="${r}" />`}function pn(t={}){let e=t.fontFamily||"Arial, sans-serif",r=t.fontSize??14,n=t.nodeFill||"#eef0ff",i=t.nodeStroke||"#3f3f3f",s=t.edgeStroke||"#555555";return`
    .node-shape { fill: ${n}; stroke: ${i}; stroke-width: 1px; }
    .node-label { fill: #333; font-family: ${e}; font-size: ${r}px; }
    .edge-path { stroke: ${s}; stroke-width: 2px; fill: none; }
    .edge-label-bg { fill: rgba(232,232,232, 0.8); opacity: 0.5; }
    .edge-label-text { fill: #333; font-family: ${e}; font-size: ${Math.max(10,r-2)}px; }
    .edge-marker { stroke: ${s}; }
    .edge-marker-fill { fill: ${s}; }

    /* Basic stroke dash animation used by flowchart link animation presets */
    @keyframes dash { to { stroke-dashoffset: -1000; } }

    /* Cluster (flowchart + sequence blocks) */
    .cluster-bg { fill: #ffffde; }
    .cluster-border { fill: none; stroke: #aaaa33; stroke-width: 1px; }
    .cluster-title-bg { fill: rgba(255,255,255,0.8); }
    .cluster-label-text { fill: #333; font-family: ${e}; font-size: 12px; }

    /* Notes */
    .note { fill: #fff5ad; stroke: #aaaa33; stroke-width: 1px; }
    .note-text { fill: #333; font-family: ${e}; font-size: 12px; }

    /* Sequence-specific add-ons (safe for flowcharts too) */
    .actor-rect { fill: #eaeaea; stroke: #666; stroke-width: 1.5px; }
    .actor-label { fill: #111; font-family: ${e}; font-size: 16px; }
    .lifeline { stroke: #999; stroke-width: 1px; }
    .activation { fill: #f4f4f4; stroke: #666; stroke-width: 1px; }
    .msg-line { stroke: #333; stroke-width: 1.5px; fill: none; }
    .msg-line.dotted { stroke-dasharray: 2 2; }
    .msg-line.thick { stroke-width: 3px; }
    .openhead { fill: none; stroke: #333; stroke-width: 1.5px; }
    .crosshead path { stroke: #333; stroke-width: 1.5px; }
    .msg-label { fill: #333; font-family: ${e}; font-size: 12px; dominant-baseline: middle; }
    .msg-label-bg { fill: #ffffff; stroke: #cccccc; stroke-width: 1px; rx: 3; }

    /* State overlays */
    .lane-divider { stroke: #aaaaaa; stroke-width: 1px; stroke-dasharray: 4 3; }
    .end-double { stroke: #3f3f3f; stroke-width: 1px; fill: none; }
  `}function jo(t,e){if(!e)return t;let r=t;if((e.nodeBkg||e.nodeBorder)&&(r=r.replace(/\.node-shape\s*\{[^}]*\}/,n=>{let i=n;return e.nodeBkg&&(i=i.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeBkg)};`)),e.nodeBorder&&(i=i.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.nodeBorder)};`)),i})),e.nodeTextColor&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeTextColor)};`)),r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeTextColor)};`))),e.edgeLabelTextColor){let n=String(e.edgeLabelTextColor);r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,i=>i.replace(/fill:\s*[^;]+;/,`fill: ${n};`))}if(e.lineColor&&(r=r.replace(/\.edge-path\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lineColor)};`))),e.arrowheadColor&&(r=r.replace(/\.edge-marker\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`)),r=r.replace(/\.edge-marker-fill\s*\{[^}]*\}/,n=>n.includes("fill:")?n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.arrowheadColor)};`):n.replace(/\}/,` fill: ${String(e.arrowheadColor)}; }`)),r=r.replace(/\.openhead\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`)),r=r.replace(/\.crosshead path\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`))),e.clusterBkg&&(r=r.replace(/\.cluster-bg\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterBkg)};`))),e.clusterBorder&&(r=r.replace(/\.cluster-border\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.clusterBorder)};`))),e.clusterTextColor&&(r=r.replace(/\.cluster-label-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterTextColor)};`))),e.clusterTitleBg||e.clusterTitleBackground){let n=String(e.clusterTitleBg||e.clusterTitleBackground);r=r.replace(/\.cluster-title-bg\s*\{[^}]*\}/,i=>i.replace(/fill:\s*[^;]+;/,`fill: ${n};`))}if(e.fontFamily){let n=String(e.fontFamily);r=r.replace(/\.node-label\s*\{[^}]*\}/,i=>i.replace(/font-family:\s*[^;]+;/,`font-family: ${n};`)),r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,i=>i.replace(/font-family:\s*[^;]+;/,`font-family: ${n};`)),r=r.replace(/\.note-text\s*\{[^}]*\}/,i=>i.replace(/font-family:\s*[^;]+;/,`font-family: ${n};`))}if(e.fontSize){let n=String(e.fontSize);r=r.replace(/\.node-label\s*\{[^}]*\}/,s=>s.replace(/font-size:\s*[^;]+;/,`font-size: ${n}px;`));let i=Math.max(10,Number(e.fontSize)-2);r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,s=>s.replace(/font-size:\s*[^;]+;/,`font-size: ${i}px;`)),r=r.replace(/\.note-text\s*\{[^}]*\}/,s=>s.replace(/font-size:\s*[^;]+;/,`font-size: ${i}px;`))}return r}function we(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&apos;")}function ot(t,e=12){let r=.6*e;return Math.max(0,Math.round(t.length*r))}var Vd=["#ECECFF","#ffffde","hsl(80, 100%, 56.2745098039%)","hsl(240, 100%, 86.2745098039%)","hsl(60, 100%, 63.5294117647%)","hsl(80, 100%, 76.2745098039%)","hsl(300, 100%, 76.2745098039%)","hsl(180, 100%, 56.2745098039%)","hsl(0, 100%, 56.2745098039%)","hsl(300, 100%, 56.2745098039%)","hsl(150, 100%, 56.2745098039%)","hsl(0, 100%, 66.2745098039%)"];function Yd(t){return t<Vd.length?Vd[t]:`hsl(${(t-Vd.length)*47%360} 60% 55%)`}function Qd(t){return Number.isInteger(t)?String(t):(Math.round(t*100)/100).toString()}function Uv(t,e){if(!(e>0))return"0%";let r=t/e*100;return`${Math.round(r)}%`}function Fc(t,e,r,n,i=0){return`<g class="cluster-bg-layer" transform="translate(${t},${e})">
  <rect class="cluster-bg" x="0" y="0" width="${r}" height="${n}" rx="${i}"/>
</g>`}function Kc(t,e,r,n,i,s=[],o=0,a="center",c="left",l=0){let f=[];f.push(`<g class="cluster-overlay" transform="translate(${t},${e})">`),f.push(`<rect class="cluster-border" x="0" y="0" width="${r}" height="${n}" rx="${l}"/>`);let u=i?we(i):"";if(u){let h=Math.max(24,ot(u,12)+10),d=-2+o,p=11+o;a==="left"?(f.push(`<rect class="cluster-title-bg" x="6" y="${d}" width="${h}" height="18" rx="3"/>`),f.push(`<text class="cluster-label-text" x="12" y="${p}" text-anchor="start">${u}</text>`)):(f.push(`<rect class="cluster-title-bg" x="6" y="${d}" width="${h}" height="18" rx="3"/>`),f.push(`<text class="cluster-label-text" x="${6+h/2}" y="${p}" text-anchor="middle">${u}</text>`))}for(let h of s){let d=h.y-e;if(f.push(`<line x1="0" y1="${d}" x2="${r}" y2="${d}" class="cluster-border" />`),h.title){let p=we(h.title),m=Math.max(24,ot(p,12)+10),g=6;f.push(`<rect class="cluster-title-bg" x="${g}" y="${d-10}" width="${m}" height="18" rx="3"/>`),c==="left"?f.push(`<text class="cluster-label-text" x="${g+6}" y="${d+1}" text-anchor="start">${p}</text>`):f.push(`<text class="cluster-label-text" x="${g+m/2}" y="${d+1}" text-anchor="middle">${p}</text>`)}}return f.push("</g>"),f.join(`
`)}var Gn=class{constructor(){this.padding=20,this.fontSize=14,this.fontFamily="Arial, sans-serif",this.defaultStroke="#3f3f3f",this.defaultFill="#eef0ff",this.arrowStroke="#555555",this.arrowMarkerSize=9}render(e){let r=1/0,n=1/0,i=-1/0,s=-1/0;for(let T of e.nodes)r=Math.min(r,T.x),n=Math.min(n,T.y),i=Math.max(i,T.x+T.width),s=Math.max(s,T.y+T.height);if(e.subgraphs)for(let T of e.subgraphs)r=Math.min(r,T.x),n=Math.min(n,T.y),i=Math.max(i,T.x+T.width),s=Math.max(s,T.y+T.height);for(let T of e.edges)if(T.points)for(let A of T.points)r=Math.min(r,A.x),n=Math.min(n,A.y),i=Math.max(i,A.x),s=Math.max(s,A.y);isFinite(r)||(r=0),isFinite(n)||(n=0),isFinite(i)||(i=e.width),isFinite(s)||(s=e.height);let o=Math.max(0,-Math.floor(r)+1),a=Math.max(0,-Math.floor(n)+1),c=this.padding+o,l=this.padding+a,f=Math.ceil(i)-Math.min(0,Math.floor(r)),u=Math.ceil(s)-Math.min(0,Math.floor(n)),h=f+this.padding*2+o,d=u+this.padding*2+a,p=[],m=[];if(p.push(this.generateDefs()),e.subgraphs&&e.subgraphs.length){let A=e.subgraphs.slice().sort((v,R)=>(v.parent?1:0)-(R.parent?1:0)),L=new Map(A.map(v=>[v.id,v])),k=v=>{let R=0,b=v.parent;for(;b;)R++,b=L.get(b)?.parent;return R},N=[];for(let v of A){if(v.id&&v.id.includes("__lane"))continue;let R=v.x+c,b=v.y+l;N.push(Fc(R,b,v.width,v.height,0));let w=k(v),C=v.label?this.escapeXml(v.label):void 0,I=7+w*12;m.push(Kc(R,b,v.width,v.height,C,[],I,"center","left",0))}p.push(`<g class="subgraph-bg">${N.join("")}</g>`)}let g={};for(let T of e.nodes)g[T.id]={x:T.x+c,y:T.y+l,width:T.width,height:T.height,shape:T.shape};if(e.subgraphs&&e.subgraphs.length)for(let T of e.subgraphs)g[T.id]={x:T.x+c,y:T.y+l,width:T.width,height:T.height,shape:"rectangle"};for(let T of e.nodes)p.push(this.generateNodeWithPad(T,c,l));for(let T of e.edges){let{path:A,overlay:L}=this.generateEdge(T,c,l,g);p.push(A),L&&m.push(L)}let x=`<rect x="0" y="0" width="${h}" height="${d}" fill="#ffffff" />`,E=`<style>${pn({fontFamily:this.fontFamily,fontSize:this.fontSize,nodeFill:this.defaultFill,nodeStroke:this.defaultStroke,edgeStroke:this.arrowStroke})}</style>`;return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${h}" height="${d}" viewBox="0 0 ${h} ${d}">
  ${x}
  ${E}
  ${p.join(`
  `)}
  ${m.join(`
  `)}
</svg>`}buildNodeStyleAttrs(e){let r=[];return e.fill&&r.push(`fill:${e.fill}`),e.stroke&&r.push(`stroke:${e.stroke}`),e.strokeWidth!=null&&r.push(`stroke-width:${e.strokeWidth}`),r.length?`style="${r.join(";")}"`:""}buildNodeStrokeStyle(e){let r=[];return e.stroke&&r.push(`stroke:${e.stroke}`),e.strokeWidth!=null&&r.push(`stroke-width:${e.strokeWidth}`),r.length?`style="${r.join(";")}"`:""}generateDefs(){let e=Math.max(8,this.arrowMarkerSize+2),r=Math.max(8,this.arrowMarkerSize+2),n=Math.max(6,e),i=Math.max(4,Math.round(r/2));return`<defs>
    <marker id="arrow" viewBox="0 0 ${e} ${r}" markerWidth="${e}" markerHeight="${r}" refX="${n}" refY="${i}" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L0,${r} L${e},${i} z" fill="${this.arrowStroke}" />
    </marker>
    <marker id="circle-marker" viewBox="0 0 9 9" markerWidth="9" markerHeight="9" refX="4.5" refY="4.5" orient="auto" markerUnits="userSpaceOnUse">
      <circle cx="4.5" cy="4.5" r="4.5" fill="${this.arrowStroke}" />
    </marker>
    <marker id="cross-marker" viewBox="0 0 12 12" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M1.5,1.5 L10.5,10.5 M10.5,1.5 L1.5,10.5" stroke="${this.arrowStroke}" stroke-width="2.25" />
    </marker>
  </defs>`}generateNodeWithPad(e,r,n){let i=e.x+r,s=e.y+n,o=i+e.width/2,a=s+e.height/2,c="",l=a,f=e.style?.strokeWidth??void 0,u=e.style?.stroke??void 0,h=e.style?.fill??void 0,d=this.buildNodeStyleAttrs({stroke:u,strokeWidth:f,fill:h}),p=e.typed,m=Math.max(0,p?.padding??10);switch(e.shape){case"rectangle":c=`<rect class="node-shape" ${d} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />`;break;case"round":{let b=Math.max(0,p?.cornerRadius??5);c=`<rect class="node-shape" ${d} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="${b}" ry="${b}" />`;break}case"stadium":let T=e.height/2;c=`<rect class="node-shape" ${d} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="${T}" ry="${T}" />`;break;case"circle":let A=Math.min(e.width,e.height)/2;c=`<circle class="node-shape" ${d} cx="${o}" cy="${a}" r="${A}" />`;break;case"diamond":{let b=[`${o},${s}`,`${i+e.width},${a}`,`${o},${s+e.height}`,`${i},${a}`].join(" ");c=`<polygon class="node-shape" ${d} points="${b}" />`;break}case"hexagon":{let b=e.width*.25,w=[`${i+b},${s}`,`${i+e.width-b},${s}`,`${i+e.width},${a}`,`${i+e.width-b},${s+e.height}`,`${i+b},${s+e.height}`,`${i},${a}`].join(" ");c=`<polygon class="node-shape" ${d} points="${w}" />`;break}case"parallelogram":{let b=e.width*.15,C=(p?.lean==="l"?[`${i},${s}`,`${i+e.width-b},${s}`,`${i+e.width},${s+e.height}`,`${i+b},${s+e.height}`]:[`${i+b},${s}`,`${i+e.width},${s}`,`${i+e.width-b},${s+e.height}`,`${i},${s+e.height}`]).join(" ");c=`<polygon class="node-shape" ${d} points="${C}" />`;break}case"trapezoid":{let b=e.width*.15,w=[`${i+b},${s}`,`${i+e.width-b},${s}`,`${i+e.width},${s+e.height}`,`${i},${s+e.height}`].join(" ");c=`<polygon class="node-shape" ${d} points="${w}" />`;break}case"trapezoidAlt":{let b=e.width*.15,w=[`${i},${s}`,`${i+e.width},${s}`,`${i+e.width-b},${s+e.height}`,`${i+b},${s+e.height}`].join(" ");c=`<polygon class="node-shape" ${d} points="${w}" />`;break}case"cylinder":{let b=Math.max(8,e.width/2),w=Math.max(6,Math.min(e.height*.22,e.width*.25)),C=s+w,I=s+e.height-w,P=Math.max(0,e.height-w*2),q=this.buildNodeStrokeStyle({stroke:u,strokeWidth:f});c=`<g>
          <rect class="node-shape" ${d} x="${i}" y="${C}" width="${e.width}" height="${P}" />
          <ellipse class="node-shape" ${d} cx="${o}" cy="${C}" rx="${e.width/2}" ry="${w}" />
          <path class="node-shape" ${q} d="M${i},${C} L${i},${I} A${e.width/2},${w} 0 0,0 ${i+e.width},${I} L${i+e.width},${C}" fill="none" />
        </g>`,l=C+P/2;break}case"subroutine":let L=5,k=this.buildNodeStrokeStyle({stroke:u,strokeWidth:f});c=`<g>
          <rect class="node-shape" ${d} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />
          <line class="node-shape" ${k} x1="${i+L}" y1="${s}" x2="${i+L}" y2="${s+e.height}" />
          <line class="node-shape" ${k} x1="${i+e.width-L}" y1="${s}" x2="${i+e.width-L}" y2="${s+e.height}" />
        </g>`;break;case"double":let N=4,v=this.buildNodeStrokeStyle({stroke:u,strokeWidth:f});c=`<g>
          <rect class="node-shape" ${d} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />
          <rect class="node-shape" ${v} x="${i+N}" y="${s+N}" width="${e.width-N*2}" height="${e.height-N*2}" rx="0" ry="0" fill="none" />
        </g>`;break;default:c=`<rect ${this.buildNodeStyleAttrs({stroke:u,strokeWidth:f,fill:h})} x="${i}" y="${s}" width="${e.width}" height="${e.height}" rx="0" ry="0" />`}let g=this.generateWrappedText(e.label,o,l,e.width-m*2),x="";if(p?.media?.image){let T=Math.min(24,Math.max(12,e.height-10)),A=T,L=i+4,k=s+(e.height-A)/2;x=`<image xlink:href="${this.escapeXml(p.media.image)}" x="${L}" y="${k}" width="${T}" height="${A}" />`}let y=`<g id="${e.id}">
    ${c}
    ${x}
    ${g}
  </g>`,E=e.link;if(E&&E.href){let T=E.tooltip?`<title>${this.escapeXml(E.tooltip)}</title>`:"",A=E.target?` target="${this.escapeXml(E.target)}" rel="noopener noreferrer"`:"";return`<a xlink:href="${this.escapeXml(E.href)}"${A} class="node-link">${T}${y}</a>`}return E&&E.tooltip?`<g class="node-call">
<title>${this.escapeXml(E.tooltip)}</title>
${y}
</g>`:y}generateWrappedText(e,r,n,i){if(e.includes("<"))return this.generateRichText(e,r,n,i);let o=Math.floor(i/7);if(o<=0||e.length<=o){let p=this.fontSize*.35;return`<text class="node-label" x="${r}" y="${n+p}" text-anchor="middle">${this.escapeXml(e)}</text>`}let a=e.split(" "),c=[],l="";for(let p of a){let m=l?`${l} ${p}`:p;m.length>o&&l?(c.push(l),l=p):l=m}l&&c.push(l);let f=18,u=(c.length-1)*f,h=n-u/2+this.fontSize*.35;return`<text class="node-label">
    ${c.map((p,m)=>{let g=h+m*f;return`<tspan x="${r}" y="${g}" text-anchor="middle">${this.escapeXml(p)}</tspan>`}).join(`
    `)}
  </text>`}generateRichText(e,r,n,i){e=this.normalizeHtml(e);let s=[],o=/<\/?(br|b|strong|i|em|u)\s*\/?\s*>/gi,a=0,c={bold:!1,italic:!1,underline:!1},l=L=>{L&&s.push({text:this.htmlDecode(L),bold:c.bold,italic:c.italic,underline:c.underline})},f;for(;f=o.exec(e);){l(e.slice(a,f.index));let L=f[0].toLowerCase(),k=f[1].toLowerCase(),N=L.startsWith("</");k==="br"?s.push({text:"",br:!0}):k==="b"||k==="strong"?c.bold=!N:k==="i"||k==="em"?c.italic=!N:k==="u"&&(c.underline=!N),a=o.lastIndex}l(e.slice(a));let u=[],d=Math.max(1,Math.floor(i/7)),p=[],m=0,g=()=>{p.length&&(u.push(p),p=[],m=0)},x=L=>L.text?L.text.split(/(\s+)/).map(N=>({...L,text:N})):[L];for(let L of s){if(L.br){g();continue}for(let k of x(L)){let N=k.text.length;m+N>d&&m>0&&g(),p.push(k),m+=N}}g();let y=18,E=(u.length-1)*y,T=n-E/2+this.fontSize*.35,A=[];for(let L=0;L<u.length;L++){let k=T+L*y,N="",v=r,R=[],b="",w={bold:!1,italic:!1,underline:!1},C=()=>{if(!b)return;let I=`${w.bold?'font-weight="bold" ':""}${w.italic?'font-style="italic" ':""}${w.underline?'text-decoration="underline" ':""}`;R.push(`<tspan ${I}>${this.escapeXml(b)}</tspan>`),b=""};for(let I of u[L]){let P={bold:!!I.bold,italic:!!I.italic,underline:!!I.underline};(P.bold!==w.bold||P.italic!==w.italic||P.underline!==w.underline)&&(C(),w=P),b+=I.text}C(),A.push(`<tspan x="${r}" y="${k}" text-anchor="middle">${R.join("")}</tspan>`)}return`<text font-family="${this.fontFamily}" font-size="${this.fontSize}" fill="#333">${A.join(`
    `)}</text>`}normalizeHtml(e){return e.replace(/<\s+/g,"<").replace(/\s+>/g,">").replace(/<\s*\//g,"</").replace(/\s*\/\s*>/g,"/>").replace(/<\s*(br)\s*>/gi,"<$1/>")}htmlDecode(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}generateEdge(e,r,n,i){if(!e.points||e.points.length<2)return{path:""};let s=e.points.map(K=>({x:K.x+r,y:K.y+n})),o=this.buildSmoothSegments(s),a="",c=1.5,l="",f="";switch(e.type){case"open":l="";break;case"dotted":a="3,3";break;case"thick":c=3;break;case"invisible":a="0,100000",l="";break}let u=e.markerStart,h=e.markerEnd,d=i[e.source],p=i[e.target],m=s[0],g=s[s.length-1];if(d&&s.length>=2){let K={start:s[0],segs:[{c1:s[1],c2:s[Math.max(0,s.length-2)],to:s[s.length-1]}]};m=this.intersectSegmentsStart(K,d).start}if(p&&s.length>=2){let K={start:s[0],segs:[{c1:s[1],c2:s[Math.max(0,s.length-2)],to:s[s.length-1]}]},ie=this.intersectSegmentsEnd(K,p);g=ie.segs.length?ie.segs[ie.segs.length-1].to:g}let x=[];x.push(`M${m.x},${m.y}`);let y=s.length>=2?s[1]:m;if(s.length>=2){let K=s[1].x-m.x,ie=s[1].y-m.y,lt=Math.hypot(K,ie)||1,gt=Math.min(22,Math.max(10,lt*.15));y={x:m.x+K/lt*gt,y:m.y+ie/lt*gt},x.push(`L${y.x},${y.y}`)}let E=e.pathMode==="orthogonal";if(s.length>=4&&!E){let K=[s[0],...s,s[s.length-1]];for(let ie=1;ie<K.length-3;ie++){let lt=K[ie-1],gt=K[ie],xt=K[ie+1],Rt=K[ie+2],Sr=gt.x+(xt.x-lt.x)/6,Tr=gt.y+(xt.y-lt.y)/6,gn=xt.x-(Rt.x-gt.x)/6,xn=xt.y-(Rt.y-gt.y)/6;x.push(`C${Sr},${Tr} ${gn},${xn} ${xt.x},${xt.y}`)}x.push(`L${g.x},${g.y}`)}else if(s.length===3&&!E){let K=m,ie=s[1],lt=g,gt=g.x-ie.x,xt=g.y-ie.y,Rt=Math.hypot(gt,xt)||1,Sr=Math.min(20,Math.max(10,Rt*.15)),Tr={x:g.x-gt/Rt*Sr,y:g.y-xt/Rt*Sr},gn=y.x-m.x,xn=y.y-m.y,Wn=gn===0&&xn===0?ie.x-K.x:gn,Hn=gn===0&&xn===0?ie.y-K.y:xn,zn=Math.hypot(Wn,Hn)||1,cs=Math.min(40,Math.max(12,zn*1.2)),Ho=y.x+Wn/zn*cs,zo=y.y+Hn/zn*cs,Vo=(g.x-ie.x)/Rt,Yo=(g.y-ie.y)/Rt,Qo=Tr.x-Vo*(Sr*.6),Xo=Tr.y-Yo*(Sr*.6);x.push(`C${Ho},${zo} ${Qo},${Xo} ${Tr.x},${Tr.y}`),x.push(`L${g.x},${g.y}`)}else x.push(`L${g.x},${g.y}`);if(E){x.length=0,x.push(`M${m.x},${m.y}`);for(let K of s.slice(1,-1))x.push(`L${K.x},${K.y}`);x.push(`L${g.x},${g.y}`)}let A=`<path class="edge-path" d="${x.join(" ")}" stroke-linecap="round" stroke-linejoin="round"`,L=e.style?.stroke,k=e.style?.strokeWidth,N=e.style?.strokeOpacity;e.dasharray&&(a=String(e.dasharray));let v=e.animation;!a&&v&&(a="5 5"),a&&(A+=` stroke-dasharray="${a}"`),k!=null?A+=` stroke-width="${k}"`:c&&c!==1.5&&(A+=` stroke-width="${c}"`),N!=null&&(A+=` stroke-opacity="${N}"`),L&&(A+=` stroke="${L}"`);let R=v?` style="animation:${v}"`:"";if(A+=R+" />",e.label){let K=this.pointAtRatio(s,.55),ie=this.escapeXml(e.label),lt=4,gt=this.fontSize-3,xt=Math.max(18,Math.min(220,ie.length*6+lt*2)),Rt=14,Sr=K.x-xt/2,Tr=K.y-Rt/2,gn=`<rect class="edge-label-bg" x="${Sr}" y="${Tr}" width="${xt}" height="${Rt}" rx="3" />`,xn=`<text class="edge-label-text" x="${K.x}" y="${K.y}" text-anchor="middle" dominant-baseline="middle">${ie}</text>`,Wn="",Hn=s.length>=2?s[s.length-2]:g,zn=g.x-Hn.x,cs=g.y-Hn.y,Ho=Math.hypot(zn,cs)||1,zo=zn/Ho,Vo=cs/Ho,Yo=-Vo,Qo=zo,Xo=k??c,Vn=Math.max(6,Math.min(14,6+(Xo-1.5)*3)),Yn=Math.max(5,Math.min(12,5+(Xo-1.5)*2.5)),FX=g.x,KX=g.y,tp=g.x-zo*Vn,rp=g.y-Vo*Vn,GX=tp+Yo*(Yn/2),jX=rp+Qo*(Yn/2),WX=tp-Yo*(Yn/2),HX=rp-Qo*(Yn/2);if(Wn+=Ko(Hn,g,L||this.arrowStroke,Vn,Yn),u==="arrow"&&s.length>=2){let Xc=s[1],np=m.x-Xc.x,ip=m.y-Xc.y,sp=Math.hypot(np,ip)||1,op=np/sp,ap=ip/sp,VX=-ap,YX=op,QX=m.x-op*Vn,XX=m.y-ap*Vn;Wn+=Go(m,Xc,L||this.arrowStroke,Vn,Yn)}return{path:`<g>
    ${A}
    ${gn}
    ${xn}
    ${Wn}
  </g>`}}let b="",w=s.length>=2?s[s.length-2]:g,C=g.x-w.x,I=g.y-w.y,P=Math.hypot(C,I)||1,q=C/P,$=I/P,F=-$,J=q,ee=k??c,ae=Math.max(6,Math.min(14,6+(ee-1.5)*3)),oe=Math.max(5,Math.min(12,5+(ee-1.5)*2.5)),Ze=g.x,at=g.y,Ne=g.x-q*ae,At=g.y-$*ae,Ie=Ne+F*(oe/2),Je=At+J*(oe/2),Er=Ne-F*(oe/2),et=At-J*(oe/2);if(h==="arrow"&&(b+=Ko(w,g,L||this.arrowStroke,ae,oe)),u==="arrow"&&s.length>=2){let K=s[1],ie=m.x-K.x,lt=m.y-K.y,gt=Math.hypot(ie,lt)||1,xt=ie/gt,Sr=-(lt/gt),Tr=xt;b+=Go(m,K,L||this.arrowStroke,ae,oe)}let Lt=L||this.arrowStroke,Gt=K=>`<circle cx="${K.x}" cy="${K.y}" r="4.5" fill="none" stroke="${Lt}" stroke-width="${ee}" />`,It=K=>`<g transform="translate(${K.x},${K.y})"><path d="M -4 -4 L 4 4" stroke="${Lt}" stroke-width="${ee}"/><path d="M -4 4 L 4 -4" stroke="${Lt}" stroke-width="${ee}"/></g>`;return h==="circle"&&(b+=Gt(g)),h==="cross"&&(b+=It(g)),u==="circle"&&(b+=Gt(m)),u==="cross"&&(b+=It(m)),b?{path:`<g>${A}
${b}</g>`}:{path:A}}buildSmoothSegments(e){if(e.length<2)return{start:e[0]||{x:0,y:0},segs:[]};if(e.length===2){let l=e[0],f=e[1],u={x:l.x+(f.x-l.x)/3,y:l.y+(f.y-l.y)/3},h={x:l.x+2*(f.x-l.x)/3,y:l.y+2*(f.y-l.y)/3};return{start:l,segs:[{c1:u,c2:h,to:f}]}}let r=[e[0],...e,e[e.length-1]],n=[],i=1,s=r.length-3,o=1,a=.35,c=28;for(let l=1;l<r.length-2;l++){let f=r[l-1],u=r[l],h=r[l+1],d=r[l+2],p=l===i?a:o,m=l===s?a:o,g={x:u.x+(h.x-f.x)/6*p,y:u.y+(h.y-f.y)/6*p},x={x:h.x-(d.x-u.x)/6*m,y:h.y-(d.y-u.y)/6*m};if(l===i){let y=h.x-u.x,E=h.y-u.y,T=Math.hypot(y,E)||1,A=Math.min(c,T*.5);g={x:u.x+y/T*A,y:u.y+E/T*A}}if(l===s){let y=h.x-u.x,E=h.y-u.y,T=Math.hypot(y,E)||1,A=Math.min(c,T*.5);x={x:h.x-y/T*A,y:h.y-E/T*A}}n.push({c1:g,c2:x,to:{x:h.x,y:h.y}})}return{start:r[1],segs:n}}pathFromSegments(e){let r=`M${e.start.x},${e.start.y}`;for(let n of e.segs)r+=` C${n.c1.x},${n.c1.y} ${n.c2.x},${n.c2.y} ${n.to.x},${n.to.y}`;return r}trimSegmentsEnd(e,r){let n=e.segs.slice();if(!n.length)return e;let i={...n[n.length-1]},s=i.to.x-i.c2.x,o=i.to.y-i.c2.y,a=Math.hypot(s,o)||1,c=Math.max(.1,Math.min(r,Math.max(0,a-.2))),l=s/a,f=o/a,u={x:i.to.x-l*c,y:i.to.y-f*c};return i.to=u,n[n.length-1]=i,{start:e.start,segs:n}}trimSegmentsStart(e,r){let n=e.segs.slice();if(!n.length)return e;let i={...n[0]},s=i.c1.x-e.start.x,o=i.c1.y-e.start.y,a=Math.hypot(s,o)||1,c=Math.max(.1,Math.min(r,Math.max(0,a-.2))),l=s/a,f=o/a;return{start:{x:e.start.x+l*c,y:e.start.y+f*c},segs:n}}intersectSegmentsEnd(e,r){if(!e.segs.length)return e;let n=e.segs[e.segs.length-1],i=n.c2,s=n.to,o=this.intersectLineWithNode(i,s,r);if(o){let a=e.segs.slice();return a[a.length-1]={...n,to:o},{start:e.start,segs:a}}return e}intersectSegmentsStart(e,r){if(!e.segs.length)return e;let n=e.segs[0],i=e.start,s=n.c1,o=this.intersectLineWithNode(i,s,r);return o?{start:o,segs:e.segs}:e}intersectLineWithNode(e,r,n){let i=n.shape,s=()=>[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];switch(i){case"round":{let o=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];return this.linePolygonIntersection(e,r,o)||this.nearestPointOnPolygon(r,o)}case"circle":{let o=n.x+n.width/2,a=n.y+n.height/2,c=Math.min(n.width,n.height)/2;return this.lineCircleIntersection(e,r,{cx:o,cy:a,r:c})}case"diamond":{let o=n.x+n.width/2,a=n.y+n.height/2,c=[{x:o,y:n.y},{x:n.x+n.width,y:a},{x:o,y:n.y+n.height},{x:n.x,y:a}];return this.linePolygonIntersection(e,r,c)||this.nearestPointOnPolygon(r,c)}case"hexagon":{let o=Math.max(10,n.width*.2),a=[{x:n.x+o,y:n.y},{x:n.x+n.width-o,y:n.y},{x:n.x+n.width,y:n.y+n.height/2},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x+o,y:n.y+n.height},{x:n.x,y:n.y+n.height/2}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"parallelogram":{let o=Math.min(n.width*.25,n.height*.6),a=[{x:n.x+o,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x,y:n.y+n.height}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"trapezoid":{let o=Math.min(n.width*.2,n.height*.5),a=[{x:n.x+o,y:n.y},{x:n.x+n.width-o,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"trapezoidAlt":{let o=Math.min(n.width*.2,n.height*.5),a=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x+o,y:n.y+n.height}];return this.linePolygonIntersection(e,r,a)||this.nearestPointOnPolygon(r,a)}case"stadium":{let o=Math.min(n.height/2,n.width/2),a=[{x:n.x+o,y:n.y},{x:n.x+n.width-o,y:n.y},{x:n.x+n.width-o,y:n.y+n.height},{x:n.x+o,y:n.y+n.height}],c=this.linePolygonIntersection(e,r,a);if(c)return c;let l=this.lineCircleIntersection(e,r,{cx:n.x+o,cy:n.y+n.height/2,r:o}),f=this.lineCircleIntersection(e,r,{cx:n.x+n.width-o,cy:n.y+n.height/2,r:o});return((...d)=>{let p=null,m=-1/0;for(let g of d)if(g){let x=-((g.x-r.x)**2+(g.y-r.y)**2);x>m&&(m=x,p=g)}return p})(l,f)||this.nearestPointOnPolygon(r,a)}default:{let o=s();return this.linePolygonIntersection(e,r,o)||this.nearestPointOnPolygon(r,o)}}}lineCircleIntersection(e,r,n){let i=r.x-e.x,s=r.y-e.y,o=e.x-n.cx,a=e.y-n.cy,c=i*i+s*s,l=2*(o*i+a*s),f=o*o+a*a-n.r*n.r,u=l*l-4*c*f;if(u<0)return null;let h=Math.sqrt(u),d=(-l-h)/(2*c),p=(-l+h)/(2*c),m=[d,p].filter(x=>x>=0&&x<=1);if(!m.length)return null;let g=Math.max(...m);return{x:e.x+i*g,y:e.y+s*g}}linePolygonIntersection(e,r,n){let i=-1/0,s=null;for(let o=0;o<n.length;o++){let a=n[o],c=n[(o+1)%n.length],l=this.segmentIntersection(e,r,a,c);l&&l.t>=0&&l.t<=1&&l.u>=0&&l.u<=1&&l.t>i&&(i=l.t,s={x:l.x,y:l.y})}return s}nearestPointOnSegment(e,r,n){let i=n.x-r.x,s=n.y-r.y,o=i*i+s*s||1,a=e.x-r.x,c=e.y-r.y,l=(a*i+c*s)/o;return l=Math.max(0,Math.min(1,l)),{x:r.x+i*l,y:r.y+s*l}}nearestPointOnPolygon(e,r){let n=r[0],i=1/0;for(let s=0;s<r.length;s++){let o=r[s],a=r[(s+1)%r.length],c=this.nearestPointOnSegment(e,o,a),l=(c.x-e.x)*(c.x-e.x)+(c.y-e.y)*(c.y-e.y);l<i&&(i=l,n=c)}return{x:n.x,y:n.y}}segmentIntersection(e,r,n,i){let s={x:r.x-e.x,y:r.y-e.y},o={x:i.x-n.x,y:i.y-n.y},a=s.x*o.y-s.y*o.x;if(Math.abs(a)<1e-6)return null;let c={x:n.x-e.x,y:n.y-e.y},l=(c.x*o.y-c.y*o.x)/a,f=(c.x*s.y-c.y*s.x)/a,u=e.x+l*s.x,h=e.y+l*s.y;return{x:u,y:h,t:l,u:f}}pointAtRatio(e,r){let n=Math.max(0,Math.min(1,r)),i=0,s=[];for(let a=0;a<e.length-1;a++){let c=e[a+1].x-e[a].x,l=e[a+1].y-e[a].y,f=Math.hypot(c,l);s.push(f),i+=f}if(i===0)return e[Math.floor(e.length/2)];let o=i*n;for(let a=0;a<s.length;a++){if(o<=s[a]){let c=s[a]===0?0:o/s[a];return{x:e[a].x+(e[a+1].x-e[a].x)*c,y:e[a].y+(e[a+1].y-e[a].y)*c}}o-=s[a]}return e[e.length-1]}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};function Pv(t){if(!t)return t;let e=t.charAt(0),r=t.charAt(t.length-1);return e==='"'&&r==='"'||e==="'"&&r==="'"?t.slice(1,-1).replace(/\\(["'])/g,"$1"):t}function qv(t){let e=[],r=Ml(t);for(let o of r.errors)e.push({line:o.line??1,column:o.column??1,message:o.message,code:"PIE_LEX",severity:"error"});cr.reset(),cr.input=r.tokens;let n=cr.diagram();for(let o of cr.errors){let a=o.token;e.push({line:a?.startLine??1,column:a?.startColumn??1,message:o.message,code:"PIE_PARSE",severity:"error"})}let i={title:void 0,showData:!1,slices:[]};if(!n||!n.children)return{model:i,errors:e};n.children.ShowDataKeyword&&n.children.ShowDataKeyword.length>0&&(i.showData=!0);let s=n.children.statement??[];for(let o of s)if(o.children?.titleStmt){let a=o.children.titleStmt[0],c=[],l=u=>{let h=a.children?.[u]??[];for(let d of h)c.push(Pv(d.image))};l("QuotedString"),l("Text"),l("NumberLiteral");let f=c.join(" ").trim();f&&(i.title=f)}else if(o.children?.sliceStmt){let a=o.children.sliceStmt[0],c=a.children?.sliceLabel?.[0]?.children?.QuotedString?.[0],l=a.children?.NumberLiteral?.[0];if(c&&l){let f=Pv(c.image).trim(),u=Number(l.image);Number.isNaN(u)||i.slices.push({label:f,value:u})}}return{model:i,errors:e}}function Gc(t,e,r,n){return{x:t+r*Math.cos(n),y:e+r*Math.sin(n)}}function Dv(t,e={}){let r=Math.max(320,Math.floor(e.width??640)),n=Math.max(240,Math.floor(e.height??400)),i=24,s=t.title?28:0,o=r/2,a=(n+s)/2+(t.title?8:0),c=Math.max(40,Math.min(r,n-s)/2-i),l=t.slices.filter(k=>Math.max(0,k.value)>0),f=l.reduce((k,N)=>k+Math.max(0,N.value),0),u=12,h=8,d=18,p=l.map(k=>`${k.label}${t.showData?` ${Qd(Number(k.value))}`:""}`),m=p.length?Math.max(...p.map(k=>ot(k,12))):0,g=p.length?u+h+m+i:0;if(p.length){let k=i+c*2+g+i;k>r&&(r=Math.ceil(k))}let x=c;p.length&&(o=Math.max(i,(r-g-x*2)/2)+x);let y=-Math.PI/2,E=`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${n}" viewBox="0 0 ${r} ${n}">`;E+=`
  <style>
    .pie-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: 600; fill: #222; }
    .slice-label { font-family: Arial, sans-serif; font-size: 12px; fill: #222; dominant-baseline: middle; }
    .leader { stroke: #444; stroke-width: 1; fill: none; }
    .pieCircle { stroke: black; stroke-width: 2px; opacity: 0.7; }
    .pieOuterCircle { stroke: black; stroke-width: 2px; fill: none; }
  </style>`,t.title&&(E+=`
  <text class="pie-title" x="${o}" y="${i+8}" text-anchor="middle">${we(t.title)}</text>`),E+=`
  <g class="pie" aria-label="pie">`;let T=.35;l.forEach((k,N)=>{let v=f>0?Math.max(0,k.value)/f:0,R=2*Math.PI*v,b=y+R,w=R>Math.PI?1:0,C=Gc(o,a,x,y),I=Gc(o,a,x,b),P=[`M ${o} ${a}`,`L ${C.x.toFixed(2)} ${C.y.toFixed(2)}`,`A ${x} ${x} 0 ${w} 1 ${I.x.toFixed(2)} ${I.y.toFixed(2)}`,"Z"].join(" "),q=k.color||Yd(N);E+=`
    <path d="${P}" class="pieCircle" fill="${q}" />`;let $=(y+b)/2,F=Math.cos($),J=Math.sin($),ee=we(Uv(k.value,f));if(R<T){let ae=x*.9,oe=x*1.06,Ze=Gc(o,a,ae,$),at=Gc(o,a,oe,$),Ne=12,At=F<0,Ie=At?at.x-Ne:at.x+Ne,Je=at.y;E+=`
    <path class="leader" d="M ${Ze.x.toFixed(2)} ${Ze.y.toFixed(2)} L ${at.x.toFixed(2)} ${at.y.toFixed(2)} L ${Ie.toFixed(2)} ${Je.toFixed(2)}" />`;let Er=At?Ie-2:Ie+2,et=At?"end":"start";E+=`
    <text class="slice-label" x="${Er.toFixed(2)}" y="${Je.toFixed(2)}" text-anchor="${et}">${ee}</text>`}else{let ae=x*.62,oe={x:o+ae*F,y:a+ae*J},Ze=Math.abs(F)<.2?"middle":F>0?"start":"end",at=ae,At=ot(ee,12)>at*1.2?"middle":Ze;E+=`
    <text class="slice-label" x="${oe.x.toFixed(2)}" y="${oe.y.toFixed(2)}" text-anchor="${At}">${ee}</text>`}y=b});let A=e.rimStroke||"black",L=e.rimStrokeWidth!=null?String(e.rimStrokeWidth):"2px";if(E+=`
  </g>
  <circle class="pie-rim pieOuterCircle" cx="${o}" cy="${a}" r="${x}" stroke="${A}" stroke-width="${L}" fill="none" />`,p.length){let k=o+x+i/2,N=p.length*d,v=a-N/2+10;E+=`
  <g class="legend">`,l.forEach((R,b)=>{let w=v+b*d,C=R.color||Yd(b),I=we(`${R.label}${t.showData?` ${Qd(Number(R.value))}`:""}`);E+=`
    <rect x="${k}" y="${w-u+6}" width="${u}" height="${u}" fill="${C}" stroke="${C}" stroke-width="1" />`,E+=`
    <text class="slice-label legend-text" x="${k+u+h}" y="${w}" text-anchor="start">${I}</text>`}),E+=`
  </g>`}return E+=`
</svg>`,E}function $v(t){if(!t||t.length===0)return"";let e=[];for(let r of t){let n=r.image??"";r.tokenType?.name==="QuotedString"&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?e.push(n.slice(1,-1)):e.push(n)}return e.join(" ").replace(/\s+/g," ").trim()}function Kt(t){if(!t)return"";let e=t.children||{},r=[];return["Identifier","QuotedString","NumberLiteral","Text"].forEach(n=>{e[n]?.forEach(s=>r.push(s))}),r.sort((n,i)=>(n.startOffset??0)-(i.startOffset??0)),$v(r)}function jn(t){if(!t)return;let e=t.children||{},r=[],n=["Identifier","NumberLiteral","QuotedString","Text","Plus","Minus","Comma","Colon","LParen","RParen"];for(let s of n)e[s]?.forEach(o=>r.push(o));return r.sort((s,o)=>(s.startOffset??0)-(o.startOffset??0)),$v(r)||void 0}function Bv(t){return t.trim().replace(/\s+/g,"_")}function gr(t,e,r,n){let i=Bv(r),s=t.get(i)||(e.get(r)?t.get(e.get(r)):void 0);if(s)return s;let o={id:i,display:n||r};return t.set(o.id,o),e.set(o.display,o.id),o}function TX(t){let e=t.children||{};return e.BidirAsyncDotted?{line:"dotted",start:"arrow",end:"arrow",async:!0}:e.BidirAsync?{line:"solid",start:"arrow",end:"arrow",async:!0}:e.DottedAsync?{line:"dotted",start:"none",end:"arrow",async:!0}:e.Async?{line:"solid",start:"none",end:"arrow",async:!0}:e.Dotted?{line:"dotted",start:"none",end:"arrow"}:e.Solid?{line:"solid",start:"none",end:"arrow"}:e.DottedCross?{line:"dotted",start:"none",end:"cross"}:e.Cross?{line:"solid",start:"none",end:"cross"}:e.DottedOpen?{line:"dotted",start:"none",end:"open"}:e.Open?{line:"solid",start:"none",end:"open"}:{line:"solid",start:"none",end:"arrow"}}function Fv(t){let{tokens:e}=Xl(t);nn.input=e;let r=nn.diagram(),n=new Map,i=new Map,s=[],o={on:!1},a,c,l,u=(r.children||{}).line||[],h=[];function d(m){let g=m.children||{};if(g.metaStmt){let T=g.metaStmt[0].children||{},A=jn(T.lineRemainder?.[0])||"";T.TitleKeyword&&(a=A),T.AccTitleKeyword&&(c=A),T.AccDescrKeyword&&(l=A);return}if(g.participantDecl){let T=g.participantDecl[0].children||{},A=T.actorRef?.[0],L=T.actorRef?.[1],k=Kt(A),N=L?Kt(L):void 0,v=Bv(k),b=gr(n,i,v,N||k);s.push({kind:"create",actor:b.id,display:b.display});return}if(g.autonumberStmt){let T=g.autonumberStmt[0].children||{};o={on:!0};let A=T.NumberLiteral||[];A.length>=1&&(o.start=Number(A[0].image)),A.length>=2&&(o.step=Number(A[1].image)),T.OffKeyword&&(o={on:!1});return}if(g.activateStmt){let T=g.activateStmt[0].children||{},A=Kt(T.actorRef?.[0]),L=gr(n,i,A);s.push({kind:"activate",actor:L.id});return}if(g.deactivateStmt){let T=g.deactivateStmt[0].children||{},A=Kt(T.actorRef?.[0]),L=gr(n,i,A);s.push({kind:"deactivate",actor:L.id});return}if(g.createStmt){let T=g.createStmt[0].children||{},A=Kt(T.actorRef?.[0]),L=T.lineRemainder?jn(T.lineRemainder[0]):void 0,k=gr(n,i,A,L||A);s.push({kind:"create",actor:k.id,display:k.display});return}if(g.destroyStmt){let T=g.destroyStmt[0].children||{},A=Kt(T.actorRef?.[0]),L=gr(n,i,A);s.push({kind:"destroy",actor:L.id});return}if(g.noteStmt){let T=g.noteStmt[0].children||{},A=jn(T.lineRemainder?.[0])||"";if(T.LeftKeyword||T.RightKeyword){let L=T.LeftKeyword?"leftOf":"rightOf",k=Kt(T.actorRef?.[0]),N=gr(n,i,k),v={pos:L,actors:[N.id],text:A};s.push({kind:"note",note:v})}else if(T.OverKeyword){let L=Kt(T.actorRef?.[0]),k=T.actorRef?.[1]?Kt(T.actorRef?.[1]):void 0,v=[gr(n,i,L).id];if(k){let R=gr(n,i,k);v.push(R.id)}s.push({kind:"note",note:{pos:"over",actors:v,text:A}})}return}let x=[{key:"altBlock",type:"alt",branchKeys:[{key:"ElseKeyword",kind:"else"}]},{key:"optBlock",type:"opt"},{key:"loopBlock",type:"loop"},{key:"parBlock",type:"par",branchKeys:[{key:"AndKeyword",kind:"and"}]},{key:"criticalBlock",type:"critical",branchKeys:[{key:"OptionKeyword",kind:"option"}]},{key:"breakBlock",type:"break"},{key:"rectBlock",type:"rect"},{key:"boxBlock",type:"box"}],y=!1;for(let E of x)if(g[E.key]){y=!0;let A=g[E.key][0].children||{},L=jn(A.lineRemainder?.[0]),k={type:E.type,title:L,branches:E.branchKeys?[]:void 0};if(h.push(k),s.push({kind:"block-start",block:k}),E.branchKeys){let N=A.Newline||[],v=E.branchKeys[0].key,R=A[v],b=A.lineRemainder;if(R&&R.length){let w=(b||[]).slice(1);for(let C=0;C<R.length;C++){let I=w[C]?jn(w[C]):void 0,P={kind:E.branchKeys[0].kind,title:I};k.branches.push(P),s.push({kind:"block-branch",block:k,branch:P})}}}s.push({kind:"block-end",block:k}),h.pop();break}if(!y){if(g.messageStmt){let T=g.messageStmt[0].children||{},A=Kt(T.actorRef?.[0]),L=Kt(T.actorRef?.[1]),k=gr(n,i,A).id,N=gr(n,i,L).id,v=TX(T.arrow?.[0]),R=jn(T.lineRemainder?.[0]),b=!!T.Plus,w=!!T.Minus,C={from:k,to:N,text:R,line:v.line,startMarker:v.start,endMarker:v.end,async:v.async,activateTarget:b,deactivateTarget:w};s.push({kind:"message",msg:C});return}if(g.linkStmt){s.push({kind:"noop"});return}s.push({kind:"noop"})}}function p(m){let g=[],x=m.children||{};for(let y of Object.keys(x)){let E=x[y];if(Array.isArray(E))for(let T of E)T&&typeof T=="object"&&T.name==="line"&&g.push(T)}return g}for(let m of u){d(m);let g=m.children||{},x=g.altBlock?.[0]||g.optBlock?.[0]||g.loopBlock?.[0]||g.parBlock?.[0]||g.criticalBlock?.[0]||g.breakBlock?.[0]||g.rectBlock?.[0]||g.boxBlock?.[0];if(x)for(let y of p(x))d(y)}return{participants:Array.from(n.values()),events:s,autonumber:o.on===!0||o.on===!1?o:{on:!1},title:a,accTitle:c,accDescr:l}}var Xd=24,jc=24,OX=16,Wc=30,AX=4,LX=12,bX=110,xr=36,Zd=160,mn=8,Hc=12,kX=12;function Kv(t){let e=[],r=new Set,n=new Map(t.participants.map(b=>[b.id,b]));function i(b){r.has(b)||(r.add(b),e.push(b))}for(let b of t.events)b.kind==="message"&&(i(b.msg.from),i(b.msg.to)),b.kind==="note"&&b.note.actors.forEach(i),(b.kind==="activate"||b.kind==="deactivate"||b.kind==="create"||b.kind==="destroy")&&i(b.actor);for(let b of t.participants)i(b.id);let s=[],o=Xd;for(let b of e){let w=n.get(b)||{id:b,display:b},C=Math.max(bX,ot(w.display,OX)+LX*2);s.push({id:b,display:w.display,x:o,y:jc,width:C,height:Wc}),o+=C+Xd}let a=Math.max(320,o),c=new Map,l=0,f=[];function u(b){c.set(b,l++)}t.events.forEach((b,w)=>{switch(b.kind){case"message":u(w);break;case"note":u(w);break;case"block-start":f.push({block:b.block,startRow:l,branches:[]}),u(w);break;case"block-branch":{let C=f[f.length-1];C&&C.branches.push({title:b.branch.title,row:l}),u(w);break}case"block-end":break;case"activate":case"deactivate":case"create":case"destroy":case"noop":break}});let h=jc+Wc+AX,d=l*xr,p=h+d+jc+Wc,m=s.map(b=>({x:b.x+b.width/2,y1:h,y2:p-jc-Wc}));function g(b){return h+b*xr+xr/2}let x=new Map(s.map(b=>[b.id,b])),y=[],E=[],T=[],A=[],L=new Map,k=(b,w)=>{let C=L.get(b)||[];C.push(w),L.set(b,C)},N=(b,w)=>{let C=L.get(b)||[],I=C.pop();if(I!=null){let P=x.get(b);P&&A.push({actor:b,x:P.x+P.width/2-3,y:g(I)-xr/2,width:6,height:g(w)-g(I)})}L.set(b,C)},v=[];t.events.forEach((b,w)=>{let C=c.has(w)?c.get(w):null;switch(b.kind){case"message":{let I=x.get(b.msg.from),P=x.get(b.msg.to);if(I&&P&&C!=null){let q=g(C),$=I.x+I.width/2,F=P.x+P.width/2;y.push({from:I.id,to:P.id,text:b.msg.text,y:q,x1:$,x2:F,line:b.msg.line,startMarker:b.msg.startMarker,endMarker:b.msg.endMarker,async:b.msg.async}),b.msg.activateTarget&&k(b.msg.to,C),b.msg.deactivateTarget&&N(b.msg.to,C);let J=v[v.length-1];J&&(J.lastRow=C)}break}case"note":{if(C==null)break;let I=($,F)=>{let J=Math.max(8,Math.floor((F-mn*2)/7)),ee=$?$.length:0;return Math.max(1,Math.ceil(ee/J))},P=g(C)-mn;if(b.note.pos==="over"){let[$,F]=b.note.actors,J=x.get($),ee=F?x.get(F):J;if(J&&ee){let ae=Math.min(J.x+J.width/2,ee.x+ee.width/2),Ze=Math.max(J.x+J.width/2,ee.x+ee.width/2)-ae+mn*2,at=I(b.note.text,Ze),Ne=Math.max(xr-mn,at*16+mn);E.push({x:ae-mn,y:P,width:Ze,height:Ne,text:b.note.text,anchor:"over"})}}else{let $=b.note.actors[0],F=x.get($);if(F){let J=b.note.pos==="leftOf",ee=J?F.x-Zd-10:F.x+F.width+10,ae=I(b.note.text,Zd),oe=Math.max(xr-mn,ae*16+mn);E.push({x:ee,y:P,width:Zd,height:oe,text:b.note.text,anchor:J?"left":"right"})}}let q=v[v.length-1];q&&C!=null&&(q.lastRow=C);break}case"activate":C!=null&&k(b.actor,C);break;case"deactivate":C!=null&&N(b.actor,C);break;case"block-start":{let I=C??l;v.push({block:b.block,startRow:I,branches:[]});break}case"block-branch":{let I=v[v.length-1];I&&C!=null&&(I.branches.push({title:b.branch.title,row:C}),I.lastRow=C);break}case"block-end":{let I=v.pop();if(I){let P=s.length>0?s[0]:void 0,q=s.length>0?s[s.length-1]:void 0,$=P?P.x:Xd,F=q?q.x+q.width:$+200,J=g(I.startRow)-xr/2-(Hc+kX),ee=I.lastRow!=null?I.lastRow:I.startRow,ae=g(ee)+xr/2+Hc,oe={type:I.block.type,title:I.block.title,x:$-Hc,y:J,width:F-$+Hc*2,height:ae-J};I.branches.length&&(oe.branches=I.branches.map(Ze=>({title:Ze.title,y:g(Ze.row)-xr/2}))),T.push(oe)}break}default:break}});let R=l;for(let[b,w]of L.entries())for(;w.length;){let C=w.pop(),I=x.get(b);I&&A.push({actor:b,x:I.x+I.width/2-3,y:g(C)-xr/2,width:6,height:g(R)-g(C)})}return{width:a,height:p,participants:s,lifelines:m,messages:y,notes:E,blocks:T,activations:A}}function Gv(t,e={}){let r=Kv(t),n=[],i=Math.ceil(r.width),s=Math.ceil(r.height);n.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${i+50}" height="${s+40}" viewBox="-50 -10 ${i+50} ${s+40}">`);let o=pn({fontFamily:"Arial, sans-serif",fontSize:14,nodeFill:"#eef0ff",nodeStroke:"#3f3f3f",edgeStroke:"#555555"});n.push(`  <style>${o}</style>`);let a=t.accTitle||t.title||void 0,c=t.accDescr||void 0;if(a&&n.push(`  <title>${we(a)}</title>`),c&&n.push(`  <desc>${we(c)}</desc>`),t.title){let h=we(t.title),d=Math.max(20,ot(t.title,16)),p=i/2;n.push(`  <text class="node-label" x="${p}" y="0" text-anchor="middle" font-size="16">${h}</text>`)}for(let h of r.participants)NX(n,h);for(let h of r.blocks)n.push(Fc(h.x,h.y,h.width,h.height,0));for(let h of r.lifelines)n.push(`  <line class="lifeline" x1="${h.x}" y1="${h.y1}" x2="${h.x}" y2="${h.y2}"/>`);for(let h of r.activations)n.push(`  <rect class="activation" x="${h.x}" y="${h.y}" width="${h.width}" height="${h.height}" />`);let l=t.autonumber?.on?t.autonumber.start??1:void 0,f=t.autonumber?.on?t.autonumber.step??1:void 0;for(let h of r.messages){vX(n,h);let d=wX(h.text,l);d&&IX(n,h,d,l),l!=null&&(l+=f)}for(let h of r.notes)RX(n,h);for(let h of r.blocks){let d=h.title?`${h.type}: ${h.title}`:h.type,p=(h.branches||[]).map(m=>({y:m.y,title:m.title}));n.push(Kc(h.x,h.y,h.width,h.height,d,p.map(m=>({...m,y:m.y+.5})),8,"left","left",0))}for(let h of r.participants)CX(n,h,r);n.push("</svg>");let u=n.join(`
`);return e.theme&&(u=MX(jo(u,e.theme),e.theme)),u}function NX(t,e){t.push(`  <g class="actor" transform="translate(${e.x},${e.y})">`),t.push(`    <rect class="node-shape" width="${e.width}" height="${e.height}" rx="0"/>`),t.push(`    <text class="node-label" x="${e.width/2}" y="${e.height/2}" text-anchor="middle" dominant-baseline="middle">${we(e.display)}</text>`),t.push("  </g>")}function CX(t,e,r){let n=r.lifelines.find(s=>Math.abs(s.x-(e.x+e.width/2))<.001),i=n?n.y2:r.height-28;t.push(`  <g class="actor" transform="translate(${e.x},${i})">`),t.push(`    <rect class="node-shape" width="${e.width}" height="${e.height}" rx="0"/>`),t.push(`    <text class="node-label" x="${e.width/2}" y="${e.height/2}" text-anchor="middle" dominant-baseline="middle">${we(e.display)}</text>`),t.push("  </g>")}function vX(t,e){let r=`msg-line ${e.line}`.trim(),n=e.x1,i=e.x2,s=e.y;t.push(`  <path class="${r}" d="M ${n} ${s} L ${i} ${s}" />`);let o={x:n,y:s},a={x:i,y:s};e.endMarker==="arrow"&&t.push("  "+Ko(o,a,void 0,9,7)),e.startMarker==="arrow"&&t.push("  "+Go(o,a,void 0,9,7)),e.endMarker==="open"&&t.push(`  <circle class="openhead" cx="${i}" cy="${s}" r="4" />`),e.startMarker==="open"&&t.push(`  <circle class="openhead" cx="${n}" cy="${s}" r="4" />`),e.endMarker==="cross"&&t.push(`  <g class="crosshead" transform="translate(${i},${s})"><path d="M -4 -4 L 4 4"/><path d="M -4 4 L 4 -4"/></g>`),e.startMarker==="cross"&&t.push(`  <g class="crosshead" transform="translate(${n},${s})"><path d="M -4 -4 L 4 4"/><path d="M -4 4 L 4 -4"/></g>`)}function wX(t,e){if(!(!t&&e==null))return e!=null&&t?`${e}: ${t}`:e!=null?String(e):t}function IX(t,e,r,n){let i=(e.x1+e.x2)/2,s=16,o=Math.max(20,ot(r,12)+10),a=i-o/2,c=e.y-14-s/2;t.push(`  <rect class="msg-label-bg" x="${a}" y="${c}" width="${o}" height="${s}" rx="3"/>`),t.push(`  <text class="msg-label" x="${i}" y="${c+s/2}" text-anchor="middle">${we(r)}</text>`)}function RX(t,e){t.push(`  <g class="note" transform="translate(${e.x},${e.y})">`),t.push(`    <rect width="${e.width}" height="${e.height}" rx="0"/>`),t.push(`    <text class="note-text" x="${e.width/2}" y="${e.height/2+4}" text-anchor="middle">${we(e.text)}</text>`),t.push("  </g>")}function MX(t,e){let r=t;return e.lifelineColor&&(r=r.replace(/\.lifeline\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lifelineColor)};`))),e.lineColor&&(r=r.replace(/\.msg-line\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lineColor)};`))),e.arrowheadColor&&(r=r.replace(/(<path d=\"M[0-9.,\s-]+Z\" fill=\")[^\"]+(\")/g,(n,i,s)=>`${i}${String(e.arrowheadColor)}${s}`),r=r.replace(/\.openhead\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`)),r=r.replace(/\.crosshead\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.arrowheadColor)};`))),e.noteBkg&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteBkg)};`))),e.noteBorder&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.noteBorder)};`))),e.noteTextColor&&(r=r.replace(/\.note-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteTextColor)};`))),e.activationBkg&&(r=r.replace(/\.activation\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.activationBkg)};`))),e.activationBorder&&(r=r.replace(/\.activation\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.activationBorder)};`))),r}function zc(t){if(!t||t.length===0)return"";let e=[];for(let r of t){let n=r.image??"";r.tokenType&&r.tokenType.name==="QuotedString"&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?e.push(n.slice(1,-1)):e.push(n)}return e.join(" ").replace(/\s+/g," ").trim()}function Jd(t,e={}){if(!t)return{id:"",kind:"simple"};let r=t.children||{};if(r.Start){let a=e.isTarget?"end":"start";return{id:`__${a}_${r.Start[0].startOffset??0}`,kind:a}}if(r.HistoryDeep)return{id:`__histdeep_${r.HistoryDeep[0].startOffset??0}`,label:"H*",kind:"history-deep"};if(r.HistoryShallow)return{id:`__hist_${r.HistoryShallow[0].startOffset??0}`,label:"H",kind:"history"};let n;if(r.AngleAngleOpen&&r.Identifier&&r.AngleAngleClose){let a=String(r.Identifier[0].image).toLowerCase();a==="choice"?n="choice":a==="fork"?n="fork":a==="join"&&(n="join")}let i=[];r.Identifier?.forEach(a=>i.push(a)),r.QuotedString?.forEach(a=>i.push(a)),i.sort((a,c)=>(a.startOffset??0)-(c.startOffset??0));let s=zc(i)||"";return{id:s.trim().replace(/\s+/g,"_"),label:s,kind:n||"simple"}}function jv(t){let{tokens:e}=ac(t);Yi.input=e;let r=Yi.diagram(),n="TD",i=new Map,s=[],o=[],a=[],c=[],f=(r.children||{}).statement||[];function u(d){let p=i.get(d.id);if(p)return p;i.set(d.id,d);let m=c[c.length-1];if(m){let g=m.id,x=`${g}__lane${m.lane}`,y=o.find(T=>T.id===x);y||(o.find(T=>T.id===g)||o.push({id:g,label:g,nodes:[],parent:c.length>1?c[c.length-2].id:void 0}),o.push({id:x,label:void 0,nodes:[],parent:g}),a.push({parentId:g,id:x,nodes:[]})),y=o.find(T=>T.id===x),y.nodes.includes(d.id)||y.nodes.push(d.id);let E=a.find(T=>T.id===x);E&&!E.nodes.includes(d.id)&&E.nodes.push(d.id),d.parent=x}return d}function h(d){let p=d.children||{};if(p.directionStmt){n=p.directionStmt[0].children.Direction?.[0]?.image||"TD";return}if(p.stateDecl){let g=p.stateDecl[0].children||{};if(g.QuotedString&&g.AsKw&&g.Identifier){let x=g.QuotedString[0].image.slice(1,-1),y=g.Identifier[0].image;u({id:y,label:x,kind:"simple"})}else if(g.Identifier){let x=g.Identifier[0].image;u({id:x,label:x,kind:"simple"})}return}if(p.stateBlock){let m=p.stateBlock[0],g=m.children||{},x=g.Identifier?.[0]||g.QuotedString?.[0],y=x?x.image.startsWith('"')?x.image.slice(1,-1):x.image:`__state_${m.location??Math.random()}`,E=y.replace(/\s+/g,"_");u({id:E,label:y,kind:"composite"}),o.find(A=>A.id===E)||o.push({id:E,label:y,nodes:[],parent:c.length?c[c.length-1].id:void 0}),c.push({id:E,lane:0});let T=g.innerStatement||[];for(let A of T)h(A);c.pop();return}if(p.transitionStmt){let g=p.transitionStmt[0].children||{},x=Jd(g.actorRef?.[0],{isTarget:!1}),y=Jd(g.actorRef?.[1],{isTarget:!0});x.id&&u({id:x.id,label:x.label||x.id,kind:x.kind}),y.id&&u({id:y.id,label:y.label||y.id,kind:y.kind});let E;if(g.Colon&&g.labelText){let T=[];g.labelText.forEach(A=>{let L=A.children||{};["QuotedString","Identifier","NumberLiteral","LabelChunk"].forEach(k=>L[k]?.forEach(N=>T.push(N)))}),T.sort((A,L)=>(A.startOffset??0)-(L.startOffset??0)),E=zc(T)}x.id&&y.id&&s.push({source:x.id,target:y.id,label:E});return}if(d.name==="innerStatement"){let m=d.children||{};if(m.Dashes&&m.Dashes.length&&c.length){c[c.length-1].lane+=1;return}}if(p.noteStmt){let m=p.noteStmt[0],g=m.children||{},x=[],y=g.actorRef?.[0],E=Jd(y);["QuotedString","Identifier","NumberLiteral","LabelChunk"].forEach(A=>g[A]?.forEach(L=>x.push(L)));let T=zc(x);if(E.id&&T){let A=`__note_${(m.location??Math.random()).toString().slice(2)}`;u({id:A,label:T,kind:"simple"}),u({id:E.id,label:E.label||E.id,kind:E.kind}),s.push({source:A,target:E.id,label:void 0})}return}if(p.stateDescriptionStmt){let g=p.stateDescriptionStmt[0].children||{},x=g.Identifier?.[0]||g.QuotedString?.[0];if(x){let y=x.image.startsWith('"')?x.image.slice(1,-1):x.image,E=y.replace(/\s+/g,"_"),T=[];["QuotedString","Identifier","NumberLiteral","LabelChunk"].forEach(L=>g[L]?.forEach(k=>T.push(k)));let A=zc(T);u({id:E,label:A||y,kind:"simple"})}return}for(let m of Object.keys(p)){let g=p[m];Array.isArray(g)&&g.forEach(x=>h(x))}}for(let d of f)h(d);return{direction:n,nodes:Array.from(i.values()),transitions:s,composites:o,lanes:a}}function _X(t){let e=[],r=[],n=[];for(let s of t.nodes){let o="rectangle",a=s.label||s.id;s.kind==="start"||s.kind==="end"?(o="circle",a=""):s.kind==="history"?(o="circle",a="H"):s.kind==="history-deep"?(o="circle",a="H*"):s.kind==="choice"?o="diamond":(s.kind==="fork"||s.kind==="join")&&(o="rectangle");let c={id:s.id,label:a,shape:o};(s.kind==="fork"||s.kind==="join")&&(c.width=80,c.height=8),e.push(c)}for(let s of t.transitions)r.push({id:`${s.source}->${s.target}-${Math.random().toString(36).slice(2,7)}`,source:s.source,target:s.target,label:s.label,type:"arrow",markerEnd:"arrow"});for(let s of t.composites)n.push({id:s.id,label:s.label,nodes:s.nodes,parent:s.parent});let i=(t.lanes||[]).slice();return{graph:{nodes:e,edges:r,subgraphs:n,direction:t.direction},laneGroups:i}}function Wv(t){var e;let{graph:r,laneGroups:n}=_X(t),i=new Ur().layout(r),s=new Gn().render(i),o=Object.fromEntries(i.nodes.map(u=>[u.id,{x:u.x,y:u.y,width:u.width,height:u.height}])),a=Object.fromEntries((i.subgraphs||[]).map(u=>[u.id,{x:u.x,y:u.y,width:u.width,height:u.height,label:u.label}])),c=[],l={};for(let u of n){if(!a[u.parentId])continue;let d=u.nodes.map(p=>o[p]).filter(Boolean);d.length&&(l[e=u.parentId]||(l[e]=[])).push({id:u.id,nodes:d})}let f=u=>{let h=/(.*)__lane(\d+)/.exec(u);return h?parseInt(h[2],10):Number.POSITIVE_INFINITY};for(let u of Object.keys(l)){let h=a[u];if(!h)continue;let d=l[u].slice();d.every(p=>/__lane\d+/.test(p.id))?d.sort((p,m)=>f(p.id)-f(m.id)):r.direction==="LR"||r.direction==="RL"?d.sort((p,m)=>Math.min(...p.nodes.map(g=>g.x))-Math.min(...m.nodes.map(g=>g.x))):d.sort((p,m)=>Math.min(...p.nodes.map(g=>g.y))-Math.min(...m.nodes.map(g=>g.y)));for(let p=1;p<d.length;p++){let m=d[p-1],g=d[p];if(r.direction==="LR"||r.direction==="RL"){let x=Math.max(...m.nodes.map(T=>T.x+T.width)),y=Math.min(...g.nodes.map(T=>T.x)),E=Math.max(h.x,Math.min(h.x+h.width,(x+y)/2));c.push(`<line class="lane-divider" x1="${E}" y1="${h.y+14}" x2="${E}" y2="${h.y+h.height}" />`)}else{let x=Math.max(...m.nodes.map(T=>T.y+T.height)),y=Math.min(...g.nodes.map(T=>T.y)),E=Math.max(h.y+14,Math.min(h.y+h.height,(x+y)/2));c.push(`<line class="lane-divider" x1="${h.x}" y1="${E}" x2="${h.x+h.width}" y2="${E}" />`)}}}for(let u of i.nodes){let h=(t.nodes||[]).find(g=>g.id===u.id);if(!h||h.kind!=="end")continue;let d=u.x+u.width/2,p=u.y+u.height/2,m=Math.max(1,Math.min(u.width,u.height)/2-3);c.push(`<circle class="end-double" cx="${d}" cy="${p}" r="${m}" fill="none" />`)}if(c.length&&(s=s.replace("</svg>",`<g class="state-overlays">${c.join(`
`)}</g></svg>`)),!/<style>/.test(s)){let u=pn();s=s.replace("<svg ","<svg ").replace("</svg>",`<style>${u}</style></svg>`)}return s}function zv(t){let r=(t.startsWith("\uFEFF")?t.slice(1):t).split(/\r?\n/);if(r.length<3||r[0].trim()!=="---")return null;let n=1,i=[];for(;n<r.length&&r[n].trim()!=="---";)i.push(r[n]),n++;if(n>=r.length)return null;let s=r.slice(n+1).join(`
`),o=i.join(`
`),a={},c={},l=!1,f="root";for(let u of i){if(!u.trim())continue;let h=u.match(/^\s*/)?.[0].length??0,d=u.match(/^\s*([A-Za-z0-9_\-]+):\s*(.*)$/);if(!d)continue;let p=d[1],m=d[2]||"";if(h===0){if(p==="config"){f="config";continue}if(p==="themeVariables"){f="theme";continue}f="root";continue}if(f==="config"){if(h<=2&&p!=="pie"&&p!=="themeVariables")continue;if(p==="pie"){f="config.pie",ep(a,"pie",{});continue}if(p==="themeVariables"){f="theme",l=!0;continue}continue}if(f==="config.pie"){if(h<4){if(p==="pie"){f="config.pie",ep(a,"pie",{});continue}if(p==="themeVariables"){f="theme",l=!0;continue}f="config";continue}Hv(a.pie,p,m);continue}if(f==="theme"){if(h<2){f="root";continue}Hv(c,p,m);continue}}return l&&Object.keys(c).length&&(ep(a,"themeVariables",{}),Object.assign(a.themeVariables,c)),{raw:o,body:s,config:Object.keys(a).length?a:void 0,themeVariables:Object.keys(c).length?c:void 0}}function ep(t,e,r){t[e]==null&&(t[e]=r)}function UX(t){let e=t.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function Hv(t,e,r){let n=UX(r);if(n===""){t[e]="";return}let i=Number(n);if(!Number.isNaN(i)&&/^-?[0-9]+(\.[0-9]+)?$/.test(n)){t[e]=i;return}if(/^(true|false)$/i.test(n)){t[e]=/^true$/i.test(n);return}t[e]=n}function Vc(t){if(!t||t.length===0)return"";let e=[];for(let r of t){let n=r.image??"";r.tokenType&&r.tokenType.name==="QuotedString"&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?e.push(n.slice(1,-1)):e.push(n)}return e.join(" ").replace(/\s+/g," ").trim()}function Wo(t){if(!t)return"";let e=t.children||{},r=[];return["Identifier","QuotedString","BacktickName"].forEach(n=>{e[n]?.forEach(s=>r.push(s))}),r.sort((n,i)=>(n.startOffset??0)-(i.startOffset??0)),Vc(r)}function Vv(t){let e=t.children||{},r=[],n=["Visibility","Identifier","QuotedString","LParen","RParen","Comma","Colon","NumberLiteral"];for(let o of n)e[o]?.forEach(a=>r.push(a));r.sort((o,a)=>(o.startOffset??0)-(a.startOffset??0));let i=Vc(r),s=/(\)\s*:|\)$)/.test(i)||/\(/.test(i);return{text:i,isMethod:s}}function Yv(t){return t.trim().replace(/\s+/g,"_")}function Qv(t){let{tokens:e}=rc(t);Vi.input=e;let r=Vi.diagram(),n=new Map,i=[],s=[],o="TD";function a(f,u){let h=Yv(f),d=n.get(h);if(d)return d;let p={id:h,display:u||f,attributes:[],methods:[]};return n.set(h,p),p}let l=(r.children||{}).statement||[];for(let f of l){let u=f.children||{};if(u.directionStmt){let h=u.directionStmt[0].children.Direction?.[0]?.image||"TD";h==="TB"?o="TB":h==="BT"?o="BT":h==="LR"?o="LR":h==="RL"?o="RL":o="TD";continue}if(u.classLine){let d=u.classLine[0].children||{},p=Wo(d.classRef?.[0]),m=a(p);if(d.LTlt&&d.Identifier&&d.GTgt&&(m.stereotype=d.Identifier[0].image),d.LCurly&&d.memberLineStmt){let g=d.memberLineStmt;for(let x of g){let y=Vv(x.children.memberLine?.[0]);y.text&&(y.isMethod?m.methods:m.attributes).push(y.text)}}continue}if(u.memberAssignStmt){let d=u.memberAssignStmt[0].children||{},p=Wo(d.classRef?.[0]),m=a(p),g=Vv(d.memberLine?.[0]);g.text&&(g.isMethod?m.methods:m.attributes).push(g.text);continue}if(u.noteStmt){let d=u.noteStmt[0].children||{},p=Wo(d.classRef?.[0]),m=[];["QuotedString","Identifier","NumberLiteral"].forEach(x=>d[x]?.forEach(y=>m.push(y)));let g=Vc(m);p&&g&&s.push({target:Yv(p),text:g});continue}if(u.relationStmt){let d=u.relationStmt[0].children||{},p=Wo(d.classRef?.[0]),m=Wo(d.classRef?.[1]),g=a(p).id,x=a(m).id,y=d.leftCard?.[0],E=d.rightCard?.[0],T=y?.image?y.image.slice(1,-1):void 0,A=E?.image?E.image.slice(1,-1):void 0,L;if(d.labelText){let w=[];d.labelText.forEach(C=>{let I=C.children||{};["QuotedString","Identifier","NumberLiteral","GenericAngle"].forEach(P=>{I[P]?.forEach(q=>w.push(q))})}),w.sort((C,I)=>(C.startOffset??0)-(I.startOffset??0)),L=Vc(w)}let k=[{key:"RelAssociation",kind:"association"},{key:"RelDependency",kind:"dependency"},{key:"RelRealization",kind:"realization"},{key:"RelExtends",kind:"extends"},{key:"RelAggregation",kind:"aggregation"},{key:"RelComposition",kind:"composition"},{key:"RelDependencyLeft",kind:"dependency"},{key:"RelRealizationLeft",kind:"realization"},{key:"RelExtendsRight",kind:"extends"},{key:"RelAggBoth",kind:"aggregation-both"},{key:"RelCompBoth",kind:"composition-both"},{key:"RelAggToComp",kind:"aggregation-to-comp"},{key:"RelCompToAgg",kind:"composition-to-agg"},{key:"LollipopLeft",kind:"lollipop-left"},{key:"LollipopRight",kind:"lollipop-right"}],N="association";for(let w of k)if(d[w.key]){N=w.kind;break}let v=g,R=x;(d.RelExtends||d.RelDependencyLeft||d.RelRealizationLeft||d.LollipopLeft)&&(v=x,R=g);let b={source:v,target:R,kind:N,label:L,leftCard:T,rightCard:A};i.push(b);continue}}return{direction:o,classes:Array.from(n.values()),relations:i,notes:s}}function PX(t,e=14){let r=t.stereotype?`\xAB${t.stereotype}\xBB ${t.display}`:t.display,n=t.attributes.slice(),i=t.methods.slice(),s=Math.max(16,Math.round(e*1.1)),o=12,a=10,c=ot(r,e+1)+o*2,l=Math.max(0,...n.map(p=>ot(p,e)))+o*2,f=Math.max(0,...i.map(p=>ot(p,e)))+o*2,u=Math.max(120,c,l,f),h=(n.length?6:0)+(i.length?6:0),d=a*2+s+n.length*s+(i.length?6:0)+(n.length?6:0)+i.length*s;return{width:u,height:d,title:r,attrLines:n,methodLines:i}}function qX(t,e,r=10,n=8,i=!0){let[s,o]=i?t:[t[1],t[0]],a=o.x-s.x,c=o.y-s.y,l=Math.hypot(a,c)||1,f=a/l,u=c/l,h=-u,d=f,p={x:o.x,y:o.y},m={x:o.x-f*r,y:o.y-u*r},g={x:m.x+h*(n/2),y:m.y+d*(n/2)},x={x:m.x-h*(n/2),y:m.y-d*(n/2)};return`<path class="edge-marker" d="M${p.x},${p.y} L${g.x},${g.y} M${p.x},${p.y} L${x.x},${x.y}" stroke="${e}" fill="none" />`}function Xv(t,e,r=12,n=10,i=!0){let[s,o]=i?t:[t[1],t[0]],a=o.x-s.x,c=o.y-s.y,l=Math.hypot(a,c)||1,f=a/l,u=c/l,h=-u,d=f,p={x:o.x,y:o.y},m={x:o.x-f*r,y:o.y-u*r},g={x:m.x+h*(n/2),y:m.y+d*(n/2)},x={x:m.x-h*(n/2),y:m.y-d*(n/2)};return`<path class="edge-marker" d="${`M${p.x},${p.y} L${g.x},${g.y} L${x.x},${x.y} Z`}" fill="white" stroke="${e}" />`}function yr(t,e,r,n=10,i=!0){let[s,o]=i?t:[t[1],t[0]],a=o.x-s.x,c=o.y-s.y,l=Math.hypot(a,c)||1,f=a/l,u=c/l,h=-u,d=f,p={x:s.x,y:s.y},m={x:p.x-f*n,y:p.y-u*n},g={x:p.x+h*(n/1.4),y:p.y+d*(n/1.4)},x={x:p.x-h*(n/1.4),y:p.y-d*(n/1.4)},y={x:p.x+f*n,y:p.y+u*n},E=`M${m.x},${m.y} L${g.x},${g.y} L${y.x},${y.y} L${x.x},${x.y} Z`;return r?`<path class="edge-marker edge-marker-fill" d="${E}" fill="${e}" stroke="${e}"/>`:`<path class="edge-marker" d="${E}" fill="white" stroke="${e}"/>`}function DX(t,e,r=!1,n="#555",i=2){let s=t.map(a=>`${a.x},${a.y}`).join(" ");return`<polyline class="edge-path ${e}" points="${s}" fill="none"${r?' stroke-dasharray="4 3"':""}/>`}function Zv(t,e={}){let r=[],n={};for(let E of t.classes){let T=PX(E);n[E.id]=T,r.push({id:E.id,label:E.display,shape:"rectangle",width:T.width,height:T.height})}let i=t.relations.map((E,T)=>({id:`e${T}`,source:E.source,target:E.target,type:"open"})),s={nodes:r,edges:i,direction:t.direction},a=new Ur().layout(s),c=Math.ceil(a.width+40),l=Math.ceil(a.height+40),f=[];f.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${c}" height="${l}" viewBox="${Math.min(0,-20)} ${Math.min(0,-20)} ${c} ${l}">`);let u=pn();f.push(`<style>${u}
    .class-title { font-weight: 600; }
    .class-divider { stroke: #aaa; stroke-width: 1; }
    .class-member { font-size: 12px; }
  </style>`);for(let E of a.nodes){let T=n[E.id],A=E.x,L=E.y,k=E.width,N=E.height,v=T.title,R=T.attrLines,b=T.methodLines,w=16,C=12,I=10,P=L+I+w;f.push(`  <g transform="translate(${A},${L})">`),f.push(`    <rect class="node-shape" width="${k}" height="${N}" rx="0"/>`),f.push(`    <text class="node-label class-title" x="${k/2}" y="${I+12}" text-anchor="middle" dominant-baseline="middle">${we(v)}</text>`);let q=I+18;if(R.length){f.push(`    <line class="class-divider" x1="0" y1="${q}" x2="${k}" y2="${q}"/>`),q+=8;for(let $ of R)f.push(`    <text class="node-label class-member" x="${C}" y="${q}" dominant-baseline="hanging">${we($)}</text>`),q+=w}if(b.length){f.push(`    <line class="class-divider" x1="0" y1="${q}" x2="${k}" y2="${q}"/>`),q+=8;for(let $ of b)f.push(`    <text class="node-label class-member" x="${C}" y="${q}" dominant-baseline="hanging">${we($)}</text>`),q+=w}f.push("  </g>")}let h="#555";for(let E=0;E<a.edges.length;E++){let T=a.edges[E],A=t.relations[E],L=T.points,k=A.kind==="dependency"||A.kind==="realization";f.push(DX(L,"edge-path",k,h,2));let N=(b,w,C,I)=>{let P=w.x-b.x,q=w.y-b.y,$=Math.hypot(P,q)||1,F=P/$,J=q/$,ee=-J,ae=F,oe=-6,Ze=8,at=b.x+F*oe+ee*Ze,Ne=b.y+J*oe+ae*Ze,At=I==="start"?"end":"start";f.push(`<text class="edge-label-text" x="${at}" y="${Ne}" text-anchor="${At}">${we(C)}</text>`)};if(A.leftCard&&L.length>=2&&N(L[0],L[1],A.leftCard,"start"),A.rightCard&&L.length>=2){let b=L[L.length-1],w=L[L.length-2];N(b,w,A.rightCard,"end")}if(A.label){let b=L[Math.floor(L.length/2)],w=String(A.label).split(/\s+/),C=[],I="",P=200;for(let F of w){let J=I?I+" "+F:F;ot(J,12)<=P?I=J:(I&&C.push(I),I=F)}I&&C.push(I);let q=14,$=b.y-(C.length-1)*q/2-10;f.push(`<text class="edge-label-text" x="${b.x}" y="${$}" text-anchor="middle">`+C.map((F,J)=>`<tspan x="${b.x}" dy="${J===0?0:q}">${we(F)}</tspan>`).join("")+"</text>")}let v=[L[0],L[1]??L[0]],R=[L[L.length-2]??L[L.length-1],L[L.length-1]];switch(A.kind){case"extends":f.push(Xv(R,h,12,10,!0));break;case"realization":f.push(Xv(R,h,12,10,!0));break;case"dependency":f.push(qX(R,h,10,7,!0));break;case"aggregation":f.push(yr(v,h,!1,8,!0));break;case"composition":f.push(yr(v,h,!0,8,!0));break;case"aggregation-both":f.push(yr(v,h,!1,8,!0)),f.push(yr(R,h,!1,8,!1));break;case"composition-both":f.push(yr(v,h,!0,8,!0)),f.push(yr(R,h,!0,8,!1));break;case"aggregation-to-comp":f.push(yr(v,h,!1,8,!0)),f.push(yr(R,h,!0,8,!1));break;case"composition-to-agg":f.push(yr(v,h,!0,8,!0)),f.push(yr(R,h,!1,8,!1));break;case"lollipop-left":f.push(`<circle class="edge-marker" cx="${v[0].x}" cy="${v[0].y}" r="5" fill="white" stroke="${h}" />`);break;case"lollipop-right":f.push(`<circle class="edge-marker" cx="${R[1].x}" cy="${R[1].y}" r="5" fill="white" stroke="${h}" />`);break;case"association":default:break}}let d=140,p=44,m=20,g=Object.fromEntries(a.nodes.map(E=>[E.id,E])),x={},y=t.notes||[];for(let E of y){let T=g[E.target];if(!T)continue;let A=x[E.target]=(x[E.target]||0)+1,L=T.x+T.width+m,k=T.y+(A-1)*(p+8),N=(w,C)=>a.nodes.some(I=>!(w+d<I.x||w>I.x+I.width||C+p<I.y||C>I.y+I.height)),v=0;for(;N(L,k)&&v<50;)k+=p+6,v++;f.push(`  <g class="note" transform="translate(${L},${k})">`),f.push(`    <rect width="${d}" height="${p}" rx="0"/>`),f.push(`    <text class="note-text" x="${d/2}" y="${p/2+4}" text-anchor="middle">${we(E.text)}</text>`),f.push("  </g>");let R=T.x+T.width,b=T.y+16;f.push(`<line x1="${R}" y1="${b}" x2="${L}" y2="${k+p/2}" stroke="#999" stroke-dasharray="4 3"/>`)}return f.push("</svg>"),f.join(`
`)}var Yc=class{constructor(e,r){this.graphBuilder=new cc,this.layoutEngine=e||new Ur,this.renderer=r||new Gn}render(e,r={}){let n=[],i=r.layoutEngine||this.layoutEngine,s=r.renderer||this.renderer;try{let o=wl(e);if(o.errors&&o.errors.length>0)for(let u of o.errors)n.push({line:u.line||1,column:u.column||1,message:u.message,severity:"error",code:"LEXER_ERROR"});Dt.reset(),Dt.input=o.tokens;let a=Dt.diagram();if(Dt.errors&&Dt.errors.length>0)for(let u of Dt.errors){let h=u.token;n.push({line:h?.startLine||1,column:h?.startColumn||1,message:u.message,severity:"error",code:"PARSER_ERROR"})}let c=this.graphBuilder.build(a),l;try{l=i.layout(c)}catch(u){return n.push({line:1,column:1,message:u.message||"Layout calculation failed",severity:"error",code:"LAYOUT_ERROR"}),{svg:this.generateErrorSvg(u.message||"Layout calculation failed"),graph:c,errors:n}}let f=s.render(l);return r.showErrors&&n.length>0&&(f=this.addErrorOverlays(f,n)),{svg:f,graph:c,errors:n}}catch(o){let a=this.generateErrorSvg(o.message||"Unknown error occurred");return n.push({line:1,column:1,message:o.message||"Unknown error occurred",severity:"error",code:"RENDER_ERROR"}),{svg:a,graph:{nodes:[],edges:[],direction:"TD"},errors:n}}}renderAny(e,r={}){let n=e,i;if(e.trimStart().startsWith("---")){let a=zv(e);a&&(n=a.body,i=a.themeVariables||a.config&&a.config.themeVariables||void 0)}let s=n.trim().split(`
`)[0];if(/^(flowchart|graph)\s+/i.test(s)){let a=this.render(n,r);return{svg:i?BX(a.svg,i):a.svg,graph:a.graph,errors:a.errors}}if(/^pie\b/i.test(s))try{let{model:a,errors:c}=qv(n),l=Dv(a,{width:r.width,height:r.height,rimStroke:i?.pieStrokeColor,rimStrokeWidth:i?.pieOuterStrokeWidth});return{svg:$X(l,i),graph:{nodes:[],edges:[],direction:"TD"},errors:c}}catch(a){let c=a?.message||"Pie render error",l=[{line:1,column:1,message:c,severity:"error",code:"PIE_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:l}}if(/^sequenceDiagram\b/.test(s))try{let a=Fv(n);return{svg:Gv(a,{theme:i}),graph:{nodes:[],edges:[],direction:"TD"},errors:[]}}catch(a){let c=a?.message||"Sequence render error",l=[{line:1,column:1,message:c,severity:"error",code:"SEQUENCE_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:l}}if(/^classDiagram\b/.test(s))try{let a=Qv(n),c=Zv(a,{theme:i});return{svg:i?jo(c,i):c,graph:{nodes:[],edges:[],direction:a.direction},errors:[]}}catch(a){let c=a?.message||"Class render error",l=[{line:1,column:1,message:c,severity:"error",code:"CLASS_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:l}}if(/^stateDiagram(?:-v2)?\b/.test(s))try{let a=jv(n),c=Wv(a);return{svg:i?jo(c,i):c,graph:{nodes:[],edges:[],direction:a.direction},errors:[]}}catch(a){let c=a?.message||"State render error",l=[{line:1,column:1,message:c,severity:"error",code:"STATE_RENDER"}];return{svg:this.generateErrorSvg(c),graph:{nodes:[],edges:[],direction:"TD"},errors:l}}return{svg:this.generateErrorSvg("Unsupported diagram type. Rendering supports flowchart, pie, sequence, class, and state."),graph:{nodes:[],edges:[],direction:"TD"},errors:[{line:1,column:1,message:"Unsupported diagram type",severity:"error",code:"UNSUPPORTED_TYPE"}]}}addErrorOverlays(e,r){let n=`
    <style>
      .error-indicator {
        fill: #ff0000;
        opacity: 0.8;
      }
      .error-text {
        fill: white;
        font-family: Arial, sans-serif;
        font-size: 12px;
        font-weight: bold;
      }
    </style>`,i=`
    <g id="errors">
      <rect x="5" y="5" width="100" height="25" rx="3" class="error-indicator" />
      <text x="55" y="20" text-anchor="middle" class="error-text">${r.length} error${r.length!==1?"s":""}</text>
    </g>`;return e.replace("</svg>",`${n}${i}</svg>`)}generateErrorSvg(e){return`<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200">
  <rect width="400" height="200" fill="#fee" stroke="#c00" stroke-width="2" />
  <text x="${400/2}" y="${200/2-20}" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#c00">
    Render Error
  </text>
  <text x="${400/2}" y="${200/2+10}" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    ${this.wrapText(e,40).map((i,s)=>`<tspan x="${400/2}" dy="${s===0?0:15}">${this.escapeXml(i)}</tspan>`).join("")}
  </text>
</svg>`}wrapText(e,r){let n=e.split(" "),i=[],s="";for(let o of n)s.length+o.length+1<=r?s+=(s?" ":"")+o:(s&&i.push(s),s=o);return s&&i.push(s),i.slice(0,3)}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};function $X(t,e){if(!e)return t;let r=t;if((e.pieOuterStrokeWidth!=null||e.pieStrokeColor)&&(r=r.replace(/\.pieOuterCircle\s*\{[^}]*\}/,i=>{let s=i;return e.pieStrokeColor&&(s=s.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.pieStrokeColor)};`)),e.pieOuterStrokeWidth!=null&&(s=s.replace(/stroke-width:\s*[^;]+;/,`stroke-width: ${String(e.pieOuterStrokeWidth)};`)),s}),e.pieStrokeColor&&(r=r.replace(/\.pieCircle\s*\{[^}]*\}/,i=>i.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.pieStrokeColor)};`)))),e.pieSectionTextColor){let i=String(e.pieSectionTextColor);r=r.replace(/\.slice-label \{[^}]*\}/,s=>s.replace(/fill:\s*#[0-9A-Fa-f]{3,8}|fill:\s*rgb\([^)]*\)/,`fill: ${i}`)),r=r.replace(/<text class="slice-label"([^>]*)>/g,`<text class="slice-label"$1 fill="${i}">`)}if(e.pieTitleTextColor){let i=String(e.pieTitleTextColor);r=r.replace(/<text class="pie-title"([^>]*)>/g,`<text class="pie-title"$1 fill="${i}">`)}if(e.pieSectionTextSize){let i=String(e.pieSectionTextSize);r=r.replace(/<text class="slice-label"([^>]*)>/g,`<text class="slice-label"$1 font-size="${i}">`)}if(e.pieTitleTextSize){let i=String(e.pieTitleTextSize);r=r.replace(/<text class="pie-title"([^>]*)>/g,`<text class="pie-title"$1 font-size="${i}">`)}let n=[];for(let i=1;i<=24;i++){let s="pie"+i;e[s]&&n.push(String(e[s]))}if(n.length){let i=0;r=r.replace(/<path[^>]*class="pieCircle"[^>]*\sfill="([^"]+)"/g,s=>{let o=n[i]??null;return i++,o?s.replace(/fill="([^"]+)"/,`fill="${o}"`):s})}return r}function BX(t,e){if(!e)return t;let r=t;if((e.nodeBkg||e.nodeBorder)&&(r=r.replace(/\.node-shape\s*\{[^}]*\}/,n=>{let i=n;return e.nodeBkg&&(i=i.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeBkg)};`)),e.nodeBorder&&(i=i.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.nodeBorder)};`)),i})),e.nodeTextColor&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.nodeTextColor)};`))),e.lineColor&&(r=r.replace(/\.edge-path\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.lineColor)};`))),e.arrowheadColor&&(r=r.replace(/(<path d="M0,0 L0,[0-9.]+ L[0-9.]+,[0-9.]+ z"[^>]*)(fill="[^"]*")/g,(n,i)=>`${i}fill="${String(e.arrowheadColor)}"`),r=r.replace(/(<circle cx="4\.5" cy="4\.5" r="4\.5"[^>]*)(fill="[^"]*")/g,(n,i)=>`${i}fill="${String(e.arrowheadColor)}"`)),e.edgeLabelTextColor){let n=String(e.edgeLabelTextColor);r=r.replace(/\.edge-label-text\s*\{[^}]*\}/,i=>i.replace(/fill:\s*[^;]+;/,`fill: ${n};`))}return e.clusterBkg&&(r=r.replace(/\.cluster-bg\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterBkg)};`))),e.clusterBorder&&(r=r.replace(/\.cluster-border\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.clusterBorder)};`))),e.clusterTextColor&&(r=r.replace(/\.cluster-label-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.clusterTextColor)};`))),e.noteBkg&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteBkg)};`))),e.noteBorder&&(r=r.replace(/\.note\s*\{[^}]*\}/,n=>n.replace(/stroke:\s*[^;]+;/,`stroke: ${String(e.noteBorder)};`))),e.noteTextColor&&(r=r.replace(/\.note-text\s*\{[^}]*\}/,n=>n.replace(/fill:\s*[^;]+;/,`fill: ${String(e.noteTextColor)};`))),e.fontFamily&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/font-family:\s*[^;]+;/,`font-family: ${String(e.fontFamily)};`))),e.fontSize&&(r=r.replace(/\.node-label\s*\{[^}]*\}/,n=>n.replace(/font-size:\s*[^;]+;/,`font-size: ${String(e.fontSize)};`))),r}function Qc(t,e={}){return new Yc(e.layoutEngine,e.renderer).renderAny(t,e)}function Jv(){return{initialize(t){},async render(t,e,r){try{return{svg:Qc(e,r).svg}}catch(n){throw new Error(`Maid render failed: ${n.message||"Unknown error"}`)}},renderSync(t,e,r){try{return{svg:Qc(e,r).svg}}catch(n){throw new Error(`Maid render failed: ${n.message||"Unknown error"}`)}}}}var YEe=Jv();function eSe(t,e={}){let{strict:r=!1,level:n="safe"}=e,i=t;for(let o=0;o<5;o++){let a=lc(i,{strict:r}),c=Ef(i,a.errors,n);if(c.length===0)return{fixed:i,errors:a.errors};let l=yf(i,c);if(l===i)return{fixed:i,errors:a.errors};i=l}let s=lc(i,{strict:r});return{fixed:i,errors:s.errors}}export{Yc as MermaidRenderer,yf as applyEdits,Ef as computeFixes,Jv as createMermaidAPI,Uy as detectDiagramType,eSe as fixText,Qc as renderMermaid,lc as validate};
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
